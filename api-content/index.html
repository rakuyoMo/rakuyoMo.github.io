{"posts":[{"title":"é€šè¿‡è¦†å†™æ–¹æ³•çœ‹ Swift æ–¹æ³•æ´¾å‘","content":"åœ¨ Swift å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸åˆ©ç”¨ extension å’Œ // MARK: æ¥åˆ’åˆ†ä»£ç é€»è¾‘ï¼Œæ¯”å¦‚åˆ’åˆ†å‡º â€œConfigâ€ã€â€œLife cycleâ€ ç­‰æ¨¡å—ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨æ‰©å±•æ—¶å´å¸¸å¸¸ä¼šé‡åˆ°æ–¹æ³•è¦†å†™çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å®šä¹‰åŸºç±»çš„â€œæ¡†æ¶æ–¹æ³•â€åï¼Œå­ç±»æ— æ³•æ­£ç¡®è¦†å†™çš„é—®é¢˜ã€‚ æœ¬æ–‡å°†é€šè¿‡è¦†å†™æ–¹æ³•ï¼Œæ·±å…¥æ¢è®¨ Swift ä¸­çš„æ–¹æ³•æ´¾å‘æœºåˆ¶ï¼Œå¹¶è®¨è®ºå¦‚ä½•åœ¨ä»£ç è®¾è®¡æ—¶è§„é¿å¸¸è§å‘ç‚¹ã€‚ æœ¬æ–‡åŸºäº Swift 5 ä¸ Xcode 16.2 ç¼–å†™ã€‚ ä½•ä¸º Swift æ–¹æ³•æ´¾å‘ é¦–å…ˆï¼Œä¸ºä¸äº†è§£ â€œæ–¹æ³•æ´¾å‘â€ çš„è¯»è€…åšä¸ªç®€çŸ­çš„æ¦‚å¿µè§£é‡Šï¼š æ–¹æ³•æ´¾å‘ç®€å•åœ°è®²ï¼ŒæŒ‡çš„æ˜¯åœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå¦‚ä½•æ‰§è¡Œè¯¥æ–¹æ³•çš„æœºåˆ¶ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸º â€œå»å“ªé‡Œæ‰¾åˆ°è¯¥æ–¹æ³•çš„å®ç°â€ çš„æœºåˆ¶ã€‚ å¹¿ä¹‰ä¸Šè¯´ Swift çš„æ–¹æ³•æ´¾å‘åˆ†ä»¥ä¸‹ä¸¤ç§ï¼š æ´¾å‘ç±»å‹ å®šä¹‰ åº•å±‚æœºåˆ¶ é™æ€æ´¾å‘ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šè°ƒç”¨ç›®æ ‡ ç›´æ¥å†…è”è°ƒç”¨ï¼Œä¸å‚ä¸è™šå‡½æ•°è¡¨ åŠ¨æ€æ´¾å‘ åœ¨è¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹ç¡®å®šè°ƒç”¨ç›®æ ‡ ä¾èµ–è™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰æˆ– Objectiveâ€‘C æ¶ˆæ¯å‘é€æœºåˆ¶ æ–¹æ³•è¦†å†™ä¸æ–¹æ³•æ´¾å‘ åœ¨å¾ˆå¤šé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨åŸºç±»ä¸­å®šä¹‰ä¸€äº›â€œæ¡†æ¶æ–¹æ³•â€ï¼Œç”±å­ç±»è¦†å†™è¿™äº›æ–¹æ³•æ¥å®ç°ç»Ÿä¸€çš„ä»£ç ç»“æ„ã€‚æ¯”å¦‚ä¸‹é¢çš„ç±»å‹ï¼š open class BaseCollectionViewCell: UICollectionViewCell { override public init(frame: CGRect) { super.init(frame: frame) config() } public required init?(coder: NSCoder) { super.init(coder: coder) config() } } extension BaseCollectionViewCell { open func config() { // âš ï¸ Non-'@objc' instance method in extensions cannot be overridden; use 'public' instead addSubviews() addInitialLayout() } open func addSubviews() { } // âš ï¸ Non-'@objc' instance method in extensions cannot be overridden; use 'public' instead open func addInitialLayout() { } // âš ï¸ Non-'@objc' instance method in extensions cannot be overridden; use 'public' instead } config()ã€addSubviews() å’Œ addInitialLayout() è¢«æˆ‘ç§°ä¸º â€œæ¡†æ¶æ–¹æ³•â€ï¼Œç”¨æ¥çº¦æŸå­ç±»ï¼Œç»Ÿä¸€ç®¡ç†æŸä¸€ç±»çš„ä»£ç ã€‚ å†™å®Œæ–¹æ³•åï¼ŒXcode ç»™äº†æˆ‘ä»¬ä¸‰ä¸ªè­¦å‘Šï¼šNon-'@objc' instance method in extensions cannot be overridden; use 'public' insteadã€‚æç¤ºæˆ‘ä»¬åœ¨ extension ä¸­å®šä¹‰çš„é @objc æ–¹æ³•ä¸èƒ½è¢«è¦†å†™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨çš„ open æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå»ºè®®æˆ‘ä»¬æ¢æˆ publicã€‚ è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ Swift ä¸­çš„æ–¹æ³•è¦†å†™ æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ Swift æ–¹æ³•è¦†å†™çš„å®ç°åŸç†ï¼šåœ¨ Swift ä¸­ï¼Œæ–¹æ³•è¦†å†™æœ¬è´¨ä¸Šæ˜¯ä¾èµ– â€œåŠ¨æ€æ´¾å‘æœºåˆ¶â€ æ¥å®ç°çš„ã€‚ å¯¹äºä¸€ä¸ªçº¯ Swift ç±»è€Œè¨€ï¼Œåœ¨ç±»çš„ä¸»è¦å£°æ˜éƒ¨åˆ†å®šä¹‰çš„æ–¹æ³•ä¼šè¢«åŠ å…¥åˆ°è™šå‡½æ•°è¡¨ï¼ˆvtable tableï¼‰ä¸­ã€‚è¿™æ„å‘³ç€åœ¨è¿è¡Œæ—¶ï¼Œæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹å¯ä»¥æ‰¾åˆ°æ­£ç¡®çš„å®ç°ï¼Œä»è€Œæ”¯æŒå­ç±»è¦†å†™ã€‚ åœ¨ Swift ä¸­ï¼Œè™šå‡½æ•°è¡¨è¢«ç§°ä¸º â€œwitness tableâ€ï¼Œä¸‹æ–‡å°†ä¼šä½¿ç”¨ â€œâ€œwitnessâ€ è¿™ä¸ªå•è¯ä»£è¡¨ â€œè™šå‡½æ•°è¡¨â€ã€‚ è€Œåœ¨ extension ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œé»˜è®¤é‡‡ç”¨çš„æ˜¯ â€œé™æ€æ´¾å‘â€ï¼Œé™æ€æ´¾å‘ä¼šåœ¨ç¼–è¯‘æ—¶ç›´æ¥ç»‘å®šè°ƒç”¨ç›®æ ‡ï¼Œä¸ä¼šè¢«åŠ å…¥åˆ° witness table é‡Œï¼Œä¹Ÿä¸æš´éœ²åœ¨ Objectiveâ€‘C è¿è¡Œæ—¶ä¸­ã€‚ ä¸Šä¸€èŠ‚ä¸­æåˆ°ï¼Œå­ç±»è¦†å†™æ–¹æ³•éœ€è¦ä¾é è™šå‡½æ•°è¡¨æˆ– Objectiveâ€‘C è¿è¡Œæ—¶ï¼Œæ‰€ä»¥å®šä¹‰åœ¨ extension ä¸­çš„æ–¹æ³•æ— æ³•è¢«å­ç±»ç»§æ‰¿ã€‚ æ”¹å†™ çŸ¥é“é”™è¯¯åŸå› çš„ä½ å¯èƒ½æƒ³åˆ°äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š å¯ä»¥å°†æ–¹æ³•ç§»åŠ¨åˆ°ä¸»è¦å£°æ˜éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡è™šå‡½æ•°è¡¨å®ç°æ–¹æ³•è¦†å†™ã€‚ æˆ–è€…æŒ‰ç…§è­¦å‘Šçš„æç¤ºï¼Œæ·»åŠ  @objcï¼Œå€ŸåŠ© Objective-C è¿è¡Œæ—¶å®ç°æ–¹æ³•è¦†å†™ã€‚ æˆ‘ä»¬å…ˆé‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œçœ‹çœ‹å¦‚ä½•å®ç°ï¼š open class BaseCollectionViewCell: UICollectionViewCell { ... open func config() { ... } ... } class SubCollectionViewCell: BaseCollectionViewCell { } extension SubCollectionViewCell { override func config() { } // âŒ Non-@objc instance method 'config()' declared in 'BaseCollectionViewCell' cannot be overridden from extension } å½“æˆ‘ä»¬å°è¯•ç»§æ‰¿ BaseCollectionViewCell å»å®šä¹‰ SubCollectionViewCell æ—¶ï¼Œé—®é¢˜æ›´ä¸¥é‡äº†ï¼ŒXcode æŠ¥äº†ä¸ªé”™è¯¯ï¼š Non-@objc instance method 'config()' declared in 'BaseCollectionViewCell' cannot be overridden from extension è¿™å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ ¹æ®è™šå‡½æ•°è¡¨çš„åŸç†ï¼Œå¦‚æœçˆ¶ç±»å‡½æ•°è¢«è¦†å†™ï¼Œé‚£ä¹ˆè¡¨ä¸­åªä¼šä¿å­˜è¢«è¦†å†™ä¹‹åçš„å‡½æ•°ã€‚æ‰€ä»¥å°½ç®¡çˆ¶ç±»çš„ config() æ–¹æ³•åœ¨è™šå‡½æ•°è¡¨ä¸­ï¼Œä½†æ˜¯å­ç±»çš„æ–¹æ³•ä¸åœ¨ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å°±æ— æ³•ä½¿ç”¨å­ç±»çš„å®ç°æ›¿ä»£çˆ¶ç±»çš„å®ç°ã€‚ æ—¢ç„¶ç¬¬ä¸€æ¡è·¯èµ°ä¸é€šï¼Œé‚£ä¹ˆç¬¬äºŒæ¡è·¯å‘¢ï¼Ÿæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š open class BaseCollectionViewCell: UICollectionViewCell { ... @objc open func config() { ... } ... } class SubCollectionViewCell: BaseCollectionViewCell { } extension SubCollectionViewCell { override func config() { } // âŒ Cannot override a non-dynamic class declaration from an extension } å¾ˆå¥½ï¼ŒæŠ¥é”™å˜äº†ï¼Œè¯æ˜æœ‰æ•ˆï¼Œä½†ä¸å®Œå…¨æœ‰æ•ˆã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨ @objc å°†çˆ¶ç±»æ–¹æ³•æš´éœ²ç»™ Objective-Cï¼Œä½†æ˜¯è¿™å®é™…ä¸Šå¹¶ä¸æ„å‘³ç€æ–¹æ³•æ´¾å‘æ–¹å¼æ”¹ä¸ºäº† â€œObjective-C æ¶ˆæ¯æ´¾å‘â€ã€‚ åœ¨ Swift 3 æ—¶ä»£å­˜åœ¨ @objc çš„éšå¼æ¨æ–­ï¼Œè€Œåœ¨å‘å¸ƒ Swift 4 æ—¶å€™ï¼Œè¿™ä¸ªéšå¼æ¨æ–­è¢«å–æ¶ˆäº†ã€‚å¼€å‘è€…åœ¨ç±»çš„ä¸»è¦å£°æ˜ï¼ˆè¯·å…ˆç•™æ„è¿™ä¸€ç‚¹ï¼Œåæ–‡ä¸­è¿˜ä¼šæåŠï¼‰ä¸­ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ  dynamic å…³é”®å­—ï¼Œæ‰èƒ½å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå°†è¿™ä¸ªæ–¹æ³•æ”¹ä¸ºä½¿ç”¨ â€œObjective-C æ¶ˆæ¯æ´¾å‘â€ã€‚å¦‚æœåªæ·»åŠ  @objcï¼Œé‚£ä¹ˆæ–¹æ³•ä»…ä»…æ˜¯è¢«æš´éœ²ç»™ Objective-C è€Œå·²ï¼Œå®é™…ä¸Šè¿˜æ˜¯è¢«æ·»åŠ åˆ°è™šå‡½æ•°è¡¨ä¸­ï¼Œæœ€ç»ˆä½¿ç”¨å‡½æ•°è¡¨æ´¾å‘ã€‚ æ‰€ä»¥æ­£ç¡®çš„åšæ³•æ˜¯ä¸ºçˆ¶ç±»çš„æ–¹æ³•å®šä¹‰æ·»åŠ  dynamic å…³é”®å­—ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š open class BaseCollectionViewCell: UICollectionViewCell { ... @objc dynamic open func config() { ... } ... } class SubCollectionViewCell: BaseCollectionViewCell { } extension SubCollectionViewCell { override func config() { } // âœ… } å¥½å¥‡çš„ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€ä¸ªå°ç»†èŠ‚ï¼šä¸ºä»€ä¹ˆå­ç±»æ–¹æ³•å…‰ç§ƒç§ƒçš„ï¼Œæ—¢ä¸ç”¨æ·»åŠ  @objcï¼Œåˆä¸ç”¨æ·»åŠ  dynamicï¼Ÿ è¿™æ˜¯å› ä¸ºå°½ç®¡ Swift 4 å·²ç»å–æ¶ˆäº† @objc éšå¼æ¨æ–­ï¼Œä½†æ˜¯åœ¨ç»§æ‰¿æ—¶è¿™ä¸€æ¨æ–­è¢«ä¿ç•™äº†ä¸‹æ¥ï¼Œå‚è€ƒï¼šConstructs that (still) infer @objcã€‚æ‰€ä»¥åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œå­ç±»è‡ªåŠ¨ç»§æ‰¿äº†çˆ¶ç±»æ–¹æ³•çš„ä¿®é¥°ã€‚ extension ç‹‚äºº å¥½äº†ï¼Œç°åœ¨ä½ è·Ÿæˆ‘è¯´ä½ æ˜¯ extension çš„ç‹‚çƒ­ç²‰ä¸ï¼Œä½ æƒ³å°†çˆ¶ç±»çš„æ¡†æ¶æ–¹æ³•ä¹Ÿç§»åˆ° extension å»å®šä¹‰ï¼Œäºæ˜¯ä½ å°†ä»£ç æ”¹æˆäº†è¿™æ ·ï¼š open class BaseCollectionViewCell: UICollectionViewCell { } extension BaseCollectionViewCell { @objc // âš ï¸ å› ä¸ºä½ çš„ç²—å¿ƒï¼Œä½ é—æ¼äº† `dynamic` å…³é”®å­—ã€‚ open func config() { } } class SubCollectionViewCell: BaseCollectionViewCell { } extension SubCollectionViewCell { override func config() { } // âœ… } è®©æˆ‘ä»¬å‡è®¾ä½ æ˜¯ä¸€ä¸ªç²—å¿ƒçš„äººï¼ˆå¯¹ä¸èµ·ï¼‰ï¼Œä½ åœ¨ç§»åŠ¨ä»£ç æ—¶ä¸¢å¤±äº† config() æ–¹æ³•ä¸Šçš„ dynamic å…³é”®å­—ã€‚æ­¤æ—¶ä½ ä¼šå‘ç°ï¼Œå­ç±»ä¸­çš„ config() æ–¹æ³•å®šä¹‰æ²¡æœ‰æŠ¥é”™ï¼æ­¤æ—¶å…ˆåˆ«ç€æ€¥æ¬¢å‘¼ â€œextension ä¸‡å²ï¼â€ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆæ­¤æ—¶ä¸éœ€è¦ä½¿ç”¨ dynamicï¼Ÿ ç­”æ¡ˆæ˜¯å› ä¸ºï¼šåœ¨ extension ä¸­å®šä¹‰æ–¹æ³•å¹¶ä½¿ç”¨ @objc ä¿®é¥°æ—¶ï¼Œå°†è‡ªåŠ¨è½¬æ¢ä¸º Objective-C æ¶ˆæ¯æ´¾å‘ã€‚æ‰€ä»¥å°±ä¸éœ€è¦æ˜¾å¼æ·»åŠ  dynamic äº†ã€‚ å†æ·±å…¥æ€è€ƒä¸€ä¸‹ï¼Œâ€œåœ¨ extension ä¸­å®šä¹‰æ–¹æ³•å¹¶ä½¿ç”¨ @objc ä¿®é¥°æ—¶ï¼Œå°†è‡ªåŠ¨è½¬æ¢ä¸º Objective-C æ¶ˆæ¯æ´¾å‘â€ è¿™ä¹ˆè®¾è®¡çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘è§‰å¾—æ˜¯å› ä¸º â€œextension ä¸­çš„æ–¹æ³•æ— æ³•è¢«åŠ å…¥è™šå‡½æ•°è¡¨â€ã€‚ä½¿ç”¨ @objc ä¿®é¥°åè‚¯å®šæ— æ³•ä½¿ç”¨é™æ€æ´¾å‘ï¼Œæ‰€ä»¥æœ€ç»ˆåªèƒ½ä½¿ç”¨ Objective-C æ¶ˆæ¯æ´¾å‘äº†ã€‚ å†å†åˆ¨æ ¹é—®åº•ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ â€œextension ä¸­çš„æ–¹æ³•æ— æ³•è¢«åŠ å…¥è™šå‡½æ•°è¡¨â€ï¼Ÿæ ¹æ®æˆ‘ç›®å‰çš„çŸ¥è¯†ï¼Œè¿™æ˜¯ Swift ç¼–è¯‘å™¨åšçš„ç¡¬æ€§è§„å®šï¼Œå¹¶ä¸”ä¸ Swift çš„è®¾è®¡ç†å¿µæœ‰å…³ã€‚æœ¬æ–‡å°±ä¸å±•å¼€è®¨è®ºäº†ã€‚ çº¯ Swift ç±» ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæ‰€æœ‰çš„ç±»éƒ½æ˜¯ç»§æ‰¿è‡ª NSObjectï¼Œé‚£ä¹ˆå¦‚æœæ˜¯ä¸€ä¸ªçº¯ Swift ç±»å‘¢ï¼Ÿæ¯”å¦‚è¯´ä¸‹é¢è¿™ä¸ªç±»å‹ï¼š class Foo { func config() {} } class SubFoo: Foo { } extension SubFoo { override func config() {} // ğŸ©º è¿™é‡Œä¼šæŠ¥é”™å—ï¼ŸæŠ¥ä»€ä¹ˆé”™ï¼Ÿ } ç»“è®ºå’Œä¸Šé¢ä¸€æ ·ã€‚ä¸è®ºæ˜¯çº¯ Swift ç±»ï¼Œè¿˜æ˜¯ä¸€ä¸ªç»§æ‰¿è‡ª NSObject çš„ç±»ï¼Œåœ¨æœ¬æ–‡æ‰€è®¨è®ºçš„åœºæ™¯ä¸­è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚ æœ‰æœ‹å‹ä¼šæåˆ° Swift ä»£ç è·¨å¹³å°æ—¶çš„è¡¨ç°ï¼šæ·»åŠ äº† @objc å’Œ dynamic çš„çº¯ Swift ç±»åœ¨ Windows æˆ– Linus å¹³å°ä¸Šå¯ä»¥æ­£å¸¸ç¼–è¯‘å—ï¼Ÿç­”æ¡ˆè‚¯å®šæ˜¯å¦å®šçš„ï¼ŒObjective-C è¿è¡Œæ—¶åªå­˜åœ¨äº Apple å¹³å°ï¼Œåœ¨ä¸Šé¢ä¸¤ä¸ªå¹³å°ä¸­æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚ æ€»ç»“ é€šè¿‡æœ¬æ–‡çš„è®¨è®ºï¼Œç›¸ä¿¡ä½ å·²ç»æŒæ¡äº†å¦‚ä½•åˆ©ç”¨ extension æ­£ç¡®è¦†å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚ åœ¨å®é™…å¼€å‘ä¸­ï¼Œè™½ç„¶ Swift çš„æ–¹æ³•æ´¾å‘å¸¸è¢«è§†ä½œé¢è¯•â€œå…«è‚¡æ–‡â€èˆ¬çš„åŸºç¡€çŸ¥è¯†ï¼Œä½†æ˜¯ç†è§£è¿™äº›ç»†å¾®å·®åˆ«ä¸ä»…èƒ½å¸®åŠ©ä½ åœ¨è®¾è®¡ç±»ç»“æ„å’Œæ–¹æ³•å®šä¹‰æ—¶åšå‡ºæ›´æ˜æ™ºçš„é€‰æ‹©ï¼Œè¿˜èƒ½åœ¨ä¿è¯é«˜æ•ˆè¿è¡Œçš„åŒæ—¶ï¼Œä¸ºåç»­çš„çµæ´»æ‰©å±•æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚ é‚£ä¹ˆç•™ä¸€ä¸ªè¯¾åæ€è€ƒé¢˜ï¼š class Foo { func config() {} } class SubFoo: Foo { } extension SubFoo { @objc override func config() {} // âŒ Non-@objc instance method 'config()' declared in 'Foo' cannot be overridden from extension } ä¸Šé¢è¿™ä¸ªä»£ç ä¸­ï¼Œçˆ¶ç±»å’Œå­ç±»ä¸­çš„ config() æ–¹æ³•åˆ†åˆ«æ˜¯å“ªç§æ´¾å‘æ–¹å¼å‘¢ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„ç­”æ¡ˆã€‚ å†™åœ¨æœ€å å…¶å®æœ¬ç¯‡æ–‡ç« çš„åœºæ™¯ â€œextension çš„è®¾è®¡åˆè¡·æ˜¯ä¸ºç±»æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œè€Œéä¿®æ”¹å·²æœ‰æ–¹æ³•â€ æ˜¯ä¸ç¬¦åˆ Swift è¯­è¨€çš„è®¾è®¡åˆè¡·çš„ã€‚å®˜æ–¹æ–‡æ¡£ä¸­æ˜¯è¿™ä¹ˆè¯´çš„ï¼š Extensions can add new functionality to a type, but they canâ€™t override existing functionality. æ‰€ä»¥ä½ å¯èƒ½ä¼šåœ¨çœ‹åˆ°æ–‡ç« å¼€å¤´æ—¶å°±è¯´ï¼šâ€œæ ¹æœ¬å°±ä¸åº”è¯¥åœ¨ extension ä¸­è¦†å†™æ–¹æ³•ï¼â€ã€‚è¿™ä¹Ÿç¡®å®ï¼ŒApple å¹¶ä¸æ¨èæˆ‘ä»¬å€ŸåŠ© ObjC çš„æ–¹å¼åœ¨ extension ä¸­è¦†å†™æ–¹æ³•ã€‚ ä½†æ˜¯æ—¢ç„¶ Apple å…è®¸å¼€å‘è€…å€ŸåŠ© ObjC è¿è¡Œæ—¶çš„ç‰¹æ€§æ¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å§‘ä¸”å…è®¸å®ƒå­˜åœ¨å§ï¼Œç›¸ä¿¡ä½ æœ‰èƒ½åŠ›æŠŠæ¡ä¸€ä¸ªåº¦ï¼Œä»€ä¹ˆæ—¶å€™å¯ä»¥ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œä»€ä¹ˆæ—¶å€™åº”å°½é‡é¿å…ã€‚ ","link":"https://blog.rakuyoo.top/swift-method-dispatch-via-overriding/"},{"title":"List files by size","content":"é—® ChatGPT å†™äº†ä¸€ä¸ª shell è„šæœ¬ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æŒ‰ç…§ä»å¤§åˆ°å°ï¼Œé€’å½’åœ°è¾“å‡ºé™¤äº† .json æ–‡ä»¶å¤–çš„æ–‡ä»¶ï¼ŒåŒ…å«æ–‡ä»¶å¤§å°å’Œæ–‡ä»¶åã€‚å¯ç”¨äºè¾…åŠ©ç­›æŸ¥é¡¹ç›®ä¸­å“ªäº›å›¾ç‰‡è¿‡å¤§ã€‚ å•ç‹¬è„šæœ¬æ–‡ä»¶å°±ä¸å­˜åˆ° GitHub ä¸Šäº†ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹å§ã€‚ #!/bin/bash # å®šä¹‰ä¸€ä¸ªå‡½æ•°å°†å­—èŠ‚å¤§å°è½¬ä¸ºäººç±»å¯è¯»æ ¼å¼ human_readable_size() { num=$1 # echo &quot;Converting size: $num bytes&quot; # Log: è½¬æ¢å­—èŠ‚å¤§å° if [ &quot;$num&quot; -lt 1024 ]; then echo &quot;${num}B&quot; elif [ &quot;$num&quot; -lt 1048576 ]; then echo &quot;$((num / 1024))K&quot; elif [ &quot;$num&quot; -lt 1073741824 ]; then echo &quot;$((num / 1048576))M&quot; else echo &quot;$((num / 1073741824))G&quot; fi } # ä¸´æ—¶æ–‡ä»¶å­˜å‚¨æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ temp_file=$(mktemp) # echo &quot;Temporary file created: $temp_file&quot; # Log: ä¸´æ—¶æ–‡ä»¶åˆ›å»º # ä½¿ç”¨ find æŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶ï¼Œæ’é™¤ .json æ–‡ä»¶ find . -type f ! -name &quot;*.json&quot; -print0 | while IFS= read -r -d '' file; do # è·å–æ–‡ä»¶å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼ŒmacOS ä½¿ç”¨ stat -f%zï¼‰ size=$(stat -f%z &quot;$file&quot;) # echo &quot;File: $file, Size: $size bytes&quot; # Log: æ–‡ä»¶å’Œå¤§å° # è¾“å‡ºå­—èŠ‚å¤§å°å’Œæ–‡ä»¶è·¯å¾„åˆ°ä¸´æ—¶æ–‡ä»¶ echo &quot;$size $file&quot; &gt;&gt; &quot;$temp_file&quot; done # Log: æ’åºä¹‹å‰çš„ä¸´æ—¶æ–‡ä»¶å†…å®¹ # echo &quot;Contents of temp file before sorting:&quot; # cat &quot;$temp_file&quot; # æŒ‰å­—èŠ‚æ•°é™åºæ’åºï¼Œå¹¶è¾“å‡ºæ ¼å¼åŒ–ç»“æœ sort -k1,1nr &quot;$temp_file&quot; | while read -r size file; do # echo &quot;Processing sorted file: $file, Size: $size bytes&quot; # Log: å¤„ç†æ’åºåçš„æ–‡ä»¶ # è·å–äººç±»å¯è¯»æ ¼å¼ readable_size=$(human_readable_size &quot;$size&quot;) # ä½¿ç”¨ printf æ¥ç¡®ä¿è¾“å‡ºæ ¼å¼å¯¹é½ printf &quot;%-10s %-10s %s\\n&quot; &quot;$readable_size&quot; &quot;$size&quot; &quot;$file&quot; done # åˆ é™¤ä¸´æ—¶æ–‡ä»¶ # echo &quot;Deleting temporary file: $temp_file&quot; # Log: åˆ é™¤ä¸´æ—¶æ–‡ä»¶ rm &quot;$temp_file&quot; ","link":"https://blog.rakuyoo.top/list_files_by_size/"},{"title":"String Catalog å®è·µ","content":"æœ€è¿‘é¡¹ç›®æœ‰äº†å›½é™…åŒ–ï¼ˆi18nï¼‰çš„éœ€æ±‚ï¼Œæ­£å¥½ WWDC23 ä¸Š Apple æ¨å‡ºäº† String Catalog åŠŸèƒ½ã€‚è¶æ­¤æœºä¼šå°è¯•ä¸€ä¸‹ï¼Œå¹¶å°†ä¸€äº›ç»éªŒè®°å½•ä¸‹æ¥ã€‚ å¦‚æœä½ å¯¹ String Catalog ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯ä»¥å…ˆå‚è€ƒ è€å¸æœºæŠ€æœ¯ WWDC 23 å†…å‚ï¼Œæˆ–è€…ç›´æ¥è§‚çœ‹ WWDC çš„ å®˜æ–¹è§†é¢‘ å’Œ æ–‡æ¡£ æ¥äº†è§£æ›´å¤šã€‚ å¥½äº†åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å§‹ä»Šå¤©çš„å†…å®¹ã€‚ å¼€å‘ç¯å¢ƒ Xcodeï¼š16.2 Swiftï¼š5.9 æ¡†æ¶ï¼šUIKit æœ€ä½æ”¯æŒç‰ˆæœ¬ï¼šiOS 13 ç»„ä»¶åŒ–å·¥å…·ï¼šCocoaPods Xcode 15 åŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ String Catalogï¼Œç‰ˆæœ¬å¯¹åŠŸèƒ½æ— ç‰¹åˆ«é™åˆ¶ã€‚ ä½†ç”±äºé¡¹ç›®æœ€ä½æ”¯æŒç‰ˆæœ¬ä¸º iOS 13ï¼Œè€Œ String(localized:) æ˜¯ iOS 15 å¼•å…¥çš„ APIï¼Œå› æ­¤éœ€è¦é¢å¤–å¤„ç†ä½ç‰ˆæœ¬å…¼å®¹çš„é—®é¢˜ã€‚ æ­¤å¤–ï¼Œå…³äº String Catalog åœ¨ CocoaPods ç»„ä»¶åŒ–é¡¹ç›®ä¸­çš„ä½¿ç”¨ï¼Œç›¸å…³èµ„æ–™è¾ƒå°‘ï¼Œå› æ­¤è¿™éƒ¨åˆ†å†…å®¹éœ€è¦å®é™…æ‘¸ç´¢ä¸€ä¸‹ã€‚ é¡¹ç›®å‡†å¤‡å·¥ä½œ é¦–å…ˆï¼Œåœ¨é¡¹ç›®çš„ PROJECT è®¾ç½®ä¸­æ·»åŠ éœ€è¦æ”¯æŒçš„è¯­è¨€ï¼š æ¥ç€å¯ä»¥ï¼ˆå¯é€‰ï¼‰è°ƒæ•´ Scheme çš„æ¨¡æ‹Ÿå™¨è®¾ç½®ï¼Œå°†è¯­è¨€å’Œåœ°åŒºè®¾ç½®ä¸ºå¾…æµ‹è¯•çš„ç¯å¢ƒï¼š ä¾‹å¦‚å°†è¯­è¨€è®¾ç½®ä¸ºè‹±è¯­ã€åœ°åŒºä¸ºç¾å›½ã€‚æ­¤æ“ä½œä¾¿äºéªŒè¯ç¿»è¯‘æ•ˆæœï¼Œä½†åœ°åŒºè®¾ç½®é€šå¸¸ä¸ä¼šå½±å“æ–‡æ¡ˆå±•ç¤ºã€‚ String Catalog + CocoaPods åœ¨ä¸»é¡¹ç›®ä¸­ä½¿ç”¨ String Catalog å¯ä»¥ç®—ä½œåœ¨ CocoaPods ä¸­ä½¿ç”¨çš„ä¸€ä¸ªå­é›†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è®²è§£å¦‚ä½•åœ¨ CocoaPods ä¸­ä½¿ç”¨ String Catalogã€‚ æ–°å»ºæ–‡ä»¶ é€šè¿‡ Command+N æ–°å»º String Catalog æ–‡ä»¶ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š æç¤ºï¼š æ–‡ä»¶é‡Œæ˜¾ç¤ºçš„è¯­è¨€ï¼Œæ˜¯æ ¹æ®æ‰€å± .xcodeproj è®¾ç½®é‡Œæ·»åŠ çš„è¯­è¨€è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ Pods.xcodeproj é»˜è®¤åŒ…å«å¤šç§è¯­è¨€ï¼Œæ‰€ä»¥ Pods ä¸­çš„ .xcstrings æ–‡ä»¶æ‰ä¼šæ˜¾ç¤ºè¿™ä¹ˆå¤šçš„è¯­ç§ã€‚ ä½†è¿™ä¸ä¼šå½±å“æœ€ç»ˆçš„ Appã€‚é‰´äºæˆ‘ä»¬å¹³æ—¶åœ¨ä½¿ç”¨æ—¶ï¼Œä¸ä¼šå°† Pods.xcodeproj æäº¤åˆ° gitï¼ŒåŒæ—¶ App çš„å¤šè¯­è¨€è®¾ç½®ä¸å— Pods çš„å½±å“ï¼Œæ‰€ä»¥ä½œä¸ºå¼€å‘è€…ä½ å®Œå…¨å¯ä»¥æ— è§†è¿™ä¸€ç‚¹ï¼Œåªä» String Catalog æŒ‘é€‰ä½ å…³æ³¨çš„è¯­ç§å³å¯ã€‚ è¿™é‡Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œå« HomeLocalizable.xcstringsï¼Œå¹¶åŠ äº†ä¸¤ä¸ªæ–‡æ¡ˆã€‚ ä¿®æ”¹ Podspec æ–‡ä»¶ æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ podspecï¼ŒæŠŠ .xcstrings æ–‡ä»¶åŠ åˆ°èµ„æºæ–‡ä»¶ä¸­ã€‚ è¯´åˆ°è¿™é‡Œï¼Œèªæ˜çš„ä½ è‚¯å®šå¯ä»¥ç›´æ¥çŒœåˆ°ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ä»¿ç…§ .xcassets ç±»å‹çš„æ–‡ä»¶ï¼Œç›´æ¥å°† .xcstrings æ–‡ä»¶æ”¾åˆ° resource_bundle çš„è‡ªå®šä¹‰ Bundle ä¸­ã€‚æ²¡é”™ï¼Œç¡®å®æ˜¯è¿™æ ·ï¼š s.resource_bundle = { 'HomeBundle' =&gt; [ 'Sources/Resource/**/*.xcstrings', 'Sources/Resource/**/*.xcassets', ] } æ³¨æ„ï¼š å¦‚æœåªå°† .xcstrings æ”¾å…¥ Bundle ä¸­çš„è¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¯¦è§ Pod ä¸ String Catalog è‡ªåŠ¨åŒ– è¿™ä¸€å°èŠ‚ã€‚ ç„¶åæ‰§è¡Œ pod installï¼Œè¿™æ · .xcstrings æ–‡ä»¶å°±ä¼šè¢«åŒ…å«åˆ° HomeBundle é‡Œäº†ã€‚ æ·»åŠ æ–°çš„æ–‡è¨€ é€‰æ‹©æˆ‘ä»¬çš„é»˜è®¤è¯­ç§ï¼Œç‚¹å‡»åŠ å·å³å¯æ·»åŠ æ–°çš„æ–‡è¨€ã€‚æ­¤ååŒæ ·çš„æ“ä½œåœ¨éœ€è¦ç¿»è¯‘çš„è¯­ç§ä¸­ï¼Œè®¾ç½®å¯¹åº”æ–‡è¨€çš„ç¿»è¯‘å†…å®¹å³å¯ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤è¯­ç§ä¸­æ–‡è¨€çš„çŠ¶æ€ï¼ˆStateï¼‰é»˜è®¤æ˜¯ä¸å±•ç¤ºï¼Œå³ Reviewed å·²å®¡æ ¸è¿‡çš„ï¼Œå’Œå…¶ä»–è¯­ç§ä¸­çš„ç»¿è‰²å¯¹å‹¾æ˜¯ä¸€æ ·çš„ã€‚è€Œå½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡è¨€åï¼Œå…¶ä»–è¯­ç§ä¸­æ–‡è¨€çš„çŠ¶æ€åˆ™æ˜¯NEWã€‚ æˆ‘å®é™…æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬å‘ NEW çŠ¶æ€çš„æ–‡è¨€æ·»åŠ å¯¹åº”çš„ç¿»è¯‘ï¼Œæˆ–è€…ä¿®æ”¹äº† NEEDS REVIEW çŠ¶æ€çš„æ–‡è¨€æ‰€å¯¹åº”çš„ç¿»è¯‘åï¼Œè¯¥æ¡æ–‡è¨€çš„çŠ¶æ€å°†è‡ªåŠ¨å˜ä¸º Reviewedã€‚ å¦å¤–ï¼Œå°±ç®—æ–‡è¨€å¤„äº NEEDS REVIEW çŠ¶æ€ï¼Œåªè¦åŒ…å«äº†å¯¹åº”çš„ç¿»è¯‘ï¼Œé‚£ä¹ˆè¯¥ç¿»è¯‘ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸æ˜¾ç¤ºçš„ã€‚ä¸è¿‡ä»å­—é¢ä¸Šæ¥çœ‹è¿™ä¸€è¡Œä¸ºæœ‰äº›å±é™©ï¼Œç¨³å¦¥èµ·è§å»ºè®®å¼€å‘è€…ç¡®ä¿æ‰€æœ‰æ–‡è¨€æ— è¯¯åï¼Œå°†å…¶æ ‡è®°ä¸º Reviewed åå†ä½¿ç”¨ã€‚ å±•ç¤ºå›½é™…åŒ–æ–‡æœ¬ è¿™ä¸€èŠ‚æˆ‘ä»¬å°±è¦æåˆ° String(localized:) çš„é—®é¢˜äº†ã€‚ç½‘ä¸Šå¤§éƒ¨åˆ†ä»‹ç» String Catalog çš„æ–‡ç« éƒ½ä¼šä½¿ç”¨ String(localized: ) è¿™ä¸€ä¸ªæ–°çš„ apiï¼Œç„¶è€Œå½“æˆ‘å®é™…ä½¿æ—¶æ‰å‘ç°ï¼Œå®ƒä»…é™äº iOS 15 + çš„ç‰ˆæœ¬ã€‚é‚£ä¹ˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨è€çš„ NSLocalizedString æ–¹æ³•ã€‚ let text = NSLocalizedString( &quot;æ‰«ç æˆ–é•¿æŒ‰å°ç¨‹åºç &quot;, tableName: &quot;HomeLocalizable&quot;, bundle: BundleToken.bundle, comment: &quot;&quot; ) private final class BundleToken { static let bundle: Bundle = { #if SWIFT_PACKAGE return Bundle.module #else guard let resourcePath = Bundle(for: BundleToken.self).resourcePath, let bundle = Bundle(path: resourcePath + &quot;/HomeBundle.bundle&quot;) // â¬…ï¸ Watch this. else { fatalError(&quot;Bundle not found, please make sure the Bundle name is correct!&quot;) } return bundle #endif }() } tableName æ˜¯ .xcstrings æ–‡ä»¶åï¼Œbundle æ˜¯åœ¨ podspec é‡Œå®šä¹‰çš„ HomeBundleã€‚ è¿™é‡Œçš„ BundleToken å‚è€ƒäº† SwiftGen çš„å®ç°ï¼Œåšäº†ä¸€äº›é€‚é… CocoaPods çš„æ”¹åŠ¨ï¼šå¢åŠ  HomeBundleã€‚ å¦‚æœä½ å¥½å¥‡ä¸ºä»€ä¹ˆä½¿ç”¨è€çš„ NSLocalizedString api ä¹Ÿå¯ä»¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆ build ç¼–è¯‘ä¸€ä¸‹é¡¹ç›®ï¼Œç„¶ååœ¨ Products ç›®å½•æ‰¾åˆ°ç¼–è¯‘å¥½äº†ä¹‹åçš„åº”ç”¨ï¼Œæœ€åæ‰¾åˆ° HomeBundle.bundleã€‚ æ­¤æ—¶ä½ å°±ä¼šå‘ç°ï¼Œ.xcstrings è™½ç„¶ä¸åƒæ˜¯ .bundle ä¸€æ ·æ˜¯ä¸€ä¸ª â€œåŒ…â€ï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼Œå®ƒä¼šè¢«ç¼–è¯‘ä¸ºå’Œ .xcstrings åŒåçš„ .strings æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨ NSLocalizedString api æ¥è¯»å–ç›¸å…³è®¾ç½®ï¼Œè¿™ç‚¹åœ¨ WWDC çš„è§†é¢‘ä¸­ä¹Ÿæœ‰ç›¸å…³è¯´æ˜ï¼š SwiftGen æˆªæ­¢æ–‡ç« æ›´æ–°ï¼ˆ2025.1.14ï¼‰ï¼ŒSwiftGen æœ€æ–°ç‰ˆä¸º 6.6.3ï¼Œå°šæœªæ­£å¼æ”¯æŒ String Catalogã€‚ï¼ˆSwiftGen ç›®å‰å¥½åƒè¿›å…¥åœæ›´çš„çŠ¶æ€ï¼‰ ä¸è¿‡æœ‰ä¸€ä¸ªç›¸å…³çš„ prï¼šXcode 15 String catalog support #1124ã€‚ è¿™ä¸ª pr å¯¹ .xcstring æ–‡ä»¶è¿›è¡Œè§£æï¼Œè§£æåç”Ÿæˆçš„å†…å®¹å’Œè€ç‰ˆæœ¬ .string è§£æåç”Ÿæˆçš„å†…å®¹ç±»ä¼¼ã€‚ é¡ºå¸¦ä¸€æï¼Œè¿™ä¼¼ä¹ä¹Ÿå½±å“åˆ°äº† Tuist å¯¹äº String Catalog çš„æ”¯æŒã€‚ ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨æˆ‘ fork çš„è¿™ä¸ªç‰ˆæœ¬ï¼š6.6.4-alpha.0ã€‚é€šè¿‡ mise å®‰è£…æ—¶ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ ¼å¼ä¿®æ”¹ mise.toml æ–‡ä»¶ï¼š [tools] &quot;ubi:rakuyoMo/SwiftGen&quot; = { version = &quot;6.6.4-alpha.0&quot;, matching = &quot;swiftgen-6.6.4-alpha.0-macos.zip&quot;, exe = &quot;swiftgen&quot; } å¦‚æœä½ ä¸æƒ³åˆ†å‰è‡ªç¼–è¯‘ SwiftGen å¯ä»¥è€ƒè™‘å°è¯•ä¸€ä¸ªåä¸º xcstrings-tool çš„æ–°å·¥å…·ï¼ŒSwift å¼€å‘ï¼Œä¸æ”¯æŒ brewï¼Œä½†æ˜¯æ”¯æŒé€šè¿‡ mise å®‰è£… cli å•ç‹¬ä½¿ç”¨ï¼Œè¯¦è§æ–‡æ¡£ ä¸€äº›æ³¨æ„ å› ä¸ºè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ€»ç»“ i18n ç›¸å…³çš„å†…å®¹ï¼Œæ‰€ä»¥ä¹Ÿé¡ºå¸¦è®°å½•ä¸€äº›é—®é¢˜æˆ–è€…æ³¨æ„äº‹é¡¹ã€‚å¯èƒ½æ¯”è¾ƒå¸¸è§ï¼Œæ¯”è¾ƒåŸºç¡€ã€‚ æ¢è¡Œç¬¦ å¦‚æœåœ¨ .xcstrings æ–‡ä»¶ä¸­ç›´æ¥è¾“å…¥ \\n ä»£è¡¨æ¢è¡Œï¼Œåœ¨å®é™…å±•ç¤ºæ—¶æ˜¯èµ·ä¸åˆ°æ¢è¡Œçš„æ•ˆæœï¼Œè€Œæ˜¯ä¼šå°† \\n å±•ç¤ºå‡ºæ¥ã€‚ä» json æ–‡ä»¶æˆ–Git ä¸­æŸ¥çœ‹ä¼šå‘ç°ï¼Œå®é™…å†…å®¹æ˜¯ \\\\nï¼Œå³è½¬ä¹‰è¿‡åçš„å†…å®¹ã€‚ æ­£ç¡®çš„æ–¹å¼æ˜¯ä½¿ç”¨ option + return ç»„åˆé”®åœ¨ .xcstrings æ–‡ä»¶ä¸­è¾“å…¥æ¢è¡Œã€‚æˆ–è€…ä¸å«Œéº»çƒ¦çš„è¯å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ json æ–‡ä»¶ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ã€‚ nslocalizedstring_key SwiftLint ä¸­åŒ…å«ç€ä¸€æ¡åä¸º nslocalizedstring_key çš„è§„åˆ™ï¼Œæ–‡æ¡£åœ¨è¿™é‡Œã€‚ å®ƒå»ºè®®ä¸è¦åŠ¨æ€ä¼ å…¥ keyï¼Œæ¯”å¦‚è¿™æ ·æ˜¯ä¸æ¨èçš„ï¼š // ä¸æ¨è let key = &quot;example_key&quot; let text = NSLocalizedString(key, comment: &quot;&quot;) Pod ä¸ String Catalog è‡ªåŠ¨åŒ– åœ¨ Xcode 15 ä¸­ï¼Œå¦‚æœè®¾ç½®äº† Use Compiler to Extract Swift Strings ä¸º YESï¼Œé‚£ä¹ˆ String Catalog æ–‡ä»¶å°±å¯ä»¥è‡ªåŠ¨è¿½è¸ªå›½é™…åŒ–æ–‡æœ¬ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå­—ç¬¦ä¸²ï¼š let test = NSLocalizedString(&quot;Test&quot;, tableName: &quot;TestLocalizable&quot;, comment: &quot;Test&quot;) ç¼–è¯‘åä¼šæœ‰ä¸€ä¸ª â€œSyncing Localizationsâ€ çš„é˜¶æ®µï¼Œåœ¨è¯¥é˜¶æ®µè¿™ä¸ªå­—ç¬¦ä¸²ä¼šè¢«è‡ªåŠ¨è®°å½•åˆ° TestLocalizable.xcstrings æ–‡ä»¶ä¸­ã€‚ ä½†æ˜¯åœ¨ pod ç»„ä»¶åŒ–é¡¹ç›®ä¸­ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²åœ¨æŸä¸ª pod å†…ï¼Œåˆ™è‡ªåŠ¨è¿½è¸ªä¸ä¼šç”Ÿæ•ˆã€‚åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š â€œSyncing Localizationsâ€ é˜¶æ®µä»…ä¼šæ‰«æå½“å‰ Scheme æ‰€åŒ…å«çš„ targetã€‚ä¸€èˆ¬æˆ‘ä»¬ç¼–è¯‘æ—¶éƒ½ä¼šé€‰æ‹©ä¸»é¡¹ç›®ï¼Œæ­¤æ—¶æ˜¯ä¸åŒ…å« pod target çš„ï¼Œæ‰€ä»¥ä¸ä¼šæ‰«æç›¸åº”çš„ä»£ç ã€‚ Pod çš„ Use Compiler to Extract Swift Strings è®¾ç½®é¡¹é»˜è®¤ä¸º NOï¼Œéœ€è¦åœ¨ Podfile ä¸­ä½¿ç”¨é’©å­æ‰‹åŠ¨å¼€å¯ï¼ˆKey ä¸º SWIFT_EMIT_LOC_STRINGSï¼‰ã€‚ å‰æ–‡ä¸­ï¼Œ.xcstrings è¢«æ·»åŠ åˆ° Bundle ä¸­ï¼Œè¿™æ„å‘³ç€å®ƒä¼šè¢«å½’å…¥ Bundle è¿™ä¸ª targetï¼Œæ¯”å¦‚ Pod åä¸º Homeï¼Œé‚£ä¹ˆ .xcstrings æ–‡ä»¶å°±åœ¨ Home-HomeBundle è¿™ä¸ª target ä¸­ã€‚è€Œé¡¹ç›®ä»£ç åˆ™åœ¨ Home è¿™ä¸ª target é‡Œã€‚æ­¤æ—¶ç¼–è¯‘ Homeï¼Œå› ä¸ºè¯¥ target å®é™…ä¸åŒ…å« .xcstringsï¼Œæ‰€ä»¥å­—ç¬¦ä¸²ä¹Ÿä¸ä¼šåŒæ­¥åˆ° .xcstrings æ–‡ä»¶ä¸­ã€‚ ç»¼ä¸Šï¼Œè€ƒè™‘åˆ° CocoaPods å·²ç»åœæ­¢å¢åŠ æ–°åŠŸèƒ½ï¼Œå»ºè®®è¿˜æ˜¯å°½å¿«è¿ç§»åˆ° SPMã€‚ ","link":"https://blog.rakuyoo.top/string-catalog/"},{"title":"HarmonyOS ä¸ ArkTS å¼€å‘æ³¨æ„äº‹é¡¹","content":"æœ¬æ–‡æŒç»­è®°å½•ä¸€äº›ä½¿ç”¨ ArkTS è¿›è¡Œ HarmonyOS å¼€å‘æ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆã€‚ä»¥åŠä¸€äº›å¯èƒ½ç§°ä¸ä¸Šæ˜¯é—®é¢˜ï¼Œä½†æ˜¯åœ¨æˆ‘çœ‹æ¥æœ‰å¿…è¦è®°å½•ä¸€ä¸‹çš„ç‚¹ã€‚ æœ¬æ–‡çš„ä¸»è¦ç»“æ„å°†åˆ†ä¸º ArkTS å’Œ HarmonyOS ä¸¤éƒ¨åˆ†ã€‚åŒæ—¶å†…å®¹å¤šä¸ iOS å¼€å‘ä»¥åŠ Swift è¯­è¨€è¿›è¡Œå¯¹æ¯”ã€‚ å› ä¸ºä»£ç é«˜äº®é™åˆ¶ï¼Œæœ¬æ–‡ä¸­æ¶‰åŠåˆ° ArkTS çš„ä»£ç ï¼Œéƒ½å°†ä½¿ç”¨ TypeScript çš„è¯­æ³•é«˜äº®è®¾ç½® ArkTS ArkTS æ˜¯ TS çš„è¶…é›†ï¼ŒåŒæ—¶ä¹Ÿé˜‰å‰²äº†ä¸€äº› TS çš„ç”¨æ³•ã€‚ æœ¬èŠ‚æ‰€è®°å½•çš„å†…å®¹æ˜¯ä»ä¸€ä¸ª TS é›¶åŸºç¡€å°ç™½çš„è§†è§’å‡ºå‘æ‰€é‡åˆ°çš„é—®é¢˜ã€‚æ‰€ä»¥æŸäº›å†…å®¹æœªå¿…å±äº ArkTS å¼•å…¥ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ TS å°±å­˜åœ¨ã€‚æŸäº›å°èŠ‚å¯èƒ½ä¼šæŒ‡å‡ºè¯¥å°èŠ‚çš„å†…å®¹æ˜¯å±äº ArkTS ç‹¬æœ‰ï¼Œè¿˜æ˜¯ TS å°±æœ‰ã€‚ä½†æ˜¯å¤§å¤šæ•°å°èŠ‚å¯èƒ½å¹¶ä¸ä¼šåšæ­¤åŒºåˆ†ã€‚ async ä¸ await ArkTS çš„å¼‚æ­¥åç¨‹ä¸åƒæ˜¯ Swift é‚£æ ·ï¼Œéœ€è¦åœ¨æ–¹æ³•å£°æ˜ä¸Šæ˜¾å¼å¢åŠ  async å…³é”®å­—ã€‚ åªè¦æ–¹æ³•è¿”å› Promise ç±»å‹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨æ—¶å€™å°±å¯ä»¥é€šè¿‡æ·»åŠ  await å…³é”®å­—ï¼Œæ¥è·å– Promise é‡Œæ‰€åŒ…å«çš„æ•°æ®ã€‚ æ¯”å¦‚ä¸‹é¢çš„æ–¹æ³•ï¼š function getData(): Promise&lt;string&gt; { return new Promise((resolve, reject) =&gt; { setTimeout(() =&gt; { resolve(&quot;Data fetched!&quot;); }, 1000); }); } function main() { const result = await getData(); // å¯ä»¥ä½¿ç”¨ await console.log(result); // è¾“å‡º: &quot;Data fetched!&quot; } è¿™å…¶å®æ˜¯ TS çš„è¯­æ³•ã€‚å½“ä½ åœ¨ TypeScript ä¸­å£°æ˜ä¸€ä¸ªå‡½æ•°ä¸º async æ—¶ï¼Œè¯¥å‡½æ•°ä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›ç»“æœã€‚å³ä½¿å‡½æ•°å†…éƒ¨æ²¡æœ‰æ˜¾å¼åœ°è¿”å› Promiseï¼Œasync å‡½æ•°ä¼šå°†å…¶ç»“æœå°è£…åœ¨ä¸€ä¸ª Promise ä¸­ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š async function myAsyncFunction() { return &quot;Hello, Async!&quot;; } // è°ƒç”¨æ–¹å¼ myAsyncFunction().then(result =&gt; console.log(result)); // è¾“å‡º: &quot;Hello, Async!&quot; myAsyncFunction å› ä¸ºè¢« async ä¿®é¥°ï¼Œæ‰€ä»¥è‡ªåŠ¨è¿”å›äº†ä¸€ä¸ª Promise&lt;string&gt; è€Œä¸æ˜¯å•çº¯çš„ stringã€‚ æ‰€ä»¥å¦‚æœæ–¹æ³•æ²¡æœ‰æ ‡è®° asyncï¼Œä½†æ˜¯è¿”å›äº† Promiseï¼Œå…¶å®å’Œæ ‡è®°äº†ä½†æ˜¯çœç•¥è¿”å›ç±»å‹æ˜¯ä¸€æ ·çš„ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥åœ¨è°ƒæ—¶ç›´æ¥ä½¿ç”¨ await åŒæ­¥è·å–å†…å®¹äº†ã€‚ HarmonyOS ç¯å¢ƒå˜é‡é…ç½® è¿™é‡Œè¯´çš„ç¯å¢ƒå˜é‡æ˜¯ â€œæ­£å¼ç¯å¢ƒâ€ã€â€œé¢„ä¸Šçº¿ç¯å¢ƒâ€ ä»¥åŠ â€œæµ‹è¯•ç¯å¢ƒâ€ã€‚åŒ…å«æ¥å£ç¯å¢ƒé…ç½®ä»¥åŠä¸€äº› debug å…¥å£ç­‰ç­‰ã€‚ åœ¨ iOS å¼€å‘ä¸­æˆ‘ä»¬æœ‰é¢„ç¼–è¯‘å®ï¼Œä½†æ˜¯ HarmonyOS è¿™å—å„¿æ²¡æœ‰è¿™ä¸ªã€‚HarmonyOS çš„æ–¹æ³•æ˜¯åœ¨å„ä¸ªå­æ¨¡å—ä¸­å»ºç«‹ target çš„ sourceRoots å­—æ®µï¼Œå°†ä¸åŒç¯å¢ƒçš„ä»£ç æ·»åŠ åˆ°ä¸åŒçš„ target ä¸­ï¼Œç„¶å entry å†å¼•ç”¨ä¸åŒçš„ targetï¼Œä»¥æ­¤æ¥è¾¾åˆ°ä¸åŒç¯å¢ƒåŠ è½½ä¸åŒä»£ç çš„éœ€æ±‚ã€‚ æœ¬èŠ‚ä¸è¯¦ç»†å±•å¼€å…·ä½“çš„è¯¦ç»†å†…å®¹ï¼Œè¯¦ç»†å†…å®¹è§å®˜æ–¹æ–‡æ¡£ã€‚ åœ¨åšè¿™ä¸€é¡¹é…ç½®çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¦‚å¿µå¾ˆå®¹æ˜“æé”™ï¼Œæˆ–è€…è¯´å®˜æ–¹æ–‡æ¡£çš„è®²è§£æµç¨‹å’Œå®é™…ä¸Šé…ç½®çš„æµç¨‹æœ‰ä¸€å®šçš„å‡ºå…¥ã€‚ï¼ˆå½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘ä¸ªäººèƒ½åŠ›ä¸è¶³å¯¼è‡´ç†è§£é”™è¯¯ï¼‰ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹é¢å‡ ä¸ª build-profile.json5 æ–‡ä»¶ã€‚é¦–å…ˆæ˜¯ä¸€ä¸ª feature module çš„ï¼š // feature/build-profile.json5 { &quot;apiType&quot;: &quot;stageMode&quot;, &quot;buildOption&quot;: {}, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;source&quot;: { &quot;sourceRoots&quot;: [&quot;./src/default&quot;] // é…ç½®targetä¸ºdefaultçš„å·®å¼‚åŒ–ä»£ç ç©ºé—´ } }, { &quot;name&quot;: &quot;custom&quot;, &quot;source&quot;: { &quot;sourceRoots&quot;: [&quot;./src/custom&quot;] // é…ç½®targetä¸ºcustomçš„å·®å¼‚åŒ–ä»£ç ç©ºé—´ } } ] } å…¶åŒ…å«ä¸¤ä¸ª targetï¼Œä½¿ç”¨ sourceRoots å¼•ç”¨äº†ä¸åŒçš„ä»£ç ã€‚ ç„¶åå†çœ‹ entry çš„ï¼š { &quot;apiType&quot;: &quot;stageMode&quot;, &quot;buildOption&quot;: {}, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, }, ] } entry åªåŒ…å«ä¸€ä¸ª default targetã€‚ æœ€åçœ‹å·¥ç¨‹çš„ï¼š { &quot;app&quot;: { &quot;signingConfigs&quot;: [], &quot;products&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;signingConfig&quot;: &quot;default&quot;, &quot;compatibleSdkVersion&quot;: &quot;5.0.0(12)&quot;, &quot;runtimeOS&quot;: &quot;HarmonyOS&quot;, }, { &quot;name&quot;: &quot;custom&quot;, &quot;signingConfig&quot;: &quot;default&quot;, &quot;compatibleSdkVersion&quot;: &quot;5.0.0(12)&quot;, &quot;runtimeOS&quot;: &quot;HarmonyOS&quot;, } ], &quot;buildModeSet&quot;: [ { &quot;name&quot;: &quot;debug&quot;, }, { &quot;name&quot;: &quot;release&quot; } ] }, &quot;modules&quot;: [ { &quot;name&quot;: &quot;entry&quot;, &quot;srcPath&quot;: &quot;./entry&quot;, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;applyToProducts&quot;: [ &quot;default&quot;, &quot;custom&quot;, ] }, ] }, { &quot;name&quot;: &quot;feature&quot;, &quot;srcPath&quot;: &quot;./feature&quot;, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;applyToProducts&quot;: [ &quot;default&quot; ] }, { &quot;name&quot;: &quot;custom&quot;, &quot;applyToProducts&quot;: [ &quot;custom&quot; ] }, ] }, ] } åœ¨é˜…è¯»å®˜æ–¹æ–‡æ¡£åï¼Œæˆ‘é¦–å…ˆçš„æƒ³æ³•å°±æ˜¯ä¸Šé¢è¿™ä¸‰ä¸ªé…ç½®æ–‡ä»¶ã€‚å®šä¹‰ default å’Œ custom ä¸¤ä¸ª productï¼Œç„¶å entry ä½œä¸ºå…¥å£ï¼Œæ·»åŠ åˆ°ä¸¤ä¸ª product ä¸­ã€‚feature/default æ·»åŠ åˆ° defaultï¼›feature/custom æ·»åŠ åˆ° customã€‚è¿™æ · default product åŒ…å« entry å’Œ feature/defaultï¼Œcustom product åŒ…å« entry å’Œ feature/customã€‚æ€è·¯çœ‹ç€æ²¡é—®é¢˜å¯¹å§ï¼Œç„¶è€Œå®é™…è¿è¡Œèµ·æ¥ä¼šå‘ç°é…ç½®ä¸ç”Ÿæ•ˆï¼šcustom product ä½¿ç”¨çš„æ˜¯ feature/defaultã€‚ é—®é¢˜åœ¨äºæ€è·¯ä¸å¯¹ï¼Œæ­£ç¡®çš„æ€è·¯åº”è¯¥æ˜¯ï¼šå°† entry ä¸­å®šä¹‰çš„ targetï¼Œä¸‹æ”¾ç»™å„ä¸ª module ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´è¦å…ˆåœ¨ entry ä¸­å®šä¹‰å„ä¸ª targetï¼Œç„¶åå†åœ¨å„ä¸ª module ä¸­ä½¿ç”¨ entry å®šä¹‰çš„ targetï¼Œè‡ªå®šå‘ä¸‹ä½¿ç”¨ã€‚ æ¯”å¦‚æœ‰5ä¸ªå­ moduleï¼Œå„è‡ªéƒ½æœ‰ä¸åŒçš„ target éœ€æ±‚ï¼Œåˆ†åˆ«æ˜¯ 1-5ï¼Œé‚£ä¹ˆ entry ä¸­å°±åº”è¯¥å®šä¹‰è¿™ 1-5ä¸ª targetï¼Œç„¶å5ä¸ªå­ module ä»ä¸­é€‰å–è‡ªå·±éœ€è¦çš„é‚£ä¸€ä¸ªã€‚ æ‰€ä»¥ä¸Šè¿°ä¾‹å­ä¸­çš„é…ç½®æ–‡ä»¶åº”è¯¥æ”¹æˆä¸‹é¢è¿™æ ·ï¼Œå…ˆçœ‹ entry çš„ build-profile.json5ï¼š { &quot;apiType&quot;: &quot;stageMode&quot;, &quot;buildOption&quot;: {}, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, }, { &quot;name&quot;: &quot;custom&quot;, // å¢åŠ  custom target }, ] } ç„¶åä¿®æ”¹å·¥ç¨‹çº§ build-profile.json5ï¼š { &quot;app&quot;: { &quot;signingConfigs&quot;: [], &quot;products&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;signingConfig&quot;: &quot;default&quot;, &quot;compatibleSdkVersion&quot;: &quot;5.0.0(12)&quot;, &quot;runtimeOS&quot;: &quot;HarmonyOS&quot;, }, { &quot;name&quot;: &quot;custom&quot;, &quot;signingConfig&quot;: &quot;default&quot;, &quot;compatibleSdkVersion&quot;: &quot;5.0.0(12)&quot;, &quot;runtimeOS&quot;: &quot;HarmonyOS&quot;, } ], &quot;buildModeSet&quot;: [ { &quot;name&quot;: &quot;debug&quot;, }, { &quot;name&quot;: &quot;release&quot; } ] }, &quot;modules&quot;: [ { &quot;name&quot;: &quot;entry&quot;, &quot;srcPath&quot;: &quot;./entry&quot;, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;applyToProducts&quot;: [ &quot;default&quot;, ] }, { &quot;name&quot;: &quot;custom&quot;, &quot;applyToProducts&quot;: [ &quot;custom&quot;, ] }, ] }, { &quot;name&quot;: &quot;feature&quot;, &quot;srcPath&quot;: &quot;./feature&quot;, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;applyToProducts&quot;: [ &quot;default&quot; ] }, { &quot;name&quot;: &quot;custom&quot;, &quot;applyToProducts&quot;: [ &quot;custom&quot; ] }, ] }, ] } è¿™ä¹ˆä¿®æ”¹åå†è¿è¡Œï¼Œcustom product å°±å¯ä»¥æ­£ç¡®åœ°è¯»å–åˆ° feature/custom äº†ã€‚ æœ€åå†æ¥è¯´ä¸€è¯´å®˜æ–¹ä¸­çš„ä¾‹å­ã€‚å®˜æ–¹ä¸Šçš„ç¤ºä¾‹ä½¿ç”¨ entry æ¼”ç¤º sourceRoots çš„ç”¨æ³•ï¼Œå…¶å®æš—è—äº† â€œentry ä¹Ÿéœ€è¦å®šä¹‰å¯¹åº”çš„ targetâ€ è¿™ä¸€ç‚¹ï¼Œåªä¸è¿‡æ²¡æœ‰æ˜è¯´ï¼Œè®©è¯»è€…å¿½ç•¥äº†è¿™ä¸€å…³é”®å†…å®¹ã€‚ ","link":"https://blog.rakuyoo.top/notes-on-harmonyos-and-arkts-development/"},{"title":"Gitlab-CI ä¸ Shell ä¼šè¯æ¨¡å¼","content":"ä¹‹å‰çš„æ–‡ç« ä¸­ä»‹ç»è¿‡ï¼ŒiOS å¸¸ç”¨çš„ Gitlab-CI æ‰§è¡Œå™¨æ˜¯ shellï¼Œå› ä¸ºæ‰“åŒ…æ—¶åªèƒ½ä½¿ç”¨è¿™ä¸ªã€‚ ä»Šå¤©å°†åŒ…ç®¡ç†å·¥å…·è¿åˆ° mise æ—¶é‡åˆ°äº†ä¸€äº›å’Œ shell æœ‰å…³çš„é—®é¢˜ï¼Œæ¶‰åŠåˆ°ä¸€äº›ä¹‹å‰çš„çŸ¥è¯†ç›²åŒºï¼Œé‚è®°å½•ä¸€ä¸‹ã€‚ æœ¬æ–‡çš„å†…å®¹å’Œ mise æ— å…³ï¼Œåªæ˜¯å·¥å…·è¿ç§»æ—¶å¼•å‡ºäº†æœ¬æ–‡æ¶‰åŠåˆ°çš„é—®é¢˜å’ŒçŸ¥è¯†ç›²åŒºã€‚å¯¹å·¥å…·æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç‚¹å‡»ä¸Šé¢çš„é“¾æ¥æŸ¥çœ‹ç›¸å…³å†…å®¹ã€‚ Shell ä¼šè¯æ¨¡å¼ å…ˆä»‹ç»ä¸€ä¸‹ Shell çš„å‡ ç§ä¼šè¯æ¨¡å¼ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ macOS çš„ é»˜è®¤ç»ˆç«¯ç¯å¢ƒæ˜¯ zshï¼Œzsh æœ‰å¤šä¸ªé…å¥—çš„æ–‡ä»¶ï¼ŒåŒ…å« ~/.zshrcã€.zprofile ç­‰ã€‚å¦ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„æ˜¯ bashï¼Œå¯ä½¿ç”¨çš„é…ç½®æ–‡ä»¶æœ‰ ~/.bash_profile ã€~/.bashrc ç­‰ã€‚ ä¹‹å‰æˆ‘åªæ¨¡ç³Šçš„çŸ¥é“æœ‰è¿™äº›æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å…¶ä¸­å†™å…¥ä¸€äº›å†…å®¹ï¼Œç„¶åå¯åŠ¨ç»ˆç«¯åå°±ä¼šè‡ªåŠ¨åŠ è½½è¿™äº›æ–‡ä»¶ï¼Œå´ä»æ¥æ²¡æœ‰å…³æ³¨è¿‡ ä»€ä¹ˆæ—¶å€™ä¼šåŠ è½½å“ªä¸ªæ–‡ä»¶ã€‚è¿™å°±æ¶‰åŠåˆ° â€œShell ä¼šè¯æ¨¡å¼â€ è¿™ä¸ªæ¦‚å¿µã€‚ â€œShell ä¼šè¯æ¨¡å¼â€æ˜¯æŒ‡ç”¨æˆ·å¯åŠ¨ä¼šè¯æ—¶ shellï¼ˆä¾‹å¦‚ bashã€zsh æˆ–å…¶ä»–å‘½ä»¤è¡Œè§£é‡Šå™¨ï¼‰å¯ä»¥è¿è¡Œçš„ä¸åŒæ–¹å¼ã€‚æ¯ç§æ¨¡å¼éƒ½è§„å®šäº† shell çš„è¡Œä¸ºæ–¹å¼ã€åŠ è½½çš„åˆå§‹åŒ–æ–‡ä»¶ä»¥åŠå¤„ç†å‘½ä»¤çš„æ–¹å¼ã€‚ æ­¤ä¼šè¯æ¨¡å¼ä¸»è¦å›´ç»•ä¸¤ä¸ªæ¦‚å¿µï¼šâ€œæ˜¯å¦æ˜¯äº¤äº’å¼â€ ä»¥åŠ â€œæ˜¯å¦ç™»å½•â€ã€‚è¿™ä¸¤ç§æ¦‚å¿µä¸¤ä¸¤ç»„åˆï¼Œè¯ç”Ÿå››ç§ä¼šè¯æ¨¡å¼ã€‚ æ˜¯å¦æ˜¯äº¤äº’å¼ï¼šæŒ‡å®šç”¨æˆ·æ˜¯å¦å¯ä»¥é€šè¿‡é”®å…¥å‘½ä»¤ç›´æ¥ä¸ shell äº¤äº’ã€‚shell ä¼šç­‰å¾…ç”¨æˆ·è¾“å…¥å¹¶æ ¹æ®è¾“å…¥çš„å‘½ä»¤æä¾›è¾“å‡ºã€‚ æ˜¯å¦ç™»å½•ï¼šæŒ‡å¼€å¯ä¼šè¯æ—¶ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚ ä¸¾å‡ ä¸ªä¾‹å­ï¼š äº¤äº’å¼ï¼šæ‰“å¼€ macOS ä¸­çš„ç»ˆç«¯ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢è¾“å…¥å‘½ä»¤ï¼Œä¸ shell äº¤äº’ã€‚ éäº¤äº’å¼ï¼šGitlab-CI æ‰§è¡Œ script æ—¶ï¼Œå°±æ˜¯éäº¤äº’å¼ã€‚æˆ‘ä»¬çŸ¥é“æ‰§è¡Œè¿‡ç¨‹ä¸­æˆ‘ä»¬æ²¡æœ‰åŠæ³•åšä»»ä½•äº‹ï¼ŒåŒ…æ‹¬è¾“å…¥è®¾å¤‡å¯†ç ï¼Œsay yes ç­‰ã€‚ ç™»å½•ï¼šé€šè¿‡ ssh è¿æ¥æœåŠ¡å™¨ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬è¾“å…¥ç”¨æˆ·åå¯†ç ã€‚åˆæˆ–è€…æ‰§è¡Œå‘½ä»¤æ—¶æºå¸¦äº† | /bin/bash --login å‚æ•°ã€‚ éç™»å½•ï¼šæ‰“å¼€ macOS çš„ç»ˆç«¯ï¼Œé»˜è®¤æ˜¯éç™»å½•çš„ã€‚åˆæˆ–è€…ä»ä¸€ä¸ªå·²ç»ç™»å½•äº†çš„ç»ˆç«¯ä¸­ï¼Œä½¿ç”¨ bash æˆ–å…¶ä»–å‘½ä»¤å¼€å¯äº†æ–°çš„ç»ˆç«¯çª—å£ï¼Œè¿™äº›ä¹Ÿæ˜¯éç™»å½•å¼çš„ã€‚ é‚£ä¹ˆåœ¨ä¸åŒçš„ç™»å½•æ¨¡å¼ä¸‹ï¼Œshell ä¼šåŠ è½½çš„é…ç½®æ–‡ä»¶å…¶å®æ˜¯ä¸åŒçš„ï¼š ä¼šè¯ç±»å‹ .bash_profile .bashrc .zprofile .zshrc äº¤äº’å¼ç™»å½• âœ… âŒ âœ… âŒ äº¤äº’å¼éç™»å½• âŒ âœ… âŒ âœ… éäº¤äº’å¼ç™»å½• âœ… âŒ âŒ âŒ éäº¤äº’å¼éç™»å½• âŒ âŒ âŒ âŒ å¦‚æœä½¿ç”¨ bashï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸€ä¸ªå¯èƒ½ä¼šä½¿ç”¨çš„é…ç½®æ–‡ä»¶ï¼š~/.profileã€‚å®ƒçš„ä½œç”¨å’Œ ~/.bash_profile ç±»ä¼¼ï¼Œä»…å½“ .bash_profile ä¸å­˜åœ¨æ—¶ï¼Œä¼šå°è¯•åŠ è½½ .profileã€‚å¦å¤–ï¼Œæœ‰çš„æ—¶å€™ .bash_profile ä¸­ä¼šæœ‰å‘½ä»¤ï¼ŒåŒæ—¶åŠ è½½ .profileã€‚ è€Œ zsh é»˜è®¤æ˜¯ä¸ä¼šå°è¯•åŠ è½½ .profile çš„ã€‚ Gitlab-CI çš„ script Gitlab-CI çš„æ–‡æ¡£æœ‰åˆ—ä¸¾å‡ºå®ƒæ‰€æ”¯æŒçš„ shell ç§ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹é»˜è®¤çš„ bashã€‚ è´´ä¸€ä¸‹æ–‡æ¡£ä¸­å…³äºå¦‚ä½•æ‰§è¡Œ script çš„ç¤ºä¾‹ # This command is used if the build should be executed in context of another user (the shell executor) cat generated-bash-script | su --shell /bin/bash --login user # This command is used if the build should be executed using the current user, but in a login environment cat generated-bash-script | /bin/bash --login # This command is used if the build should be executed in a Docker environment cat generated-bash-script | /bin/bash ä»æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸è®ºå“ªç§æ–¹å¼ï¼ŒGitlab-CI éƒ½æ˜¯ä½¿ç”¨ /bin/bash ç¯å¢ƒæ‰§è¡Œçš„ script ä¸­å®šä¹‰çš„è„šæœ¬ï¼Œå¹¶ä¸”åœ¨é Docker ç¯å¢ƒä¸‹ï¼Œä¼šæºå¸¦ --login å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ä½¿ç”¨çš„æ˜¯ â€œéäº¤äº’å¼ç™»å½• Shellâ€ï¼Œå›çœ‹ä¸Šé¢çš„è¡¨æ ¼ï¼Œ.bash_profile æ–‡ä»¶ä¼šè¢«åŠ è½½ã€‚ æ­¤æ—¶å°±éœ€è¦æ³¨æ„äº†ï¼Œå› ä¸º macOS é»˜è®¤çš„ç»ˆç«¯æ˜¯ zshï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¼–å†™è„šæœ¬çš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½ä¼šä¹ æƒ¯æ€§åœ°å°†é…ç½®å†™å…¥åˆ° .zprofile æˆ–è€… .zshrc æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å›åˆ° Gitlab-CI ä¸­å°±ä¼šå‘ç°ä¸ç”Ÿæ•ˆï¼ŒåŸå› å°±æ˜¯è„šæœ¬çš„æ‰§è¡Œç¯å¢ƒä¸åŒã€‚ ","link":"https://blog.rakuyoo.top/gitlab-ci-and-shell-session-mode/"},{"title":"ä»æºç çœ‹å¦‚ä½•åˆ·æ–° Epoxy åˆ—è¡¨","content":"å¦‚ä½•æ­£ç¡®çš„åˆ·æ–° Epoxy åˆ—è¡¨å¯ä»¥è¯´æ˜¯ç†Ÿç»ƒä½¿ç”¨è¿™ä¸ªæ¡†æ¶çš„å…³é”®ï¼Œåˆä¸Šæ‰‹æ—¶æ€»ä¼šæœ‰ â€œä¸ºä»€ä¹ˆåˆ—è¡¨åˆ·æ–°åæ•°æ®æ²¡å˜â€ å’Œ â€œä¸ºä»€ä¹ˆå®ƒåˆ·æ–°åæ•°æ®å°±å˜äº†â€ çš„ç–‘æƒ‘ã€‚ æœ¬æ–‡ä»æºç åˆ†æçš„è§’åº¦ï¼Œå¸¦å¤§å®¶æ¥æ¢³ç† Epoxy åˆ—è¡¨åˆ·æ–°çš„åŸç†ï¼Œå¹¶å­¦ä¼šå¦‚ä½•æ­£ç¡®åˆ·æ–° Epoxy åˆ—è¡¨ã€‚ Epoxy åˆ—è¡¨æœ¬è´¨ä¸Šè¿˜æ˜¯ UICollectionViewï¼Œåªä¸è¿‡å®ç°äº† diff ç®—æ³•ï¼Œå°è£…äº† reuse id çš„åˆ›å»ºã€‚ å¯¹äºä¸€ä¸ªå¸¸è§çš„ UICollectionViewCell æˆ– UITableViewCellï¼Œæˆ‘çš„ä¹ æƒ¯æ˜¯ï¼š Cell åˆå§‹åŒ–æ—¶åˆ›å»º subviewsï¼Œæ·»åŠ åˆ° contentView ä¸Šï¼Œå¹¶è®¾ç½®å¸ƒå±€ã€‚ å¯¹å¤–æš´éœ² config() æ–¹æ³•ï¼Œæˆ–ç›´æ¥æš´éœ² subviews åœ¨ collectionView(_: cellForItemAt:) æ–¹æ³•ä¸­å°†æ•°æ®è®¾ç½®åˆ° subviews ä¸Šã€‚ å¦‚æœæƒ³è¦åˆ—è¡¨ä¸Š Cell ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ— å¤–ä¹ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š åˆ›å»ºä¸åŒçš„ Cellã€‚ä¸åŒçš„æ•°æ®å¯¹åº”ä¸åŒçš„ Cellï¼ŒæŠ›å¼ƒæˆ–éƒ¨åˆ†æŠ›å¼ƒé‡ç”¨æœºåˆ¶ã€‚ åœ¨ Cell åˆ›å»ºæˆ–å¤ç”¨åï¼Œé‡æ–°è®¾ç½® subviews ä¸Šçš„æ•°æ®ã€‚è¿™åŒ…æ‹¬ä¸¤ç§æ–¹æ³•ï¼š collectionView(_: cellForItemAt:) æ–¹æ³•ä¸­è°ƒç”¨ config()ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ subviewsã€‚ ä½¿ç”¨å“åº”å¼æ¡†æ¶ï¼Œæ¯”å¦‚ Combineï¼Œå°†æ•°æ®ç»‘å®šåˆ° Cell çš„ subviews ä¸Šã€‚ é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»è¿™å‡ ç§æ–¹æ³•ä¸Šå…¥æ‰‹ï¼Œçœ‹çœ‹å¦‚ä½•æ­£ç¡®åˆ·æ–° Epoxy åˆ—è¡¨ã€‚ Cell åˆ›å»ºæµç¨‹ é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ Epoxy æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ª Cellã€‚åœ¨ä½¿ç”¨æ¡†æ¶æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼åˆ›å»ºè¿‡ reuse idï¼ŒEpoxy æ¡†æ¶æ˜¯å¦‚ä½•åˆ›å»ºå®ƒçš„ï¼Ÿ æºç åˆ†æ åœ¨ CollectionView/Internal/CollectionViewDataSource.swift ä¸­ï¼Œå…³äº Cell çš„åˆ›å»ºå¦‚ä¸‹æ‰€ç¤ºï¼š func collectionView( _ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell { guard let item = data?.item(at: indexPath), let section = data?.section(at: indexPath.section), let reuseID = reuseIDStore.registeredReuseID(for: item.viewDifferentiator) else { // The `item(â€¦)` or `registeredReuseID(â€¦)` methods will assert in this scenario. return UICollectionViewCell() } let cell = collectionView.dequeueReusableCell(withReuseIdentifier: reuseID, for: indexPath) if let cell = cell as? CollectionViewCell { self.collectionView?.configure( cell: cell, with: item, at: .init(itemDataID: item.dataID, section: .dataID(section.dataID)), animated: false) } else { EpoxyLogger.shared.assertionFailure( &quot;Only CollectionViewCell and subclasses are allowed in a CollectionView.&quot;) } return cell } é¦–å…ˆå…³æ³¨åˆ›å»º Cell æ—¶ä½¿ç”¨çš„æ ‡è¯†ç¬¦ï¼Œå³ reuseID è¿™ä¸ªå˜é‡æ˜¯ä»ä½•è€Œæ¥çš„ã€‚ let reuseID = reuseIDStore.registeredReuseID(for: item.viewDifferentiator) è¿™é‡ŒåŒ…å«ä¸¤ä¸ªéœ€è¦æ˜ç™½çš„å†…å®¹ï¼Œåˆ†åˆ«æ˜¯ reuseIDStore å’Œ viewDifferentiatorã€‚ ä»åå¾€å‰çœ‹ï¼ŒviewDifferentiator å®šä¹‰åœ¨ ViewDifferentiatorProviding åè®®é‡Œï¼Œå®ƒçš„ç±»å‹ ViewDifferentiator æ˜¯ä¸€ä¸ªéµå¾ª Hashable çš„ç»“æ„ä½“ï¼š // MARK: - ViewDifferentiatorProviding public protocol ViewDifferentiatorProviding { var viewDifferentiator: ViewDifferentiator { get } } // MARK: - ViewDifferentiator public struct ViewDifferentiator: Hashable { public init(viewType: AnyClass, styleID: AnyHashable?) { viewTypeDescription = &quot;\\(type(of: viewType.self))&quot; self.styleID = styleID } public var viewTypeDescription: String public var styleID: AnyHashable? } ä»æºç æ³¨é‡Šä¸Šå¯ä»¥çœ‹å‡ºæ¥è¿™ä¸¤ä¸ªç±»å‹å°±æ˜¯æœåŠ¡äº reuseID åˆ›å»ºçš„ã€‚ItemModel æ˜¯è¿™ä¹ˆå®ç° ViewDifferentiatorProviding åè®®çš„ï¼š extension ItemModel { public var viewDifferentiator: ViewDifferentiator { .init(viewType: View.self, styleID: styleID) } ... } è¿™é‡Œçš„ View æ˜¯ä¸€ä¸ªèŒƒå‹ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®ç°äº† EpoxyableView çš„ UIView å¯¹è±¡ã€‚styleID å®šä¹‰åœ¨ StyleIDProviding åè®®ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ‰©å±•å‡ºæ¥çš„å­˜å‚¨å±æ€§ï¼Œå…¶ç±»å‹æ˜¯ AnyHashableï¼Œè¿™é‡Œå°±çœç•¥å±•ç¤ºå®ƒçš„å®šä¹‰äº†ã€‚ é‚£ä¹ˆä½¿ç”¨æ—¶å®ƒçš„å€¼æ˜¯å“ªå„¿æ¥çš„å‘¢ï¼Ÿ public struct ItemModel&lt;View: UIView&gt;: ViewEpoxyModeled { ... public init&lt;Params: Hashable, Content: Equatable&gt;( dataID: AnyHashable, params: Params, content: Content, makeView: @escaping (Params) -&gt; View, setContent: @escaping (CallbackContext, Content) -&gt; Void) { self.dataID = dataID styleID = params // â¬…ï¸ åœ¨è¿™é‡Œè¿›è¡Œèµ‹å€¼ erasedContent = content self.makeView = { makeView(params) } self.setContent = { setContent($0, content) } isErasedContentEqual = { otherModel in guard let otherContent = otherModel.erasedContent as? Content else { return false } return otherContent == content } } ... } ä¸Šé¢è¿™ä¸ªæ˜¯ ItemModel çš„åˆå§‹ã€åŸºæœ¬åˆå§‹åŒ–æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨åˆå§‹åŒ–æ—¶ï¼Œæ˜¯ä½¿ç”¨ params è¿™ä¸ªå‚æ•°åˆå§‹åŒ– styleID å±æ€§çš„ã€‚ä½†æ˜¯åŸºæœ¬ä¸Šæˆ‘ä»¬éƒ½å¾ˆå°‘ä½¿ç”¨è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸‹é¢è¿™ä¸ªï¼š extension StyledView where Self: BehaviorsConfigurableView &amp; ContentConfigurableView { public static func itemModel( dataID: AnyHashable, content: Content, behaviors: Behaviors? = nil, style: Style) -&gt; ItemModel&lt;Self&gt; { ItemModel&lt;Self&gt;( dataID: dataID, params: style, // â¬…ï¸ å‘ç° params çš„æ¥æº content: content, makeView: Self.init(style:), setContent: { context, content in context.view.setContent(content, animated: context.animated) }) .setBehaviors { context in context.view.setBehaviors(behaviors) } } } çœ‹åˆ°è¿™é‡Œå°±æ˜ç™½äº†ï¼šè¿™ä¸ª styleID å°±æ˜¯åˆ›å»º EpoxyableView æ—¶å®šä¹‰çš„ Styleã€‚æ‰€ä»¥ viewDifferentiator ä»£è¡¨çš„å°±æ˜¯éµå¾ª EpoxyableView åè®®çš„è¿™ä¸ªç±»å‹æœ¬èº«ä»¥åŠå®ƒæ‰€åŒ…å«çš„ Style å¯¹è±¡ã€‚å½“åŒä¸€ä¸ª View ä½†æ˜¯ Style ä¸åŒæ—¶ï¼ŒviewDifferentiator ä¹Ÿå°±ä¸åŒã€‚ çœ‹å®Œäº† viewDifferentiatorï¼Œè®©æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹ reuseIDStoreã€‚ å®ƒçš„ç±»å‹æ˜¯ä¸€ä¸ªç±» ReuseIDStoreï¼Œä»å‘½åä¸Šå¯ä»¥çœ‹å‡ºè¿™ä¸ªç±»æ˜¯ä¸“é—¨ç”¨æ¥å­˜å‚¨ reuse id çš„ã€‚é€šè¿‡æºç å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç±»å†…éƒ¨ä½¿ç”¨ä¸¤ä¸ª Dictionary æ¥å°è£… reuse id çš„åˆ›å»ºã€å­˜å‚¨ä»¥åŠè¯»å–é€»è¾‘ã€‚ å¯¹å¤–ä¸»è¦æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼šreuseID(byRegistering:) å’Œ registeredReuseID(for:)ï¼Œå‚æ•°éƒ½æ˜¯ ViewDifferentiatorã€‚å‰è€…ç”¨äºå­˜å‚¨ reuse idï¼Œåè€…è´Ÿè´£æŸ¥è¯¢è¯»å–ã€‚ å†…éƒ¨åŒ…å«ä»¥ä¸‹ä¸¤ä¸ª Dictionary: private var uniqueViewDifferentiatorCountsForViewTypes = [String: Int]() private var reuseIDsForViewDifferentiators = [ViewDifferentiator: String]() uniqueViewDifferentiatorCountsForViewTypes è´Ÿè´£è®¡æ•°ï¼Œå³ä¸€ä¸ª CollectionView æ³¨å†Œäº†å‡ æ¬¡è¿™ä¸ª Viewï¼ˆCellï¼‰ã€‚ é€šè¿‡è¿½è¸ªè°ƒç”¨æ ˆï¼Œå¯ä»¥å‘ç°æ¯æ¬¡è°ƒç”¨ setSections(_: strategy:) æ–¹æ³•æ—¶ï¼Œå¦‚æœå­˜åœ¨æ–°çš„ ViewDifferentiatorï¼Œå°±ä¼šè°ƒç”¨ reuseID(byRegistering:) è¿›è¡Œæ³¨å†Œã€‚ è¿™é‡Œæˆ‘ä»¬ç»“åˆæ³¨å†Œæ–¹æ³• reuseID(byRegistering:) çš„å®ç°æ¥ä¸€èµ·çœ‹ï¼š public func reuseID(byRegistering viewDifferentiator: ViewDifferentiator) -&gt; String { if let existingReuseID = reuseIDsForViewDifferentiators[viewDifferentiator] { return existingReuseID } let viewType = viewDifferentiator.viewTypeDescription let uniqueViewDifferentiatorCount = uniqueViewDifferentiatorCountsForViewTypes[viewType] ?? 0 uniqueViewDifferentiatorCountsForViewTypes[viewType] = uniqueViewDifferentiatorCount + 1 let reuseID = &quot;\\(viewType)_\\(uniqueViewDifferentiatorCount)&quot; // â¬…ï¸ ç±»å‹åŠ å‡ºç°æ¬¡æ•° reuseIDsForViewDifferentiators[viewDifferentiator] = reuseID return reuseID } ViewDifferentiator æ˜¯éµå¾ª Hashable çš„ï¼Œå¯¹äºåŒä¸€ä¸ª View ç±»å‹è€Œè¨€ï¼Œä¸åŒçš„ Style å®ä¾‹æ„å‘³ç€ä¸åŒçš„ ViewDifferentiatorï¼Œæ¯ä¸€ç§éƒ½ä¼šè°ƒç”¨ reuseID(byRegistering:) è¿›è¡Œæ³¨å†Œã€‚é€šè¿‡ç´¯åŠ  countï¼Œå¯ä»¥ä¿è¯ä¸åŒçš„ ViewDifferentiator å¯¹åº”ä¸åŒçš„ reuse idã€‚ å°ç»“ åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªä¾‹å­æ¥æ€»ç»“ä¸€ä¸‹ reuse id çš„åˆ›å»ºè¿‡ç¨‹å’Œåˆ›å»ºç»“æœã€‚ å‡è®¾å®šä¹‰å¦‚ä¸‹ä¸€ä¸ª Viewï¼š final class TextRow: UIView, EpoxyableView { enum Style { case small, large } } ä½¿ç”¨æ—¶å¦‚ä¸‹ï¼š // ... other row TextRow.itemModel(dataID: &quot;small&quot;, style: .small) // ... other row TextRow.itemModel(dataID: &quot;large&quot;, style: .large) // ... other row é‚£ä¹ˆå½“æˆ‘ä»¬è°ƒç”¨ collectionView.setSections(_: strategy:) æ—¶ï¼Œå› ä¸ºä¸¤ä¸ª ItemModel å®ä¾‹å¯¹åº”çš„ Style ä¸åŒï¼ŒCollectionView ä¸­å°±ä¼šæ³¨å†Œä¸¤ä¸ª Cellï¼Œreuse id åˆ†åˆ«ä¸º TextRow_0 å’Œ TextRow_1ã€‚ æ‰€ä»¥å¦‚æœä½ å¸Œæœ›æŠ›å¼ƒæˆ–éƒ¨åˆ†æŠ›å¼ƒ Cell çš„é‡ç”¨æœºåˆ¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦ä¿è¯ reuse id å„ä¸ç›¸åŒï¼Œå³ ä½¿ç”¨ä¸åŒçš„ Viewï¼Œæˆ–è€…ä¸åŒçš„ View.Styleã€‚ åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å¸¸é€šè¿‡å­—é¢å«ä¹‰ï¼Œå°†æ¯”å¦‚ TextColor ç­‰ UI æ ·å¼å°è£…åœ¨ Style ä¸­ã€‚åœ¨é‡åˆ° â€œå¯ç”¨æ—¶æ˜¾ç¤ºé»‘è‰²ï¼Œä¸å¯ç”¨æ—¶å±•ç¤ºç°è‰²â€ è¿™ç§éœ€æ±‚æ—¶ï¼ŒåŠ¨æ€ä¿®æ”¹ TextColorï¼Œéšåè°ƒç”¨ setSections(_: strategy:) åˆ·æ–°åˆ—è¡¨ã€‚è¿™æ—¶åˆ—è¡¨æ•°æ®å‘ç”Ÿå˜åŠ¨ï¼Œå…¶å®æ˜¯ reuse id ä¸åŒï¼Œç³»ç»Ÿåˆ›å»ºäº†æ–°çš„ Cell æ¥å±•ç¤ºä¸åŒçš„æ–‡å­—é¢œè‰²ã€‚å¾ˆå¤šæ—¶å€™è¿™ç§ç°è±¡å…¶å®è¿èƒŒäº†å¼€å‘è€…çš„åˆè¡·ã€‚ æ›´æ–° Cell æ•°æ® å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯æ›´æ–° Cell ä¸Šå­è§†å›¾çš„æ•°æ®ï¼Œæ¯”å¦‚ Label çš„ text ç­‰ã€‚åœ¨ Epoxy ä¸­ï¼Œæˆ‘ä»¬å¸¸å°†æ•°æ®å®šä¹‰åœ¨ Content é‡Œï¼Œå¹¶åœ¨ setContent(_: animated:) æ–¹æ³•å†…å°†æ•°æ®æ¸²æŸ“åˆ° UI ä¸Šï¼Œæ¯”å¦‚è¿™æ ·ï¼š extension HeaderRow: ContentConfigurableView { struct Content: Equatable { let title: String let tips: String? } func setContent(_ content: Content, animated: Bool) { titleLabel.text = content.title tipsLabel.text = content.tips } } é‚£ä¹ˆæ˜¯ä¸æ˜¯ä¿®æ”¹äº† Content ä¹‹åï¼Œå†è°ƒç”¨ setSections(_: strategy:) åˆ·æ–°åˆ—è¡¨å³å¯åˆ·æ–° UIï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æºç ã€‚ Content è®¾ç½®æµç¨‹ æºç åˆ†æ é¦–å…ˆçœ‹ä¸€ä¸‹ itemModel(dataID: content: behaviors: style:) æ–¹æ³•çš„å®šä¹‰ï¼Œå®ƒæ˜¯ EpoxyableView åˆ›å»º ItemModel çš„æ–¹æ³•ã€‚ extension StyledView where Self: BehaviorsConfigurableView &amp; ContentConfigurableView { public static func itemModel( dataID: AnyHashable, content: Content, behaviors: Behaviors? = nil, style: Style) -&gt; ItemModel&lt;Self&gt; { ItemModel&lt;Self&gt;( dataID: dataID, params: style, content: content, // â¬…ï¸ ä¼ å…¥ makeView: Self.init(style:), setContent: { context, content in // â¬…ï¸ åœ¨é—­åŒ…å†…åˆåäº†å‡ºæ¥ï¼Œç›¸å½“äºé—­åŒ…æŒæœ‰äº† Content å®ä¾‹ context.view.setContent(content, animated: context.animated) }) .setBehaviors { context in context.view.setBehaviors(behaviors) } } } ä»å®ç°ä¸Šçœ‹ï¼Œcontent å®ä¾‹è¢«åŒ…è£¹è¿›äº† setContent é—­åŒ…ï¼Œå»¶è¿Ÿåˆ°åˆé€‚çš„æ—¶æœºå†è¿›è¡Œè°ƒç”¨ï¼š extension ItemModel: InternalItemModeling { ... public func configure(cell: ItemWrapperView, with metadata: ItemCellMetadata) { // Even if there's no `setContent` closure, we need to make sure to call `viewForCell` to ensure that the cell is set up. let view = viewForCell(cell) setContent?(.init(view: view, metadata: metadata)) } ... } è¿™é‡Œæ’ä¸€å¥ï¼Œåœ¨å¯»æ‰¾ setContent é—­åŒ…çš„ Caller æ—¶ï¼Œä½ æœ‰å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š extension AnyItemModel: InternalItemModeling { ... public func configure(cell: ItemWrapperView, with metadata: ItemCellMetadata) { model.configure(cell: cell, with: metadata) if let view = cell.view { setContent?(.init(view: view, metadata: metadata)) } } ... } è¿™ä¸ªæ–¹æ³•å±äº AnyItemModelï¼Œè¿™ä¸ªç±»å‹æ“¦é™¤è´Ÿè´£åŒ…è£¹ä¸åŒçš„ ItemModel å®ä¾‹ï¼Œæ–¹æ³•ç¬¬ä¸€è¡Œçš„ model å³æ˜¯å®ƒæ‰€åŒ…è£…çš„ ItemModel å®ä¾‹ã€‚ ä¸ºä»€ä¹ˆæåˆ°è¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªæ–¹æ³•çœ‹ä¸Šå»è°ƒç”¨äº†ä¸¤æ¬¡ setContent é—­åŒ…ã€‚ç„¶è€Œå®é™…ä¸Šï¼Œä¸æ­¢ setContentï¼ŒAnyItemModel ä¸­çš„å…¶ä»–ç±»ä¼¼çš„å±æ€§ï¼ˆæ¯”å¦‚ setBehaviorsï¼‰éƒ½æ˜¯ nilï¼Œæ‰€ä»¥ setContent é—­åŒ…åªè°ƒç”¨äº†ä¸€æ¬¡ï¼Œé‡ç‚¹è¿˜æ˜¯å…³æ³¨ ItemModel çš„ configure(cell: with:) æ–¹æ³•ã€‚ AnyItemModel çš„ setContent æ˜¯ nil æ˜¯è®¾è®¡ä¸Šå†³å®šçš„ï¼Œé¡¹ç›®ä¸­æœç´¢ä¸åˆ°å¯¹å…¶è¿›è¡Œèµ‹å€¼çš„ä»£ç ã€‚è‡³äºä¸ºä»€ä¹ˆæ˜æ˜æ²¡æœ‰èµ‹å€¼ï¼Œå´è¿˜æœ‰è°ƒç”¨ï¼ŒçŒœæµ‹æ˜¯ä¸ºäº†æ¶æ„ä¸Šçš„ç»Ÿä¸€ï¼Ÿ ç»§ç»­å‘ä¸Šå¯»æ‰¾è°ƒç”¨æ–¹ï¼Œå¯ä»¥å‘ç°æ˜¯åœ¨ä¸Šæ–‡ä¸­æåˆ°çš„ collectionView(_: cellForItemAt:) æ–¹æ³•å†…è°ƒç”¨çš„ã€‚æ–¹æ³•å®ç°å†…æœ‰ä¸€è¡Œ self.collectionView?.configure( ... )ï¼Œè¯¥æ–¹æ³•å†…æ— åˆ¤æ–­åœ°è°ƒç”¨äº† model çš„ configure(cell: with:) æ–¹æ³•ã€‚ å°ç»“ æ€»ç»“ä¸€ä¸‹é€»è¾‘å’Œè°ƒç”¨é“¾ï¼š åˆ·æ–° CollectionView æ—¶ï¼Œæ‰§è¡Œ collectionView(_: cellForItemAt:)ï¼Œé€šè¿‡å±‚å±‚è°ƒç”¨ï¼Œæœ€ç»ˆ model.setContent é—­åŒ…è¢«è°ƒç”¨ï¼ŒView çš„ setContent(_: animated) è¢«è°ƒç”¨ï¼Œæ–°çš„ Content è¢«è®¾ç½®åˆ° UI ä¸Šã€‚ åˆ°è¿™é‡Œç»“æŸäº†å—ï¼Ÿè¿˜ä¸è¦é«˜å…´çš„å¤ªæ—©ï¼Œä¸è¦å¿˜è®°äº† CollectionView è¿˜å­˜åœ¨ Diff çš„é€»è¾‘ï¼šæ›´æ–° Content å®ä¾‹åè°ƒç”¨ setSections(_: strategy:)ï¼ŒCollectionView ä¸€å®šä¼šè¢«åˆ·æ–°å—ï¼Ÿæœªå¿…ã€‚ CollectionView åˆ·æ–°æ—¶æœº æºç åˆ†æ è®©æˆ‘ä»¬è‡ªé¡¶å‘ä¸‹çœ‹ï¼Œå…ˆçœ‹ setSections(_: strategy:) çš„å®ç°ï¼š open class CollectionView: UICollectionView { ... public func setSections(_ sections: [SectionModel], animated: Bool) { let strategy: UpdateStrategy if configuration.usesBatchUpdatesForAllReloads { strategy = animated ? .animatedBatchUpdates : .nonanimatedBatchUpdates } else { strategy = animated ? .animatedBatchUpdates : .reloadData } setSections(sections, strategy: strategy) } public func setSections(_ sections: [SectionModel], strategy: UpdateStrategy) { EpoxyLogger.shared.assert(Thread.isMainThread, &quot;This method must be called on the main thread.&quot;) epoxyDataSource.registerSections(sections) apply(.make(sections: sections), strategy: strategy) } ... } registerSections() ä¸Šæ–‡æœ‰æåˆ°ï¼Œè´Ÿè´£æ³¨å†Œ Section ä»¥åŠ Cellã€‚é‡ç‚¹å…³æ³¨ä¸‹é¢çš„ apply(_: strategy:) æ–¹æ³•ã€‚æŸ¥çœ‹è¯¥çš„å®ç°ï¼Œå¯ä»¥çœ‹åˆ°å…¶å†…éƒ¨è°ƒç”¨äº†ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š open class CollectionView: UICollectionView { ... private func updateView(with data: CollectionViewData, strategy: UpdateStrategy) { updateState = .preparingUpdate let performUpdates = { self.performBatchUpdates({ self.performUpdates(data: data, animated: strategy.animated) }, completion: { _ in if let nextUpdate = self.queuedUpdate, self.window != nil { self.queuedUpdate = nil self.updateView(with: nextUpdate.newData, strategy: nextUpdate.strategy) } else { self.completeUpdates() } }) } // There's two cases in which we should always have a strategy of `.reloadData`: // - The first update, since we're going from empty content to non-empty content, and we don't want to animate that update. // - Before the first layout of this collection view when `bounds.size` is still zero, since there's no benefit to doing batch updates in that scenario. let override = (epoxyDataSource.data == nil || bounds.size == .zero) ? .reloadData : strategy switch override { case .animatedBatchUpdates: performUpdates() case .nonanimatedBatchUpdates: UIView.performWithoutAnimation { performUpdates() } case .reloadData: let result = epoxyDataSource.applyData(data) updateState = .updating(from: result.oldData) reloadData() completeUpdates() } } ... } é€šè¿‡ä¸Šé¢çš„å®ç°æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç¬¬ä¸€ä¸ªåˆ·æ–°æ–¹æ¡ˆï¼šå¦‚æœ strategy æ˜¯ .reloadDataï¼Œé‚£ä¹ˆä¼šç›´æ¥è°ƒç”¨ UICollectionView çš„ reloadData æ–¹æ³•ï¼ˆå³ä¸ä½¿ç”¨ Epoxy å†…ç½®çš„ Diff ç®—æ³•ï¼‰ï¼Œæ­¤æ—¶ collectionView(_: cellForItemAt:) æ–¹æ³•å¿…æ‰§è¡Œï¼Œæ–°çš„ Content å¯ä»¥è¢«æ­£ç¡®åœ°æ›´æ–°ã€‚ ä¹‹æ‰€ä»¥ä¿ç•™æ³¨é‡Šï¼Œæ˜¯å› ä¸ºè¿™é‡Œçš„æ³¨é‡Šæ¯”è¾ƒå…³é”®ã€‚é€šè¿‡æ³¨é‡Šæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼šåˆæ¬¡åŠ è½½æ—¶ï¼Œæˆ–è€…å¯¹ä¸€ä¸ªå°šæœªå…·æœ‰å°ºå¯¸çš„ CollectionView è°ƒç”¨åˆ·æ–°æ—¶ï¼Œå°†å¿½ç•¥å¤–éƒ¨å‚æ•°ï¼Œæ°¸è¿œä½¿ç”¨ .reloadData æ–¹å¼è¿›è¡Œåˆ·æ–°ã€‚ é‚£å¦‚æœä½¿ç”¨å…¶ä»–çš„ strategy å‘¢ï¼Ÿå°±éœ€è¦å…³æ³¨ performUpdates é—­åŒ…é‡Œè°ƒç”¨çš„ performUpdates(data: animated:) æ–¹æ³•äº†ã€‚ è¿™é‡Œç¨å¾®æä¸€ä¸‹ UICollectionView çš„ performBatchUpdates(_: completion:) æ–¹æ³•ï¼Œå®ƒæ˜¯ç”¨æ¥å°†å¤šä¸ªæ“ä½œï¼ˆupdateã€insertã€delete ç­‰ï¼‰ï¼Œåˆå¹¶è‡³ä¸€ä¸ªåŠ¨ç”»å†…è¿›è¡Œå±•ç¤ºã€‚ å› ä¸º performUpdates(data: animated:) é‡Œä½¿ç”¨äº† diff ç®—æ³•ï¼Œè¯¥ç®—æ³•ä¼šåŒæ—¶è®¡ç®—å‡ºä¸Šè¿°å¤šç§æ“ä½œï¼Œæ‰€ä»¥ä¸ºäº†æ›´å¥½çš„ UI äº¤äº’å±•ç¤ºï¼Œéœ€è¦å°†è¿™äº›æ“ä½œåˆå¹¶è‡³ä¸€ä¸ªåŠ¨ç”»å†…å±•ç¤ºã€‚ performUpdates(data: animated:) æ–¹æ³•å®ç°æ¯”è¾ƒå¤šï¼Œè¿™é‡ŒæŒ‘ä¸€äº›æˆ‘ä»¬å…³æ³¨çš„è´´ä¸€ä¸‹ï¼š open class CollectionView: UICollectionView { ... private func performUpdates(data: CollectionViewData, animated: Bool) { let result = epoxyDataSource.applyData(data) updateState = .updating(from: result.oldData) for (fromIndexPath, toIndexPath) in result.changeset.itemChangeset.updates { if let cell = cellForItem(at: fromIndexPath) as? CollectionViewCell, let item = epoxyDataSource.data?.item(at: toIndexPath) { let metadata = ItemCellMetadata( traitCollection: traitCollection, state: cell.state, animated: animated) item.configure(cell: cell, with: metadata) // â¬…ï¸ ç†Ÿæ‚‰çš„è€æœ‹å‹ item.configureStateChange(in: cell, with: metadata) } } ... deleteSections(result.changeset.sectionChangeset.deletes) deleteItems(at: result.changeset.itemChangeset.deletes) for (fromIndex, toIndex) in result.changeset.sectionChangeset.moves { moveSection(fromIndex, toSection: toIndex) } for (fromIndexPath, toIndexPath) in result.changeset.itemChangeset.moves { moveItem(at: fromIndexPath, to: toIndexPath) // â¬…ï¸ moveItem æœªå¿…ä¼šè§¦å‘ cell åŠ è½½ } insertSections(result.changeset.sectionChangeset.inserts) insertItems(at: result.changeset.itemChangeset.inserts) // â¬…ï¸ insertItems ä¹Ÿä¼šè§¦å‘ cell åŠ è½½ } ... } æ–¹æ³•å®ç°çš„ç¬¬ä¸€è¡Œï¼ŒepoxyDataSource.applyData(data) å°±æ˜¯åº”ç”¨ diff ç®—æ³•ã€‚ä¹‹å‰å†™çš„ Epoxy æºç åˆ†æç³»åˆ—æ–‡ç« ä¸­ï¼Œç¬¬ä¸€ç¯‡å°±æ˜¯æœ‰å…³ Epoxy çš„ Diff ç®—æ³•çš„ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ç®—æ³•åŸç†ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•å®ç°ä¸­å¯ä»¥è¯´æœ‰ä¸¤ä¸ªåˆ·æ–°é€»è¾‘ï¼š ç†Ÿæ‚‰çš„æœ‹å‹ï¼šitem.configure(cell: cell, with: metadata)ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸Šé¢çš„æ¡ä»¶éƒ½æ»¡è¶³ï¼Œé‚£ä¹ˆ configure(cell: with:) æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼ŒContent å°±ä¼šè¢«æ›´æ–°ã€‚ åˆæˆ–è€…å½’åˆ° inserts é‡Œï¼Œä½œä¸ºä¸€ä¸ªæ–°çš„ Cell æ’å…¥åˆ°åˆ—è¡¨ä¸­ã€‚ IndexPathChangeset åŒ…å«ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š public struct IndexPathChangeset { ... /// The inserted `IndexPath`s needed to get from the old collection to the new collection. public var inserts: [IndexPath] /// The deleted `IndexPath`s needed to get from the old collection to the new collection. public var deletes: [IndexPath] /// The updated `IndexPath`s needed to get from the old collection to the new collection. public var updates: [(old: IndexPath, new: IndexPath)] /// The moved `IndexPath`s needed to get from the old collection to the new collection. public var moves: [(old: IndexPath, new: IndexPath)] ... } è¿™ä¸¤ä¸ªæ–¹æ¡ˆä¸­ï¼Œinserts çš„é€»è¾‘å¾ˆç®€å•ã€‚è®©æˆ‘ä»¬å¿½ç•¥ diff ç®—æ³•çš„é€»è¾‘ï¼Œç›´æ¥è¯´ç»“è®ºï¼šåªè¦ dataID å‘ç”Ÿå˜åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ–°çš„ ItemModelï¼Œå°±ä¼šæ‰§è¡Œ delete &amp; insertã€‚æ‰€ä»¥ç¬¬äºŒä¸ªåˆ·æ–°æ–¹æ¡ˆå°±æ˜¯ï¼šä¿®æ”¹å‰åï¼ŒItemModel çš„ dataID ä¸åŒã€‚ é‚£ configure(cell: with:) çš„å‰ç½®æ¡ä»¶éƒ½æœ‰å“ªäº›å‘¢ï¼Ÿé¦–å…ˆæ˜¯ for å¾ªç¯çš„æ•°ç»„ä¸ä¸ºç©ºï¼Œå…¶æ¬¡æ˜¯ä¸¤ä¸ª ifã€‚èªæ˜çš„ä½ åº”è¯¥å¯ä»¥å‘ç°ï¼Œè¿™ä¸¤ä¸ª if ä¸æ˜¯é€»è¾‘é‡ç‚¹ï¼Œç¬¬ä¸€ä¸ª if åªæ˜¯ä¸ºäº†æ»¡è¶³ Swift è¯­æ³•çš„ç±»å‹è½¬æ¢ï¼Œè€Œç¬¬äºŒä¸ª if æ˜¯ä¸ºäº†åˆ¤æ–­ Cell æ˜¯å¦å±•ç¤ºå‡ºæ¥ï¼Œé¿å… configure(cell: with:) å¤šæ¬¡è°ƒç”¨ã€‚æ‰€ä»¥é‡ç‚¹å°±åœ¨äº result.changeset.itemChangeset.updates æ˜¯å¦ä¸ºç©ºã€‚ æ‰€ä»¥æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹å°±æ˜¯ï¼šå¦‚ä½•ä¿®æ”¹æˆ‘ä»¬çš„æ•°æ®æºï¼Œå¯ä»¥è®©å…¶å½’åˆ° updates é›†åˆé‡Œã€‚æ¡ä»¶æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š è¿™ä¸ª ItemModel åœ¨åˆ·æ–°å‰å·²ç»å­˜åœ¨äºåˆ—è¡¨ä¸­ï¼Œåœ¨åˆ—è¡¨ä¸­å…·æœ‰ Indexã€‚ ItemModel çš„ isDiffableItemEqual(to:) æ–¹æ³•è¿”å› falseã€‚ ç›¸å…³æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š extension ItemModel: Diffable { ... public func isDiffableItemEqual(to otherDiffableItem: Diffable) -&gt; Bool { guard let other = otherDiffableItem as? Self else { return false } return isErasedContentEqual?(other) ?? true } } isErasedContentEqual åœ¨ ItemModel åˆå§‹åŒ–æ—¶è¿›è¡Œè®¾ç½®ï¼š public struct ItemModel&lt;View: UIView&gt;: ViewEpoxyModeled { ... public init&lt;Content: Equatable&gt;( dataID: AnyHashable, content: Content, setContent: @escaping (CallbackContext, Content) -&gt; Void) { self.dataID = dataID erasedContent = content // â¬…ï¸ erasedContent å°±æ˜¯ content self.setContent = { setContent($0, content) } isErasedContentEqual = { otherModel in guard let otherContent = otherModel.erasedContent as? Content else { return false } return otherContent == content // â¬…ï¸ Content éµå¾ª Equatable çš„ç›®çš„å°±åœ¨æ­¤ } } ... } ä»ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•å®ç°ä¸­æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç»“è®ºï¼š å¦‚æœ EpoxyableView æ²¡æœ‰å®šä¹‰ Contentï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸å­˜åœ¨ updates çš„é€»è¾‘ã€‚ æ›´æ–°å‰åï¼Œä¸¤ä¸ª ItemModel çš„ Content ä¸ç›¸ç­‰ï¼ŒEpoxyableView çš„ setContent(_: animated:) æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ã€‚ é‚£ä¹ˆç¬¬ä¸‰ç§åˆ·æ–°æ–¹æ¡ˆå°±æ˜¯ï¼šç¡®ä¿ä¿®æ”¹å‰åçš„ Content ä¸ç›¸ç­‰ã€‚ å°ç»“ ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œåœ¨è°ƒç”¨ setSections(_: strategy:) æ–¹æ³•ä¹‹åï¼ŒStyle ä¸å˜çš„å‰æä¸‹ï¼Œä»¥ä¸‹å‡ ç§æƒ…å†µ EpoxyableView çš„ setContent(_: animated) æ–¹æ³•å°†è¢«è°ƒç”¨ï¼š strategy ä¸º .reloadData æ—¶ã€‚ åŒ…æ‹¬ç©º CollectionView åˆæ¬¡åŠ è½½æ•°æ®ï¼Œæˆ–è€… CollectionView å°šæ²¡æœ‰ Size æ—¶ã€‚ ä¿®æ”¹æ•°æ®å‰åï¼ŒItemModel çš„ dataID å‘ç”Ÿäº†æ”¹å˜ã€‚ ä¿®æ”¹æ•°æ®å‰åï¼ŒContent çš„ == è¿”å› falseï¼Œå³ä¸¤ä¸ª Content ä¸ç›¸ç­‰ã€‚ æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å°±æ˜¯æœ‰æ•ˆçš„ï¼š private var count = 0 { didSet { setItems(items, animated: true) } } @ItemModelBuilder private var items: [ItemModeling] { TextRow.itemModel( dataID: DataID.row, content: .init( title: &quot;Count \\(count)&quot;, body: &quot;Tap to increment&quot;), style: .large) .didSelect { [weak self] _ in self?.count += 1 } } æ€»ç»“ åˆ°è¿™é‡Œè®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼Œå€ŸåŠ© Epoxy çš„æœºåˆ¶æˆ‘ä»¬åº”è¯¥å¦‚ä½•åˆ·æ–°åˆ—è¡¨ã€‚ æ–¹æ³• æè¿° æ¨èæŒ‡æ•° ä½¿ç”¨ä¸åŒçš„ dataID æ¯”å¦‚å£°æ˜ä¸€ä¸ª enum DataID { case some(value: String) }ï¼Œæ¯æ¬¡åˆ·æ–°æ—¶ä¿®æ”¹ value çš„å€¼ã€‚ æˆ–è€…å°† dataID å’Œæ•°ç»„çš„ä¸‹æ ‡åšå¯¹åº”ï¼Œè¿™æ ·åœ¨ç§»åŠ¨ Cell æ—¶ï¼Œç›¸å½“äºåŒä¸€ä¸ª ItemModel çš„ Content å‘ç”Ÿäº†å˜åŒ–ã€‚ ğŸŒŸ ä½¿ç”¨ä¸åŒçš„ Style å°†éœ€è¦å˜åŒ–çš„å€¼å®šä¹‰åœ¨ Style é‡Œï¼Œåˆ·æ–° Style ååˆ·æ–°åˆ—è¡¨ ğŸŒŸğŸŒŸ åˆ©ç”¨ Equatableï¼Œä¿®æ”¹ Content ç¡®ä¿ Content çš„åˆ¤ç­‰é€»è¾‘ç¬¦åˆæ‚¨çš„è¦æ±‚ï¼Œä¿®æ”¹ Content ååˆ·æ–°åˆ—è¡¨ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ æœ‰ä¸€ä¸ªåˆ·æ–°ä¹‹å¤–çš„å¼•ç”³è¯é¢˜ï¼Œä¸Šæ–‡ä¹Ÿæåˆ°è¿‡ï¼Œé‚£å°±æ˜¯ä»€ä¹ˆæ ·çš„æ•°æ®è¯¥æ”¾åˆ° Style ä¸­ã€‚å¸Œæœ›çœ‹å®Œè¿™ç¯‡æ–‡ç« åï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ä½ ä¹Ÿèƒ½æœ‰æ–°çš„æ€è€ƒå’Œç†è§£ã€‚ æƒ³å¿…å¯¹äºèªæ˜çš„ä½ æ¥è¯´ï¼Œä¸Šè¿°åˆ†æè¿‡ç¨‹æœ‰ç‚¹å¤ªç®€å•äº†ï¼Œåªè¦ç¨å¾®æ·±å…¥è¿½ä¸€ä¸‹ä»£ç ï¼Œå°±èƒ½æ¢³ç†æ¸…æ¥šè¿™äº›æƒ…å†µã€‚ç”šè‡³ Epoxy çš„ demo å’Œæ–‡æ¡£ä¸­å·²ç»ä»‹ç»çš„å¾ˆæ¸…æ¥šäº†ã€‚ ä½†æ˜¯æœ‰çš„æ—¶å€™ï¼Œç”Ÿæ´»å°±æ˜¯è¿™ä¹ˆè¯¡å¼‚ã€‚ä¸æŠŠè¿™äº›è¿‡ç¨‹å†™ä¸‹æ¥çš„è¯ï¼Œå¯¹äºä½¿ç”¨è¿˜ä¸ç†Ÿç»ƒçš„æˆ‘è€Œè¯´ï¼Œç»å¸¸ä¼šé™·å…¥æ–‡ç« å¼€å¤´çš„ç–‘é—®ï¼šâ€œä¸ºä»€ä¹ˆåˆ—è¡¨åˆ·æ–°åæ•°æ®æ²¡å˜â€ å’Œ â€œä¸ºä»€ä¹ˆå®ƒåˆ·æ–°åæ•°æ®å°±å˜äº†â€ã€‚ä¹Ÿå°±æ˜¯è¯´å³ä½¿æˆ‘ä»¬çŸ¥é“äº† â€œå½“ Content ä¸ä¸€è‡´æ—¶åˆ·æ–°åˆ—è¡¨ï¼Œåˆ—è¡¨æ•°æ®ä¼šå‘ç”Ÿå˜åŒ–â€ å¹¶æŒ‰ä¹‹ä»˜å‡ºå®è·µæ—¶ï¼Œä¾ç„¶ä¼šæœ‰ä¸ç”Ÿæ•ˆçš„æƒ…å†µå‘ç”Ÿã€‚ è¿™ç¯‡æ–‡ç« è¿˜ä¸æ˜¯å®Œå…¨ä½“ï¼Œæ—¥åå½“æˆ‘å†æ¬¡å‘ç°åˆ·æ–°å¤±æ•ˆçš„æƒ…å†µæ—¶ï¼Œæˆ‘å°†å®Œå–„è¿™ç¯‡æ–‡ç« ï¼Œè¡¥å……å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚ ","link":"https://blog.rakuyoo.top/refresh-epoxy-list/"},{"title":"Lazy var çš„çº¿ç¨‹å®‰å…¨é—®é¢˜","content":"Swift çš„ lazy å…³é”®å­—ä¸€ç›´æœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½ç•¥çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¿™ä¹ˆä¸€æ®µæè¿°ï¼š Note If a property marked with the lazy modifier is accessed by multiple threads simultaneously and the property hasnâ€™t yet been initialized, thereâ€™s no guarantee that the property will be initialized only once. å®˜æ–¹è‡ªå·±ä¹Ÿè¯´äº†ï¼Œå¦‚æœå¤šçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œå¯èƒ½å¯¼è‡´åˆå§‹åŒ–ä¸¤æ¬¡ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¸å¤ªä¼šé‡åˆ°è¿™ç§é—®é¢˜ï¼Œéƒ½æ˜¯åœ¨ viewDidLoad ä¸­æ·»åŠ ã€å¸ƒå±€å­è§†å›¾ï¼Œä½†æ˜¯å°‘æ•°æƒ…å†µè¿˜æ˜¯æœ‰å¯èƒ½ä¼šç¢°åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ã€‚ lazy var void ä¸ dispatch_once Xcode 16 &amp; Swift 6 ä»¥å‰ é™¤äº†ç”¨ lazy ä¿®é¥° UI è§†å›¾ä¹‹å¤–ï¼Œå¦ä¸€ä¸ªå¯èƒ½æ¯”è¾ƒå¸¸è§çš„ç”¨æ³•æ˜¯ç”¨ lazy var void ä»£æ›¿ dispatch_onceã€‚ åœ¨ä¸­æ–‡äº’è”ç½‘ä¸Šèƒ½æœåˆ°å¾ˆå¤šè¿™ç§ç”¨æ³•ï¼Œä½†æ˜¯è¯»åˆ°è¿™é‡Œä½ åº”è¯¥èƒ½å‘ç°ï¼Œè¿™ç§ç”¨æ³•å…¶å®ä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒç”¨çš„æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ lazy å…³é”®å­—ä¿®é¥°ã€‚ åœ¨ã€ŠMigrating to Swift 3ã€‹ï¼Œå®˜æ–¹æ˜ç¡®æåˆ°äº†ä»£æ›¿ dispatch_once çš„åŠæ³•ï¼š The free function dispatch_once is no longer available in Swift. In Swift, you can use lazily initialized globals or static properties and get the same thread-safety and called-once guarantees as dispatch_once provided. Example: let myGlobal = { â€¦ global contains initialization in a call to a closure â€¦ }() _ = myGlobal // using myGlobal will invoke the initialization code only the first time it is used. è¯·æ³¨æ„ï¼Œç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ˜¯ letï¼Œå¹¶ä¸”æ˜¯ lazily initialized globals æˆ–è€… static propertiesã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œstatic ä¿®é¥°æˆ–è€…é¡¶å±‚å±æ€§çš„åˆå§‹åŒ–éƒ½æ˜¯å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå†é…åˆä¸Šçº¿ç¨‹å®‰å…¨çš„ let å®šä¹‰ï¼Œè¿™æ‰å¯ä»¥è¾¾åˆ°å’Œ dispatch_once ç›¸åŒçš„æ•ˆæœã€‚ æ‰€ä»¥ç»¼ä¸Šï¼Œå»ºè®®ä½¿ç”¨ static let void æ¥ä»£æ›¿ lazy var voidã€‚ <!-- ### Xcode 16 & Swift 6 é‚£ä¹ˆåœ¨æœ€æ–°çš„ Xcode 16 ä¸­å‘¢ï¼Ÿ Xcode 16 ä¼šè‡ªåŠ¨æ·»åŠ  `@MainActor`ï¼Œ ->","link":"https://blog.rakuyoo.top/thread-safety-with-lazy/"},{"title":"åœ¨ Xcode playground ä¸­é¢„è§ˆ View è§†å›¾","content":"è®°å½•ä¸€ä¸ªæ€»æ˜¯å¿˜è®°çš„æ“ä½œï¼š import UIKit import PlaygroundSupport let image = UIImage(named: &quot;winnie.png&quot;) let imageView = UIImageView(image: image) PlaygroundPage.current.liveView = imageView åœ¨ Xcode playground ä¸­ï¼Œå¦‚æœå¼•å…¥ PlaygroundSupport åº“ï¼Œèµ‹å€¼ PlaygroundPage.current.liveViewï¼Œå¯ä»¥å°†è§†å›¾æ˜¾ç¤ºåœ¨å³ä¾§çš„é¢„è§ˆæ¡†ï¼Œä¹Ÿå°±æ˜¯ Live View ä¸­ã€‚ å¦å¤–ä¸åªæ˜¯ UIViewï¼ŒUIViewController åŠå…¶å­ç±»ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒPlaygroundPage.current.liveView = controller å³å¯ã€‚ ","link":"https://blog.rakuyoo.top/preview-in-xcode-playground/"},{"title":"epoxyæºç ç¬”è®°2ï¼šåœ¨æ‰©å±•ä¸­å®šä¹‰å­˜å‚¨å±æ€§","content":"å¸¸è§„çš„åœ¨æ‰©å±•ä¸­å®šä¹‰å­˜å‚¨å±æ€§çš„æ–¹æ³•æ˜¯å€ŸåŠ© Objective-C çš„ runtime è¿›è¡Œå±æ€§å…³è”ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä»…é™äº ObjC ç±»ï¼Œé‚£ä¹ˆçº¯ Swift ç±»ï¼Œæ¯”å¦‚ç»“æ„ä½“è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ åœ¨ epoxy è¿™ä¸ªåº“ä¸­å‘ç°äº†è§£å†³åŠæ³•ã€‚ Objective-C runtime å…ˆè¯´ä¸€ä¸‹ç”¨ Objective-C runtime çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š private var loadingViewKey: Void? extension HUDProtocol { public var loadingView: LoadingView { get { if let view = objc_getAssociatedObject(self, &amp;loadingViewKey) as? LoadingView { return view } loadingView = LoadingView() return loadingView } set { objc_setAssociatedObject(self, &amp;loadingViewKey, newValue, .OBJC_ASSOCIATION_RETAIN_NONATOMIC) } } } ä½¿ç”¨ loadingViewKey å…³è” loadingView å±æ€§ï¼ŒåŒæ—¶ get æ–¹æ³•å†…è¿˜åšäº†ä¸€æ¬¡æ‡’åŠ è½½ã€‚å¯¹äº Key çš„å®šä¹‰å½¢å¼å¤šç§å¤šæ ·ï¼Œè¿™é‡Œå°±ä¸åšè¿‡åº¦èµ˜è¿°ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç¿»çœ‹ epoxy ä»£ç ä¸­å‘ç°ï¼Œåœ¨ä½¿ç”¨å…³è”å±æ€§ç»™ ObjC ç±»å¢åŠ å­˜å‚¨å±æ€§æ—¶ï¼Œè¿˜æ˜¯ç”¨åˆ°äº† @nonobjcã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªçº¯ Swift åº“ï¼Œæ‰€ä»¥ä½¿ç”¨ @nonobjc æ¥é¿å…ç”Ÿæˆ objc æ¥å£ä¹Ÿæ˜¯å¾ˆåˆç†çš„ä¼˜åŒ–ã€‚ Epoxy ä¸­çš„åšæ³• è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æºç ï¼Œæ¯”å¦‚ DidChangeStateProviding.swift è¿™ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­å†…å®¹å¦‚ä¸‹ï¼š æˆ‘ä¼šçœç•¥æ‰ä¸€äº›å’Œæœ¬æ–‡æ— å…³çš„æ³¨é‡Šå’Œå†…å®¹ï¼Œå®Œæ•´çš„å†…å®¹è¯·ç‚¹å‡»ä¸Šæ–¹é“¾æ¥æŸ¥çœ‹åŸå§‹ä»£ç ã€‚ extension CallbackContextEpoxyModeled { public typealias DidChangeState = (CallbackContext) -&gt; Void public var didChangeState: DidChangeState? { get { self[didChangeStateProperty] } set { self[didChangeStateProperty] = newValue } } private var didChangeStateProperty: EpoxyModelProperty&lt;DidChangeState?&gt; { .init(keyPath: \\Self.didChangeState, defaultValue: nil, updateStrategy: .chain()) } } å¯ä»¥çœ‹åˆ°ä¸Šè¿°ä»£ç æ‰©å±•äº† CallbackContextEpoxyModeledï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰äº†å­˜å‚¨å±æ€§ didChangeStateã€‚ ç»†çœ‹ didChangeStateï¼Œå‘ç°ç”¨åˆ°äº† subscript è¯­æ³•ã€‚æ¥ç€æŸ¥çœ‹ CallbackContextEpoxyModeled çš„å£°æ˜ï¼š public protocol CallbackContextEpoxyModeled: EpoxyModeled { associatedtype CallbackContext } å‘ç°ä»…ä»…æ˜¯ä¸€ä¸ªåè®®ã€‚æ¥ç€å¾€ä¸‹çœ‹ï¼Œå®ƒæ‰€éµå¾ªçš„ EpoxyModeled åœ¨è¿™é‡Œè¿›è¡Œå®šä¹‰ã€‚ å…³é”®ä»£ç å¦‚ä¸‹ï¼š public protocol EpoxyModeled { /// The underlying storage of this model that stores the current property values. var storage: EpoxyModelStorage { get set } } extension EpoxyModeled { /// Stores or retrieves a value of the specified property in `storage`. public subscript&lt;Property&gt;(property: EpoxyModelProperty&lt;Property&gt;) -&gt; Property { get { storage[property] } set { storage[property] = newValue } } } ä»è¿™é‡Œæ„Ÿè§‰EpoxyModeledå°±æ˜¯ä¸€ä¸ªå£³ï¼Œç”¨æ¥å°è£… storage è¿™ä¸ªå±æ€§ã€‚ä¸Šé¢æåˆ°çš„ subscript è¯­æ³•å…¶å®ä¹Ÿæ˜¯å¯¹ storage çš„ subscript çš„è°ƒç”¨ã€‚ ä½†æ˜¯è¿™é‡Œå°±å¤æ‚äº†ä¸€äº›ï¼ŒåŒæ—¶å‡ºç°äº† EpoxyModelStorage å’Œ EpoxyModelProperty ä¸¤ä¸ªç±»å‹ã€‚è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ EpoxyModelStorageã€‚ EpoxyModelStorage è¯¥ç±»å‹åœ¨è¿™é‡Œè¿›è¡Œå®šä¹‰ã€‚ ä¾ç„¶è´´å‡ºæ¥ä¸€äº›å…³é”®ä»£ç ï¼š public struct EpoxyModelStorage { public init() { } /// Stores or retrieves the value of the specified property. public subscript&lt;Property&gt;(property: EpoxyModelProperty&lt;Property&gt;) -&gt; Property { get { guard let propertyStorage = storage[property.keyPath] else { return property.defaultValue() } // This cast will never fail as the storage is only settable via this subscript and the `KeyPath` key is unique for any provider and value type pair. // swiftlint:disable:next force_cast return propertyStorage.value as! Property } set { // We first update the value without using the `updateStrategy` since the likely scenario // is that there won't be a collision that requires the `updateStrategy`, and we'll be able to // return without incurring the cost of another write. let propertyStorage = PropertyStorage(value: newValue, property: property) guard var replaced = storage.updateValue(propertyStorage, forKey: property.keyPath) else { return } // This cast will never fail as the storage is only settable via this subscript and the // `KeyPath` key is unique for any provider and value type pair. // swiftlint:disable:next force_cast replaced.value = property.updateStrategy.update(replaced.value as! Property, newValue) storage[property.keyPath] = replaced } } // MARK: Private /// The underlying storage for the properties, with a key of the `EpoxyModelProperty.keyPath` and /// a value of the property's `PropertyStorage`. /// /// Does not include default values. private var storage = [AnyKeyPath: PropertyStorage]() } // MARK: - PropertyStorage /// A value stored within an `EpoxyModelStorage`. private struct PropertyStorage { /// The type-erased value of the `EpoxyModelProperty`. var value: Any /// The property's corresponding `EpoxyModelProperty`, erased to an `AnyEpoxyModelProperty`. var property: AnyEpoxyModelProperty } å¯ä»¥çœ‹åˆ°åœ¨ EpoxyModelStorage ä¸­å®šä¹‰äº†ä¸€ä¸ªå…³é”®çš„å­˜å‚¨å±æ€§ storageï¼Œè¯¥å±æ€§æ˜¯å­—å…¸ç±»å‹ï¼Œä½¿ç”¨ KeyPath åš Keyï¼ŒValue æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§ã€‚ä½†æ˜¯è¿™é‡Œå…¶å® PropertyStorage ä¸æ˜¯é‡ç‚¹ï¼Œå› ä¸ºç”¨åˆ° PropertyStorage.property çš„ä»£ç å¹¶ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´ä¹‹å†…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°† storage è¿›è¡Œç®€åŒ–ï¼Œå°±å½“ä½œ [AnyKeyPath: Any] ç±»å‹æ¥å¯¹å¾…ã€‚ å†å›çœ‹ EpoxyModelStorage çš„ subscript å®ç°ï¼Œè‡³æ­¤å…¶å®æˆ‘ä»¬å·²ç»èƒ½æ˜ç™½ Epoxy åœ¨ extension ä¸­å®šä¹‰å­˜å‚¨å±æ€§çš„åŸç†ï¼šå…¶å®å°±æ˜¯ç”¨ KeyPath åš keyï¼Œå°†å­˜å‚¨å±æ€§å¯¹åº”çš„å€¼å­˜å‚¨åˆ°å†…éƒ¨çš„ä¸€ä¸ªå­—å…¸å±æ€§ä¸­ã€‚ çœ‹åˆ°è¿™é‡Œä¼šä¸ä¼šæœ‰ç‚¹å¤±æœ›ï¼Ÿæœ‰çš„äººè¿˜ä¼šè¯´è¿™æ˜¯è„±è£¤å­æ”¾å±ï¼Œç†ç”±å¦‚ä¸‹ï¼š åœ¨éœ€è¦ extension å®šä¹‰å­˜å‚¨å±æ€§çš„ç±»å‹é‡Œæ‰‹åŠ¨å®šä¹‰ä¸€ä¸ª [String: Any]ï¼Œç„¶ååœ¨ extension é‡Œæ“ä½œè¿™ä¸ªå­—å…¸ä¸ä¹Ÿèƒ½è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœå—ï¼Ÿè¿˜è‡³äºè´¹è¿™ä¹ˆå¤§åŠ²å†™è¿™ä¹ˆå¤šå°è£…ï¼Ÿ è€Œä¸”ä¸€ç‚¹ä¹Ÿä¸çµæ´»ï¼Œä¸åƒæ˜¯ObjCä¸€æ ·éšå†™éšç”¨ï¼Œæ— éœ€æ›´æ”¹åŸç±»å‹çš„å®šä¹‰ã€‚ è¿˜æœ‰ï¼Œå› ä¸º protocol æ˜¯ public çš„ï¼Œé‚£ä¹ˆ storage å¿…ç„¶ä¼šè¢«æš´éœ²ç»™å¤–ç•Œï¼Œé€ æˆä¸€å®šç¨‹åº¦çš„éšæ‚£ã€‚ ç–‘é—®æš‚ä¸”æŒ‰ä¸‹ä¸è¡¨ï¼Œå†æ¥çœ‹çœ‹ EpoxyModelProperty è¿™ä¸ªç±»å‹ã€‚ EpoxyModelProperty å…ˆçœ‹å®šä¹‰ï¼š public struct EpoxyModelProperty&lt;Value&gt; { /// Creates a property identified by a `KeyPath` to its provided `value` and with its default value if not customized in content by consumers. /// /// The `updateStrategy` is used to update the value when updating from an old value to a new value. public init&lt;Model&gt;( keyPath: KeyPath&lt;Model, Value&gt;, defaultValue: @escaping @autoclosure () -&gt; Value, updateStrategy: UpdateStrategy) { self.keyPath = keyPath self.defaultValue = defaultValue self.updateStrategy = updateStrategy } /// The `KeyPath` that uniquely identifies this property. public let keyPath: AnyKeyPath /// A closure that produces the default property value when called. public let defaultValue: () -&gt; Value /// A closure used to update an `EpoxyModelProperty` from an old value to a new value. public let updateStrategy: UpdateStrategy } // MARK: EpoxyModelProperty.UpdateStrategy extension EpoxyModelProperty { /// A closure used to update an `EpoxyModelProperty` from an old value to a new value. public struct UpdateStrategy { public init(update: @escaping (Value, Value) -&gt; Value) { self.update = update } /// A closure used to update an `EpoxyModelProperty` from an old value to a new value. public var update: (_ old: Value, _ new: Value) -&gt; Value } } // MARK: Defaults extension EpoxyModelProperty.UpdateStrategy { /// Replaces the old value with the new value when an update occurs. public static var replace: Self { .init { _, new in new } } /// Chains the new closure value onto the old closure value, returning a new closure that first calls the old closure and then subsequently calls the new closure. public static func chain() -&gt; EpoxyModelProperty&lt;(() -&gt; Void)?&gt;.UpdateStrategy { .init { old, new in guard let new = new else { return old } guard let old = old else { return new } return { old() new() } } } /// Chains the new closure value onto the old closure value, returning a new closure that first calls the old closure and then subsequently calls the new closure. public static func chain&lt;A&gt;() -&gt; EpoxyModelProperty&lt;((A) -&gt; Void)?&gt;.UpdateStrategy { .init { old, new in guard let new = new else { return old } guard let old = old else { return new } return { a in old(a) new(a) } } } // Add more arities as needed } EpoxyModelProperty æœ‰ä¸‰ä¸ªå±æ€§ï¼škeyPathã€defaultValue å’Œ updateStrategyã€‚ keyPath å’Œ defaultValue é…åˆèŒƒå‹å¯ä»¥å¾ˆå¥½çš„è§£å†³ objc_getAssociatedObject ä¸­ç±»å‹è½¬æ¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å›çœ‹ä¸Šé¢æåˆ°è¿‡çš„è¿™ä¸ªä»£ç ç‰‡æ®µï¼š // This cast will never fail as the storage is only settable via this subscript and the `KeyPath` key is unique for any provider and value type pair. // swiftlint:disable:next force_cast return propertyStorage.value as! Property è¿™ä¹Ÿå°±è§£ç­”äº†ä¸Šé¢æåˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä»…ä»…å®šä¹‰ä¸€ä¸ª [String: Any]ï¼Œé‚£ä¹ˆ String ç±»å‹çš„ Key å’Œ Any ç±»å‹çš„ Value æ˜æ˜¾æ— æ³•ä¿è¯å¯¹é½ã€‚ é‚£ä¹ˆä½ å¯èƒ½æƒ³è¯´æ”¹æˆ [KeyPath: Any] å‘¢ï¼Ÿç­”æ¡ˆä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚å› ä¸ºåœ¨è°ƒç”¨ subscript æ—¶ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ KeyPathï¼Œåˆ™ä¼šè§¦å‘ç³»ç»Ÿé»˜è®¤çš„é€šè¿‡ KeyPath å–å€¼çš„æ–¹æ³•ï¼Œä¸ä¼šèµ°è‡ªå®šä¹‰çš„ subscriptï¼Œæ‰€ä»¥ Map çš„ Key æ— è®ºå¦‚ä½•éƒ½éœ€è¦è‡ªå®šä¹‰ç±»å‹æ¥åŒ…ä¸€å±‚ï¼Œæ—¢ç„¶è¦åŒ…ä¸€å±‚ï¼Œä½•ä¸ç›´æ¥è¿ defaultValue ä¹Ÿå°è£…ä¸€ä¸‹å‘¢ï¼Ÿ è‡³äº updateStrategy å®šä¹‰äº†å±æ€§èµ‹å€¼æ—¶çš„æ–¹æ³•ï¼Œæ˜¯æ›¿æ¢åŸå€¼ï¼Ÿè¿˜æ˜¯ä¸¤ä¸ªå€¼éƒ½æ‰§è¡Œï¼Ÿè™½ç„¶å®ƒå’Œæœ¬æ–‡å†…å®¹æ— å…³ï¼Œä½†æ˜¯è¿™ä¸ªå®ç”¨çš„å±æ€§ç¡®å®ä¹Ÿæ˜¯ EpoxyModelProperty çš„å¿…è¦æ€§ä¹‹ä¸€ã€‚ è§£å†³ç–‘é—® é’ˆå¯¹ä¸Šè¿°ä¸‰ä¸ªé—®é¢˜ï¼š ä¸ºä½•ä¸æ‰‹åŠ¨å®šä¹‰ [String: Any]ï¼Ÿepoxy å±äºè¿‡åº¦å°è£… ç¼ºä¹çµæ´»æ€§ï¼Œè€Œä¸”éœ€è¦æ›´æ”¹åŸç±»å‹çš„å®šä¹‰ã€‚å¯¹äºæ— æ³•æ›´æ”¹å®šä¹‰çš„ç±»å‹ï¼Œåˆ™æ— æ³•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚ å› ä¸º protocol æ˜¯ public çš„ï¼Œå¯¼è‡´ storage ä¼šè¢«æš´éœ²ç»™å¤–ç•Œï¼Œé€ æˆä¸€å®šç¨‹åº¦çš„éšæ‚£ã€‚ é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç”¨ protocol è§„èŒƒå±æ€§å®šä¹‰åœ¨ Swift ä¸­ç»å¯¹ä¸ç®—æ˜¯è¿‡åº¦å°è£…ï¼Œè€Œæ˜¯å¾ˆå¸¸è§çš„æ–¹æ³•ï¼›å› ä¸ºæ— æ³•ç›´æ¥ä½¿ç”¨ KeyPath ç±»å‹ä½œä¸º Map çš„Keyï¼Œä¸ºäº†ä¿æŒç±»å‹å®‰å…¨ï¼Œåœ¨ä¸Šå±‚è°ƒç”¨ä¸­ä¹Ÿæ— æ³•ç›´æ¥ä½¿ç”¨ AnyKeyPathï¼Œæ‰€ä»¥å¿…ç„¶éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç±»å‹æ¥åšè°ƒç”¨é“¾ä¸­çš„ â€œç´¢å¼•â€ã€‚ è€Œä¸”å…¶ä»–ä¸¤ä¸ªé—®é¢˜ç¡®å®æ˜¯å®é™…å­˜åœ¨çš„ã€‚ç‰¹åˆ«æ˜¯ç¬¬äºŒä¸ªé—®é¢˜ï¼Œé™¤éä½¿ç”¨ objc_getAssociatedObject æ¥å®ç°ç›¸å…³åè®®ï¼Œå¦åˆ™åˆ™æ— æ³•ä½¿ç”¨è¿™å¥—æ–¹æ³•ã€‚ è‡³äºç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œè€ƒè™‘åˆ°å¤–éƒ¨å¯¹è¯¥ç±»å‹çš„æ‰©å±•æ€§ï¼Œæš´éœ² storage å±æ€§ç»™å¤–ç•Œæ˜¯å¿…ç„¶çš„ï¼Œå¦åˆ™å¤–éƒ¨å¦‚ä½•ç»™è¿™ä¸ªç±»å‹å¢åŠ æ–°çš„å­˜å‚¨å±æ€§å‘¢ï¼Ÿé™¤éä½ æ˜ç¡®ä¸å…è®¸å¤–éƒ¨ç»™è¿™ä¸ªç±»å‹å¢åŠ å­˜å‚¨å±æ€§ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª internal type åŒ…ä¸€å±‚ Mapã€‚ ç®€åŒ–ä»£ç  ç°åœ¨è®©æˆ‘ä»¬å­¦ä»¥è‡´ç”¨ï¼Œè€ƒè™‘ä¸€ä¸‹å¦‚ä½•ç®€åŒ–ä»£ç ã€‚ å…³é”®ç±»å‹æ˜¯ä¸‰ä¸ªåè®®ï¼šEpoxyModeledã€EpoxyModelStorage å’Œ EpoxyModelPropertyï¼Œç®€åŒ–è‚¯å®šä¹Ÿæ˜¯é’ˆå¯¹è¿™ä¸‰ä¸ªç±»å‹è¿›è¡Œç®€åŒ–ã€‚ ä½†æ˜¯å…¶å®å¯ä»¥åˆ å‡çš„ç©ºé—´å¹¶ä¸å¤šï¼Œä»…ä»…åœ¨ä½ ä¸éœ€è¦ updateStrategy æ—¶ï¼Œå¯ä»¥å°†å®ç°ç®€åŒ–ä¸ºä¸‹é¢çš„è¿™æ ·ï¼š public struct ModelProperty&lt;Value&gt; { public init&lt;Model&gt;( keyPath: KeyPath&lt;Model, Value&gt;, defaultValue: @escaping @autoclosure () -&gt; Value ) { self.keyPath = keyPath self.defaultValue = defaultValue } public let keyPath: AnyKeyPath public let defaultValue: () -&gt; Value } public struct ModelStorage { private var storage = [AnyKeyPath: Any]() public init() { } public subscript&lt;Property&gt;(property: ModelProperty&lt;Property&gt;) -&gt; Property { get { guard let propertyStorage = storage[property.keyPath] else { return property.defaultValue() } return propertyStorage as! Property } set { storage[property.keyPath] = newValue } } } public protocol Modeled { var storage: ModelStorage { get set } } extension Modeled { public subscript&lt;Property&gt;(property: ModelProperty&lt;Property&gt;) -&gt; Property { get { storage[property] } set { storage[property] = newValue } } } å…¶å®ä¸Šè¿°ä»£ç ä¹Ÿå°±ç›¸å½“äº updateStrategy = .replace çš„æƒ…å†µã€‚ä¸è¿‡ï¼ŒæŸ¥çœ‹è¿™ä»½ç®€åŒ–çš„ä»£ç æ˜¯ä¸æ˜¯æ„Ÿè§‰æ•´ä¸ªé€»è¾‘éƒ½æ›´æ¸…æ™°äº†å‘¢ğŸ˜ åœ¨è°ƒç”¨ä¸Šå’ŒåŸæœ¬å®ç°ä¹Ÿæ²¡æœ‰åŒºåˆ«ï¼š struct Action: Modeled { var storage = ModelStorage() } extension Action { var testString: String { get { self[testStringProperty] } set { self[testStringProperty] = newValue } } private var testStringProperty: ModelProperty&lt;String&gt; { .init(keyPath: \\Self.testString, defaultValue: &quot;default&quot;) } } var testAction = Action() print(testAction.testString) // &quot;default&quot; testAction.testString = &quot;123&quot; print(testAction.testString) // &quot;123&quot; å¯¹äº†ï¼ŒModeled ä¸­çš„ subscript å…¶å®å±äºç®€åŒ–ä»£ç çš„æ“ä½œï¼Œå¦‚æœå»æ‰è¿™éƒ¨åˆ†ä»£ç ï¼Œé‚£ä¹ˆåœ¨ testString çš„ get å’Œ set ä¸­ï¼Œä½¿ç”¨ self.storage[testStringProperty] ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸å½±å“ä¸»è¦é€»è¾‘ã€‚ ","link":"https://blog.rakuyoo.top/epoxy-source-code-notes-2/"},{"title":"Github Actionï¼šåœ¨æ­¥éª¤ä¹‹é—´å…±äº«æ•°æ®","content":"Github Action å„ä¸ª Setp ä¹‹é—´æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥å‡å¦‚æˆ‘ä»¬åœ¨ A Step ä¸­å®šä¹‰äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œåœ¨æ¥ä¸‹æ¥çš„ Step ä¸­æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚ é‚£ä¹ˆæ€ä¹ˆå…±äº«å‘¢ï¼Ÿåœ¨æœ€æ–°çš„ Github Action ä¸­ï¼Œå¯ä»¥é€šè¿‡ Environment files æ¥å®ç°ã€‚ Environment files å®ƒçš„åšæ³•æ˜¯é€šè¿‡ä¸€ä¸ªç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼Œåœ¨å„ä¸ªStepä¹‹é—´å…±äº«è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ã€‚ å®˜æ–¹çš„ä¾‹å­å¦‚ä¸‹æ‰€ç¤ºï¼š steps: - name: Set the value id: step_one run: | echo &quot;action_state=yellow&quot; &gt;&gt; &quot;$GITHUB_ENV&quot; - name: Use the value id: step_two run: | printf '%s\\n' &quot;$action_state&quot; # This will output 'yellow' echo &quot;action_state=yellow&quot; &gt;&gt; &quot;$GITHUB_ENV&quot; è¿™æ®µå°±æ˜¯å…³é”®ä»£ç äº†ã€‚ è¢«æŠ›å¼ƒçš„ set-env å¦‚æœä½ åœ¨ Google ä¸Šæœç´¢è¿‡è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œä½ å¯èƒ½ä¼šæœåˆ°è¿™ç¯‡æ–‡ç« ï¼šGitHub Actions ç¬¬15å¤©ï¼šåœ¨æ­¥éª¤ä¹‹é—´å…±äº«æ•°æ®ã€‚ è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„ set-env æ–¹æ³•ï¼Œåœ¨åç»­çš„ Github Action ä¸­è¢«ç¦æ­¢ä½¿ç”¨äº†ï¼Œè¯¦è§å®˜æ–¹åšæ–‡ï¼šGitHub Actions: Deprecating set-env and add-path commands åœ¨æœ¬æ–‡æ’°å†™æ—¶ï¼Œå¦‚æœåœ¨ Github Action ä¸­æ²¡æœ‰ç»è¿‡ä»»ä½•é…ç½®åœ°å»ä½¿ç”¨ set-env çš„è¯ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼ŒStep æ‰§è¡Œå¤±è´¥ã€‚ â€œEnvironment filesâ€ çš„åšæ³•ä¹Ÿå¹¶ä¸éº»çƒ¦ï¼Œåè€Œè§‰å¾—æ¯” set-env ç®€å•å¾ˆå¤šï¼Œæ‰€ä»¥å°±ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•å§ã€‚ ","link":"https://blog.rakuyoo.top/share-env-between-steps-in-github-action/"},{"title":"UIImage.size And CGImage.size","content":"è®°å½•ä¸€ä¸ªæœ€è¿‘å‘ç°çš„å°ç»†èŠ‚ï¼šUIImage.size å’Œ CGImage.size åœ¨ä¸€äº›æƒ…å†µä¸‹æ˜¯ä¸ç›¸ç­‰çš„ã€‚ å¦‚æœä½ çš„å›¾ç‰‡æ˜¯æ·»åŠ åˆ° Assets.xcassets å¹¶è®¾ç½®äº† 1xã€2x ç­‰ä¸åŒè§„æ ¼ï¼Œé‚£ä¹ˆ UIImage.size çš„å¤§å°å°†å§‹ç»ˆç­‰äº 1x æ—¶å€™çš„å°ºå¯¸ï¼Œä¸è®ºå½“å‰æœºå‹å®é™…ä½¿ç”¨äº†å“ªç§è§„æ ¼çš„å›¾ç‰‡ã€‚ è€Œ CGImage.size è¿”å›çš„åˆ™æ˜¯ UIImage.size * ImageScale ä¹‹åçš„ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœè¯¥å›¾ç‰‡æ˜¯ 2x å›¾ï¼Œé‚£ä¹ˆ CGImage.size å°±ä¼šæ˜¯ UIImage.size çš„äºŒå€ã€‚ è¿™ä¸€é—®é¢˜åœ¨ä½¿ç”¨ CGImage ç”»å›¾ä¼šæš´éœ²å‡ºæ¥ï¼Œå¾ˆå¤šæ—¶å€™ä¼šä½¿ç”¨ UIImage.size æˆ–è€… UIImageView.size è®¾ç½®ç”»å¸ƒï¼Œç„¶è€Œå› ä¸ºå¿½ç•¥äº† CGImage.sizeï¼Œå°±ä¼šå¯¼è‡´ç”»å‡ºæ¥çš„å›¾ç‰‡å°ºå¯¸åå¤§ï¼Œå‡ºç°æ˜¾ç¤ºçš„å›¾ç‰‡è¢«å‰ªè£çš„é—®é¢˜ã€‚ ","link":"https://blog.rakuyoo.top/uiimage-size-and-cgimage-size/"},{"title":"åŠ é€Ÿ git submodule","content":"iOS ä¸­æœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹æ•°æ®åº“å°è£…ï¼šGRDBã€‚è¯¥ç»„ä»¶ä½¿ç”¨äº† git submodule æ¥ä¾èµ– SQLiteLibã€‚ è¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬åªä½¿ç”¨ä¹‹å‰ä»‹ç»è¿‡çš„ è®¾ç½® SPM Mirrorï¼Œé‚£ä¹ˆè¿™ä¸ªå­æ¨¡å—å°±ä¼šæ˜¯ä¸€ä¸ªæ¼ç½‘ä¹‹é±¼ã€‚ é‚£ä¹ˆæ€ä¹ˆä¸ºè¿™ä¸ªå­æ¨¡å—è®¾ç½®é•œåƒå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ git config --global url.[New].insteadOf [Old] å‘½ä»¤æ¥æ›¿æ¢ url ä¸­çš„æŸä¸ªéƒ¨åˆ†ã€‚å¯ä»¥å‚è€ƒï¼šEasier Git Repository Cloning with insteadOf New æ˜¯é•œåƒ urlï¼Œè€Œ Old æ˜¯ github urlï¼Œè®¾ç½®åæˆ‘ä»¬å¯ä»¥é€šè¿‡ git config --global -l æˆ–è€… git config --global -e å‘½ä»¤æ¥æŸ¥çœ‹æ˜¯å¦è®¾ç½®æˆåŠŸã€‚ è®¾ç½®æˆåŠŸåä¸è®ºæ˜¯æ‰§è¡Œ git clone æˆ–è€… git submodule update --initï¼Œéƒ½ä¼šé€šè¿‡é•œåƒ url å»æ‰§è¡Œäº†ã€‚ ","link":"https://blog.rakuyoo.top/speed-up-git-submodule/"},{"title":"æå–ipaæ–‡ä»¶","content":"æœ‰çš„æ—¶å€™æˆ‘ä»¬æƒ³è¦çœ‹çœ‹æŸä¸ª App çš„èµ„æºæ–‡ä»¶ï¼Œæˆ–è€…å•çº¯çœ‹çœ‹å®ƒå¼•ç”¨äº†å“ªäº›ä¸‰æ–¹åº“ç­‰ã€‚è¿™äº›å†…å®¹åªè¦æœ‰ä¸€ä¸ª ipa æ–‡ä»¶å°±å¯ä»¥çœ‹ï¼Œä¹Ÿæ— éœ€ç ¸å£³ã€‚ æœ¬æ–‡å°±è®°å½•ä¸€ä¸‹å¦‚ä½•ç®€å•çš„æå–æ‰‹æœºä¸­ App çš„ ipa æ–‡ä»¶ã€‚ é¦–å…ˆç¡®ä¿æ‰‹æœºä¸Šå·²ç»å®‰è£…äº†è¯¥ appã€‚ éšååœ¨ mac ä¸Šä¸‹è½½ Apple çš„å®˜æ–¹è½¯ä»¶ Apple Configurator å®‰è£…åæ‰“å¼€ï¼Œæ‰‹æœºè¿æ¥Macåä¼šåœ¨è½¯ä»¶ä¸Šæ˜¾ç¤ºå½“å‰è®¾å¤‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š é€‰ä¸­è®¾å¤‡ï¼Œéšåç‚¹å‡»å³ä¸Šè§’çš„ â€œæ·»åŠ â€ æŒ‰é’®ï¼Œé€‰æ‹© Appï¼š åœ¨å¼¹å‡ºçš„åˆ—è¡¨ä¸­é€‰æ‹©è¦æå– ipa çš„ Appï¼Œéšåç‚¹å‡» â€œæ·»åŠ â€ æŒ‰é’®ï¼š è¿™ä¸€æ­¥æœ‰å¯èƒ½ä¼šæç¤ºä½ è¦ç™»é™† Apple IDã€‚å‡ºç°è¿™ç§æƒ…å†µè¦ä¹ˆæ˜¯ä½ çš„ Mac æ²¡æœ‰ç™»å½•ï¼Œè¦ä¹ˆæ˜¯ä½ çš„æ‰‹æœºå’Œ Mac ç™»å½•çš„ä¸æ˜¯åŒä¸€ä¸ª IDã€‚æŒ‰ç…§æç¤ºç™»å½•å³å¯ã€‚ å› ä¸ºæˆ‘ä»¬çš„æ‰‹æœºä¸Šå·²ç»å®‰è£…äº†è¯¥ appï¼Œæ‰€ä»¥ Apple Configurator è‚¯å®šæ˜¯è£…ä¸ä¸Šçš„ï¼Œä¼šå¼¹å‡ºä¸‹é¢çš„å¼¹çª—ï¼š æ­¤æ—¶ä¸è¦æ“ä½œ Apple Configuratorï¼æ‰“å¼€ Finder è®¿è¾¾ Appï¼Œä½¿ç”¨å¿«æ·é”® Command + Shift + G æ‰“å¼€è·³è½¬å¼¹çª—ï¼Œåœ¨å¼¹çª—ä¸­è¾“å…¥ä¸‹é¢çš„è·¯å¾„ï¼š ~/Library/Group Containers/K36BKF7T3D.group.com.apple.configurator/Library/Caches/Assets/TemporaryItems/MobileApps/ è¿›åˆ°è·¯å¾„ä¸‹ï¼Œä¸€å±‚å±‚ç‚¹åˆ°æœ€é‡Œé¢ï¼Œå°±å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ ipa åŒ…äº†ï¼š Apple Configurator å¼¹çª—å…³é—­åï¼Œè¯¥ ipa å°±ä¼šè‡ªåŠ¨åˆ é™¤ã€‚æ‰€ä»¥è¯·åœ¨å…³é—­è½¯ä»¶ä¹‹å‰å°† ipa æ‹·è´å‡ºæ¥ã€‚ ","link":"https://blog.rakuyoo.top/extract-ipa-file/"},{"title":"Tuist æ³¨æ„äº‹é¡¹","content":"æœ€è¿‘åœ¨å­¦ä¹ ä½¿ç”¨ Tuist ç”Ÿæˆé¡¹ç›®ï¼Œæ‘†è„±çƒ¦äººçš„ .xcodeprojã€‚ä½†æ˜¯ Tuist å¥½ç”¨è™½ç„¶å¥½ç”¨ï¼Œä½†æ˜¯å› ä¸ºæœ€è¿‘æ–‡æ¡£æ­£åœ¨è¿ç§»ï¼ŒåŠ ä¹‹ä¸€äº›ä¸œè¥¿åªèƒ½ä»ç¤ºä¾‹ä¸­å‘æ˜ï¼Œæ•´ä¸ªå­¦ä¹ è¿‡ç¨‹æœ‰ç‚¹è´¹åŠ²ã€‚æ‰€ä»¥å¼€ä¸€ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹ã€‚ UIKit æ¨¡ç‰ˆ åœ¨æœ‰çš„åœ°æ–¹ä½ å¯ä»¥çœ‹åˆ° â€œé€šè¿‡ tuist init --template swiftui åˆ›å»º SwiftUI é¡¹ç›®â€ã€‚ä¹Ÿå°±æ˜¯è¯´é»˜è®¤æ˜¯åˆ›å»º UIKit é¡¹ç›®ã€‚ ä½†æ˜¯ï¼UIKit çš„æ¨¡æ¿å·²ç»åœ¨è¿™ä¸ª PR ä¸­è¢«åˆ é™¤ç²¾ç®€æ‰ï¼Œå¹¶è·Ÿéš 4.0.0 ç‰ˆæœ¬ä¸€èµ·å‘å¸ƒäº†ã€‚æ‰€ä»¥å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ 4.0+ ç‰ˆæœ¬çš„ Tuistï¼Œé‚£ä¹ˆæ‰§è¡Œ init æ“ä½œåé»˜è®¤ç”Ÿæˆçš„å°±æ˜¯ SwiftUI é¡¹ç›®äº†ã€‚ å®˜æ–¹è®¤ä¸ºå¤§å¤šæ•°äººå·²ç»è¿ç§»åˆ°SwiftUIäº†... æ‰€ä»¥å¦‚æœä½ æƒ³åˆ›å»º UIKit é¡¹ç›®ï¼Œé‚£ä¹ˆä½ æœ‰ä¸¤ç§ï¼ˆæˆ–è€…æ›´å¤šï¼‰é€‰æ‹©ï¼š æ‰‹åŠ¨æŠŠ UIKit æ¨¡æ¿ä»è¯¥ PR ä¸­æ‰¾å›æ¥ã€‚ æ¯åˆ›å»ºä¸€ä¸ªé¡¹ç›®éƒ½æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ Info.plist ä»¥åŠæ·»åŠ  AppDelegate ç­‰æ–‡ä»¶ã€‚ å› ä¸ºæˆ‘æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥æ˜¯æ‰‹åŠ¨æ·»åŠ çš„ç›¸å…³æ–‡ä»¶ã€‚ å¦‚æœé‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼šè§£å†³ä»SwiftUIè¿å›UIKitæ—¶ï¼ŒSceneDelegateä¸æ‰§è¡Œçš„é—®é¢˜ã€‚ä¹‹å‰å·²ç»ä¸ºè¿™ä¸ªé—®é¢˜å•ç‹¬å‘è¿‡ä¸€ç‰‡æ–‡ç« äº†ï¼Œè¿™é‡Œå†é‡å¤æä¸€ä¸‹ã€‚ èµ„æºç”Ÿæˆ Tuist é›†æˆäº† SwiftGen æ¥å®ç°èµ„æºç”Ÿæˆï¼Œæ‰€ä»¥ SwiftGen çš„æ¨¡æ¿å¯ä»¥ç›´æ¥æ‹¿åˆ° Tuist é‡Œä½¿ç”¨ã€‚ Tuist çš„é»˜è®¤æ¨¡å—åœ¨è¿™é‡Œï¼šTemplatesã€‚ ä»¥æ–‡ä»¶èµ„æºçš„ç”Ÿæˆä¸ºä¾‹ï¼Œè¿™ä¸ªé»˜è®¤æ¨¡æ¿ å’Œ SwiftGen çš„ structured-swift5.stencil æ¨¡æ¿å‡ ä¹ä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ä¸€äº› SwiftFormat å’Œ SwiftLint çš„å†…å®¹ã€‚ ä¸åŒ…å«ç›®å½•å±‚çº§ SwiftGen å¯¹äºä¸€ç§èµ„æºæœ‰å¤šä¸ªé»˜è®¤æ¨¡ç‰ˆï¼Œæ¯”å¦‚æ–‡ä»¶èµ„æºè¿˜æœ‰ flat-swift5.stencil è¿™ä¸ªä¸åŒ…å«æ–‡ä»¶å¤¹å±‚çº§çš„æ¨¡ç‰ˆã€‚å•ç‹¬ä½¿ç”¨ SwiftGen çš„è¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ --templateName å‚æ•°æ¥ä½¿ç”¨è¯¥æ¨¡æ¿ï¼Œä½†æ˜¯ Tuist é‡Œæ¯ç§ç±»å‹çš„èµ„æºåªæœ‰ä¸€ç§æ¨¡æ¿ã€‚ æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³ç”Ÿæˆçš„èµ„æºä¸åŒ…å«æ–‡ä»¶å¤¹ç›®å½•å±‚çº§ï¼Œåªèƒ½å‚è€ƒTuistå®˜æ–¹æ–‡æ¡£çš„å†…å®¹è‡ªå®šä¹‰æ¨¡æ¿ï¼š If you want to provide your own templates to synthesize accessors to other resource types, which must be supported by SwiftGen, you can create them at Tuist/ResourceSynthesizers/{name}.stencil, where the name is the camel-case version of the resource. Resource Template name strings Strings.stencil assets Assets.stencil plists Plists.stencil fonts Fonts.stencil coreData CoreData.stencil interfaceBuilder InterfaceBuilder.stencil json JSON.stencil yaml YAML.stencil files Files.stencil æ³¨æ„ï¼Œå®˜æ–¹çš„è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯æ›¿æ¢äº†é»˜è®¤å®ç°ï¼Œç›¸å…³ä»£ç åº”è¯¥æ˜¯è¿™é‡Œã€‚ å¦‚æœä½ ä¸æƒ³è¦†ç›–é»˜è®¤å®ç°ï¼Œæƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥å‚è€ƒapp_with_pluginsè¿™ä¸ªç¤ºä¾‹ã€‚ è‡ªå®šä¹‰è§£æç±»å‹ æ–‡æ¡£æœ€åçš„éƒ¨åˆ†æœ‰æåˆ°ï¼Œå¯ä»¥é€šè¿‡ Project.resourceSynthesizers å±æ€§æ¥è®¾ç½®æœ¬é¡¹ç›®è‡ªåŠ¨ä¸ºå“ªäº›ç±»å‹çš„èµ„æºç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚ è¿™ä¸ªå±æ€§æ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œå…¶é»˜è®¤å€¼å®šä¹‰åœ¨è¿™é‡Œï¼š extension [ResourceSynthesizer] { public static var `default`: Self { [ .strings(), .assets(), .plists(), .fonts(), ] } } å¯è§ä½¿ç”¨çš„æ˜¯é»˜è®¤æ¨¡æ¿ï¼Œè€Œä¸”ä¸åŒ…å« .filesã€‚å¦‚æœæœ‰éœ€è¦çš„è¯åˆ™éœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚ ç¦ç”¨èµ„æºç”Ÿæˆ è™½ç„¶ä½ å¤§æ¦‚ç‡ä¸éœ€è¦ï¼Œä¸è¿‡è¿˜æ˜¯æä¸€å˜´ã€‚æ–‡æ¡£ä¸­ä¹Ÿæœ‰è¯´æ˜ï¼Œé‚£å°±æ˜¯å¯ä»¥é€šè¿‡è®¾ç½® Project.Options.disableSynthesizedResourceAccessors å±æ€§ï¼Œæ¥ç¦ç”¨èµ„æºçš„è‡ªåŠ¨ç”Ÿæˆã€‚ ç»„ä»¶åŒ– Tuist åº”è¯¥æ˜¯å®æ–½ç»„ä»¶åŒ–çš„å¥½æ‰‹ã€‚ ç›®å½•ç»“æ„ é¦–å…ˆè®©æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ç›®å½•ç»“æ„ï¼Œè¿™å…³ç³»åˆ°æˆ‘ä»¬å¦‚ä½•ç»„ç»‡ä¸»é¡¹ç›®å’Œå„ä¸ªç»„ä»¶ã€‚ åœ¨å®˜æ–¹æ–‡æ¡£é‡Œæˆ‘ä»¬èƒ½çœ‹åˆ°å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š Tuist/ Config.swift Package.swift ProjectDescriptionHelpers/ Projects/ App/ Project.swift Feature/ Project.swift Workspace.swift Tuist æ–‡ä»¶å¤¹æ˜¯ Tuist çš„ä¸€äº›é…ç½®ï¼ŒWorkspace.swift ç”¨æ¥åŒ…å«å„ä¸ª Projectsã€‚ ä½†æ˜¯å¦‚æœä½ ä»”ç»†ç¿»çœ‹è¿‡ä»–ä»¬çš„ç¤ºä¾‹çš„è¯ï¼Œæ¯”å¦‚ ios_app_with_static_frameworks å’Œ ios_app_with_framework_and_resourcesï¼Œå°±ä¼šå‘ç°å…¶å®æ ¹ç›®å½•ä¸‹çš„å†…å®¹æ˜¯å¤šå˜çš„ã€‚ å¦‚æœä½ è·Ÿæˆ‘ä¸€æ ·å¥½å¥‡ â€œä»€ä¹ˆæ˜¯æœ€ä½³å®è·µâ€ï¼Œå¯ä»¥çœ‹è¿™ä¸ªè®¨è®ºã€‚ç„¶åç»“è®ºå°±æ˜¯ï¼šæ²¡æœ‰ä»€ä¹ˆæœ€ä½³å®è·µï¼Œå®Œå…¨å–å†³äºä½ çš„ä¸ªäººç”¨æ³•å’Œä¹ æƒ¯ã€‚ Tuist çœŸçš„éå¸¸çµæ´»ï¼Œæä¾›äº†å¾ˆå¤šä¾¿æ·çš„å†™æ³•ï¼Œä¸åŒäººç”¨ Tuist ä¼šå†™å‡ºä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¼šæœ‰ä¸åŒçš„ç”¨æ³•ã€‚ Tuist vs SPM å¯¹ç›®å½•ç»“æ„æœ‰äº†ä¸€äº›æ¦‚å¿µä¹‹åï¼Œå°±è¯¥è€ƒè™‘å¦‚ä½•ç»„ç»‡å„ä¸ªç»„ä»¶äº†ã€‚ å®˜æ–¹æ–‡æ¡£é‡Œæœ‰ä¸€ç¯‡æ–‡ç« ï¼šMigrate local Swift Packages è®²çš„æ˜¯å¦‚ä½•å°†æœ¬åœ°çš„ SPM ç»„ä»¶è¿ç§»åˆ° Tuistï¼Œæ”¹ä¸ºä½¿ç”¨ Tuist ç®¡ç†ã€‚ å›½å¤–åº”è¯¥æ˜¯å·²ç»æ²¡æœ‰ä»€ä¹ˆäººç”¨ CocoaPods åšç»„ä»¶åŒ–ç®¡ç†äº†ï¼Ÿ... è¿™é‡Œæˆ‘ä¹Ÿæ¨èä½¿ç”¨ Tuist + Multiple Projects æ¥åšå­ç»„ä»¶ã€‚é¦–å…ˆ SPM è¦æ¯” CocoaPods æ›´ç°ä»£æ›´å®˜æ–¹ï¼Œä½†æ˜¯ SPM æœ¬èº«æœ‰æ€§èƒ½é—®é¢˜ï¼Œå†åŠ ä¸Šå›½å†…è®¿é—®é—®é¢˜ï¼Œæ‰€ä»¥çœŸè¦å®é™…ç”¨èµ·æ¥å¾ˆéº»çƒ¦ã€‚å¦å¤–ä½¿ç”¨ Tuist æ¥ç®¡ç†é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„ SwiftGenï¼Œä¸ç”¨å†åœ¨ SPM é‡Œè¿›è¡Œç›¸å…³é…ç½®ã€‚æœ€åä¸å¾—ä¸æçš„æ˜¯ï¼Œç”¨ Tuist åŠ è½½ä¾èµ–æ˜¯çœŸçš„å¿«... å•ç‹¬è¿è¡Œç»„ä»¶ æˆ‘ä¸ªäººå¯¹ç»„ä»¶åŒ–çš„æ ‡å‡†æ˜¯æ¯ä¸ªå­ç»„ä»¶åº”è¯¥éƒ½èƒ½ç‹¬ç«‹ç¼–è¯‘ï¼Œè¿›ä¸€æ­¥èƒ½ç‹¬ç«‹è¿è¡Œã€‚åŸºäºè¿™ä¸ªæ ‡å‡†çš„è¯ï¼Œä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚ å–„ç”¨è½¯é“¾æ¥ é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ Tuist/ProjectDescriptionHelpers æ˜¯ä¸èƒ½è¢«å­é¡¹ç›®è¯»å–çš„ï¼Œæ¯”å¦‚å‰æ–‡æåˆ°çš„ç›®å½•ç»“æ„ä¸­ï¼š Tuist/ Config.swift Package.swift ProjectDescriptionHelpers/ Projects/ App/ Project.swift Feature/ Project.swift Tuist/ Config.swift Package.swift Workspace.swift åœ¨ Projects/Feature ä¸­æ‰§è¡Œ tuist generate å‘½ä»¤æ—¶ï¼Œæ˜¯è¯»å–ä¸åˆ°æ ¹ç›®å½•ä¸­ Tuist/ProjectDescriptionHelpers é‡Œçš„å…¬å…±æ–¹æ³•çš„ã€‚ ä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•æ˜¯ä½¿ç”¨è½¯é“¾æ¥ï¼Œå°† ProjectDescriptionHelpers æ–‡ä»¶å¤¹è½¯é“¾åˆ° Projects/Feature/Tuist é‡Œã€‚ åŒç† Tuist/.swiftpm/configuration/mirrors.json æ–‡ä»¶ä¹Ÿå¯ä»¥è¿™ä¹ˆåšã€‚ æ˜¯å¦éœ€è¦å¤šä¸ª Config.swift ç»è¿‡è¿›ä¸€æ­¥å®è·µï¼Œä»¥åŠç›¸å…³ è®¨è®ºï¼Œå‘ç°å…¶å®ä¸å»ºè®® æœ‰å¤šä¸ª Config.swift æ–‡ä»¶ã€‚æ‰€ä»¥ Feature/Tuist/Config.swift æ–‡ä»¶åº”è¯¥æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚ æˆ‘ç°åœ¨ä½¿ç”¨çš„ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š Tuist/ Config.swift Package.swift ProjectDescriptionHelpers/ Projects/ App/ Project.swift Components/ FeatureA/ Project.swift FeatureB/ Project.swift Workspace.swift ä¹Ÿå°±æ˜¯è¯´å„ä¸ªç»„ä»¶å†…å®Œå…¨æ²¡æœ‰ Tuist æ–‡ä»¶å¤¹ï¼ˆä¾èµ–éƒ¨åˆ†åœ¨ Tuist/ProjectDescriptionHelpers è¿›è¡Œäº†å°è£…ï¼‰ è¿™æ—¶å‡å¦‚æˆ‘ä»¬åœ¨ Projects/Components/FeatureA ç›®å½•ä¸‹æ‰§è¡Œ tuist generateï¼Œå…¶å®è¯»å–çš„æ˜¯æ ¹ç›®å½•ä¸­ Tuist çš„é…ç½®ï¼Œç”Ÿæˆçš„æ˜¯ App é¡¹ç›®è€Œä¸æ˜¯ç»„ä»¶é¡¹ç›®ã€‚ è¿™ä¸ªæ—¶å€™è‚¯å®šæ˜¯ä¸èƒ½æ»¡è¶³ â€œç»„ä»¶ç‹¬ç«‹è¿è¡Œâ€ çš„ï¼Œå› ä¸ºç°åœ¨è¿™ä¸ªç»„ä»¶ç®—æ˜¯ä¸€ä¸ª libï¼Œæ²¡æœ‰å‰ç«¯ AppDelegate ç­‰ç›¸åº”å…¥å£å»è¿è¡Œ Appã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦æ”¹æˆè¿™ç§æ–¹å¼å‘¢ï¼Ÿä¸€æ˜¯åŸºäºå®˜æ–¹æ¨èçš„ä¸è¦ä½¿ç”¨å¤šä¸ª Config.swift çš„å»ºè®®ï¼›äºŒæ˜¯å’Œç¾¤å‹è®¨è®ºåï¼Œå‘ç°ä¸€èˆ¬æµ‹è¯•ä¸€ä¸ª lib æ—¶ä¼šå•ç‹¬å»ºä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œæ¯”å¦‚ FeatureATestï¼Œè¯¥æµ‹è¯•é¡¹ç›®ä¸åœ¨ FeatureA ä¸‹ï¼›ä¸‰æ˜¯ç†æƒ³å¾ˆä¸°æ»¡ç°å®å¾ˆéª¨å¹²ï¼Œè¯æ˜¯è¿™ä¹ˆè¯´ï¼Œä½†æ˜¯å®é™…ä¸Šå‡ ä¹ä¸ä¼šå•ç‹¬è¿è¡ŒæŸä¸ª libã€‚ æ‰€ä»¥åŸºäºä»¥ä¸Šä¸‰ä¸ªç†ç”±ï¼Œå¦‚æœæœªæ¥éœ€è¦å•ç‹¬æµ‹è¯•æŸä¸ª libï¼Œé‚£ä¹ˆæœ€ä½³å®è·µåº”è¯¥æ˜¯æ–°å»ºä¸€ä¸ªç›¸å…³çš„ Test é¡¹ç›®ã€‚ ","link":"https://blog.rakuyoo.top/tuist-notes/"},{"title":"è§£å†³ä»SwiftUIè¿å›UIKitæ—¶ï¼ŒSceneDelegateä¸æ‰§è¡Œçš„é—®é¢˜","content":"æœ€è¿‘åœ¨ç ”ç©¶ Tuistï¼Œä¸€ä¸ªç”¨æ¥ç®¡ç† Xcode é¡¹ç›®çš„å·¥å…·ã€‚è¿™ä¸ªå·¥å…·å¥½åƒä» 4.0 ç‰ˆæœ¬å¼€å§‹ï¼Œåˆ›å»ºæ–°é¡¹ç›®é»˜è®¤å°±æ˜¯ SwiftUI æ¨¡ç‰ˆäº†ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å†ä» SwiftUI æ”¹å› UIKitã€‚ åœ¨æ”¹åŠ¨è¿‡ç¨‹ä¸­å‘ç° SceneDelegate ä¸æ‰§è¡Œï¼Œæœç´¢äº†ä¸€ç•ªåæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚ å…·ä½“çš„æ”¹åŠ¨æ–¹æ³•å’Œæµç¨‹å¯ä»¥å‚è€ƒï¼šHow to migrate from SwiftUI to UIKit App Delegate Life Cycle in Xcode è§£å†³æ–¹æ¡ˆå‡ºè‡ªè¿™é‡Œï¼šApp migrated to UIKit lifecycle doesn't call SceneDelegate æ’ä¸€å˜´ï¼ŒçœŸæ²¡æƒ³åˆ°è¿˜ä¼šæœ‰å…¶ä»–äººä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜... å¦‚ä¸Šè¿°é—®é¢˜é‡Œæ‰€è®²çš„é‚£æ ·ï¼Œè¿™ä¸ª bug çš„æ ¹æœ¬é—®é¢˜å¯èƒ½æ˜¯ï¼š do not turn off support multiple windows. It seems that disabling multiple windows prevents UIKit from launching a new scene when the previous scene is no longer available. ä¹Ÿå°±æ˜¯è¯´ SwiftUI çš„ @main å…¥å£æ²¡äº†ï¼ŒåŒæ—¶å› ä¸ºä¸æ”¯æŒå¤šçª—å£ï¼Œæ‰€ä»¥å¯¼è‡´åœ¨å½“å‰åœºæ™¯ä¸å¯ç”¨æ—¶ï¼Œæ— æ³•åˆ›å»º SceneDelegate çš„æ–°åœºæ™¯ã€‚ è§£å†³æ–¹æ¡ˆé™¤äº†æŠŠè®¾å¤‡ä¸Šçš„ app åˆ é™¤é‡æ–°å®‰è£…ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æŠŠ Info.plist ä¸­çš„ scene configurations manifest åˆ é™¤ï¼Œç„¶åæ‰‹åŠ¨åˆ›å»ºå®ƒï¼š class AppDelegate: NSObject, UIApplicationDelegate { func application(_ application: UIApplication, configurationForConnecting connectingSceneSession: UISceneSession, options: UIScene.ConnectionOptions) -&gt; UISceneConfiguration { let configuration = UISceneConfiguration(name: nil, sessionRole: connectingSceneSession.role) if connectingSceneSession.role == .windowApplication { configuration.delegateClass = SceneDelegate.self } return configuration } } æ³¨æ„ï¼Œå¦‚æœä¸åˆ é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ä¸ä¼šè°ƒç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦åˆ é™¤ç„¶åæ‰‹åŠ¨åˆ›å»ºã€‚ æœ€ååæ§½ä¸€ä¸‹ï¼ŒçœŸçš„æ²¡æƒ³åˆ° iOS å°±è¿è¿™ä¸ªä¹Ÿä¼šæœ‰ç±»ä¼¼ â€œç¼“å­˜â€ çš„é—®é¢˜... æƒ³åˆ°äº† LaunchScreen ... ","link":"https://blog.rakuyoo.top/jie-jue-cong-swiftui-qian-hui-uikit-shi-scenedelegate-bu-zhi-xing-de-wen-ti/"},{"title":"CSSé€‰æ‹©å™¨","content":"CSS æœ‰å¤šç§é€‰æ‹©å™¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é’ˆå¯¹ä¸åŒçš„ HTML æ ‡ç­¾è®¾ç½®æ ·å¼ã€‚ é€‰æ‹©å™¨ é€šé…ç¬¦é€‰æ‹©å™¨ é€šé…ç¬¦é€‰æ‹©å™¨ï¼ˆ*ï¼‰å¯ä»¥é€‰æ‹©ä»»ä½•å…ƒç´ ï¼Œé€šå¸¸ç”¨äºè®¾ç½®é»˜è®¤æ ·å¼ã€‚ * { margin: 0; padding: 0; } ç±»å‹é€‰æ‹©å™¨ ç±»å‹é€‰æ‹©å™¨ï¼ˆType Selectorsï¼‰ç›´æ¥ä½¿ç”¨ HTML æ ‡ç­¾æ¥é€‰æ‹©é€‰æ‹©å…ƒç´ ï¼š p { color: blue; } ä¸Šé¢çš„ä»£ç å°†æ‰€æœ‰çš„ &lt;p&gt; æ ‡ç­¾æ–‡æœ¬æ¸²æŸ“ä¸ºè“è‰²ã€‚ class é€‰æ‹©å™¨ ä¸ªäººç†è§£ class é€‰æ‹©å™¨ä»£è¡¨ç€ â€œä¸€ç±»æœ‰ç€ç›¸åŒæ ·å¼çš„æ ‡ç­¾â€ï¼Œæ‰€ä»¥è¯¥é€‰æ‹©å™¨å¯ä»¥ç”¨äºå¤šä¸ª HTML æ ‡ç­¾ã€‚ ç±»é€‰æ‹©å™¨ä½¿ç”¨ . å¼€å¤´ï¼Œåæ¥ç±»åï¼š &lt;style&gt; .first { font-weight: bold; text-decoration: line-through; } &lt;/style&gt; &lt;p class=&quot;first&quot;&gt;è¶…è¶ŠæŠ€æœ¯&lt;/p&gt; &lt;div&gt;å“ˆå“ˆ.&lt;/div&gt; &lt;p&gt;ä¸€èµ·å­¦å‰ç«¯!&lt;/p&gt; ä¸€ä¸ªæ ‡ç­¾ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ª classï¼Œå¤šä¸ª class ä¹‹é—´ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼š &lt;!-- åŒ…å«ä¸¤ä¸ª classï¼šinfo å’Œ highlight --&gt; &lt;p class=&quot;info highlight&quot;&gt;...&lt;/p&gt; æ­¤å¤–ï¼Œå½“ä½ åœ¨ä¸åŒçš„ HTML æ ‡ç­¾ä¸­ä½¿ç”¨äº†ç›¸åŒçš„ classï¼Œç„¶åè¿˜æƒ³é€‰æ‹©æŸä¸ªå…·ä½“çš„æ ‡ç­¾æ—¶ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·ç»„åˆä½¿ç”¨ä¸¤ä¸ªé€‰æ‹©å™¨ï¼š &lt;style&gt; p.first { color: red; } &lt;/style&gt; &lt;p class=&quot;first&quot;&gt;è¯¥é¢œè‰²ä¼šæ˜¯çº¢è‰²&lt;/p&gt; &lt;span class=&quot;first&quot;&gt;è¯¥é¢œè‰²ä¸ä¼šæ˜¯çº¢è‰²&lt;/span&gt; id é€‰æ‹©å™¨ ä¸ªäººç†è§£è¿™é‡Œçš„ id åœ¨ä½¿ç”¨åœºæ™¯ä¸Šå°±å’Œæ•°æ®åº“ä¸­çš„ä¸»é”®ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥å®šä½æŸä¸ªå”¯ä¸€çš„ HTML æ ‡ç­¾ï¼Œæ‰€ä»¥è¯¥é€‰æ‹©å™¨æˆ–è€…è¯´ id å±æ€§çš„å€¼ï¼Œåœ¨ HTML æ–‡æ¡£ä¸­éœ€è¦æ˜¯å”¯ä¸€çš„ï¼Œä¸èƒ½å‡ºç°åœ¨å¤šä¸ªå…ƒç´ ä¸Šã€‚ id é€‰æ‹©å™¨ä½¿ç”¨ # å·æ¥å®šä¹‰ï¼š &lt;style&gt; #my-id { background-color: yellow; } &lt;/style&gt; &lt;p id=&quot;my-id&quot;&gt;è¶…è¶ŠæŠ€æœ¯&lt;/p&gt; &lt;div&gt;å“ˆå“ˆ.&lt;/div&gt; &lt;p&gt;ä¸€èµ·å­¦å‰ç«¯!&lt;/p&gt; å› ä¸º id é€‰æ‹©å™¨çš„å”¯ä¸€æ€§ï¼Œæ‰€ä»¥å°±æ²¡å¿…è¦åƒä¸Šé¢æåˆ°çš„ class é€‰æ‹©å™¨ä¸€æ ·ï¼Œé€šè¿‡æ ‡ç­¾å†è¿›ä¸€æ­¥ç¼©å°é€‰æ‹©èŒƒå›´äº†ã€‚ å±æ€§é€‰æ‹©å™¨ æˆ‘ä»¬éƒ½çŸ¥é“å¯ä»¥åœ¨ html æ ‡ç­¾ä¸Šè‡ªå®šä¹‰ä»»æ„çš„å±æ€§ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š &lt;!-- `data-rakuyo` ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºå®ƒä¸æ˜æ‰€ä»¥ï¼› ä½†æ˜¯å®ƒåˆå¾ˆå¥½ï¼Œå¯ä»¥ä¸€çœ¼è®©ä½ çœ‹å‡ºå®ƒæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§ã€‚ --&gt; &lt;div data-rakuyo&gt;...&lt;/div&gt; å±æ€§é€‰æ‹©å™¨ä½¿ç”¨ [] ä¸­æ‹¬å·åŒ…è£¹å±æ€§åç§°ã€‚é’ˆå¯¹ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å±æ€§é€‰æ‹©å™¨æ¥é€‰æ‹©è¯¥ div æ ‡ç­¾ï¼š /* é€‰æ‹©æ‰€æœ‰å¸¦æœ‰ `data-rakuyo` å±æ€§çš„å…ƒç´ ï¼Œä¸è®ºå…¶æ‰€å±å“ªä¸ª html æ ‡ç­¾ */ [data-rakuyo] { font-weight: bold; } å†è¿›ä¸€æ­¥ç¼©å°èŒƒå›´ï¼Œå±æ€§é€‰æ‹©å™¨å¯ä»¥é€šè¿‡æŒ‡å®šæ ‡ç­¾æ¥ç­›é€‰ â€œå…·æœ‰æŸäº›å±æ€§çš„æ ‡ç­¾â€ï¼š /* ä»…é™å¸¦æœ‰ `data-style` å±æ€§çš„ &lt;button&gt; æ ‡ç­¾ */ button[data-style] { font-weight: bold; } å¯ä»¥é€šè¿‡å…·ä½“çš„å±æ€§å€¼æ¥åšæ¡ä»¶ç­›é€‰ï¼š &lt;style&gt; [data-style=&quot;cancel&quot;] { color: gray; } [data-style=&quot;done&quot;] { color: black; } &lt;/style&gt; &lt;button data-style=&quot;cancel&quot;&gt;å–æ¶ˆ&lt;/button&gt; &lt;button data-style=&quot;done&quot;&gt;ä¸‹å•&lt;/button&gt; å±æ€§é€‰æ‹©å™¨è¿˜å¯ä»¥å€ŸåŠ©ä¸€äº›åŒ¹é…æ“ä½œç¬¦ï¼Œæ¯”å¦‚ $= å’Œ *= æ¥å®ç°ç‰¹å®šçš„åŠŸèƒ½ï¼š /* é€‰æ‹© `src` å±æ€§ä»¥ `https` å¼€å¤´çš„æ‰€æœ‰å›¾ç‰‡ */ img[src^=&quot;https&quot;] { color: red; } /* é€‰æ‹© `src` å±æ€§ä»¥ `.jpg` ç»“å°¾çš„æ‰€æœ‰å›¾ç‰‡ */ img[src$=&quot;.jpg&quot;] { border: 3px solid black; } /* é€‰æ‹© `href` å±æ€§åŒ…å« `external` *å­—ç¬¦ä¸²* çš„æ‰€æœ‰é“¾æ¥ */ a[href*=&quot;external&quot;] { color: green; } /* é€‰æ‹© `href` å±æ€§åŒ…å« `external` *å•è¯* çš„æ‰€æœ‰é“¾æ¥ */ a[href~=&quot;external&quot;] { color: green; } æ³¨æ„ *= å’Œ ~= çš„åŒºåˆ«ã€‚å‰è€…åŒ¹é…å­—ç¬¦ä¸²ï¼Œè€Œåè€…åŒ¹é…çš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„å•è¯ã€‚ ä¼ªé€‰æ‹©å™¨ ä¼ªé€‰æ‹©å™¨åŒ…å« â€œä¼ªç±»é€‰æ‹©å™¨â€ å’Œ â€œä¼ªå…ƒç´ é€‰æ‹©å™¨â€ ä¸¤ç§ã€‚ ä¼ªç±»é€‰æ‹©å™¨ ä¼ªç±»é€‰æ‹©å™¨ç”¨äºå®šä¹‰å…ƒç´ åœ¨ç‰¹å®šçŠ¶æ€ä¸‹çš„æ ·å¼ï¼Œæ¯”å¦‚é¼ æ ‡æ‚¬åœæ—¶çš„æ ·å¼ã€‚æˆ–è€…ç”¨äºé€‰æ‹©ç¬¬nä¸ªå­å…ƒç´ ã€‚ /* è®¾ç½®è¡¨æ ¼ä¸­æŸä¸€åˆ—çš„æ–‡å­—ä¸æ¢è¡Œ */ .nowrap-column { white-space: nowrap; } å¯¹äºç‰¹å®šçŠ¶æ€ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ï¼š åç§° è¯´æ˜ ç¤ºä¾‹ :hover ç”¨äºåœ¨ç”¨æˆ·å°†é¼ æ ‡æ‚¬åœåœ¨å…ƒç´ ä¸Šæ—¶åº”ç”¨æ ·å¼ a:hover { color: red; } :active ç”¨äºé€‰å–è¢«ç”¨æˆ·æ¿€æ´»ï¼ˆä¾‹å¦‚é¼ æ ‡ç‚¹å‡»ï¼‰çš„å…ƒç´  button:active { background-color: gray; } :visited ç”¨äºé€‰å–ç”¨æˆ·å·²è®¿é—®è¿‡çš„é“¾æ¥ a:visited { color: purple; } :focus ç”¨äºé€‰å–å½“å‰è·å–äº†ç„¦ç‚¹çš„å…ƒç´ é€šå¸¸åœ¨ç”¨æˆ·é€šè¿‡é”®ç›˜æˆ–è€…é¼ æ ‡è¿›è¡Œäº¤äº’æ—¶å‡ºç° input:focus { border-color: blue; } å¯¹äºé€‰æ‹©å­å…ƒç´ ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç”¨æ³•ï¼š åç§° è¯´æ˜ ç¤ºä¾‹ :nth-of-type(n) è¯¥é€‰æ‹©å™¨å…è®¸ä½ é€‰æ‹©ç›¸åŒç±»å‹çš„ä¸”ç‰¹å®šä½ç½®çš„å­å…ƒç´ è¯·æ³¨æ„ï¼Œnä»1å¼€å§‹ï¼Œä¸”ä¸èƒ½æ˜¯è´Ÿæ•° /* è¿™ä¼šä½¿æ¯éš”ä¸¤ä¸ªæ®µè½æ–‡å­—å˜ä¸ºçº¢è‰² */ p:nth-of-type(2n) { color: red; } :nth-child(n) è¯¥é€‰æ‹©å™¨å…è®¸ä½ é€‰æ‹©ç‰¹å®šä½ç½®çš„å­å…ƒç´  /* åˆ—è¡¨ä¸­çš„å¥‡æ•°é¡¹èƒŒæ™¯è‰²å˜ä¸ºæµ…ç°è‰² */ li:nth-child(odd) { background-color: lightgray; } :nth-last-child(n) è¯¥é€‰æ‹©å™¨ä¸:nth-child(n)ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä»å…ƒç´ çš„æœ«å°¾å¼€å§‹è®¡æ•°ã€‚ /* * è¿™ä¼šä½¿æ¯ä¸ªæ— åºåˆ—è¡¨ï¼ˆulï¼‰çš„ * å€’æ•°ç¬¬äºŒä¸ªåˆ—è¡¨é¡¹ï¼ˆliï¼‰çš„æ–‡å­—é¢œè‰²å˜ä¸ºè“è‰² */ ul li:nth-last-child(2) { color: blue; } :first-childâ€œnth-child(1)â€ è¯¥é€‰æ‹©å™¨é€‰å–æŸä¸ªå…ƒç´ çš„ç¬¬ä¸€ä¸ªå­å…ƒç´  /* * è¿™ä¼šä½¿æ¯ä¸ªæ— åºåˆ—è¡¨ï¼ˆulï¼‰çš„ç¬¬ä¸€ä¸ªåˆ—è¡¨é¡¹ï¼ˆliï¼‰çš„æ–‡å­—åŠ ç²— */ ul li:first-child { font-weight: bold; } :last-childâ€œnth-last-child(1)â€ è¯¥é€‰æ‹©å™¨é€‰å–æŸä¸ªå…ƒç´ çš„æœ€åä¸€ä¸ªå­å…ƒç´  /* * è¿™ä¼šä½¿æ¯ä¸ªæ— åºåˆ—è¡¨ï¼ˆulï¼‰ * çš„æœ€åä¸€ä¸ªåˆ—è¡¨é¡¹ï¼ˆliï¼‰çš„æ–‡å­—å˜ä¸ºæ–œä½“ */ ul li:last-child { font-style: italic; } æˆ‘è§‰å¾— :nth-of-type å’Œ :nth-child çš„æ¦‚å¿µæ¯”è¾ƒæ¥è¿‘ï¼ŒåŒæ—¶å®¹æ˜“æ··æ·†ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œç‰¹æ„å°†ä»–ä»¬ä¸¤ä¸ªå•ç‹¬æ‹¿å‡ºæ¥ï¼Œç”¨ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªé€‰æ‹©å™¨ä¹‹é—´çš„åŒºåˆ«ã€‚ &lt;div class=&quot;container&quot;&gt; &lt;p&gt;Paragraph 1&lt;/p&gt; &lt;div&gt;Div 1&lt;/div&gt; &lt;p&gt;Paragraph 2&lt;/p&gt; &lt;p&gt;Paragraph 3&lt;/p&gt; &lt;div&gt;Div 2&lt;/div&gt; &lt;/div&gt; é’ˆå¯¹ä¸Šé¢è¿™æ®µ htmlï¼Œä¸¤ä¸ªé€‰æ‹©å™¨çš„ç»“æœä¸ºï¼š é€‰æ‹©å™¨ ç»“æœ è¯´æ˜ .container p:nth-of-type(2) é€‰æ‹©åˆ° &lt;p&gt;Paragraph 2&lt;/p&gt; è¿™ä¸ªé€‰æ‹©å™¨å°†é€‰æ‹©å®¹å™¨ .container å†…çš„ç¬¬äºŒä¸ª &lt;p&gt; å…ƒç´ ã€‚åœ¨ç»™å®šçš„ HTML ç»“æ„ä¸­ï¼Œç¬¬äºŒä¸ª &lt;p&gt; å…ƒç´ æ˜¯ &quot;Paragraph 2&quot;ï¼Œå› æ­¤è¯¥é€‰æ‹©å™¨ä¼šå½±å“åˆ°è¿™ä¸ªæ®µè½å…ƒç´ ã€‚ .container p:nth-child(2) ä¸ä¼šé€‰æ‹©ä»»ä½•å…ƒç´  è¿™ä¸ªé€‰æ‹©å™¨å°†é€‰æ‹©å®¹å™¨ .container å†…æ‰€æœ‰çš„ &lt;p&gt; å…ƒç´ ä¸­çš„ç¬¬äºŒä¸ªå­å…ƒç´ ã€‚åœ¨ç»™å®šçš„ HTML ç»“æ„ä¸­ï¼Œç¬¬äºŒä¸ªå­å…ƒç´ æ˜¯ &quot;Div 1&quot;ï¼Œè€Œä¸æ˜¯ &lt;p&gt; å…ƒç´ ã€‚å› æ­¤ï¼Œè¿™ä¸ªé€‰æ‹©å™¨ä¸ä¼šé€‰æ‹©ä»»ä½•å…ƒç´ ï¼Œå› ä¸ºåœ¨è¯¥ç»“æ„ä¸­ï¼Œç¬¬äºŒä¸ªå­å…ƒç´ ä¸æ˜¯ &lt;p&gt; å…ƒç´ ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œnth-child(n) ä¼šå…ˆæŒ‰ç…§é¡ºåºé€‰æ‹©çˆ¶è§†å›¾çš„å­å…ƒç´ ï¼Œå†çœ‹è¯¥å­å…ƒç´ æ˜¯å¦ç¬¦åˆé™åˆ¶æ¡ä»¶ï¼Œå¦‚æœç¬¦åˆåˆ™æ ·å¼ç”Ÿæ•ˆï¼Œå¦åˆ™ä¸ä¼šç”Ÿæ•ˆï¼›è€Œ nth-of-type(n) åˆ™ç›¸åï¼Œä¼šå…ˆé€‰æ‹©ç¬¦åˆè¦æ±‚çš„å…ƒç´ ï¼Œå†æŒ‰ç…§é¡ºåºè¿›è¡Œé€‰æ‹©ã€‚ åŒç†å¯å¾—ï¼Œå› ä¸º :first-childã€:last-child å’Œ :nth-child(1)ã€:nth-last-child(1) ç›¸åŒï¼Œæ‰€ä»¥å‡å¦‚ä½¿ç”¨ p:fist-childï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ ‡ç­¾ä¸æ˜¯ &lt;p&gt;ï¼Œé‚£ä¹ˆè¯¥æ ·å¼ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚ ä¼ªå…ƒç´ é€‰æ‹©å™¨ ä¼ªå…ƒç´ é€‰æ‹©å™¨ç”¨äºé€‰æ‹©å…ƒç´ çš„ç‰¹å®šéƒ¨åˆ†è€Œä¸æ˜¯å…ƒç´ æœ¬èº«ã€‚ä¼ªå…ƒç´ é€‰æ‹©å™¨ä»¥åŒå†’å· :: å¼€å¤´ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ä¼ªå…ƒç´ é€‰æ‹©å™¨ï¼š /* é€‰æ‹©å…ƒç´ çš„ç¬¬ä¸€è¡Œæ–‡æœ¬ */ p::first-line { font-weight: bold; } /* é€‰æ‹©å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­—æ¯ */ p::first-letter { font-size: 150%; } /* åœ¨å…ƒç´ å†…å®¹ä¹‹å‰æ’å…¥å†…å®¹ */ p::before { content: &quot;å‰ç½®å†…å®¹ &quot;; } /* åœ¨å…ƒç´ å†…å®¹ä¹‹åæ’å…¥å†…å®¹ */ p::after { content: &quot; åç½®å†…å®¹&quot;; } /* é€‰æ‹©ç”¨æˆ·é€‰ä¸­çš„æ–‡æœ¬éƒ¨åˆ† */ ::selection { background-color: yellow; color: black; } /* é€‰æ‹©è¾“å…¥æ¡†çš„å ä½ç¬¦æ–‡æœ¬ */ input::placeholder { color: gray; } é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€äº›ä¸å¤ªå¸¸è§çš„ä¼ªå…ƒç´ é€‰æ‹©å™¨ï¼š /* é€‰æ‹©åˆ—è¡¨é¡¹çš„æ ‡è®°éƒ¨åˆ†ï¼ˆé€šå¸¸æ˜¯åˆ—è¡¨é¡¹å‰é¢çš„ç¬¦å·ï¼Œå¦‚åœ†ç‚¹æˆ–æ•°å­—ï¼‰ */ li::marker { color: red; } /* é€‰æ‹©å…ƒç´ çš„èƒŒæ™¯å±‚ï¼Œç”¨äºå¤„ç†å…¨å±å…ƒç´ çš„èƒŒæ™¯æ ·å¼ */ dialog::backdrop { background-color: rgba(0, 0, 0, 0.5); } /* é€‰æ‹©æ‹¼å†™é”™è¯¯çš„æ–‡æœ¬éƒ¨åˆ† */ ::spelling-error { text-decoration: underline wavy red; } /* é€‰æ‹©è¯­æ³•é”™è¯¯çš„æ–‡æœ¬éƒ¨åˆ† */ ::grammar-error { text-decoration: underline dashed blue; } ç»„åˆé€‰æ‹©å™¨ ç»„åˆé€‰æ‹©å™¨æ˜¯ CSS ä¸­çš„ä¸€ç§é€‰æ‹©å™¨ï¼Œå…è®¸ä½ é’ˆå¯¹åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶çš„å…ƒç´ åº”ç”¨æ ·å¼ã€‚ åä»£é€‰æ‹©å™¨ åä»£é€‰æ‹©å™¨ï¼ˆDescendant Selectorï¼‰å…è®¸ä½ é€‰æ‹©æŸä¸ªå…ƒç´ å†…éƒ¨çš„æ‰€æœ‰åä»£å…ƒç´ ã€‚ &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Descendant Selector Example&lt;/title&gt; &lt;style&gt; /* é€‰æ‹© .container å†…éƒ¨çš„æ‰€æœ‰ p å…ƒç´  */ .container p { color: blue; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;div&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.container p é€‰æ‹©å™¨ä¼šé€‰æ‹©æ‰€æœ‰åµŒå¥—åœ¨ .container å†…éƒ¨çš„ &lt;p&gt; å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬çš„é¢œè‰²è®¾ä¸ºè“è‰²ã€‚å³ä¸¤ä¸ª &lt;p&gt; æ ‡ç­¾éƒ½ä¼šå˜æˆè“è‰²ã€‚ å­é€‰æ‹©å™¨ å­é€‰æ‹©å™¨ï¼ˆChild Selectorï¼‰ç”¨äºé€‰æ‹©æŸä¸ªå…ƒç´ çš„ç›´æ¥å­å…ƒç´ ã€‚ &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Child Selector Example&lt;/title&gt; &lt;style&gt; /* é€‰æ‹© .container ä¸‹çš„ç›´æ¥å­å…ƒç´  p */ .container &gt; p { font-weight: bold; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;div&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.container &gt; p é€‰æ‹©å™¨åªä¼šé€‰æ‹© .container ç›´æ¥å­å…ƒç´ ä¸­çš„ &lt;p&gt; å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬çš„å­—ä½“åŠ ç²—ã€‚è€Œé‡Œå±‚çš„ This is another paragraph. å¹¶ä¸ä¼šè¢«åŠ ç²—ã€‚ å¯¹æ¯” åä»£é€‰æ‹©å™¨ æ¥çœ‹ï¼Œåä»£é€‰æ‹©å™¨ä¼šä¸€ç›´æŸ¥è¯¢åˆ°è¯¥å¶å­èŠ‚ç‚¹çš„æœ€æœ«ç«¯ï¼Œæ¸²æŸ“æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„æ ‡ç­¾ï¼Œä¸ç®¡ä¸­é—´æ˜¯å¦è¿˜æœ‰å…¶ä»–æ ‡ç­¾ï¼›è€Œ å­é€‰æ‹©å™¨ åªä¼šæ¸²æŸ“ä¸‹ä¸€ä¸ªå±‚çº§ï¼ˆç›´æ¥ï¼‰çš„å­èŠ‚ç‚¹ï¼Œå¹¶ä¸ä¼šè¿›ä¸€æ­¥æ·±å…¥ã€‚ ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ï¼ˆAdjacent Sibling Selectorï¼‰é€‰æ‹©ç´§æ¥åœ¨æŒ‡å®šå…ƒç´ åçš„å…„å¼Ÿå…ƒç´ ã€‚ &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Adjacent Sibling Selector Example&lt;/title&gt; &lt;style&gt; /* é€‰æ‹© .container åé¢ç´§é‚»çš„ p å…„å¼Ÿå…ƒç´  */ .container + p { color: green; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;/div&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.container + p é€‰æ‹©å™¨ä¼šé€‰æ‹©ç´§æ¥åœ¨ .container å…ƒç´ åé¢çš„ &lt;p&gt; å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬çš„é¢œè‰²è®¾ä¸ºç»¿è‰²ã€‚å³ This is another paragraph. ä¼šè¢«æ¸²æŸ“ä¸ºç»¿è‰²ã€‚ æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š â€œç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨â€ å¼ºè°ƒ ç›¸é‚»ã€‚å¦‚æœæˆ‘ä»¬å°†ä»£ç è¿›è¡Œä¿®æ”¹ï¼š &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;/div&gt; &lt;span&gt;123&lt;/span&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; æ­¤æ—¶ .container ä¸å†æœ‰ä»»ä½•ç›¸é‚»çš„ &lt;p&gt; èŠ‚ç‚¹ï¼Œæ‰€ä»¥ .container + p ä¸ä¼šé€‰æ‹©ä»»ä½•çš„æ ‡ç­¾è¿›è¡Œæ¸²æŸ“ã€‚ â€œç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨â€ åªä¼šæ¸²æŸ“ç›¸é‚»çš„ ä¸€ä¸ª èŠ‚ç‚¹ã€‚å¦‚æœæˆ‘ä»¬å°†ä»£ç è¿›è¡Œä¿®æ”¹ï¼š &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;/div&gt; &lt;p&gt;This is another paragraph. 1&lt;/p&gt; &lt;p&gt;This is another paragraph. 2&lt;/p&gt; é‚£ä¹ˆåªæœ‰ç›¸é‚»çš„ç¬¬ä¸€ä¸ª &lt;p&gt; æ ‡ç­¾ï¼Œå³ This is another paragraph. 1 ä¼šè¢«æ¸²æŸ“ä¸ºç»¿è‰²ï¼Œå¦å¤–ä¸€ä¸ª &lt;p&gt; æ ‡ç­¾ä»ä¸ºé»‘è‰²ã€‚ é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨ é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨ï¼ˆGeneral Sibling Selectorï¼‰é€‰æ‹©ä¸æŒ‡å®šå…ƒç´ ç›¸é‚»çš„æ‰€æœ‰å…„å¼Ÿå…ƒç´ ã€‚ &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;General Sibling Selector Example&lt;/title&gt; &lt;style&gt; /* é€‰æ‹© .container åçš„æ‰€æœ‰ p å…„å¼Ÿå…ƒç´  */ .container ~ p { font-style: italic; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;/div&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; &lt;p&gt;This is yet another paragraph.&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.container ~ p é€‰æ‹©å™¨ä¼šé€‰æ‹©ç´§è·Ÿåœ¨ .container å…ƒç´ åçš„æ‰€æœ‰ &lt;p&gt; å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬çš„å­—ä½“æ ·å¼è®¾ä¸ºæ–œä½“ã€‚å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼Œè¯¥é€‰æ‹©å™¨å’Œ ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ äº’ä¸ºä¸€å¯¹ã€‚ ç»„åˆé€‰æ‹©å™¨æ€»ç»“ åä»£é€‰æ‹©å™¨ï¼ˆ ï¼‰ å’Œ å­é€‰æ‹©å™¨ï¼ˆ&gt;ï¼‰ äº’ä¸ºä¸€å¯¹ï¼šåŒæ ·æ˜¯é€‰æ‹©å­å…ƒç´ ï¼Œå‰è€…ä¼šæ·±å…¥åˆ°å±‚çº§çš„æœ€æœ«ç«¯ï¼Œè€Œåè€…åªä¼šé€‰æ‹©ä¸‹ä¸€ä¸ªå±‚çº§ï¼Œç‚¹åˆ°ä¸ºæ­¢ã€‚ ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ï¼ˆ+ï¼‰ å’Œ é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨ï¼ˆ~ï¼‰ äº’ä¸ºä¸€å¯¹ï¼šåŒæ ·æ˜¯é€‰æ‹©ç›¸é‚»å…ƒç´ ï¼Œå‰è€…åªé€‰æ‹©åŒå±‚çº§å†…ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œè€Œåè€…ä¼šé€‰æ‹©åŒå±‚çº§å†…æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ã€‚ è¯¾åæ€è€ƒ ç°åœ¨æˆ‘ä»¬æå‡ºæ¥è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼šä»æ¥å£å¤„è·å–å•†å“çš„ä»·æ ¼ï¼ˆå¿½ç•¥æ¥å£è¯·æ±‚æ­¥éª¤ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªä»·æ ¼å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ &quot;Â¥35.66&quot;ã€‚é’ˆå¯¹è¯¥å­—ç¬¦ä¸²è¿›è¡Œæ¸²æŸ“ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š æ–‡å­—é¢œè‰²å‡ä¸ºçº¢è‰²ã€‚ Â¥ å’Œ .66 éƒ¨åˆ†æ ·å¼ä¸€è‡´ï¼š15å·å­—ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ Â¥ ç¬¦å·å¹¶ä¸ä¸€å®šå­˜åœ¨ã€‚ 35 éƒ¨åˆ†åŠ ç²—ï¼Œ18å·å­—ã€‚ ä½¿ç”¨ js+html+cssï¼Œç•™å‡ ç§’é’Ÿæ€è€ƒç»™å‡ºç­”æ¡ˆã€‚ ... ... ... ... ... å‚è€ƒç­”æ¡ˆå¦‚ä¸‹ï¼š &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;style&gt; /* æ ·å¼1ï¼šÂ¥ç¬¦å· 15 å·å­—ï¼Œçº¢è‰² */ .currency-sign, .after-dot { font-size: 15px; } /* æ ·å¼2ï¼šÂ¥ å’Œ . ä¹‹é—´çš„å†…å®¹ï¼Œ18å·å­—ï¼ŒåŠ ç²—ï¼Œçº¢è‰² */ .between { font-size: 18px; font-weight: bold; } .currency-sign, .after-dot, .between { color: red; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;span class=&quot;currency-value&quot;&gt;&lt;/span&gt; &lt;!-- ä½¿ç”¨ JavaScript å®šä¹‰å˜é‡ --&gt; &lt;script&gt; // å®šä¹‰å˜é‡ï¼Œä»£æ›¿æ¥å£è¯·æ±‚çš„æ­¥éª¤ const currencyValue = &quot;Â¥35.66&quot;; // è·å– span æ ‡ç­¾ const spanElement = document.querySelector('.currency-value'); // æ£€æŸ¥ span æ ‡ç­¾æ˜¯å¦å­˜åœ¨ if (spanElement) { // æ£€æŸ¥ currencyValue æ˜¯å¦åŒ…å« &quot;Â¥&quot; ç¬¦å· if (currencyValue.includes('Â¥')) { // æ¸²æŸ“ Â¥ ç¬¦å· const currencySignSpan = document.createElement('span'); currencySignSpan.innerText = 'Â¥'; currencySignSpan.classList.add('currency-sign'); spanElement.appendChild(currencySignSpan); } // åˆ å» &quot;Â¥&quot; ç¬¦å·åçš„å€¼ let valueWithoutSign = currencyValue.replace('Â¥', ''); // æŒ‰ &quot;.&quot; åˆ†éš”å€¼ const [beforeDot, afterDot] = valueWithoutSign.split('.'); // æ¸²æŸ“ &quot;.&quot; ä¹‹å‰çš„å†…å®¹ const beforeDotSpan = document.createElement('span'); beforeDotSpan.innerText = beforeDot; beforeDotSpan.classList.add('between'); spanElement.appendChild(beforeDotSpan); // æ¸²æŸ“ &quot;.&quot; ç¬¦å· å’Œ &quot;.&quot; ä¹‹åçš„å†…å®¹ const afterDotSpan = document.createElement('span'); afterDotSpan.innerText = '.' + afterDot; afterDotSpan.classList.add('after-dot'); spanElement.appendChild(afterDotSpan); } &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; ç„¶åæˆ‘ä»¬å¯ä»¥å†è¿›ä¸€æ­¥ï¼Œå¦‚æœæ”¹æˆ vue3 + TypeScript å‘¢ï¼Ÿ &lt;template&gt; &lt;span class=&quot;currency-value&quot;&gt; &lt;span v-if=&quot;hasCurrencySign&quot; class=&quot;currency-sign&quot;&gt;Â¥&lt;/span&gt; &lt;span class=&quot;between&quot;&gt;{{ beforeDot }}&lt;/span&gt; &lt;span class=&quot;after-dot&quot;&gt;.{{ finalAfterDot }}&lt;/span&gt; &lt;/span&gt; &lt;/template&gt; &lt;script setup lang=&quot;ts&quot;&gt; import { ref } from 'vue'; const currencyValue = ref&lt;string&gt;(&quot;Â¥35.66&quot;); const hasCurrencySign = currencyValue.value.includes('Â¥'); const [beforeDot, afterDot] = currencyValue.value.replace('Â¥', '').split('.'); const finalAfterDot = afterDot || '00'; &lt;/script&gt; &lt;style scoped&gt; /* æ ·å¼1ï¼šÂ¥ç¬¦å· 15 å·å­—ï¼Œçº¢è‰² */ .currency-sign, .after-dot { font-size: 15px; } /* æ ·å¼2ï¼šÂ¥ å’Œ . ä¹‹é—´çš„å†…å®¹ï¼Œ18å·å­—ï¼ŒåŠ ç²—ï¼Œçº¢è‰² */ .between { font-size: 18px; font-weight: bold; } .currency-sign, .after-dot, .between { color: red; } &lt;/style&gt; å¯è§å› ä¸º vue ä¸­çš„æ¨¡ç‰ˆå¯ä»¥ç›´æ¥å¼•ç”¨å˜é‡ï¼Œä¸ºæˆ‘ä»¬å‡å°‘äº†å¤§é‡çš„ DOM æ“ä½œï¼Œä»£ç é‡å¾—ä»¥å‡å°‘äº†ä¸å°‘ã€‚ ","link":"https://blog.rakuyoo.top/css-selector/"},{"title":"HTML å…ƒç´ æ˜¾ç¤ºæ¨¡å¼","content":"è®°å½•å‰ç«¯çš„å­¦ä¹ è¿‡ç¨‹ã€‚ æœ¬ç¯‡æ–‡ç« æ˜¯æœ€åŸºç¡€çš„ HTML éƒ¨åˆ†ã€‚ å…ƒç´ æ˜¾ç¤ºæ¨¡å¼ HTML å…ƒç´ ä¸€èˆ¬åˆ†ä¸º â€œå—å…ƒç´ â€ å’Œ â€œè¡Œå†…å…ƒç´ â€ã€‚ å—å…ƒç´  &lt;div&gt; æ˜¯æœ€å…¸å‹çš„å—å…ƒç´ ã€‚å…¶ä½™çš„è¿˜æœ‰ &lt;h1&gt; ~ &lt;h6&gt;ã€&lt;p&gt;ã€&lt;ul&gt;ã€&lt;ol&gt;ã€&lt;li&gt; ç­‰ã€‚ ç‰¹æ€§ï¼š ç‹¬å ä¸€è¡Œ é«˜åº¦ã€å®½åº¦ã€å¤–è¾¹è·å’Œå†…è¾¹è·éƒ½å¯ä»¥æ§åˆ¶ å®½åº¦é»˜è®¤æ˜¯å®¹å™¨ï¼ˆçˆ¶çº§å®½åº¦ï¼‰çš„ 100% æ˜¯ä¸€ä¸ªå®¹å™¨åŠç›’å­ï¼Œé‡Œé¢å¯ä»¥æ”¾è¡Œå†…æˆ–è€…å—çº§å…ƒç´  æ³¨æ„ï¼š æ–‡å­—ç±»å…ƒç´ å†…éƒ¨ä¸èƒ½ä½¿ç”¨å—çº§å…ƒç´  &lt;p&gt; æ ‡ç­¾ä¸»è¦ç”¨äºå­˜æ”¾æ–‡å­—ï¼Œå› æ­¤ &lt;p&gt; é‡Œé¢ä¸èƒ½æ”¾å—çº§å…ƒç´ ï¼Œç‰¹åˆ«æ˜¯ä¸èƒ½æ”¾ &lt;div&gt; åŒç†ï¼Œ&lt;h1&gt; ~ &lt;h6&gt; ç­‰éƒ½æ˜¯æ–‡å­—ç±»å—çº§æ ‡ç­¾ï¼Œé‡Œé¢ä¹Ÿä¸èƒ½æ”¾å…¶ä»–å—çº§å…ƒç´  è¡Œå†…å…ƒç´  æ˜¯æœ€å…¸å‹çš„è¡Œå†…å…ƒç´ ã€‚å…¶ä½™çš„è¿˜æœ‰ &lt;a&gt;ã€&lt;strong&gt;ã€&lt;b&gt;ã€&lt;em&gt;ã€&lt;i&gt;ã€&lt;del&gt;ã€&lt;s&gt;ã€&lt;ins&gt;ã€&lt;u&gt;ç­‰ã€‚ æœ‰çš„åœ°æ–¹ä¹Ÿå°†è¡Œå†…å…ƒç´ æˆä¸ºå†…è”å…ƒç´ ã€‚ ç‰¹æ€§ï¼š ç›¸é‚»è¡Œå†…å…ƒç´ åœ¨ä¸€è¡Œä¸Šï¼Œä¸€è¡Œå¯ä»¥æ˜¾ç¤ºå¤šä¸ª å®½ã€é«˜ç›´æ¥è®¾ç½®æ˜¯æ— æ•ˆçš„ é»˜è®¤å®½åº¦å°±æ˜¯å®ƒæœ¬èº«å†…å®¹çš„å®½åº¦ è¡Œå†…å…ƒç´ åªèƒ½å®¹çº³æ–‡æœ¬æˆ–å…¶ä»–è¡Œå†…å…ƒç´ ã€‚ æ³¨æ„ï¼š é“¾æ¥é‡Œä¸èƒ½å†æ”¾é“¾æ¥ ç‰¹æ®Šæƒ…å†µé“¾æ¥ &lt;a&gt; é‡Œé¢å¯ä»¥æ”¾å—çº§å…ƒç´ ï¼Œä½†æ˜¯ç»™ &lt;a&gt; è½¬æ¢æˆå—çº§æ¨¡å¼æœ€å®‰å…¨ ç¤ºä¾‹ ä¸‹é¢è¿™æ®µä»£ç å¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ã€‚ &lt;body&gt; &lt;h1&gt;ã€Šå‰ç«¯å°è¯¾ã€‹&lt;/h1&gt; &lt;h2&gt; ä¸€æœ¬å¸®ä½ å…¥é—¨ä¸è¿›é˜¶çš„å‰ç«¯ä¹¦ &lt;!-- h2 å’Œ p éƒ½æ˜¯å—çº§å…ƒç´ ï¼Œå†…éƒ¨å¯ä»¥ç›´æ¥åŒ…å«å…¶ä»–å…ƒç´ ï¼Œæ¯”å¦‚ &lt;hr&gt; --&gt; &lt;!-- html æ ‡ç­¾ä¹‹é—´ï¼Œé»˜è®¤å¥½åƒæ˜¯ä¼šæœ‰ä¸€äº›é—´è·çš„ã€‚æ‰€ä»¥è¿™ä¸ª &lt;hr&gt; å¦‚æœå†™åœ¨ &lt;p&gt; å¤–å±‚ï¼Œä¼šæœ‰ä¸ä¸€æ ·çš„ ui æ•ˆæœ --&gt; &lt;hr&gt; &lt;/h2&gt; &lt;!-- ç”¨ div è¿™ä¸ªå—çº§å…ƒç´ åŒ…ä¸€ä¸‹ï¼Œå¯ä»¥ä¿è¯ä»£ç å æ•´è¡Œ ä¸ç”¨ div åŒ…è£¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ çš„å¤§å°å°±æ˜¯ code çš„å¤§å° --&gt; &lt;div class=&quot;code-bg&quot;&gt; &lt;code&gt; const p = document.querySelector('p'); p.onclick = function() { alert('å™¢ï¼Œå™¢ï¼Œå™¢ï¼Œåˆ«ç‚¹æˆ‘äº†ã€‚'); } &lt;/code&gt; &lt;/div&gt; &lt;/body&gt; ","link":"https://blog.rakuyoo.top/html-element-display-mode/"},{"title":"Jellyfin + tinymediamanager + TMM åˆ®å‰Š","content":"ä½¿ç”¨ tinymediamanager é…åˆ TMMï¼ˆthemoviedbï¼‰å®ç° Jellyfin åˆ®å‰Šã€‚ ç½‘ä¸Šç°æœ‰çš„æ•™ç¨‹éƒ½æ¯”è¾ƒè€äº†ï¼Œæ‰€ä»¥å¼€ä¸€ç¯‡å¸–å­è®°å½•ä¸€ä¸‹è‡ªå·±é…ç½®çš„è¿‡ç¨‹ã€‚ TMM API Key å› ä¸ºæ˜¯ä½¿ç”¨ TMM æ¥å®ç°åˆ®å‰Šï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä¸Šå®˜ç½‘ ç”³è¯·ä¸€ä¸‹ API Keyã€‚ é¦–å…ˆä½ éœ€è¦æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œæ³¨å†Œè´¦å·æ¯”è¾ƒç®€å•ï¼Œæœ¬ç¯‡ä¸ä½œä»‹ç»ã€‚ åœ¨åˆæ¬¡ç™»å½•ï¼Œæœªé…ç½®è¿‡ API çš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ç§æ–¹æ³•è®©æˆ‘ä»¬è¿›å…¥åˆ° API ç”³è¯·é¡µé¢ï¼š ç›´æ¥æ‹‰åˆ°é¡µé¢æœ€åº•éƒ¨ï¼Œç‚¹å‡» API ã€‚ ç‚¹å‡»è‡ªå·±çš„å¤´åƒï¼Œè¿›å…¥è´¦æˆ·è®¾ç½®é¡µé¢ï¼Œç„¶åç‚¹å‡»åˆ—è¡¨å·¦ä¾§çš„ API é€‰é¡¹ã€‚ æ³¨æ„ ç”³è¯·è¿‡ API ä¹‹åå°±ä¸èƒ½ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•äº†ï¼Œä¼šè¿›å…¥æ–‡æ¡£é¡µé¢ã€‚åªèƒ½ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•æŸ¥çœ‹å·²ç»ç”³è¯·çš„ APIã€‚ åœ¨ API é€‰é¡¹é¡µé¢ï¼Œæˆ‘ä»¬é€‰æ‹© Developer ç±»å‹ï¼Œåˆ›å»º API Keyã€‚ è¿›å…¥åˆ°ä¿¡æ¯å¡«å†™é¡µé¢ï¼Œè¿™é‡Œæˆ‘å€Ÿç”¨ä¸€å¼ åˆ«äººçš„å›¾åšç¤ºä¾‹ï¼š ç»è¿‡å®é™…æµ‹è¯•ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š åº”ç”¨ä¿¡æ¯éƒ¨åˆ†ç›´æ¥æŒ‰ç…§ä¸Šå›¾æ‰€ç¤ºå¡«å†™å³å¯ï¼Œä¸€æ¨¡ä¸€æ ·å°±è¡Œã€‚ å§“åå¿…é¡»è¦ä½¿ç”¨è‹±æ–‡ã€‚ åœ°å€ä¿¡æ¯æ‰¾ä¸€ä¸ªéšæœºåœ°å€ç”Ÿæˆå™¨ç”Ÿæˆä¸€ä¸‹å³å¯ã€‚æ³¨æ„ åœ°å€1 å’Œ åœ°å€2 éƒ½è¦æœ‰ï¼Œå¯ä»¥æ˜¯ä¸­æ–‡ï¼Œä¸¤ä¸ªä¸€æ ·ä¹Ÿå¯ä»¥ã€‚ ç‚¹å‡»æäº¤åå³å¯å®Œæˆç”³è¯·ï¼Œç”³è¯·æ˜¯ç§’è¿‡çš„ï¼Œåœ¨æ–°é¡µé¢å¯ä»¥ç«‹åˆ»æŸ¥çœ‹åˆ°æˆ‘ä»¬ç”³è¯·çš„ keyï¼š æœ‰çš„æ–‡ç« é™„å›¾é‡Œï¼Œæ ‡é¢˜æ˜¾ç¤ºçš„æ˜¯ â€œAPIå¯†é’¥ï¼ˆv3 authï¼‰â€ã€‚åœ¨ TMM æœ€æ–°ç‰ˆé‡Œç›´æ¥æ˜¾ç¤º â€œAPI å¯†é’¥â€ äº†ï¼Œå…¶å®æ˜¯ä¸€å›äº‹ã€‚ NAS é…ç½® å›åˆ°ç¾¤æ™– NAS ä¸Šï¼Œé¦–å…ˆéœ€è¦é€šè¿‡ docker å®‰è£… tinymediamanager docker-compose çœæµç‰ˆï¼Œæˆ‘åšäº†ä¸€ä»½ docker-compose æ–‡ä»¶ï¼Œå¦‚æœæ‚¨æœ‰ç¼–ç¨‹ç»éªŒå¯ä»¥ç›´æ¥å‚è€ƒä½¿ç”¨ï¼š version: '3.8' services: tinymediamanager: container_name: tinymediamanager-tinymediamanager image: tinymediamanager/tinymediamanager:latest command: /app/tinyMediaManager -Dtmm.contentfolder=/data extra_hosts: - &quot;www.themoviedb.org:8.67.111.128&quot; - &quot;www.themoviedb.org:18.154.144.22&quot; - &quot;www.themoviedb.org:99.86.199.23&quot; - &quot;image.tmdb.org:84.17.46.53&quot; - &quot;image.tmdb.org:89.187.162.242&quot; - &quot;image.tmdb.org:138.199.46.66&quot; - &quot;api.themoviedb.org:13.33.33.60&quot; - &quot;api.themoviedb.org:13.224.167.10&quot; - &quot;api.themoviedb.org:99.84.192.81&quot; - &quot;api.thetvdb.org:192.241.234.54&quot; ports: - 4000:4000 volumes: - /volume1/video:/media:rw - /volume1/docker/tiny-media-manager/config:/config:rw - /volume1/docker/tiny-media-manager/data:/data:rw environment: PATH: &quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot; LANG: &quot;en_US.UTF-8&quot; LC_ALL: &quot;en_US.UTF-8&quot; USER_ID: &quot;0&quot; GROUP_ID: &quot;0&quot; APP: &quot;tinyMediaManager&quot; UMASK: &quot;0022&quot; ALLOW_DIRECT_VNC: &quot;true&quot; LC_TIME: &quot;C.UTF-8&quot; ENABLE_CJK_FONT: &quot;1&quot; restart: always privileged: true network_mode: bridge è¯¥æ–‡ä»¶è®¾ç½®äº†ä»¥ä¸‹å†…å®¹ï¼š å®¹å™¨åï¼štinymediamanager-tinymediamanager é…ç½®äº† hostsï¼Œè§£å†³ TMDB è®¿é—®é—®é¢˜ å¯ç”¨ â€œè‡ªåŠ¨é‡æ–°å¯åŠ¨â€ ä½¿ç”¨é«˜çº§æƒé™æ‰§è¡Œå®¹å™¨ ç«¯å£å· 4000 æŒ‚è½½ä»¥ä¸‹è·¯å¾„ï¼Œå‡ä¸ºè¯»å†™æƒé™ æœ¬åœ° /volume1/videoï¼ŒæŒ‚è½½åˆ°å®¹å™¨å†… /media æœ¬åœ° /volume1/docker/tiny-media-manager/configï¼ŒæŒ‚è½½åˆ°å®¹å™¨å†… /config æœ¬åœ° /volume1/docker/tiny-media-manager/dataï¼ŒæŒ‚è½½åˆ°å®¹å™¨å†… /data æ‰‹åŠ¨å®‰è£… å¦‚æœä¸æƒ³ä½¿ç”¨ docker-compose å®‰è£…ï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£… å®‰è£… tinymediamanager åœ¨æ³¨å†Œè¡¨ä¸­æœç´¢ tinymediamanagerï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©ç¬¬äºŒä¸ªå®˜æ–¹é•œåƒã€‚ å¤§éƒ¨åˆ†æ•™ç¨‹ä¸æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ª star æœ€å¤šçš„ï¼Œå°±æ˜¯é€‰æ‹©ç¬¬ä¸‰ä¸ªæ‰€è°“ â€œä¸­æ–‡æ›´å‹å¥½â€ çš„ã€‚å…¶å®åœ¨ 2024 å¹´ï¼Œå®˜æ–¹çš„ç”¨èµ·æ¥æ‰æ˜¯æœ€ç®€å•çš„ã€‚ ä¸‹è½½å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å…ˆä¸è¦æ‰“å¼€ï¼Œè¿›å…¥åç»­çš„é…ç½®æµç¨‹ã€‚ åˆ›å»º tinymediamanager å®¹å™¨ é¦–å…ˆé€šè¿‡ ssh ç™»å½•ç¾¤æ™–ï¼Œç„¶åé€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿è¡Œ tinymediamanager dockerã€‚ è¿™ä¸€æ­¥å¯ä»¥ç›´æ¥æ·»åŠ  hostï¼Œè§£å†³ tinymediamanager æ— æ³•è®¿é—®çš„é—®é¢˜ã€‚é¿å…æˆ‘ä»¬åœ¨åç»­è¿›å…¥ docker å®¹å™¨å†…éƒ¨ä¿®æ”¹ hostã€‚ ä½†æ˜¯ä¸»è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œå¦‚æœåœ¨ DSM é‡Œæ‰‹åŠ¨å…³é—­å®¹å™¨å†é‡æ–°å¯åŠ¨ï¼Œé‚£ä¹ˆ host é…ç½®å°±å¤±æ•ˆäº†ã€‚å› ä¸º TMM å®¹å™¨å†…æ²¡æœ‰ viï¼ŒåŒæ—¶è€ƒè™‘ä»¥åå†æ¬¡ä¿®æ”¹ï¼Œä¸ªäººè¿˜æ˜¯å»ºè®®å°† /etc/hosts æ–‡ä»¶æŒ‚è½½å‡ºæ¥ï¼Œç„¶ååœ¨æ–‡ä»¶å†…æ·»åŠ ä¸‹åˆ— hostã€‚ docker run \\ --name=tinyMediaManager \\ --add-host=www.themoviedb.org:8.67.111.128 \\ --add-host=www.themoviedb.org:18.154.144.22 \\ --add-host=www.themoviedb.org:99.86.199.23 \\ --add-host=image.tmdb.org:84.17.46.53 \\ --add-host=image.tmdb.org:89.187.162.242 \\ --add-host=image.tmdb.org:138.199.46.66 \\ --add-host=api.themoviedb.org:13.33.33.60 \\ --add-host=api.themoviedb.org:13.224.167.10 \\ --add-host=api.themoviedb.org:99.84.192.81 \\ --add-host=api.thetvdb.org:192.241.234.54 \\ tinymediamanager/tinymediamanager:latest è¿è¡Œåˆ°ä¸‹é¢è¿™ä¸€æ­¥å°± ok äº†ï¼š æ­¤æ—¶å®¹å™¨å·²ç»åˆ›å»ºå¥½ï¼Œæˆ‘ä»¬å¯ä»¥ ctrl+c åœæ­¢è¿è¡Œï¼Œç„¶åå›åˆ° NAS ä¸Šåœæ­¢è¯¥å®¹å™¨ï¼Œå‡†è®¸åç»­çš„ç¼–è¾‘ã€‚ é…ç½® tinymediamanager å®¹å™¨ åœ¨ docker æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª TinyMediaManager ç›®å½•ï¼Œç„¶åæ–°å»º data æ–‡ä»¶å¤¹ã€‚ åœ¨å®¹å™¨å†…æ‰¾åˆ°åˆšæ‰æ–°åˆ›å»ºå¥½çš„å®¹å™¨ï¼Œç‚¹å‡» è¯¦æƒ…-&gt;è®¾ç½® è¿›å…¥é…ç½®ã€‚ ç«¯å£å·ä½¿ç”¨é»˜è®¤æˆ–æ ¹æ®ä½ çš„å®é™…æƒ…å†µå¡«å†™ã€‚ æ–‡ä»¶å¤¹æŒ‚è½½éœ€è¦æŒ‚è½½ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯åˆšæ‰åˆ›å»ºçš„ data æ–‡ä»¶å¤¹ï¼Œå¦ä¸€ä¸ªæ˜¯ä½ å½“å‰ å­˜å‚¨å½±ç‰‡ çš„æ–‡ä»¶å¤¹ã€‚ ç¯å¢ƒå˜é‡éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š USER_ID å’Œ GROUP_ID ä¿®æ”¹ä¸º 0ï¼ˆrootç”¨æˆ·ï¼‰ã€‚ PASSWORD å¯ä»¥ç›´æ¥åˆ æ‰ã€‚ å¢åŠ  ENABLE_CJK_FONT è¿™ä¸ª keyï¼Œå€¼ä¸º 1ã€‚ å¯¹äº ENABLE_CJK_FONTï¼Œè€ç‰ˆçš„æ•™ç¨‹é‡Œéƒ½éœ€è¦æ·»åŠ ï¼Œä¸ºäº†åˆ‡æ¢ä¸ºä¸­æ–‡åæ­£å¸¸æ˜¾ç¤ºã€‚æˆ‘åœ¨è£…æœ€æ–°ç‰ˆçš„æ—¶å€™ç›´æ¥åŠ ä¸Šäº†ï¼Œæ²¡æœ‰æµ‹è¯•ä¸åŠ å¯ä»¥ä¸å¯ä»¥ã€‚ å¡«å®Œåæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œå®¹å™¨äº†ã€‚ å®˜æ–¹é•œåƒè¾ƒå…¶ä»–é•œåƒçš„ä¼˜åŠ¿ æˆªæ­¢åˆ°æœ¬æ–‡å‘å¸ƒï¼Œå®˜æ–¹é•œåƒå·²ç»æ¥åˆ°äº† 5.x çš„ç‰ˆæœ¬ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªé•œåƒè¿˜æ˜¯ 3.x çš„ç‰ˆæœ¬ã€‚ ç›¸æ¯”è¾ƒè€ç‰ˆï¼Œæ–°ç‰ˆçš„æŒ‚è½½ç›®å½•ä» /config å˜ä¸ºäº† /dataï¼Œé»˜è®¤ç«¯å£ä» 5800 å˜ä¸ºäº† 4000ã€‚ åœ¨å¯¹ä¸­æ–‡çš„æ”¯æŒä¸Šï¼Œæœ€æ–°çš„å®˜æ–¹é•œåƒå¯¹ä¸­æ–‡çš„æ”¯æŒå·²ç»å¾ˆå¥½äº†ï¼Œä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚è€Œå…¶ä»–ä¸¤ä¸ªé•œåƒç‰ˆæœ¬å¯¹ä¸­æ–‡çš„æ”¯æŒæ¯”è¾ƒéº»çƒ¦ï¼š æ•™ç¨‹ä¸­å¾€å¾€æåˆ°æˆ‘ä»¬éœ€è¦å°† /etc/cont-init.d/10-cjk-font.sh æ–‡ä»¶ä¸­çš„ http://dl-cdn.alpinelinux.org æ›¿æ¢ä¸º http://mirrors.tuna.tsinghua.edu.cn/ã€‚ æ­¤ä¸¾æ˜¯ä¸ºäº†ä¸‹è½½ä¸­æ–‡å­—ä½“ï¼Œç„¶è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ romancin çš„é•œåƒï¼Œé‚£ä¹ˆå°±ç®—æ›¿æ¢äº†ä¹Ÿæ²¡ç”¨ï¼Œè®¾ç½®ä¸ºä¸­æ–‡ä¾ç„¶ä¼šä¹±ç ã€‚è¿™æ˜¯å› ä¸ºè¯¥å­—ä½“åœ¨æ¸…åæºä¸‹å·²ç»å¤±æ•ˆäº†ï¼ˆé˜¿é‡Œäº‘å¥½åƒä¹Ÿå¤±æ•ˆäº†ï¼‰ã€‚æœ‰ç½‘å‹æåˆ°åä¸ºäº‘æ˜¯æœ‰æ•ˆçš„ï¼Œç»è¿‡æµ‹è¯•ç¡®å®å¯ä»¥ã€‚ æœ€åï¼Œåœ¨åˆ®å‰Šæ•ˆç‡å’Œç»“æœä¸Šï¼Œä¹Ÿæ˜¯æ–°ç‰ˆæ›´ä¸ºå‡ºè‰²ã€‚ tinymediamanager é…ç½® æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ http://nas-ip:4000/ è¿›å…¥ tinymediamanagerã€‚åˆå§‹æ˜¯ä¸€ä¸ªè‹±æ–‡çš„å¼•å¯¼é¡µé¢ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç›´æ¥ next å³å¯ã€‚ è¿›å…¥ä¸»é¡µé¢åï¼Œæˆ‘ä»¬è¿›å…¥è®¾ç½®ï¼Œä¿®æ”¹è¯­è¨€ä¸ºä¸­æ–‡ã€‚ ","link":"https://blog.rakuyoo.top/jellyfin-scraper-with-tmm/"},{"title":"ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨","content":"å‡å¦‚æˆ‘ä»¬æ²¡æœ‰å…¬ç½‘ IPï¼Œæˆ–è€…å…¬ç½‘ IP å‡ºç°æ•…éšœæš‚æ—¶æ— æ³•è®¿é—®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å€ŸåŠ©äº‘æœåŠ¡å™¨+WireGuardçš„å½¢å¼å®ç°å†…ç½‘ç©¿é€ã€‚ æœ¬æ–‡ä¸ºã€Šç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—æ–‡ç« çš„ç¬¬å››ç¯‡ã€‚å…¨éƒ¨æ–‡ç« è¯·å‚è€ƒï¼š ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½®DDNS ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½®WireGurad ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½®Nginxè®¿é—®DockeræœåŠ¡ ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨ æˆ‘åœ¨è…¾è®¯äº‘ä¸Šæœ‰ä¸€å° Ubuntu è½»é‡çº§æœåŠ¡å™¨ï¼Œæœ¬æ–‡å°†ä»¥å…¶ä¸ºåŸºç¡€è¿›è¡Œå„ç§é…ç½®ã€‚ äº‘æœåŠ¡å™¨é…ç½® å¢åŠ è®°å½• é¦–å…ˆæˆ‘ä»¬éœ€è¦å¢åŠ ä¸€æ¡æ–°çš„è®°å½•å€¼ï¼Œä½œä¸ºåˆ›å»º WireGuard éš§é“çš„å…¥å£ã€‚è¿™é‡Œå¯ä»¥å‚è€ƒä¹‹å‰çš„æµç¨‹ï¼šæ·»åŠ åŸŸåè®°å½•ã€‚ æ³¨æ„è¿™é‡Œçš„è®°å½•å€¼éœ€è¦å¡«å†™ä½ æœåŠ¡å™¨çš„å…¬ç½‘ IPã€‚ å¼€æ”¾ç«¯å£ æ¥ç€å»åˆ°æœåŠ¡å™¨ç®¡ç†åå°ï¼Œéœ€è¦åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾ NAS ä¸­ WireGuard çš„ç«¯å£ã€‚åœ¨å‰æ–‡ç¤ºä¾‹ä¸­ï¼Œè¯¥å€¼ä¸º 51820ã€‚ åœ¨äº‘æœåŠ¡å™¨ä¸Šé…ç½® WireGuard å®‰è£… WireGuard æœåŠ¡ é¦–å…ˆæˆ‘ä»¬ ssh åˆ°è¿œç«¯äº‘æœåŠ¡å™¨ï¼Œç„¶åå®‰è£… WireGuard æœåŠ¡ï¼š apt update &amp;&amp; apt install wireguard -y # å…ˆæ›´æ–°å†å®‰è£… è¯¥è¿‡ç¨‹å¯èƒ½ä¼šè¶…æ—¶ï¼Œå¯ä»¥è¯•ç€ä¿®æ”¹ sources.list æºè§£å†³ã€‚ åˆ›å»ºé…ç½® ç„¶åæˆ‘ä»¬åˆ›å»ºå¹¶è¿›å…¥ wireguard æ–‡ä»¶å¤¹ã€‚ mkdir /etc/wireguard cd /etc/wireguard æ¥ç€æŒ‰ç…§ é…ç½® WireGuard æœåŠ¡ç«¯ çš„æ–¹å¼ï¼Œåˆ›å»ºå…¬ç§é’¥ã€‚ æ³¨æ„è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸¤å¥—å®¢æˆ·ç«¯é…ç½®ã€‚å› ä¸ºç°åœ¨æˆ‘ä»¬æ˜¯è¦å°†è¯¥äº‘æœåŠ¡å™¨ä½œä¸º WireGuard çš„æœåŠ¡ç«¯ï¼ŒNAS å’Œæˆ‘ä»¬çš„æ“ä½œç»ˆç«¯ï¼ˆæ¯”å¦‚ Macï¼‰éƒ½æ˜¯å®¢æˆ·ç«¯ã€‚ æ¥ç€æˆ‘ä»¬åˆ›å»º wg0.conf é…ç½®æ–‡ä»¶ã€‚ å®¢æˆ·ç«¯é…ç½® NAS é…ç½® é€šè¿‡ SSH è¿æ¥ NASï¼Œè¿›å…¥ /etc/wireguard æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ wg1.conf é…ç½®æ–‡ä»¶ã€‚ ä¿å­˜æ–‡ä»¶åï¼Œé€šè¿‡ wg-quick up wg1 å‘½ä»¤å¯åŠ¨é…ç½®ã€‚æˆ–è€…å‚è€ƒå‰æ–‡è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ã€‚ å®¢æˆ·ç«¯é…ç½® å®¢æˆ·ç«¯é…ç½®å°±ç®€å•å¾ˆå¤šäº†ï¼Œå’Œå‰æ–‡ä¸­çš„æ“ä½œæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚ æ³¨æ„ç«¯å£ã€IP å³å¯ã€‚ ","link":"https://blog.rakuyoo.top/synology-with-cloud/"},{"title":"ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½®Nginxè®¿é—®DockeræœåŠ¡","content":"å½“æˆ‘ä»¬é…ç½®ç© DDNS å’Œ WireGuard ä¹‹åï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®‰å…¨çš„è®¿é—®æˆ‘ä»¬ NAS ä¸Šçš„æ–‡ä»¶ä»¥åŠå„ç§æœåŠ¡äº†ã€‚ ä½†æ˜¯å¦‚æœä½ è§‰å¾—é€šè¿‡ç«¯å£è®¿é—® Docker ä¸­å„ä¸ªæœåŠ¡å¤ªç¹çï¼Œæˆ–è€… Docker æœåŠ¡å¤ªå¤šï¼Œè¦è®°çš„ç«¯å£å¤ªå¤šã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® Nginx çš„æ–¹å¼ï¼Œæ¥ç»™å„ä¸ª Docker æœåŠ¡ç»‘å®šä¸€ä¸ªåŸŸåã€‚ æœ¬æ–‡ä¸ºã€Šç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸‰ç¯‡ã€‚å…¨éƒ¨æ–‡ç« è¯·å‚è€ƒï¼š ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½®DDNS ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½®WireGurad ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½®Nginxè®¿é—®DockeræœåŠ¡ ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨ åœ¨äº‘å¹³å°æ·»åŠ è®°å½•å€¼ å‰é¢å‡ ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åœ¨è…¾è®¯äº‘ä¸Šè®¾ç½®è¿‡å¤šæ¡ä¸»æœºè®°å½•ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å†æ·»åŠ ä¸€æ¡ä½œä¸ºæˆ‘ä»¬ Docker æœåŠ¡çš„å…¥å£åŸŸåã€‚ åŒæ ·æ˜¯åœ¨è…¾è®¯äº‘ æˆ‘çš„åŸŸå é¡µé¢ï¼Œç‚¹å‡»å·²æ³¨å†ŒåŸŸåï¼Œè¿›å…¥â€œè®°å½•ç®¡ç†â€é¡µé¢ã€‚ å•å‡»æ·»åŠ è®°å½•ï¼Œæ ¹æ®ä½ æœåŠ¡çš„éœ€æ±‚æ·»åŠ ä¸€æ¡ä¸»æœºè®°å½•ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸º calibre-web æ·»åŠ åŸŸåï¼Œé‚£ä¹ˆä¸»æœºè®°å½•å¯ä»¥å†™ calibreã€‚ è®°å½•å€¼å’Œä½  NAS çš„å†…ç½‘ IP ç›¸åŒã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è®¾ç½®çš„ 192.168.47.29ã€‚ é…ç½® NAS çš„ Nginx DSM æœ¬èº«è‡ªå¸¦ Nginxï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è‡ªå¸¦ Nginx çš„æ–¹å¼æ¥ä¸º Docker æœåŠ¡å¢åŠ é…ç½®ã€‚ DSM çš„ Nginx æ¯æ¬¡å¯åŠ¨æ—¶ä¼šæ ¹æ®æ¨¡æ¿æ–‡ä»¶é‡æ–°åˆ›å»ºï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¸ä¿®æ”¹æ–‡ä»¶æœ¬èº«ï¼Œæ‰€ä»¥æ— ç¢ã€‚ é€šè¿‡ ps aux|grep nginx å‘½ä»¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ° DSM åŠ è½½çš„æ˜¯ /etc/nginx/nginx.conf.runï¼Œåœ¨è¯¥æ–‡ä»¶æœ«å°¾æœ‰ä¸€è¡Œ include sites-enabled/*ã€‚è¿™ä»£è¡¨ç€æˆ‘ä»¬å¯ä»¥å°†æ–°å¢çš„é…ç½®æ”¾åˆ° /etc/nginx/sites-enabled æ–‡ä»¶å¤¹ä¸‹ã€‚ è¿›å…¥ sites-enabled æ–‡ä»¶å¤¹ï¼Œç„¶åé€šè¿‡ vim æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š cd /etc/nginx/sites-enabled vim calibre.baidu.com.conf # å¯ä½¿ç”¨ä½ è¦é…ç½®çš„æœåŠ¡çš„åŸŸåä½œä¸ºæ–‡ä»¶å åœ¨æ–‡ä»¶å†…å¡«å…¥ä¸‹é¢çš„å†…å®¹ï¼š server { listen 80; server_name calibre.baidu.com; # æœåŠ¡çš„åŸŸåï¼Œæ ¹æ®å®é™…æƒ…å†µæ›¿æ¢ #charset koi8-r; #access_log /var/log/nginx/host.access.log main; location / { proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; proxy_redirect off; proxy_pass http://172.17.0.1:8083; # å¡«å†™ç¾¤æ™–å®¹å™¨è¯¦æƒ…ä¸­è®¾ç½®çš„ç½‘å…³/IPåœ°å€+é…ç½®çš„ç«¯å£ # å¦‚æœæ‚¨è¦ä½¿ç”¨æœ¬åœ°å­˜å‚¨ç­–ç•¥ï¼Œè¯·å°†ä¸‹ä¸€è¡Œæ³¨é‡Šç¬¦åˆ é™¤ï¼Œå¹¶æ›´æ”¹å¤§å°ä¸ºç†è®ºæœ€å¤§æ–‡ä»¶å°ºå¯¸ client_max_body_size 2000m; } } ä¿å­˜åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å‘Šè¯‰ Nginx ä½¿ç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œç„¶åé‡è½½ Nginx çš„é…ç½®æ–‡ä»¶ã€‚ /usr/bin/nginx -c /etc/nginx/nginx.conf.run -t /usr/bin/nginx -c /etc/nginx/nginx.conf.run -s reload ç°åœ¨æ‚¨åº”è¯¥å·²ç»å¯ä»¥ä½¿ç”¨ calibre.baidu.com ä»£æ›¿ sana.baidu.com:8083 æ¥è®¿é—®æ‚¨çš„ calibre-web æœåŠ¡äº†ã€‚ ","link":"https://blog.rakuyoo.top/synology-docker-public-access/"},{"title":"ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½®WireGurad","content":"å› ä¸ºé…ç½®äº†å…¬ç½‘ ipï¼Œä¸ºäº†å®‰å…¨ï¼Œä½¿ç”¨ WireGuard æ§åˆ¶è®¿é—®ã€‚ æœ¬æ–‡å‚è€ƒè‡ªï¼šç¾¤æ™–DS220+å®‰è£… WireGuard ä¿å§†çº§æ•™ç¨‹ æœ¬æ–‡ä¸ºã€Šç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒç¯‡ã€‚å…¨éƒ¨æ–‡ç« è¯·å‚è€ƒï¼š ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½®DDNS ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½®WireGurad ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½®Nginxè®¿é—®DockeræœåŠ¡ ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨ å®‰è£… WireGuard å¥—ä»¶ å¼€å¯ SSH å› ä¸º WireGuard å®‰è£…åéœ€è¦é€šè¿‡ SSH æ‰§è¡Œç›¸å…³å‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå¼€å¯ç¾¤æ™–çš„ SSH åŠŸèƒ½ã€‚ åœ¨ç¾¤æ™– â€œç»ˆç«¯æœºå’ŒSNMP -&gt; ç»ˆç«¯æœºâ€ ä¸­å‹¾é€‰ å¯åŠ¨SSHåŠŸèƒ½ï¼Œç«¯å£å·ä½¿ç”¨é»˜è®¤å³å¯ã€‚ç„¶åç‚¹å‡»åº”ç”¨å³å¯å®Œæˆå¼€å¯ã€‚ éšåæ‚¨å¯ä»¥å°è¯•åœ¨ç»ˆç«¯ä¸­é€šè¿‡å†…ç½‘æˆ–å…¬ç½‘ip/åŸŸåè®¿é—®ç¾¤æ™–ã€‚ å¦‚æœæ‚¨è¿˜æ²¡æœ‰å…¬ç½‘ipï¼Œé‚£ä¹ˆæ‚¨éœ€è¦åœ¨å†…ç½‘ç¯å¢ƒä¸‹å®Œæˆåç»­æ“ä½œï¼Œå› ä¸ºç¾¤æ™–çš„ QC æ˜¯ä¸æ”¯æŒ SSH è®¿é—®çš„ã€‚ å®‰è£… WireGuard å¥—ä»¶ é¦–å…ˆåœ¨ â€œå¥—ä»¶ä¸­å¿ƒ -&gt; è®¾ç½® -&gt; å¥—ä»¶æ¥æºâ€ ä¸­æ·»åŠ  spk7.imnks.com/ çŸ¿ç¥æºã€‚éšåæœç´¢ WireGuardï¼Œæ‰¾åˆ°å¯¹åº”å¥—ä»¶åç‚¹å‡»å®‰è£…ã€‚ å®‰è£…å®Œæˆåæˆ‘ä»¬é€šè¿‡ SSH è®¿é—®ç¾¤æ™–NASã€‚ æˆ‘è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œé¦–å…ˆæ‰§è¡Œäº† sudo su å‘½ä»¤ï¼Œé¿å…åç»­æƒé™é—®é¢˜ã€‚ SSH ç™»å½•ç¾¤æ™– NAS åï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š # èµ‹äºˆWireguardå¥—ä»¶æƒé™ï¼Œåœ¨å®‰è£…ç¾¤æ™–å¥—ä»¶æ—¶ï¼Œæˆ‘ä»¬åœ¨ç®€ä»‹å¤„ä¹Ÿçœ‹åˆ°äº†è¯¥å‘½ä»¤ã€‚ sudo sed -i 's/package/root/g' /var/packages/WireGuard/conf/privilege è‡³æ­¤ WireGuard å¥—ä»¶å®‰è£…å®Œæˆã€‚ é…ç½® WireGuard æœåŠ¡ç«¯ ä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›å…¥ WireGuard é…ç½®æ–‡ä»¶å¤¹ï¼š # åˆ›å»ºç›¸å…³ç›®å½•ï¼Œè¯¥ç›®å½•å¯èƒ½å·²ç»å­˜åœ¨ï¼Œæ— è§†ç›¸å…³æŠ¥é”™å³å¯ã€‚ mkdir /etc/wireguard/ # è¿›å…¥Wireguardæ–‡ä»¶å¤¹ï¼Œåç»­æ“ä½œéƒ½å°†åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­è¿›è¡Œã€‚ cd /etc/wireguard/ åˆ›å»ºå…¬ç§é’¥ åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç”ŸæˆæœåŠ¡ç«¯å…¬ç§é’¥ä»¥åŠå®¢æˆ·ç«¯å…¬ç§é’¥ï¼š #ç”ŸæˆæœåŠ¡å™¨ç«¯ç§é’¥ wg genkey &gt; server_privateKey #ç”ŸæˆæœåŠ¡å™¨ç«¯ç§é’¥å¯¹åº”çš„å…¬é’¥ wg pubkey &lt; server_privateKey &gt; server_publicKey # ç”Ÿæˆå®¢æˆ·ç«¯ç§é’¥åŠå¯¹åº”çš„å…¬é’¥ wg genkey | tee client_privateKey | wg pubkey &gt; client_publicKey # ä½¿ç”¨ cat å‘½ä»¤æŸ¥çœ‹å¯¹åº”å†…å®¹ã€‚ cat server_privateKey cat server_publicKey cat client_privateKey cat client_publicKey å¤åˆ¶å¥½è¿™äº›ç§˜é’¥ï¼Œåé¢é…ç½®æ–‡ä»¶æ—¶éœ€è¦ç”¨åˆ°ã€‚ åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶ æŒ‰ç…§æ³¨é‡Šï¼Œå°†ä¸‹é¢é…ç½®ä¸­çš„å†…å®¹æ›¿æ¢ä¸ºæ‚¨åœ¨ä¸Šä¸€æ­¥ä¸­ç”Ÿæˆçš„å†…å®¹ã€‚ [Interface] PrivateKey = serverprivatekey # æ›¿æ¢ä¸ºæœåŠ¡å™¨ç§é’¥ Address = 10.8.0.1/24 PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth+ -j MASQUERADE PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth+ -j MASQUERADE ListenPort = 51820 # ç«¯å£é»˜è®¤ 51820ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ MTU = 1420 [Peer] PublicKey = clientpublickey # æ›¿æ¢ä¸ºå®¢æˆ·ç«¯å…¬é’¥ AllowedIPs = 10.8.0.2/32 è¯´æ˜ï¼š ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­çš„ Address å’Œ AllowedIPsï¼Œå‰ä¸‰ä½éœ€è¦åœ¨åŒä¸€å±€åŸŸç½‘å†…å¯¹é½ã€‚æœ€åä¸€ä½è¯¦è§åæ–‡ æ·»åŠ æ–°çš„å®¢æˆ·ç«¯ ä¸€èŠ‚ã€‚ ç¼–è¾‘åå†…å®¹åå›åˆ°ç»ˆç«¯ï¼Œä½¿ç”¨ vim æˆ–å…¶ä»–æ‰‹æ®µåœ¨ /etc/wireguard/ è·¯å¾„ä¸‹åˆ›å»º wg0.conf æ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸ºä¸Šè¿°é…ç½®ã€‚ å¯åŠ¨æœåŠ¡ å…ˆå›åˆ°ç¾¤æ™–å¥—ä»¶ä¸­å¿ƒï¼Œå¯åŠ¨ WireGuard å¥—ä»¶ã€‚ ä¹‹å‰å¯åŠ¨äº†ä¹Ÿæ— æ‰€è°“ï¼Œé¡ºåºä¸é‡è¦ å†å›åˆ°SSHç»ˆç«¯ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åŠ è½½é…ç½®æ–‡ä»¶ï¼š # ä½¿ç”¨ `up` å‘½ä»¤åŠ è½½ wg0 é…ç½® sudo wg-quick up wg0 # ä½¿ç”¨ `down` å‘½ä»¤åœæ­¢ wg0ï¼Œå½“å‰ä¸æ‰§è¡Œ # sudo wg-quick down wg0 éšåæˆ‘ä»¬ä½¿ç”¨ wg å‘½ä»¤å³å¯æŸ¥çœ‹å½“å‰çŠ¶æ€ï¼š è¯´æ˜ï¼š æœ‰å®¢æˆ·ç«¯è¿æ¥çš„æ—¶å€™ peer æ‰ä¼šæ˜¾ç¤º keepaliveï¼Œæ­¤æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®å®¢æˆ·ç«¯è¿æ¥ï¼Œèƒ½å¤Ÿå±•ç¤ºå‡ºæ¥å¯¹åº”çš„é…ç½®å³å¯ã€‚ æœ€åæˆ‘ä»¬ä¸º wg0 æœåŠ¡æ·»åŠ å¼€æœºè‡ªå¯åŠ¨ï¼š sudo wg-autostart enable wg0 # å¼€å¯è‡ªå¯åŠ¨ # sudo wg-autostart disable wg0 # å…³é—­è‡ªå¯åŠ¨ å¤‡æ³¨ï¼šç¾¤æ™–çš„ WireGuard å¥—ä»¶æ— æ³•é€šè¿‡ systemctl æ¥é…ç½®å¼€å¯è‡ªå¯åŠ¨ï¼Œä¸çŸ¥é“æ˜¯ DSM çš„é—®é¢˜è¿˜æ˜¯å¥—ä»¶çš„é—®é¢˜ï¼Œè¿™é‡Œæ²¡æœ‰è¿›ä¸€æ­¥æ·±ç©¶ã€‚ è·¯ç”±å™¨è®¾ç½®ç›‘å¬ç«¯å£å·è½¬å‘ ä¸ºäº†æ›´å¥½çš„ç†è§£åé¢çš„æ“ä½œï¼Œæˆ‘ä»¬å…ˆå¤§è‡´è®²ä¸€ä¸‹å€ŸåŠ© WireGuard è¦åšçš„äº‹æƒ…ï¼š æˆ‘ä»¬ä¹‹å‰åœ¨ ç¾¤æ™–NASé…ç½®DDNS ä¸€æ–‡ä¸­é…ç½®äº† DDNSï¼Œåœ¨åé¢çš„æ“ä½œä¸­ï¼Œæˆ‘ä»¬å°†å€ŸåŠ©ä¸Šé¢çš„åŸŸåæ¥æ„å»º WireGuard éš§é“ã€‚ç­‰åˆ°éš§é“å»ºç«‹å¥½äº†ä¹‹åï¼Œæˆ‘ä»¬å†å€ŸåŠ©ç«¯å£è½¬å‘ï¼Œé€šè¿‡éš§é“èµ°å†…ç½‘æœåŠ¡ã€‚ è…¾è®¯äº‘ä¸Šçš„é…ç½® å› ä¸ºä¹‹å‰æˆ‘ä»¬åˆ›å»ºçš„è®°å½•è¢«æˆ‘ä»¬ç”¨æ¥å»ºç«‹éš§é“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€æ¡è®°å½•æ¥ä½œä¸º NAS çœŸæ­£çš„å…¥å£ã€‚ æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æ–°å»ºä¸€æ¡è®°å½•ï¼Œä¸»æœºè®°å½•éšä½ å®šï¼Œæ³¨æ„è®°å½•å€¼éœ€è¦å¡«å†™ä¸º NAS åœ¨å†…ç½‘ä¸­çš„ IP åœ°å€ã€‚ åæ–‡æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹åŸŸåä½œä¸ºç¤ºä¾‹ï¼š ç”¨äºåˆ›å»º WireGuard éš§é“çš„åŸŸåï¼šgwa.baidu.comï¼Œè®°å½•å€¼ä¸ºå…¬ç½‘ ipï¼ˆ39.156.66.10ï¼‰ ä½œä¸º NAS å…¥å£çš„åŸŸåï¼šsana.baidu.comï¼Œè®°å½•å€¼ä¸º NAS å†…ç½‘ ipï¼ˆ192.168.47.29ï¼‰ è·¯ç”±å™¨é™æ€ IP åˆ†é… å› ä¸ºè·¯ç”±å™¨é‡å¯ä¼šå¯¼è‡´ ip å˜åŒ–ï¼Œè€Œæˆ‘ä»¬éœ€è¦ NAS å†…ç½‘çš„ IP å€¼ã€‚å¥½åœ¨ç°åœ¨å¤§éƒ¨åˆ†è·¯ç”±å™¨éƒ½æ”¯æŒ DHCP é™æ€ IP åˆ†é…ã€‚ ç™»å½•è·¯ç”±å™¨åå°ï¼Œæ ¹æ®ä½ çš„è·¯ç”±å™¨çš„è®¾ç½®ï¼Œå°†ç¾¤æ™–å¯¹åº”è®¾å¤‡çš„ IP æ·»åŠ åˆ° DHCP é™æ€ IP åˆ—è¡¨ï¼Œä½¿å…¶æ‹¥æœ‰å›ºå®šçš„ IP å€¼ã€‚ é€šè¿‡ NAS è®¾ç½®ç«¯å£è½¬å‘ æˆ‘è¿™é‡Œé€‰æ‹©çš„æ–¹æ¡ˆæ˜¯é€šè¿‡ç¾¤æ™–è®¾ç½®ç«¯å£è½¬å‘ï¼Œè€Œä¸æ˜¯é€šè¿‡è·¯ç”±å™¨ã€‚å¦‚æœä½ å¸Œæœ›é€šè¿‡è·¯ç”±å™¨è¿›è¡Œè½¬å‘ï¼Œåˆ™å¯ä»¥åœ¨è·¯ç”±å™¨åå°ä¸Šè¿›è¡Œè®¾ç½®ã€‚ å…ˆç•™åœ¨è·¯ç”±å™¨ç®¡ç†åå°ï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯è·¯ç”±å™¨çš„ UPnP åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½ä½¿ç”¨ NAS æ¥è®¾ç½®ç«¯å£è½¬å‘ã€‚ å¼€å¯è·¯ç”±å™¨çš„ UPnP ä¹‹åï¼Œæˆ‘ä»¬å›åˆ° NASï¼Œæ¥åˆ° â€œæ§åˆ¶é¢æ¿ -&gt; å¤–éƒ¨è®¿é—® -&gt; è·¯ç”±å™¨é…ç½®â€ é¡µé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç‚¹å‡»æ–°å¢æŒ‰é’®ï¼Œé€‰æ‹© â€œè‡ªå®šä¹‰ç«¯å£â€ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚ åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œé€šè®¯åè®®æˆ‘ä»¬é€‰æ‹© UDPï¼Œç«¯å£è®¾ç½®ä¸º åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶ ä¸€èŠ‚ä¸­ï¼ŒListenPort çš„å€¼ã€‚ æœ€åç‚¹å‡»å®Œæˆã€‚å®Œæˆåæˆ‘ä»¬å¯ä»¥å›åˆ°è·¯ç”±å™¨çš„ UPnP é¡µé¢ï¼Œåˆ·æ–°çœ‹çœ‹æ˜¯å¦æœ‰å¯¹åº”çš„è®°å½•ã€‚ é…ç½® WireGuard å®¢æˆ·ç«¯ ä¸‹è½½å®¢æˆ·ç«¯ WireGuard å®¢æˆ·ç«¯ä¸‹è½½å‚è€ƒï¼šWireGuardå®¢æˆ·ç«¯ã€‚Apple å¹³å°å‡éœ€è¦å›½å¤–çš„ Apple IDã€‚ åˆ›å»ºå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ å®‰è£…å®¢æˆ·ç«¯çš„é—´éš™ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡å¥½å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š [Interface] PrivateKey = clientprivatekey # æ›¿æ¢ä¸ºå®¢æˆ·ç«¯ç§é’¥ Address = 10.8.0.2/32 # è¿™é‡Œéœ€è¦å¯¹åº”ä¸Šæ–‡ [åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶] ä¸€èŠ‚ä¸­ï¼Œpeer.AllowedIPs é‡Œå¯¹åº”çš„å€¼ MTU = 1420 [Peer] PublicKey = serverpublickey # æ›¿æ¢ä¸ºæœåŠ¡ç«¯å…¬é’¥ Endpoint = gwa.baidu.com:51820 # ç”¨äºåˆ›å»º WireGuard éš§é“çš„åŸŸåï¼ŒåŠ ä¸Šä¸Šæ–‡è®¾ç½®çš„ ListenPort ç«¯å£ AllowedIPs = 10.8.0.1/24, 192.168.47.29/24 # åˆ†åˆ«æ˜¯ [åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶] ä¸€èŠ‚ä¸­,Interface.Addressï¼Œä»¥åŠ NAS å†…ç½‘ IP PersistentKeepalive = 25 å°†ä¸Šè¿°å†…å®¹ä¿å­˜ä¸º wgnas.confï¼ˆæ–‡ä»¶åéšæ„ï¼‰ã€‚ä¹‹åæˆ‘ä»¬æ‰“å¼€ WireGuard å®¢æˆ·ç«¯ï¼Œé€‰æ‹©é€šè¿‡æ–‡ä»¶åˆ›å»ºéš§é“ï¼Œé€‰æ‹© wgnas.confï¼Œå³å¯å®Œæˆé…ç½®è®¾ç½®ã€‚ è‡³æ­¤ï¼Œæ‚¨çš„åŸŸåé…ç½®åº”è¯¥ç¬¦åˆä¸‹é¢çš„æƒ…å†µï¼š WireGuard å¼€å¯çŠ¶æ€ gwa.baidu.com sana.baidu.com å¼€å¯ æ— æ³•è®¿é—® èƒ½è®¿é—® NAS å…³é—­ æ— æ³•è®¿é—® æ— æ³•è®¿é—® å³åªæœ‰åœ¨å¼€ç€ WireGuard çš„å‰æä¸‹ï¼Œå¯ä»¥é€šè¿‡ sana.baidu.com è®¿é—®æ‚¨çš„ NAS æœåŠ¡ã€‚ æ·»åŠ æ–°çš„å®¢æˆ·ç«¯ ä¸Šé¢çš„æ­¥éª¤é‡Œæˆ‘ä»¬åªæ·»åŠ äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå› ä¸ºåŒä¸€æ—¶é—´ WireGuard åªèƒ½è¯†åˆ«ä¸€ä¸ªéš§é“ï¼Œå¦‚æœæ‚¨æœ‰å¤šå°è®¾å¤‡ï¼Œæˆ–è€…å¤šäººå…¬ç”¨åŒä¸€å° NASï¼Œåˆ™éœ€è¦è®¾ç½®å¤šä¸ª WireGuard å®¢æˆ·ç«¯é…ç½®ï¼Œä¸èƒ½å¤šå°è®¾å¤‡åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚ è®©æˆ‘ä»¬æ‰“å¼€ åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶ ä¸­çš„åˆ›å»ºçš„é…ç½®æ–‡ä»¶ã€‚ å…¶ä¸­ Peer çš„éƒ¨åˆ†ä»£è¡¨ç€æ¯ä¸ªå®¢æˆ·ç«¯ã€‚å½“æˆ‘ä»¬éœ€è¦æ–°å¢å®¢æˆ·ç«¯æ—¶ï¼ŒæœåŠ¡ç«¯éœ€è¦æ·»åŠ ä¸€å¥—æ–°çš„ Peer é…ç½®ã€‚ [Interface] PrivateKey = serverprivatekey Address = 10.8.0.1/24 ... ListenPort = 51820 MTU = 1420 # ä¸Šè¿°å†…å®¹ä¿æŒä¸å˜ [Peer] PublicKey = clientpublickey AllowedIPs = 10.8.0.2/32 [Peer] # æ–°çš„ Peer é…ç½® PublicKey = clientpublickey01 # ä¸€å¥—æ–°çš„å®¢æˆ·ç«¯å…¬é’¥ AllowedIPs = 10.8.0.3/32 # æ³¨æ„è¿™é‡Œéœ€è¦ä¿®æ”¹ ip åœ°å€æœ€åä¸€ä½ï¼Œä¸€èˆ¬+1å³å¯ éšåæŒ‰ç…§ åˆ›å»ºå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ ä¸­çš„æ–¹æ³•ï¼Œåœ¨æ–°çš„å®¢æˆ·ç«¯ä¸­åŠ è½½æ–°çš„é…ç½®æ–‡ä»¶å³å¯ã€‚ ","link":"https://blog.rakuyoo.top/synology-with-wireguard/"},{"title":"ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½®DDNS","content":"æœ¬æ–‡ä½¿ç”¨DSM 7.0ã€‚è¯·æ‚¨ç¡®ä¿å·²ç»è·å–äº†å…¬ç½‘ ipï¼Œå¹¶ä¸”å·²ç»è´­ä¹°äº†åŸŸåã€‚ å› ä¸ºæˆ‘çš„åŸŸååœ¨è…¾è®¯äº‘ä¸Šï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ DDNS ä½¿ç”¨è…¾è®¯äº‘çš„æœåŠ¡ï¼Œæ­¥éª¤å‚è€ƒï¼šç¾¤æ™–ï¼ˆSynologyï¼‰NAS å¯ç”¨è…¾è®¯äº‘ DDNS å¹¶å®‰è£…å…è´¹è¯ä¹¦ æœ¬æ–‡ä¸ºã€Šç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ã€‚å…¨éƒ¨æ–‡ç« è¯·å‚è€ƒï¼š ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½®DDNS ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½®WireGurad ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½®Nginxè®¿é—®DockeræœåŠ¡ ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨ è·å–è…¾è®¯äº‘ API å¯†é’¥ ç™»å½• è…¾è®¯äº‘ API å¯†é’¥ ï¼Œæ–°å»ºè…¾è®¯äº‘ API SecretId åŠ SecretKey å¯†é’¥ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¤åˆ¶å¥½æ‚¨çš„ Id ä»¥åŠ Keyï¼Œç‚¹å‡»ç¡®å®šå key å°†æ— æ³•æŸ¥çœ‹ã€‚ æ·»åŠ åŸŸåè®°å½• åœ¨ æˆ‘çš„åŸŸå é¡µé¢ï¼Œç‚¹å‡»å·²æ³¨å†ŒåŸŸåï¼Œè¿›å…¥â€œè®°å½•ç®¡ç†â€é¡µé¢ã€‚ å•å‡»æ·»åŠ è®°å½•ï¼Œæ·»åŠ ä¸€æ¡ä¸»æœºè®°å½•ä¸ºä»»æ„ï¼Œè®°å½•å€¼ä¸ºä»»æ„ IP çš„ A è®°å½•ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¯´æ˜ï¼š å‡å¦‚æ‚¨çš„åŸŸåä¸º baidu.comï¼Œä¸»æœºè®°å½•ä¸º abcï¼Œé‚£ä¹ˆå¯¹åº”çš„åŸŸåå°±æ˜¯ abc.baidu.comã€‚æ‰€ä»¥æœ¬æ­¥éª¤ä¸­çš„ä¸»æœºè®°å½•è¯·æ ¹æ®æ‚¨çš„å®é™…æƒ…å†µå¡«å†™ã€‚ è®°å½•å€¼å¯ä»¥å¡«å†™ä¸ºä»»æ„ IP åœ°å€ï¼ˆæ¯”å¦‚0.0.0.0ï¼‰ï¼Œæœ€å DDNS ç»‘å®šå®Œæˆåï¼Œè¯¥å€¼ä¼šè‡ªåŠ¨æ›´æ–°ä¸ºæ­£ç¡®çš„å…¬ç½‘ IP åœ°å€ï¼Œæ‰€ä»¥ç°åœ¨å¡«çš„å†…å®¹æ— æ‰€è°“ã€‚ ç¾¤æ™–é…ç½® DDNS é¦–å…ˆæŒ‰ç…§ä¸‹å›¾æ‰€ç¤ºï¼Œè¿›å…¥ç¾¤æ™–æ·»åŠ  DDNS çš„é¢æ¿ å¤–éƒ¨åœ°å€åº”å½“å°±æ˜¯æ‚¨çš„å…¬ç½‘ ip åœ°å€ã€‚ å…¶ä½™å„å­—æ®µä¸ºï¼š æœåŠ¡ä¾›åº”å•†ï¼šè…¾è®¯äº‘ã€‚ ä¸»æœºåç§°ï¼šè¯·å¡«å†™ä¸Šä¸€æ­¥ä¸­æ‚¨æ·»åŠ çš„åŸŸååç§°ã€‚æ¯”å¦‚ abc.baidu.comã€‚ ç”¨æˆ·å/ç”µå­é‚®ä»¶ï¼šè¯·å¡«å†™æ‚¨è·å–åˆ°çš„ SecretId ä¿¡æ¯ã€‚ å¯†ç /å¯†é’¥ï¼šè¯·å¡«å†™æ‚¨è·å–åˆ°çš„ SecretKey ä¿¡æ¯ã€‚ ä» Tencent Cloud è·å–è¯ä¹¦ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºé»˜è®¤è¯ä¹¦ï¼šå‹¾é€‰é€‰é¡¹åï¼Œå¯è‡ªåŠ¨ä¸ºæ‚¨ç”³è¯·è…¾è®¯äº‘ TrustAsia SSL å…è´¹è¯ä¹¦å¹¶æ›¿æ¢ NAS çš„é»˜è®¤ SSL è¯ä¹¦ã€‚ å¤‡æ³¨ï¼š å¦‚æœæ‚¨ä¸éœ€è¦ httpsï¼Œé‚£ä¹ˆè¿™ä¸ªè¯ä¹¦ä¸å‹¾é€‰ä¹Ÿå¯ä»¥ã€‚ æ­¤æ—¶å¯ä»¥å•å‡»æµ‹è¯•è”æœºï¼Œæµ‹è¯•æ˜¯å¦èƒ½è”æœºæˆåŠŸã€‚å¦‚çŠ¶æ€æ æ˜¾ç¤ºä¸ºæ­£å¸¸ï¼Œåˆ™ä»£è¡¨è”æœºæˆåŠŸã€‚ æœ€åå•å‡»ç¡®å®šï¼Œå³å¯å®Œæˆè®¾ç½®ã€‚ç­‰å¾…è§£æç”Ÿæ•ˆåï¼ˆè§£æç”Ÿæ•ˆæ—¶é—´ä¸€èˆ¬éœ€è¦ 10åˆ†é’Ÿï¼‰ï¼Œå³å¯ä½¿ç”¨åŸŸåï¼ˆabc.baidu.com:5000ï¼Œéœ€è¦æºå¸¦ç«¯å£ï¼‰è®¿é—®NASã€‚ æ‰‹åŠ¨æ›´æ–° DDNSï¼ˆå¯é€‰ï¼‰ å®Œæˆè®¾ç½®åï¼Œå•å‡»ç¾¤æ™–é¢æ¿ä¸Šçš„ç«‹å³æ›´æ–°ï¼Œç³»ç»Ÿä¼šæ›´æ–°æœ€æ–°çš„ DDNS è§£æè®°å½•ï¼Œå¹¶ç¡®è®¤çŠ¶æ€æ˜¯å¦æ˜¾ç¤ºä¸ºæ­£å¸¸ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿”å› æˆ‘çš„åŸŸå é¡µé¢ï¼Œå•å‡»åŸŸåï¼Œå³å¯æŸ¥çœ‹è®°å½•å€¼æ˜¯å¦å·²å˜æ›´ä¸ºå…¬ç½‘ IP åœ°å€ã€‚ ","link":"https://blog.rakuyoo.top/synology-config-ddns/"},{"title":"Package.swift é™çº§é—®é¢˜æ’æŸ¥","content":"è¿‡å» Package.swift æ²¡æœ‰å¥½å¥½å†™ï¼Œtoolchain ç‰ˆæœ¬è·Ÿç€ Xcode èµ°ï¼Œæ²¡æœ‰å…¼å®¹ä¸åŒçš„ç‰ˆæœ¬ã€‚æœ€è¿‘ç ”ç©¶ç”¨ SPM ä»£æ›¿ CocoaPodsï¼Œæ‰€ä»¥è®¤çœŸçš„ç ”ç©¶æŠ˜è…¾äº†ä¸€ä¸‹ã€‚ æœ¬æ–‡æ€»ç»“æŠŠ Package.swift ä» 5.9 é™è‡³ 5.1 è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚ æœ¬æ–‡ä¸è®²è§£åŸºç¡€è¯­æ³•ã€‚ ç‰ˆæœ¬å·å‰çš„ç©ºæ ¼ ä¹‹å‰ 5.9 çš„æ—¶å€™æ˜¯è¿™ä¹ˆå†™çš„ï¼š // swift-tools-version: 5.9 ç›´æ¥å°† 5.9 æ”¹æˆ 5.1 ä¹‹åæŠ¥é”™äº†ï¼š horizontal whitespace sequence [U+0020] immediately preceding the version specifier is supported by only Swift â‰¥ 5.4; consider removing the sequence for Swift 5.1 åŸå› æ˜¯ version: å’Œ 5.1 ä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚è€Œè¿™ä¸ªç©ºæ ¼æ˜¯ Swift 5.4 æ—¶æ‰æ”¯æŒçš„ç‰¹æ€§... æ‰€ä»¥æ”¹æˆä¸‹é¢è¿™æ ·å°±å¯ä»¥äº†ï¼š // swift-tools-version:5.1 // â¬†ï¸æ³¨æ„è¿™é‡Œæ²¡æœ‰ç©ºæ ¼ å‚è€ƒè‡ªï¼šSwift Package Tools Version çš„å†™æ³• èµ„æºçš„å¼•ç”¨ åƒæˆ‘ä¸€æ ·æ²¡æœ‰æŒç»­å…³æ³¨ SPM å‘å±•çš„å¼€å‘è€…å¯èƒ½ä¸çŸ¥é“ï¼Œåœ¨ SPM ä¸­å¼•ç”¨èµ„æºæ˜¯ 5.3 å¼€å§‹æ‰æ”¯æŒçš„ç‰¹æ€§ã€‚ æ‰€ä»¥å¦‚æœä½ çš„åŒ…ä½¿ç”¨äº† Resource bundle æˆ–è€… Binary Frameworkï¼Œé‚£ä¹ˆä½ å°±ä¸èƒ½é™è‡³ 5.1 äº†ï¼Œæœ€ä½ä¹Ÿè¦ 5.3 ç‰ˆæœ¬æ‰è¡Œã€‚ çœç•¥ target.path æˆ‘æ²¡èƒ½æ‰¾åˆ°è¿™ä¸ªçš„ææ¡ˆï¼Œå¯èƒ½æ˜¯ Allow sources anywhere in ./Sources when only one target is present è¿™ä¸ªã€‚å¦‚æœå“ªä½æ˜ç¡®çŸ¥é“éº»çƒ¦åœ¨è¯„è®ºåŒºå‘ŠçŸ¥ã€‚ åœ¨ 5.9 ç‰ˆæœ¬ä¸Šï¼Œå¦‚æœæˆ‘ä»¬çš„ä»£ç éƒ½åœ¨ Sources ç›®å½•ä¸‹ï¼Œä¸”åªæœ‰ä¸€ä¸ª Targetï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¸æ˜¾å¼æŒ‡å®š target.path å±æ€§ã€‚ ä½†æ˜¯åœ¨ 5.1 ç‰ˆæœ¬ä¸Šä¸è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ˜¾å¼åœ°æŒ‡å®š path è·¯å¾„ã€‚ ","link":"https://blog.rakuyoo.top/troubleshooting-package_swift-downgrade-issues/"},{"title":"è§£å†³é‡ç½®SPMç¼“å­˜å¤±è´¥çš„é—®é¢˜","content":"ç›¸ä¿¡ç»å¸¸ä½¿ç”¨ SPM çš„å°ä¼™ä¼´ï¼Œåº”è¯¥éƒ½é‡åˆ°è¿‡ä½¿ç”¨ Reset Package Caches æ—¶æŠ¥é”™ï¼šAn unknown error occurred. reference 'refs/remotes/origin/main' not found (-1)ï¼Œæˆ–è€…å…¶ä»–åˆ†æ”¯ã€‚ å…³äºè¿™ä¸ªé—®é¢˜åœ¨ stackoverflow ä¸Šæœ‰æ¯”è¾ƒå¤šçš„è®¨è®ºï¼Œä¾‹å¦‚è¿™ä¸ª SPM unknown error reference not found when changing branchã€‚ æ€æ¥æƒ³å»å†³å®šæ ¹æ®ä¸Šé¢çš„å›ç­”ï¼Œè®°å½•ä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚ åœ¨æˆ‘çš„åœºæ™¯ä¸‹ï¼ˆXcode 15ï¼‰ï¼Œä»…ä»…åˆ é™¤ ~/Library/Caches/org.swift.swiftpm/repositories ä¸‹å¯¹åº”çš„ç›®å½•å³å¯è§£å†³é—®é¢˜ï¼Œä¹‹åé‡æ–° Rest å³å¯ã€‚ é—®é¢˜çš„å‘ç”Ÿ é“¾æ¥ä¸­æåˆ°äº†ä¸¤ç§è§‚ç‚¹ã€‚ä¸€å¼€å§‹ @mrwest09 æåˆ°ï¼Œå¦‚æœä½¿ç”¨ sshï¼ˆgit@ï¼‰å¼•å…¥ä¾èµ–ï¼Œåˆ™æœ‰å¯èƒ½ä¼šäº§ç”Ÿè¯¥é—®é¢˜ã€‚å®é™…ä¸Šè¿™ä¹Ÿç¬¦åˆæˆ‘çš„ä½¿ç”¨åœºæ™¯ï¼ˆä¸è¿‡æˆ‘æ²¡æœ‰è¯• httpsï¼‰ã€‚ ä½†æ˜¯åæ¥ @Ivan Vavilov ä¹Ÿæåˆ°ï¼Œä»–ä½¿ç”¨çš„ httpsï¼Œä½†æ˜¯ä¹Ÿä¾ç„¶å‡ºç°äº†è¯¥é—®é¢˜ã€‚ æ‰€ä»¥æ€ä¹ˆè¯´å¥½å‘¢ï¼Œè¿™ä¸ªé—®é¢˜çš„å‘ç”Ÿæœªå¿…å¯ä»¥éƒ½å½’ç»“åˆ° sshï¼Œè‡³äºçœŸæ­£çš„åŸå› ä»…ä»ä¸Šè¿°å›ç­”ä¸­å¯èƒ½æš‚æ—¶æ— ä»å¾—çŸ¥... é—®é¢˜çš„è§£å†³ ç›´æ¥æ–¹å¼ åˆ é™¤ ~/Library/Caches/org.swift.swiftpm/repositories ä¸‹çš„å†…å®¹å³å¯ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œå›ç­”ä¸­è¿˜æåˆ°äº†ä¸€ä¸ª â€œSwift package caches both in the derived data directory of your projectâ€ã€‚è¯¥ç¼“å­˜çš„å®é™…ç›®å½•åœ¨ ~/Library/Developer/Xcode/DerivedData/$project/SourcePackages/repositoriesã€‚ æˆ‘çš„åœºæ™¯ä¸‹ä»…åˆ é™¤ org.swift.swiftpm ä¸­çš„å†…å®¹å³å¯ã€‚å¦‚æœä½ ä»…åˆ é™¤å®ƒæ— æ•ˆï¼Œå¯ä»¥çœ‹å†è¯•è¯• ä¸€å¹¶ SourcePackages ä¸‹çš„å†…å®¹ã€‚ è‡ªåŠ¨åŒ–å¤„ç† å›ç­”ä¸­è¿˜æœ‰å¥½å¿ƒçš„å¤§ä½¬å†™äº†2ä¸ªè‡ªåŠ¨åˆ é™¤ç¼“å­˜çš„è„šæœ¬ï¼Œä¸€ä¸ªæ˜¯ï¼š #!/bin/bash if [[ $# -eq 0 ]] ; then echo 'Please call the script with the name of your project as it appears in the derived data directory. Case-insensitive.' echo 'For example: ./fix-spm-cache.sh myproject' exit 0 fi # Delete all directories named &quot;remotes&quot; from the global Swift Package Manager cache. cd ~/Library/Caches/org.swift.swiftpm/repositories for i in $(find . -name &quot;remotes&quot; -type d); do echo &quot;Deleting $i&quot; rm -rf $i done # Find derived data directories for all projects matching the script argument, and # delete all directories named &quot;remotes&quot; from source package repositories cache for those projects. cd ~/Library/Developer/Xcode/DerivedData/ for project in $(find . -iname &quot;$1*&quot; -type d -maxdepth 1); do for i in $(find &quot;$project/SourcePackages/repositories&quot; -name &quot;remotes&quot; -type d); do echo &quot;Deleting $i&quot; rm -rf $i done done è¿™ä¸ªè„šæœ¬åˆ é™¤äº†ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªè·¯å¾„ä¸‹çš„ç¼“å­˜ï¼Œä½¿ç”¨æ—¶éœ€è¦ sh ./fix-spm-cache.sh myprojectã€‚ å¦å¤–ä¸€ä¸ªå¤§ä½¬ä½¿ç”¨äº†å¦å¤–ä¸€ä¸ªæ€è·¯ï¼Œç¼–å†™äº†ä¸€ä¸ª python è„šæœ¬ï¼š # Sometimes Xcode cannot resolve SPM(File -&gt; Packages -&gt; Resolve Package versions) if the dependency url is ssh # This script is a workaround to resolve package versions. # Usage: # python spmResolve.py # or # python3 spmResolve.py import os.path import subprocess import glob import json def main(): package_file = &quot;xcshareddata/swiftpm/Package.resolved&quot; xcodeproj = glob.glob('*.xcodeproj') xcworkspace = glob.glob('*.xcworkspace') spmproj = glob.glob('Package.resolved') package_resolved = &quot;&quot; if xcodeproj: package_resolved = xcodeproj[0] + f&quot;/project.xcworkspace/{package_file}&quot; elif xcworkspace: package_resolved = xcworkspace[0] + f&quot;/{package_file}&quot; elif spmproj: package_resolved = spmproj[0] else: print(f&quot;ğŸ˜± Cannot find *.xcodeproj, *.xcworkspace or Package.resolved file&quot;) exit(-1) update_package_resolved(package_resolved) def update_package_resolved(package_resolved): if not os.path.exists(package_resolved): print(f&quot;ğŸ˜± Package.resolved file doesn't exit: {package_resolved}&quot;) exit(-1) print(f&quot;Found: {package_resolved}&quot;) f = open(package_resolved) content = json.load(f) f.close() for pin in content[&quot;pins&quot;]: url = pin[&quot;location&quot;] if &quot;branch&quot; in pin[&quot;state&quot;]: branch = pin[&quot;state&quot;][&quot;branch&quot;] commit_hash = get_git_revision_hash(url, branch) print(f&quot;{url}, {branch}, {commit_hash}&quot;) pin[&quot;state&quot;][&quot;revision&quot;] = commit_hash elif &quot;version&quot; in pin[&quot;state&quot;]: version = pin[&quot;state&quot;][&quot;version&quot;] commit_hash = get_git_revision_by_tag(url, version) print(f&quot;{url}, {version}, {commit_hash}&quot;) pin[&quot;state&quot;][&quot;revision&quot;] = commit_hash with open(package_resolved, &quot;w&quot;) as output: json.dump(content, output, indent=4) # resolve SPM subprocess.run(['xcodebuild', '-resolvePackageDependencies']) print('ğŸ‰ Well done') def get_git_revision_hash(url, branch) -&gt; str: command = f'git ls-remote {url} refs/heads/{branch} | cut -f 1' return get_git_command_output(command) def get_git_revision_by_tag(url, version) -&gt; str: command = f'git ls-remote {url} -t {version} | cut -f 1' return get_git_command_output(command) def get_git_command_output(command) -&gt; str: return subprocess.check_output(command, stderr=subprocess.STDOUT, shell=True).decode('ascii').rstrip() if __name__ == '__main__': main() ä½¿ç”¨æ–¹å¼ä¸ºåœ¨åŒ…å« *.xcodeproj æˆ– *.xcworkspace æ–‡ä»¶çš„è·¯å¾„ä¸‹ï¼Œè°ƒç”¨ python spmResolve.pyã€‚ ","link":"https://blog.rakuyoo.top/fix-spm-cache/"},{"title":"ç§»é™¤å­—ç¬¦ä¸²ä¸­çš„ï¿½","content":"ä¸€ä¸ªéå¸¸éå¸¸éå¸¸å¸¸è§çš„éœ€æ±‚ï¼Œä¸€ä¸ªé™åˆ¶è¾“å…¥é•¿åº¦çš„è¾“å…¥æ¡†ï¼ŒåŒæ—¶ä¸é™åˆ¶ç”¨æˆ·è¾“å…¥å­—ç¬¦çš„ç±»å‹ã€‚ è¿™é‡Œæˆ‘ä»¬å…ˆå‡å®šä¸€ä¸ªéœ€æ±‚ï¼š ä¸€ä¸ªæœ€å¤šè¾“å…¥6ä¸ªå­—ç¬¦çš„è¾“å…¥æ¡†ï¼Œä¸é™åˆ¶ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ç±»å‹ï¼Œå³å¯ä»¥è¾“å…¥ç©ºæ ¼ã€ä¸­æ–‡è‹±æ–‡ã€æ ‡ç‚¹ç¬¦å·ã€æ•°å­—ä»¥åŠ Emojiã€‚ åœ¨è¿™ä¸ªéœ€æ±‚ä¸‹è€ƒè™‘ä¸‹é¢è¿™ä¸ªåœºæ™¯ï¼š è¾“å…¥æ¡†ä¸Šå·²ç»æœ‰äº†æ–‡å­—ï¼š&quot; g,5å°±&quot;ï¼Œç”¨æˆ·å³å°†è¾“å…¥ä¸€ä¸ª ğŸ‰‘ï¸ã€‚ è¿™æ—¶ï¼Œä½ çš„ç¨‹åºå¾ˆå¯èƒ½å°±ä¼šå‡ºé—®é¢˜äº†ã€‚ å­—ç¬¦é•¿åº¦ æˆ‘ä»¬å¤§å®¶åº”è¯¥éƒ½çŸ¥é“ Swift.String çš„ count å±æ€§å’Œ ObjC çš„ length å±æ€§è·å–çš„ç»“æœä¸åŒã€‚ æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œå®é™…è¾“å‡ºç»“æœå¦‚æ³¨é‡Šæ‰€è¿°ã€‚ let string = &quot; g,5å°±ğŸ‰‘ï¸&quot; print(string.count) // 6 print((string as NSString).length) // 8 å›åˆ°éœ€æ±‚å’Œåœºæ™¯ä¸Šï¼Œæˆ‘ç›¸ä¿¡ä½ æ—©å°±çŸ¥é“ï¼Œåœ¨åšè¿™ç§æˆªå–çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥ç”¨ string.count åˆ¤æ–­é•¿åº¦ã€‚ è¿™ç§æ—¶å€™æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨ utf16 ç¼–ç æ¥è·å–é•¿åº¦ï¼š let string = &quot; g,5å°±ğŸ‰‘ï¸&quot; print(string.count) // 6 print(string.utf16.count) // 8 print((string as NSString).length) // 8 ç›´æ¥æˆªå– æå®šäº†é•¿åº¦ï¼Œå‰©ä¸‹çš„å°±æ˜¯æˆªå–äº†ï¼š extension String { func prefixed(_ maxLength: Int) -&gt; String { let sequence = utf16 guard sequence.count &gt; maxLength else { return self } let startIndex = sequence.startIndex let endIndex = sequence.index(startIndex, offsetBy: maxLength) let result = String(sequence[startIndex ..&lt; endIndex]) // ä»¥é˜²ä¸‡ä¸€ï¼Œå€ŸåŠ© Objective-C çš„èƒ½åŠ›è¿›è¡Œæˆªå– return result ?? (self as NSString).substring(to: maxLength) } } å› ä¸º String çš„ init?(_ codeUnits: Substring.UTF16View) æ„é€ å™¨è¿”å›å¯èƒ½ä¸ºç©ºï¼Œä¿é™©èµ·è§æœ€åè¿˜æ˜¯å€Ÿç”¨äº†ä¸€ä¸‹ ObjC çš„æ–¹æ³•æ¥åšæˆªå–ã€‚ å¥½äº†ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æ˜¯æˆ‘å†™è¿™ç¯‡åšå®¢ä¹‹å‰çš„ç†è§£å’Œåšæ³•ã€‚åé¢å¼€å§‹è¯´é—®é¢˜ã€‚ åŠä¸ª emoji å¯¹ä¸Šè¿°çš„åœºæ™¯åº”ç”¨è¯¥æ–¹æ³•åï¼Œæˆ‘ä»¬å¾—åˆ°çš„æˆªå–ç»“æœå…¶å®æ˜¯æœ‰é—®é¢˜çš„ï¼š &quot; g,5å°±ğŸ‰‘ï¸&quot;.prefixed(6) // g,5å°±ï¿½ 6çš„é•¿åº¦é™åˆ¶æ­£å¥½å¡åœ¨ ğŸ‰‘ï¸ çš„ç¼–ç ä¸Šï¼Œå¯¼è‡´æœ€åé—ç•™ä¸‹æ¥åŠä¸ª emojiã€‚ å¦‚æœä»…ä»…æ˜¯å±•ç¤ºè¿˜å¥½ï¼Œä½†æ˜¯å¦‚æœæ‹¿è¿™ä¸ªå­—ç¬¦ä¸²åœ¨ iOS 13 ä¸Šï¼Œä½¿ç”¨ JSONEncoder å»ç¼–ç ï¼Œå°±ä¼šé€ æˆé—ªé€€ï¼Œè€Œä¸”ä¸è®ºæ˜¯é€šè¿‡ try catch ä¹Ÿå¥½ï¼Œtry? ä¹Ÿå¥½ï¼Œéƒ½æ— æ³•æ•è·åˆ°è¯¥å¼‚å¸¸ï¼ˆEXC_BAD_ACCESSï¼‰ã€‚ è§£å†³é—®é¢˜ é€šè¿‡æ–­ç‚¹å¯çŸ¥ï¼ŒåŸæœ¬æ–¹æ³•çš„ result å±æ€§æ˜¯ nilï¼Œæœ€ç»ˆæ˜¯é€šè¿‡ ObjC çš„ substring æ–¹æ³•å¾—åˆ°äº†ç›®æ ‡å­—ç¬¦ä¸²ã€‚ å¾ˆæ˜æ˜¾è¿™ä¸ªé—®é¢˜æ˜¯ emoji æˆªå–ä¸å…¨å¯¼è‡´çš„ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥åˆ é™¤æ•´ä¸ª emojiï¼Œè€Œä¸æ˜¯æ®‹ç•™åŠä¸ªã€‚ è¿›ä¸€æ­¥æœç´¢ï¼Œæˆ‘æ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼šSwift å­—ç¬¦ä¸² æˆªå– åŠä¸ªè¡¨æƒ…emoji \\u0000fffd çš„å¤„ç† åŸæ–‡è§£å†³æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼Œé€šè¿‡å®è·µï¼Œè¯¥æ–¹æ³•ç¡®å®å¯ä»¥è§£å†³é—®é¢˜ã€‚ // text:Optional(&quot;123456789ğŸ˜’&quot;) var newText = (text as NSString).substring(to: 10) newText = (text as NSString).substring(to: maxLength) // æœ‰å¯èƒ½ä¼šæˆªå–åˆ°åŠä¸ªè¡¨æƒ…ï¼Œæ‰€ä»¥è¿™é‡Œå‰”é™¤æ‰åŠä¸ªè¡¨æƒ…çš„æƒ…å†µ if let data = newText.data(using: .utf8), let temp = NSString(data: data, encoding: String.Encoding.utf8.rawValue), temp.contains(&quot;\\u{0000fffd}&quot;) { newText = temp.replacingOccurrences(of: &quot;\\u{0000fffd}&quot;, with: &quot;&quot;) as String } è¿›ä¸€æ­¥ä¼˜åŒ– å…¶å®ä¸Šé¢çš„æ–¹æ³•æ— éœ€å°† data è½¬ä¸º NSStringï¼Œç›´æ¥ä½¿ç”¨ String å» contains ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™ä¸ªæš‚ä¸”æŒ‰ä¸‹ä¸è¡¨ã€‚ ä½†æ˜¯å¯¹äºæ— æ³•é¢„æµ‹çš„ç”¨æˆ·è¾“å…¥ï¼Œæ¯ä¸€æ¬¡æˆªå–éƒ½è¦å…ˆå°† text è½¬ä¸º dataï¼Œå†è½¬å› stringï¼Œæœ€åæ‰èƒ½åšåˆ¤æ–­ï¼Œæˆ‘æ˜¯ä¸å¤ªæƒ³æ¥å—çš„ã€‚ æ‰€ä»¥æˆ‘ç›´æ¥å°†è¿™ä¸ªç­”æ¡ˆä¸¢ç»™äº† ChatGPTï¼Œç»“æœä¸€ç³»åˆ—çš„è°ƒæ•™å’Œå®è·µï¼Œæœ€ç»ˆå¾—åˆ°äº†å¦‚ä¸‹ç‰ˆæœ¬çš„æ–¹æ³•ï¼š extension String { func prefixed(_ maxLength: Int) -&gt; String { let sequence = utf16 guard sequence.count &gt; maxLength else { return self } let startIndex = sequence.startIndex var endIndex = sequence.index(startIndex, offsetBy: maxLength) while endIndex &gt; startIndex &amp;&amp; UTF16.isTrailSurrogate(sequence[endIndex]) { endIndex = sequence.index(before: endIndex) } let result = String(sequence[..&lt;endIndex]) return result ?? (self as NSString).substring(to: maxLength) } } ä¸€äº› UTF-16 çš„æ¦‚å¿µ å¦‚æœä½ å¯¹ â€œä¸ºä»€ä¹ˆâ€ ä¸æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆç°åœ¨ä½ å·²ç»å¾—åˆ°äº†ç­”æ¡ˆï¼Œå¯ä»¥å…³é—­æ‰è¿™ä¸ªé¡µé¢äº†ã€‚ ä¸‹é¢çš„å†…å®¹å°†å…ˆä»‹ç»ä¸€äº›å’Œ UTF-16 æœ‰å…³çš„æ¦‚å¿µã€‚ UTF-16 UTF-16ç¼–ç çš„å­—ç¬¦å¯ä»¥æ˜¯1ä¸ªæˆ–2ä¸ª16ä½ç å…ƒã€‚ é‚£äº›åªéœ€è¦1ä¸ª16ä½ç å…ƒçš„å­—ç¬¦è¢«ç§°ä¸ºBMPï¼ˆåŸºæœ¬å¤šæ–‡æœ¬å¹³é¢ï¼‰å­—ç¬¦ï¼Œå¦‚è‹±æ–‡å­—æ¯ï¼Œæ•°å­—ï¼Œæ ‡ç‚¹ç¬¦å·ç­‰ã€‚ è€Œé‚£äº›éœ€è¦2ä¸ª16ä½ç å…ƒçš„å­—ç¬¦è¢«ç§°ä¸ºéBMPå­—ç¬¦ï¼Œå¦‚æŸäº›emojiã€‚ Surrogate Pairs åœ¨ Unicodeæ ‡å‡†ä¸­ï¼Œè¿˜åŒ…å« &quot;Low surrogate&quot; å’Œ &quot;High surrogate&quot; ä¸¤ä¸ªæ¦‚å¿µï¼Œæˆ–è€…ä¹Ÿç§°ä¸ºå‰å¯¼ä»£ç†ï¼ˆlead surrogateï¼‰å’Œ å°¾éšä»£ç†ï¼ˆtrail surrogateï¼‰ã€‚ å®ƒä»¬å…±åŒç»„æˆäº† &quot;surrogate pairs&quot;ï¼Œå³ä¸€ä¸ªä»£ç†å¯¹ã€‚ å®ƒè¢«ç”¨æ¥è¡¨ç¤ºåœ¨ UTF-16 ç¼–ç ä¸­ï¼Œä¸èƒ½ç”¨å•ä¸ª16ä½ç¼–ç å•å…ƒæ‰€è¡¨ç¤ºçš„å­—ç¬¦ï¼Œå–å€¼èŒƒå›´åœ¨ U+10000 è‡³ U+10FFFF ä¹‹é—´ã€‚ &quot;High surrogate&quot; æ˜¯ä¸€ä¸ªä»£ç†å¯¹ä¸­çš„ç¬¬ä¸€ä¸ª16ä½ç¼–ç å•å…ƒï¼Œå…¶èŒƒå›´ä» U+D800 åˆ° U+DBFFã€‚ &quot;Low surrogate&quot; æ˜¯ä¸€ä¸ªä»£ç†å¯¹ä¸­çš„ç¬¬äºŒä¸ª16ä½ç¼–ç å•å…ƒï¼Œå…¶èŒƒå›´ä» U+DC00 åˆ° U+DFFFã€‚ ä¾‹å¦‚ï¼Œemoji &quot;ğŸ‰‘ï¸&quot; åœ¨UTF-16ç¼–ç ä¸‹ï¼Œæ˜¯ç”±ä¸¤ä¸ª16ä½ç å…ƒç»„æˆçš„ï¼š0xD83D å’Œ 0xDD91ã€‚è¿™ä¸¤ä¸ªç å…ƒå°±æ˜¯ä¸€ä¸ªä»£ç†å¯¹ï¼Œå…¶ä¸­ 0xD83D æ˜¯å‰å¯¼ä»£ç†ï¼Œ0xDD91 æ˜¯å°¾éšä»£ç†ã€‚ å›åˆ°éœ€æ±‚å’Œåœºæ™¯ å¯¹äºå­—ç¬¦ä¸² &quot; g,5å°±ğŸ‰‘ï¸&quot;ï¼Œå½“æˆ‘ä»¬çš„æœ€å¤§é•¿åº¦ä¸º 6 ä½æ—¶ï¼Œæˆªå–çš„ä¸ºæ­¢æ°å¥½åœ¨ 0xD83D å’Œ 0xDD91 çš„ä¸­é—´ã€‚æ­¤æ—¶ endIndex æŒ‡å‘çš„æ˜¯ç¬¬7ä½ï¼Œå³ 0xDD91 å°¾éšä»£ç†ã€‚ æ‰€ä»¥æˆ‘ä»¬ç”¨ UTF16.isTrailSurrogate æ–¹æ³•åˆ¤æ–­ï¼Œå¦‚æœæˆªå–çš„æœ«å°¾æ˜¯ä¸€ä¸ªå°¾éšä»£ç†ï¼Œåˆ™å‘å‰ç§»åŠ¨ä¸€ä½ï¼Œå°†æ•´ä¸ª emoji èˆæ‰ã€‚ ä¸€äº›å…¶ä»–çš„æƒ³æ³• å…¶å®å…¶ä»–æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š é€šè¿‡æ–‡æ¡£å¯çŸ¥ï¼Œinit?(_ codeUnits: Substring.UTF16View) å½“ codeUnits éæ³•æ—¶è¿”å› nilã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç‚¹æ¥ç¼–å†™é€’å½’/å¾ªç¯ï¼Œé€’å‡ endIndexã€‚ æå‰åˆ¤æ–­æ‰€è¦æˆªå–çš„å­—ç¬¦æ˜¯å¦æ˜¯ emojiï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ•´ä¸ª emoji æˆªæ‰ã€‚ ä» &quot; g,5å°±ï¿½&quot; ä¸­åˆ¤æ–­æ˜¯å¦åŒ…å« ï¿½ è¿™ä¸ªå­—ç¬¦ï¼Œå¦‚æœæœ‰å°±å…¨å±€æ›¿æ¢ã€‚ å…¶ä¸­ç¬¬ä¸‰ä¸ªæ–¹æ³•æˆ‘è¿˜å…·ä½“å®è·µäº†ä¸€ä¸‹ã€‚ é¦–å…ˆæˆ‘ä»¬æ²¡æœ‰åŠæ³•é€šè¿‡ utf16 ç›´æ¥å¾—åˆ° String å¯¹è±¡ï¼Œå› ä¸º ï¿½ è¿™ä¸ªç¬¦å·ä¼šå¯¼è‡´åˆå§‹åŒ–å¤±è´¥ã€‚æ‰€ä»¥åªèƒ½é€šè¿‡ NSString æ¥æ‹¿åˆ°ç›®æ ‡å­—ç¬¦ä¸²ã€‚ å…¶æ¬¡ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°äº† NSString å¯¹è±¡åï¼Œç›´æ¥è°ƒç”¨ .contains(&quot;ï¿½&quot;)ï¼Œè¿”å›å€¼å±…ç„¶æ˜¯ falseã€‚ let string = &quot; g,5å°±ğŸ‰‘ï¸&quot; let original = (string as NSString).substring(to: 6) print(original.contains(&quot;ï¿½&quot;)) // false æ­¤æ—¶ï¼Œåªè¦å‘æ–‡ä¸­æåˆ°çš„ç¬¬ä¸€ç§æ–¹æ³•é‚£æ ·ï¼Œå¯¹ string è½¬ä¸€æ¬¡ data å³å¯åˆ¤æ–­æˆåŠŸã€‚ let string = &quot; g,5å°±ğŸ‰‘ï¸&quot; let original = (string as NSString).substring(to: 6) let utf8Data = original.data(using: .utf8)! if let test = String(data: utf8Data, encoding: .utf8) { print(test.contains(&quot;ï¿½&quot;)) // true } ä½†æ˜¯è¿™ä¸€å¥—ä¸‹æ¥ç¡®å®æœ‰ç‚¹å¾—ä¸å¿å¤±äº†ã€‚ ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆæ˜¯ falseï¼Ÿ ç»è¿‡ç¿»é˜…èµ„æ–™ï¼Œæ€€ç–‘è¿™æ˜¯å› ä¸º NSString å’Œ String çš„åº•å±‚å¤„ç†ä¸åŒå¯¼è‡´çš„ã€‚ å¯¹äº NSStringï¼Œå…è®¸å­˜åœ¨æ— æ•ˆå­—ç¬¦ï¼Œæ‰€ä»¥ &quot; g,5å°±ï¿½&quot; ä¸­çš„ ï¿½ å’Œæˆ‘ä»¬æ‰‹å†™çš„ ï¿½ å¹¶éæ˜¯ç»Ÿä¸€ä¸ªå«ä¹‰ï¼Œåè€…ä»£è¡¨ä¸€ä¸ª â€œUnicodeæ›¿æ¢å­—ç¬¦â€ï¼Œå®ƒç”¨æ¥æ›¿æ¢æ— æ³•è¯†åˆ«æˆ–æ— æ•ˆçš„Unicodeå­—ç¬¦ã€‚è€Œ NSString ä¸­çš„ ï¿½ å°±åªæ˜¯ä¸€ä¸ªæ— æ•ˆçš„ Unicodeï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ‰ä¼šä¸åŒ¹é…ã€‚ è¿™å…¶å®ä¹Ÿèƒ½å›ç­”æœ€å¼€å§‹çš„é‚£ä¸ªæ–¹æ¡ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦å…ˆè½¬ dataï¼Œå†è½¬ä¸€æ¬¡ stringï¼Œæœ€åæ‰èƒ½åˆ¤æ–­æˆåŠŸã€‚ ","link":"https://blog.rakuyoo.top/remove-illegal-characters-from-string/"},{"title":"è®° podspec è½¬ podspec.json","content":"å¦‚æœä½ åƒæˆ‘ä¸€æ ·ä½¿ç”¨ Xcode 14.3 &amp; CocoaPods 12.4.1ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ å¾ˆæœ‰å¯èƒ½é‡åˆ°è·Ÿæˆ‘ä¸€æ ·é—®é¢˜ï¼šXcode 14.3 has pod lib lint failã€‚ å¦‚æœä½ æ­£åœ¨å¼€å‘çš„æ˜¯ä¸€ä¸ªç§æœ‰ podï¼Œé‚£è¿˜å¥½è¯´ï¼Œå¯ä»¥ç›´æ¥å°† podspec æ–‡ä»¶ push åˆ°è‡ªå·±çš„ git spec ä¸Šã€‚ ä½†æ˜¯å¦‚æœä½ åƒæˆ‘ä¸€æ ·ï¼Œç§æœ‰ spec repo ä¸­å­˜å‚¨çš„æ˜¯ podspec.jsonï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„è¿™ä¸ªå‘½ä»¤ä¹Ÿè®¸ä¼šå¸®åˆ°ä½ ï¼š pod ipc spec Name.podspec &gt;&gt; Name.podspec.json ä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥å°† podspec æ–‡ä»¶è½¬æ¢ä¸º podspec.json æ–‡ä»¶ï¼Œä¹‹åä½ å°±å¯ä»¥å°† json æ–‡ä»¶æ¨åˆ° git spec repo é‡Œäº†ã€‚ ","link":"https://blog.rakuyoo.top/ji-podspec-zhuan-podspecjson/"},{"title":"CGO ä¸ WireGuardKit ç¼–è¯‘","content":"CGO æ˜¯ä¸€ç§åœ¨ iOS å¹³å°ä¸Šè¿è¡Œ Go ä»£ç çš„æ–¹æ¡ˆã€‚è€Œ WireGuard ä¸€ç§ VPN æŠ€æœ¯ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€éƒ¨åˆ† Go ä»£ç ï¼ŒåŒæ—¶é¡¹ç›®æä¾›äº†ä¸€ä¸ª Makefile è„šæœ¬ï¼Œä½¿ç”¨ CGO æ¥å°†ç›¸å…³ä»£ç ç¼–è¯‘æˆ iOS é™æ€åº“ã€‚ å†™è¿™ç¯‡æ–‡ç« çš„å¥‘æœºæ˜¯ï¼Œå› ä¸ºå¸Œæœ›ä½¿ç”¨ Mac Catalyst å°†å†…éƒ¨å·¥å…·å¸¦åˆ° macOS å¹³å°ï¼Œæˆ‘åˆå›è¿‡å¤´å»çœ‹ä¸€å¹´å‰ï¼ˆæ°å·§æ˜¯22å¹´3æœˆï¼‰ç ”ç©¶ WireGuard çš„è¿‡ç¨‹ã€‚ å‘ç°è™½ç„¶å½“æ—¶çš„ç ”ç©¶æˆåŠŸï¼Œ.xcframewrok æ–‡ä»¶è¿˜åœ¨ï¼Œä½†æ˜¯è¿‡ç¨‹å·²ç»æ¨¡ç³Šä¸æ¸…äº†ã€‚å¦å¤–è¿˜éœ€è¦é’ˆå¯¹ Mac Cataglyst æ„å»ºå‡ºæ–°çš„é™æ€åº“ï¼Œæ‰€ä»¥åˆè¦ä»å¤´è¿›è¡Œæ¢³ç†ä¸è¿‡å¥½åœ¨æ˜¯ â€œæ¨¡ç³Šä¸æ¸…â€ï¼Œè€Œä¸æ˜¯ â€œä¸€å¹²äºŒå‡€â€ï¼Œå¤šå°‘è¿˜è®°å¾—ä¸€äº›ã€‚ Makefile æˆ‘å¯¹ Go è¯­è¨€å‡ ä¹å¯ä»¥è¯´æ˜¯ä¸€çªä¸é€šçš„ã€‚ è€Œå¯¹äº Makefile ä¹Ÿåªæœ‰å¾ˆå°‘å¾ˆå°‘çš„äº†è§£ã€‚ æƒ³è¦æ‰§è¡Œ Makefile æ–‡ä»¶ä¸­çš„è„šæœ¬ï¼Œå°±åœ¨å‘½ä»¤è¡Œä¸­ï¼Œåœ¨è¿›å…¥å¯¹åº”ç›®å½•åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # å‰ææ˜¯è¯´ï¼Œç”µè„‘ä¸Šè¦å®‰è£… makeã€‚ä¸€èˆ¬å®‰è£…äº† Xcode å‘½ä»¤è¡Œçš„è¯éƒ½æ˜¯æœ‰çš„ã€‚ make è¿™é‡Œæˆ‘å°†è¯¥ Makefile å…ˆè´´è¿‡æ¥ï¼š # These are generally passed to us by xcode, but we set working defaults for standalone compilation too. ARCHS ?= x86_64 arm64 PLATFORM_NAME ?= macosx SDKROOT ?= $(shell xcrun --sdk $(PLATFORM_NAME) --show-sdk-path) CONFIGURATION_BUILD_DIR ?= $(CURDIR)/out CONFIGURATION_TEMP_DIR ?= $(CURDIR)/.tmp export PATH := $(PATH):/usr/local/bin:/opt/homebrew/bin export CC ?= clang LIPO ?= lipo DESTDIR ?= $(CONFIGURATION_BUILD_DIR) BUILDDIR ?= $(CONFIGURATION_TEMP_DIR)/wireguard-go-bridge CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -arch GOARCH_arm64 := arm64 GOARCH_x86_64 := amd64 GOOS_macosx := darwin GOOS_iphoneos := ios build: $(DESTDIR)/libwg-go.a version-header: $(DESTDIR)/wireguard-go-version.h REAL_GOROOT := $(shell go env GOROOT 2&gt;/dev/null) export GOROOT := $(BUILDDIR)/goroot $(GOROOT)/.prepared: [ -n &quot;$(REAL_GOROOT)&quot; ] mkdir -p &quot;$(GOROOT)&quot; rsync -a --delete --exclude=pkg/obj/go-build &quot;$(REAL_GOROOT)/&quot; &quot;$(GOROOT)/&quot; cat goruntime-*.diff | patch -p1 -f -N -r- -d &quot;$(GOROOT)&quot; touch &quot;$@&quot; define libwg-go-a $(BUILDDIR)/libwg-go-$(1).a: export CGO_ENABLED := 1 $(BUILDDIR)/libwg-go-$(1).a: export CGO_CFLAGS := $(CFLAGS_PREFIX) $(ARCH) $(BUILDDIR)/libwg-go-$(1).a: export CGO_LDFLAGS := $(CFLAGS_PREFIX) $(ARCH) $(BUILDDIR)/libwg-go-$(1).a: export GOOS := $(GOOS_$(PLATFORM_NAME)) $(BUILDDIR)/libwg-go-$(1).a: export GOARCH := $(GOARCH_$(1)) $(BUILDDIR)/libwg-go-$(1).a: $(GOROOT)/.prepared go.mod go build -ldflags=-w -trimpath -v -o &quot;$(BUILDDIR)/libwg-go-$(1).a&quot; -buildmode c-archive rm -f &quot;$(BUILDDIR)/libwg-go-$(1).h&quot; endef $(foreach ARCH,$(ARCHS),$(eval $(call libwg-go-a,$(ARCH)))) $(DESTDIR)/wireguard-go-version.h: go.mod $(GOROOT)/.prepared sed -E -n 's/.*golang\\.zx2c4\\.com\\/wireguard +v[0-9.]+-[0-9]+-([0-9a-f]{8})[0-9a-f]{4}.*/#define WIREGUARD_GO_VERSION &quot;\\1&quot;/p' &quot;$&lt;&quot; &gt; &quot;$@&quot; $(DESTDIR)/libwg-go.a: $(foreach ARCH,$(ARCHS),$(BUILDDIR)/libwg-go-$(ARCH).a) @mkdir -vp &quot;$(DESTDIR)&quot; $(LIPO) -create -output &quot;$@&quot; $^ clean: rm -rf &quot;$(BUILDDIR)&quot; &quot;$(DESTDIR)/libwg-go.a&quot; &quot;$(DESTDIR)/wireguard-go-version.h&quot; install: build .PHONY: clean build version-header install è¿™ä¸ªè„šæœ¬åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š å®šä¹‰å˜é‡ï¼šæœ€å¼€å§‹çš„å‡ è¡Œéƒ½æ˜¯å®šä¹‰å˜é‡ï¼Œå…¶ä¸­ ?= è¯­æ³•åˆ™æ˜¯è®¾ç½®é»˜è®¤å€¼ï¼Œæ„æ€æ˜¯å¯ä»¥ä»å¤–éƒ¨è®¾ç½®è¯¥å€¼ã€‚ å®šä¹‰ç›®æ ‡ï¼šæ­¤åè„šæœ¬å®šä¹‰äº†4ä¸ªç›®æ ‡ï¼Œåˆ†åˆ«æ˜¯ buildã€version-headerã€clean å’Œ installã€‚å…¶ä¸­ version-header ç›®æ ‡å†…è¿˜å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼šlibwg-go-aã€‚ ç›®æ ‡çš„æ‰§è¡Œé¡ºåºï¼šæœ€åçš„ .PHONY ç”¨æ¥å®šä¹‰ç›®æ ‡æ‰§è¡Œé¡ºåºï¼Œè„šæœ¬å°†æŒ‰ç…§è¯¥å€¼çš„é¡ºåºå»æ‰§è¡Œç›®æ ‡ã€‚ çœ‹å®Œå¤§å—æˆ‘ä»¬æ¥çœ‹ç»†èŠ‚ã€‚ å®šä¹‰å˜é‡ åœ¨æ­¤ä¸è§£é‡Šæ¯ä¸ªå˜é‡çš„ä½œç”¨ï¼Œå…ˆé‡ç‚¹å…³æ³¨ä¸‹é¢å‡ ä¸ªï¼š ARCHS ?= x86_64 arm64 PLATFORM_NAME ?= macosx SDKROOT ?= $(shell xcrun --sdk $(PLATFORM_NAME) --show-sdk-path) GOARCH_arm64 := arm64 GOARCH_x86_64 := amd64 GOOS_macosx := darwin GOOS_iphoneos := ios ä¸Šé¢å·²ç»æåˆ°äº†ï¼Œè¿™ä¸ª Makefile æ˜¯ç”¨æ¥æ„å»º iOS é™æ€åº“çš„ã€‚ é‚£ä¹ˆ ARCHS è¿™ä¸ªå˜é‡å°±ä»£è¡¨ç€è¿™ä¸ªåº“æ‰€æ”¯æŒçš„æ¶æ„ã€‚é»˜è®¤æ˜¯ x86_64 å’Œ arm64 ä¸¤ä¸ªã€‚ PLATFORM_NAME å’Œ SDKROOT è¦ä¸€èµ·çœ‹ï¼Œæ ¹æ®æŒ‡å®šçš„å¹³å°è·å–å¯¹åº” SDK çš„è·¯å¾„ï¼Œå³ç”¨ä½•ç§ SDK æ¥æ„å»ºé™æ€åº“ã€‚ PLATFORM_NAME å¯é€‰çš„å€¼åŒ…æ‹¬ï¼š å€¼ å«ä¹‰ iphoneos iOS macosx macOS iphonesimulator iOS æ¨¡æ‹Ÿå™¨ åé¢å‡ ä¸ªå˜é‡åˆ™æ˜¯å®šä¹‰äº†ä¸€äº› CGO çš„å‚æ•°ï¼Œæ³¨æ„è¿™é‡Œæ˜¯æ²¡æœ‰ iphonesimulator å¯¹åº”çš„å‚æ•°çš„ï¼Œåªæœ‰ iOS å’Œ macOSã€‚ libwg-go-a å‡½æ•° å‰å‡ è¡Œæ˜¯ä½¿ç”¨ export æ¥å®šä¹‰ä¸€äº›ç¯å¢ƒå˜é‡ï¼ŒCGO_CFLAGS å’Œ CGO_LDFLAGS ç®—æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ª CGO å‚æ•°ï¼Œç”¨æ¥æŒ‡å®š C ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨çš„é€‰é¡¹ï¼Œåé¢è¿˜ä¼šæåŠã€‚ å‡½æ•°å†…çš„ $(1) æŒ‡çš„æ˜¯è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚åœ¨ libwg-go-a å‡½æ•°çš„ä¸‹ä¸€è¡Œæ˜¯ä¸€ä¸ª foreach è¯­å¥ï¼Œå®ƒçš„ä½œç”¨æ˜¯éå† ARCHSï¼Œå†å°†æ¯ä¸€ä¸ª ARCH ä½œä¸º libwg-go-a å‡½æ•°çš„å‚æ•°ä¼ å…¥ï¼Œæ¥è°ƒç”¨ libwg-go-a å‡½æ•°ã€‚æ‰€ä»¥è¿™é‡Œçš„ $(1) å°±æ˜¯æˆ‘ä»¬åœ¨æœ€ä¸Šé¢å®šä¹‰çš„ ARCHS é‡Œçš„å†…å®¹ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥æ³¨æ„åˆ° $(GOOS_$(PLATFORM_NAME)) è¿™é‡Œï¼Œä»£ç å€ŸåŠ© PLATFORM_NAME å˜é‡å¥—äº†ä¸€å±‚ï¼Œæ¥æ‹¼æ¥è·å– GOOS_macosx æˆ–è€… GOOS_iphoneos çš„å€¼ã€‚ å…¶ä¸­æ¯”è¾ƒå…³é”®çš„ go build å‘½ä»¤ï¼Œå°±æ˜¯çœŸæ­£è´Ÿè´£æ„å»ºé™æ€åº“çš„å‘½ä»¤ã€‚æœ€åç”Ÿæˆçš„é™æ€åº“æ–‡ä»¶ååˆ™æ˜¯ libwg-go-$(1).aã€‚ å°ç»“ åˆ°è¿™é‡Œ Makefile å¤§è‡´å°±ç®—æ˜¯è¯´å®Œäº†ï¼Œå¼„æ˜ç™½äº†è¿™ä¸ªæ–‡ä»¶çš„å¤§è‡´ç»“æ„ä¸å„éƒ¨åˆ†çš„ä½œç”¨ï¼Œåé¢æ‰å¥½åŠ¨æ‰‹å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚ é€šè¿‡ä¿®æ”¹ ARCHS å’Œ PLATFORM_NAME çš„å€¼ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° iOS å’Œ macOS å¹³å°çš„é™æ€åº“ï¼Œå¤§ä½“ä¸Šå·¥ä½œä¹Ÿå°±ç»“æŸäº†ã€‚ ä½†æ˜¯å¾€å¾€è¿˜ä¼šæœ‰äº›é¢å¤–å·¥ä½œè¦å¤„ç†ã€‚ ç¼–è¯‘æ”¯æŒæ¨¡æ‹Ÿå™¨çš„é™æ€åº“ è™½ç„¶ WireGuard VPN æœ¬èº«ä¸æ”¯æŒæ¨¡æ‹Ÿå™¨ï¼Œä½†æ˜¯è·³å‡ºè¿™ä¸ªè¯é¢˜ï¼Œä¸Šé¢æœ‰æåˆ°ï¼Œè¿™ä¸ªè„šæœ¬ç°åœ¨æ˜¯ä¸æ”¯æŒ iphonesimulator çš„ï¼Œå¦‚æœæƒ³è¦æ”¯æŒæ¨¡æ‹Ÿå™¨è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ å…¶å®ä¸æ”¯æŒçš„åŸå› å¾ˆç®€å•ï¼šå› ä¸ºä¸å­˜åœ¨ GOOS_iphonesimulator å˜é‡ï¼ˆæƒ³ä¸€æƒ³ $(GOOS_$(PLATFORM_NAME))ï¼‰ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å®šä¹‰è¯¥å˜é‡ã€‚é€šè¿‡æŸ¥é˜…èµ„æ–™ï¼Œæ¨¡æ‹Ÿå™¨å¯¹åº”çš„ GOOS ä¹Ÿä¸º iosï¼Œæ‰€ä»¥å˜é‡å®šä¹‰å¦‚ä¸‹ï¼š GOARCH_arm64 := arm64 GOARCH_x86_64 := amd64 GOOS_macosx := darwin GOOS_iphoneos := ios +GOOS_iphonesimulator := ios ä¹‹åå†æ‰§è¡Œ make å‘½ä»¤ï¼Œå°±å¯ä»¥å¾—åˆ°æ”¯æŒ iOS æ¨¡æ‹Ÿå™¨çš„é™æ€åº“äº†ã€‚ ç¼–è¯‘æ”¯æŒ Mac Cataglyst çš„é™æ€åº“ å›å½’ä¸šåŠ¡ï¼Œæœ¬æ¬¡æˆ‘çš„å·¥ä½œæ˜¯è¦ç¼–è¯‘æ”¯æŒ Mac Cataglyst çš„é™æ€åº“ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ x86_64-apple-ios13.0-macabi é€šè¿‡æŸ¥æ‰¾èµ„æ–™ï¼Œæˆ‘äº†è§£åˆ° -target x86_64-apple-ios13.0-macabi è¿™ä¸ªç”¨äºæè¿°ç‰¹å®šæ“ä½œç³»ç»Ÿå’Œå¤„ç†å™¨æ¶æ„çš„æ ‡è¯†ç¬¦ï¼š x86_64 è¡¨ç¤ºå¤„ç†å™¨æ¶æ„ä¸º 64 ä½çš„ Intel æˆ– AMD å¤„ç†å™¨ï¼› apple è¡¨ç¤ºè¿è¡Œåœ¨è‹¹æœæ“ä½œç³»ç»Ÿä¸Šï¼› ios13.0 è¡¨ç¤ºæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¸º iOS 13.0ï¼› macab è¡¨ç¤ºä½¿ç”¨çš„æ˜¯ Mac ä¸Šçš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆMac Application Binary Interfaceï¼‰ï¼Œå³æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ Mac Cataglystã€‚ é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ ‡è¯†ç¬¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºå‡ºæ”¯æŒ Mac Cataglyst çš„é™æ€åº“ã€‚ æ¥ç€é€šè¿‡è¿™ä¸ªå›å¤å¾—çŸ¥ï¼Œè¯¥å€¼éœ€è¦èµ‹å€¼ç»™ CGO_CFLAGS å˜é‡ã€‚å›åˆ°è„šæœ¬ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒCGO_CFLAGS ä¸Šä½¿ç”¨ CFLAGS_PREFIX è¿›è¡Œå°è£…ã€‚ åœ¨è¿™ä¸€æ­¥æˆ‘é‡åˆ°äº†2ä¸ªé—®é¢˜ï¼š ä¸è¦ç›´æ¥å°† -target x86_64-apple-ios13.0-macabi å†™åœ¨ CFLAGS_PREFIX çš„æœ«å°¾ã€‚ çœç•¥ä¸€äº›ä»£ç åï¼ŒæŠŠä¸¤è¡Œç›¸å…³ä»£ç æ”¾åœ¨ä¸€èµ·çœ‹ï¼š CFLAGS_PREFIX := -isysroot $(SDKROOT) -arch $(BUILDDIR)/libwg-go-$(1).a: export CGO_CFLAGS := $(CFLAGS_PREFIX) $(ARCH) å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸Š export çš„å†…å®¹æ˜¯ -isysroot $(SDKROOT) -arch x86_64ã€‚ å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨ CFLAGS_PREFIX çš„æœ«å°¾æ·»åŠ ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠ -arch x86_64 éš”å¼€ï¼Œç»§è€ŒæŠ¥é”™ã€‚æ‰€ä»¥æ·»åŠ åˆ° -arch å‰å³å¯ã€‚ æ‰¾ä¸åˆ° x86_64-apple-ios13.0-macabiã€‚ ç›¸å…³çš„é—®é¢˜åœ¨ golang/go çš„ github ä¸Šæ˜¯å¯ä»¥æœåˆ°çš„ï¼Œå¯æƒœè¿™ä¸ªé—®é¢˜æ˜¯é’ˆå¯¹ go-mobile çš„ï¼Œä½†æ˜¯å¯ä»¥æ³¨æ„åˆ°å›å¤ä¸­çš„ï¼Œ-iosversion=14 å­—æ ·ã€‚ äºæ˜¯å°†å…¶æ”¹ä¸º x86_64-apple-ios14.0-macabiï¼Œæœæ–­è§£å†³é—®é¢˜ã€‚ ç¼–è¯‘ Mac Cataglyst è™½ç„¶æ“ä½œçš„æ˜¯ iOS Appï¼Œä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯è¿è¡Œåœ¨ macOS ä¸Šï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ä½¿ç”¨ macosx çš„ sdk è¿›è¡Œæ„å»ºã€‚ ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š ARCHS ?= x86_64 arm64 PLATFORM_NAME ?= macosx SDKROOT ?= $(shell xcrun --sdk $(PLATFORM_NAME) --show-sdk-path) -CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -arch +CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -target x86_64-apple-ios14.0-macabi -arch ä½†æ˜¯è¿è¡Œä»£ç åä¼šå‘ç° arm64 æ¶æ„çš„åŒ…æ‰“ä¸å‡ºã€‚ Warning å…¶å®åˆ°è¿™é‡Œï¼Œæœ‰å…³ WireGuard çš„ç›¸å…³å·¥ä½œå·²ç» â€œç»“æŸâ€ äº†ã€‚å› ä¸ºè™½ç„¶æœ€åæˆ‘æ‰“å‡ºäº†åŒ…ï¼Œä½†æ˜¯æˆªæ­¢åˆ°æœ¬æ–‡å‘å¸ƒï¼Œæˆ‘è¿˜æœªèƒ½æˆåŠŸå°†é¡¹ç›®è¿è¡Œèµ·æ¥ï¼Œæ‰€ä»¥å¹¶ä¸çŸ¥é“æ¥ä¸‹æ¥çš„æ“ä½œæ˜¯å¦æ­£ç¡®ã€‚ é€šè¿‡å°† GOOS_macosx å¯¹åº”çš„å€¼ä¿®æ”¹ä¸º ios å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥æœ€ç»ˆä¿®æ”¹ä¸ºï¼š ARCHS ?= x86_64 arm64 PLATFORM_NAME ?= macosx SDKROOT ?= $(shell xcrun --sdk $(PLATFORM_NAME) --show-sdk-path) -CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -arch +CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -target x86_64-apple-ios14.0-macabi -arch GOARCH_arm64 := arm64 GOARCH_x86_64 := amd64 -GOOS_macosx := darwin +GOOS_macosx := ios GOOS_iphoneos := ios GOOS_maccatalyst := ios GOOS_iphonesimulator := ios å‚è€ƒ golang/go with issue #36856 golang/go with issue #47228 Re: Support for M1 MacBook Simulators ","link":"https://blog.rakuyoo.top/cgo-and-wireGuardkit-compilation/"},{"title":"epoxy æºç ç¬”è®°1ï¼šDiffing ç®—æ³•","content":"æœ€è¿‘å¼€å§‹é˜…è¯»å­¦ä¹  epoxy çš„æºç ï¼Œå¼€ä¸ªæ–°çš„ç³»åˆ—æ¥è®°å½•ä¸€ä¸‹å­¦ä¹ æˆåŠŸã€‚ æœ¬ç³»åˆ—æ–‡ç« ä¸å¯¹ epoxy æ˜¯ä»€ä¹ˆè¿›è¡Œè®²è§£ï¼Œç›´æ¥è®²è§£å…¶ä¸­çš„éƒ¨åˆ†æºç å†…å®¹ã€‚ å¦‚æœç›¸æ¯”è¾ƒæ–‡å­—ï¼Œæ‚¨æ›´å–œæ¬¢ç›´æ¥é˜…è¯»ä»£ç +æ³¨é‡Šï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è·³åˆ°æ–‡ç« æœ«å°¾çš„ æ€»ç»“ ä¸€èŠ‚ï¼Œè¯¥å°èŠ‚åŒ…å«äº†ä¸€ä¸ªå®Œæ•´çš„ï¼Œå¸¦æ³¨é‡Šè®²è§£çš„æºç ã€‚ ç›®å½• æºç  ContiguousArray é¢„å¡«å……æ•°ç»„ entries è®°å½•æ–°å…ƒç´  Entry å¯¹è±¡å’Œ trackNewIndex(_:) æ–¹æ³• è®°å½•æ—§å…ƒç´  NewRecord &amp; OldRecord ç¡®å®šå…ƒç´ å˜åŠ¨ ä¸­åœºä¼‘æ¯ åˆ é™¤ã€æ–°å¢ä¸ç§»åŠ¨ åˆ é™¤ æ–°å¢å’Œç§»åŠ¨ æ€»ç»“ æºç  æœ¬æ–‡ä¸»è¦è®²è§£ Collection+Diff.swift æ–‡ä»¶ä¸­çš„ makeChangeset(from:) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥å¿«é€Ÿæ¯”è¾ƒå‡ºä¸¤ä¸ªé›†åˆä¹‹é—´çš„åŒºåˆ«ï¼ŒåŒæ—¶è¿”å›å¢åˆ æ”¹çš„ç´¢å¼•é›†åˆã€‚ é¦–å…ˆè´´ä¸€ä¸‹ç›¸å…³çš„æºç ï¼š // MARK: - Collection extension Collection where Element: Diffable, Index == Int { /// Diffs two collections (e.g. `Array`s) of `Diffable` items, returning an `IndexChangeset` /// representing the minimal set of changes to get from the other collection to this collection. /// /// - Parameters: /// - from other: The collection of old data. public func makeChangeset(from other: Self) -&gt; IndexChangeset { // Arranging the elements contiguously prior to diffing improves performance by ~40%. let new = ContiguousArray(self) let old = ContiguousArray(other) /// The entries in both this and the other collection, keyed by their `dataID`s. var entries = [AnyHashable: Entry](minimumCapacity: new.count) var duplicates = [Entry]() var newResults = ContiguousArray&lt;NewRecord&gt;() newResults.reserveCapacity(new.count) for index in new.indices { let id = new[index].diffIdentifier let entry = entries[id, default: Entry()] if entry.trackNewIndex(index) { duplicates.append(entry) } entries[id] = entry newResults.append(NewRecord(entry: entry)) } var oldResults = ContiguousArray&lt;OldRecord&gt;() oldResults.reserveCapacity(old.count) for index in old.indices { let id = old[index].diffIdentifier let entry = entries[id] entry?.pushOldIndex(index) oldResults.append(OldRecord(entry: entry)) } for newIndex in new.indices { let entry = newResults[newIndex].entry if let oldIndex = entry.popOldIndex() { let newItem = new[newIndex] let oldItem = other[oldIndex] if !oldItem.isDiffableItemEqual(to: newItem) { entry.isUpdated = true } newResults[newIndex].correspondingOldIndex = oldIndex oldResults[oldIndex].correspondingNewIndex = newIndex } } var deletes = [Int]() var deleteOffsets = [Int]() deleteOffsets.reserveCapacity(old.count) var runningDeleteOffset = 0 for index in old.indices { deleteOffsets.append(runningDeleteOffset) let record = oldResults[index] if record.correspondingNewIndex == nil { deletes.append(index) runningDeleteOffset += 1 } } var inserts = [Int]() var updates = [(Int, Int)]() var moves = [(Int, Int)]() var insertOffsets = [Int]() insertOffsets.reserveCapacity(new.count) var runningInsertOffset = 0 for index in new.indices { insertOffsets.append(runningInsertOffset) let record = newResults[index] if let oldArrayIndex = record.correspondingOldIndex { if record.entry.isUpdated { updates.append((oldArrayIndex, index)) } let insertOffset = insertOffsets[index] let deleteOffset = deleteOffsets[oldArrayIndex] if (oldArrayIndex - deleteOffset + insertOffset) != index { moves.append((oldArrayIndex, index)) } } else { inserts.append(index) runningInsertOffset += 1 } } EpoxyLogger.shared.assert( old.count + inserts.count - deletes.count == new.count, &quot;Failed sanity check for old count with changes matching new count.&quot;) return IndexChangeset( inserts: inserts, deletes: deletes, updates: updates, moves: moves, newIndices: oldResults.map { $0.correspondingNewIndex }, duplicates: duplicates.map { $0.newIndices }) } // MARK: - Entry /// A bookkeeping refrence type for the diffing algorithm. private final class Entry { // MARK: Internal private(set) var oldIndices = [Int]() private(set) var newIndices = [Int]() var isUpdated = false /// Tracks an index from the new indices, returning `true` if this entry has previously tracked /// a new index as a means to identify duplicates and `false` otherwise. func trackNewIndex(_ index: Int) -&gt; Bool { let previouslyEmpty = newIndices.isEmpty newIndices.append(index) // We've encountered a duplicate, return true so we can track it. if !previouslyEmpty, newIndices.count == 2 { return true } return false } func pushOldIndex(_ index: Int) { oldIndices.append(index) } func popOldIndex() -&gt; Int? { guard currentOldIndex &lt; oldIndices.endIndex else { return nil } defer { currentOldIndex += 1 } return oldIndices[currentOldIndex] } // MARK: Private private var currentOldIndex = 0 } // MARK: - OldRecord /// A bookkeeping type for pairing up an old element with its new index. private struct OldRecord { var entry: Entry? var correspondingNewIndex: Int? = nil } // MARK: - NewRecord /// A bookkeeping type for pairing up a new element with its old index. private struct NewRecord { var entry: Entry var correspondingOldIndex: Int? = nil } makeChangeset(from:) æ–¹æ³•æ˜¯ Collection&lt;Diffable&gt; çš„ä¸€ä¸ªæ‰©å±•ï¼Œå®é™…ä½¿ç”¨æ—¶ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸ºä¸€ä¸ª [Diffable]ã€‚æ–¹æ³•æ¥æ”¶ä¸€ä¸ªåŒç±»å‹çš„é›†åˆï¼Œè¿”å›ä¸€ä¸ª IndexChangeset ç±»å‹çš„ç»“æ„ä½“ã€‚ è¿”å›å€¼æš‚ä¸”å¿½ç•¥ï¼Œå’±ä»¬ç›´æ¥æ¥çœ‹å‡½æ•°ä½“ã€‚ ContiguousArray let new = ContiguousArray(self) let old = ContiguousArray(other) å‡½æ•°ä½“å†…é¦–å…ˆå°† self å’Œ other è½¬æ¢ä¸º ContiguousArray ç±»å‹çš„æ•°ç»„ã€‚ä»å˜é‡åä¸Šæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œself ä»£è¡¨ç€æ–°çš„é›†åˆï¼Œè€Œ other ä»£è¡¨ç€æ—§çš„çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯è¢«æ¯”è¾ƒçš„é›†åˆã€‚ ContiguousArray å’Œ Array ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº ContiguousArray èƒ½ä¿è¯å­å…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œè¿™å°±å…è®¸ CPU é€šè¿‡æŒ‡é’ˆè¿›è¡Œè¿ç»­è®¿é—®ï¼Œå¤§å¹…æå‡æ€§èƒ½ã€‚è€Œ Array æˆ‘ä»¬å¤§å®¶éƒ½çŸ¥é“ï¼Œå®ƒçš„å†…éƒ¨ä½¿ç”¨äº† â€œç¼“å†²åŒºâ€ï¼Œé€»è¾‘ä¸Šæ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯å†…å­˜ä¸Šæœªå¿…æ˜¯è¿ç»­çš„ã€‚ å› ä¸ºåœ¨åç»­çš„ç®—æ³•ä¸­ï¼Œself å’Œ other çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œå°†å…¶è½¬æ¢ä¸º ContiguousArray æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ é€šè¿‡æºç ä¸­çš„æ³¨é‡Šæˆ‘ä»¬ä¹Ÿèƒ½çŸ¥é“ï¼Œå°† self å’Œ other è½¬æ¢ä¸º ContiguousArray ç±»å‹ï¼Œå¯ä»¥æå‡å¤§çº¦ 40% çš„æ€§èƒ½ã€‚ åæ–‡ä¸­ï¼Œå°†ä½¿ç”¨ new ä»£è¡¨ selfï¼Œä½¿ç”¨ old ä»£è¡¨ otherã€‚å’Œè¿™é‡Œçš„å˜é‡å£°æ˜ä¿æŒåŒæ­¥ã€‚ é¢„å¡«å……æ•°ç»„ æ¯•ç«Ÿæ˜¯ä¸€ä¸ªè®²ç©¶æ•ˆç‡çš„ç®—æ³•ï¼Œåæ–‡ä¸­éšå¤„å¯è§ .init(minimumCapacity:) ã€ reserveCapacity(_:) æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼šè®¾ç½®æ•°ç»„çš„é•¿åº¦ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ Swift æ•°ç»„æ‰©å®¹é€šå¸¸æ˜¯ç›´æ¥ *2ã€‚ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬æœ‰æåˆ°ï¼Œæ•´ä¸ªç®—æ³•ä¸­æ•°æ®æºçš„å¤§å°æ˜¯å·²çŸ¥çš„ï¼Œé‚£ä¹ˆä½œä¸ºä¸€ä¸ªè®²ç©¶æ•ˆç‡çš„ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºæ•°ç»„çš„åŒæ—¶å°±è®¾å®šå¥½æ•°ç»„çš„å¤§å°ï¼Œé¿å…åœ¨åç»­æ“ä½œä¸­è§¦å‘æ•°ç»„çš„è‡ªåŠ¨æ‰©å®¹ï¼Œå‡å°‘å› ä¸ºæ‰©å®¹è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚ entries var entries = [AnyHashable: Entry](minimumCapacity: new.count) entries è¿™ä¸ªå­—å…¸å˜é‡çš„ä½œç”¨æ˜¯ï¼Œå°† new å’Œ old ä¸­ï¼Œä½¿ç”¨ç›¸åŒ id çš„å…ƒç´ ç´¢å¼•å€¼å¯¹åº”èµ·æ¥ã€‚ ç°åœ¨è¿™ä¹ˆè®²å¯èƒ½æ¯”è¾ƒæŠ½è±¡ï¼Œåé¢ç»“åˆé€»è¾‘ä¸€èµ·æ¥è°ˆã€‚ è®°å½•æ–°å…ƒç´  var newResults = ContiguousArray&lt;NewRecord&gt;() newResults.reserveCapacity(new.count) for index in new.indices { let id = new[index].diffIdentifier let entry = entries[id, default: Entry()] if entry.trackNewIndex(index) { duplicates.append(entry) } entries[id] = entry newResults.append(NewRecord(entry: entry)) } ä»£ç é¦–å…ˆä½¿ç”¨æ–°åºåˆ—çš„ç´¢å¼•è¿›è¡Œéå†ï¼Œä½¿ç”¨å¯¹åº”å…ƒç´ çš„ idï¼Œå°è¯•å» entries ä¸­æŸ¥æ‰¾å…ƒç´ ã€‚ è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªå°æŠ€å·§ï¼šDictionay çš„ defaultã€‚å½“ä¸å­˜åœ¨ id å¯¹åº”çš„å…ƒç´ æ—¶ï¼Œå°†è¿”å› default å¯¹åº”çš„å†…å®¹ã€‚è¿™é‡Œå³æ˜¯è¿”å›ä¸€ä¸ªç©ºçš„ Entry å¯¹è±¡ã€‚ ç¨åè®²è§£ Entry å¯¹è±¡å’Œ trackNewIndex(_:) æ–¹æ³•çš„å…·ä½“å†…å®¹ï¼Œå…ˆå¤§è‡´è¯´ä¸€ä¸‹ï¼š Entry å¯¹è±¡ç”¨æ¥è®°å½• â€œæ‹¥æœ‰åŒä¸€ä¸ª id çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå…¶åœ¨æ–°ã€æ—§ä¸¤ä¸ªæ•°ç»„ä¸­çš„ä½ç½®â€ã€‚ trackNewIndex(_:) æ–¹æ³•æ¥æ”¶ç´¢å¼•ä½œä¸ºå‚æ•°ï¼Œå¹¶å­˜å‚¨åˆ° Entry å¯¹è±¡ä¸­ã€‚åŒæ—¶è¯¥æ–¹æ³•ä¼šè¿”å›è¿™ä¸ª Entry å¯¹è±¡æ˜¯å¦å·²ç»åœ¨ä¹‹å‰å‡ºç°è¿‡ï¼ˆç›¸å½“äºä¸€ä¸ªé‡å¤æ£€æŸ¥ï¼‰ã€‚ ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“è¿™ä¸ª for å¾ªç¯å¤§è‡´çš„å«ä¹‰å’Œä½œç”¨äº†ï¼š å®ƒéå†æ–°æ•°ç»„ï¼Œé¦–å…ˆæ ¹æ® id å°†æ•°ç»„å…ƒç´ å­˜å‚¨åˆ° entries å¯¹è±¡ä¸­ï¼Œå…¶æ¬¡å¯¹è¯¥æ•°ç»„åšä¸€ä¸ª â€œé‡å¤æ£€æŸ¥â€ï¼Œå¹¶è®°å½•ä¸‹é‡å¤çš„æ¬¡æ•°ã€‚ Entry å¯¹è±¡å’Œ trackNewIndex(_:) æ–¹æ³• Entry å¯¹è±¡æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå®ƒçš„å®Œæ•´å£°æ˜æ¯”è¾ƒé•¿ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†é‡å¤è´´äº†ï¼Œè¯»è€…å¯ä»¥ç¿»åˆ°æœ€ä¸Šé¢ è‡ªè¡ŒæŸ¥çœ‹ã€‚ æˆ‘ä»¬å…ˆæŠŠç›®å…‰é›†ä¸­åœ¨ newIndices è¿™ä¸ªå±æ€§ä»¥åŠ trackNewIndex(_:) æ–¹æ³•ä¸Šã€‚ trackNewIndex(_:) æ–¹æ³•çš„å®ç°ä¸ºï¼š /// Tracks an index from the new indices, returning `true` if this entry has previously tracked a new index as a means to identify duplicates and `false` otherwise. func trackNewIndex(_ index: Int) -&gt; Bool { let previouslyEmpty = newIndices.isEmpty newIndices.append(index) // We've encountered a duplicate, return true so we can track it. if !previouslyEmpty, newIndices.count == 2 { return true } return false } è¯¥æ–¹æ³•å°†å‚æ•°å­˜å‚¨åˆ° newIndices é‡Œã€‚è¿™æ˜¯å®ƒçš„ä½œç”¨ä¹‹ä¸€ï¼šè®°å½•è¯¥ id åœ¨æ–°æ•°ç»„ï¼ˆnewï¼‰ä¸­çš„ä½ç½®ã€‚ ç„¶ååˆ¤æ–­ï¼Œå¦‚æœ newIndices ä¸­çš„å…ƒç´ ç­‰äº 2ï¼Œåˆ™æ„å‘³ç€å‡ºç°äº†é‡å¤ã€‚è¿™å¾ˆå¥½ç†è§£ï¼ŒnewIndices å¤§äº 1 æ„å‘³ç€åŒä¸€ä¸ª id å‡ºç°äº†ä¸¤æ¬¡ã€‚ä¸è¿‡æˆªæ­¢åˆ°å‘æ–‡æˆ‘ä¹Ÿæ²¡èƒ½ç†è§£ï¼Œä¸ºä»€ä¹ˆæ˜¯ == 2 è€Œä¸æ˜¯ &gt;= 2ã€‚ç»“åˆåæ–‡æ¨æ–­ï¼ŒçŒœæµ‹æ˜¯ä¸å¸Œæœ› duplicates ä¸­å‡ºç°é‡å¤çš„å…ƒç´ ã€‚ è®°å½•æ—§å…ƒç´  var oldResults = ContiguousArray&lt;OldRecord&gt;() oldResults.reserveCapacity(old.count) for index in old.indices { let id = old[index].diffIdentifier let entry = entries[id] entry?.pushOldIndex(index) oldResults.append(OldRecord(entry: entry)) } è®°å½•æ—§å…ƒç´ çš„é€»è¾‘æ¯”è®°å½•æ–°å…ƒç´ çš„é€»è¾‘è¦ç®€å•ä¸€äº›ï¼šå½“æˆ‘ä»¬é€šè¿‡ idï¼Œå¦‚æœåœ¨ entries æ˜ å°„è¡¨ä¸­æŸ¥åˆ°å¯¹åº”å…ƒç´ æ—¶ï¼ˆæ„å‘³ç€è¯¥ id å­˜åœ¨å¯¹åº”çš„æ–°å…ƒç´ ï¼‰ï¼Œåˆ™å­˜å‚¨è¯¥å…ƒç´ åœ¨æ—§æ•°æ®ä¸­çš„ç´¢å¼•å€¼ã€‚å¦åˆ™ä¸è¿›è¡Œå­˜å‚¨ï¼ˆå› ä¸º entries çš„æ„æ€æ˜¯å­˜å‚¨ â€œæ–°-æ—§â€ çš„å¯¹åº”å…³ç³»ï¼Œä¸å­˜åœ¨æ–°ï¼Œé‚£ä¹ˆæ—§å°±æ²¡æœ‰æ„ä¹‰ï¼‰ã€‚ NewRecord &amp; OldRecord åœ¨éå†æ–°é›†åˆå’Œæ—§é›†åˆçš„å¾ªç¯ä¸­ï¼Œæœ«å°¾éƒ½æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯¹åº”çš„ XXRecord å¯¹è±¡ã€‚è¿™ä¸¤ä¸ªç±»å‹çš„å£°æ˜æ¯”è¾ƒç›¸ä¼¼ï¼Œé™¤äº†å­˜å‚¨å¯¹åº”çš„ Entry ä¹‹å¤–ï¼Œè¿˜å¸¦æœ‰ä¸€ä¸ª Int? ç±»å‹çš„ correspondingXXXIndex å±æ€§ï¼Œè¯¥å±æ€§é»˜è®¤æ˜¯ nilã€‚ correspondingOldIndex æ„å‘³ç€åœ¨æ–°é›†åˆä¸­ï¼Œè¯¥å…ƒç´ åœ¨æ—§é›†åˆä¸­çš„ä½ç½®ã€‚ correspondingNewIndex æ„å‘³ç€åœ¨æ—§é›†åˆä¸­ï¼Œè¯¥å…ƒç´ åœ¨æ–°é›†åˆä¸­çš„ä½ç½®ã€‚ å¦‚æœæ˜¯ nilï¼Œåˆ™æ„å‘³ç€è¯¥å…ƒç´ åœ¨å¦å¤–çš„é›†åˆä¸­ä¸å­˜åœ¨ã€‚ è¿™ä¸¤ä¸ªå±æ€§éƒ½åœ¨åé¢çš„ç®—æ³•ä¸­èµ·åˆ°äº†é‡è¦çš„ä½œç”¨ã€‚ ç¡®å®šå…ƒç´ å˜åŠ¨ for newIndex in new.indices { let entry = newResults[newIndex].entry if let oldIndex = entry.popOldIndex() { let newItem = new[newIndex] let oldItem = other[oldIndex] if !oldItem.isDiffableItemEqual(to: newItem) { entry.isUpdated = true } newResults[newIndex].correspondingOldIndex = oldIndex oldResults[oldIndex].correspondingNewIndex = newIndex } } è¿™ä¸ªå¯¹æ–°é›†åˆçš„éå†ï¼Œç¡®å®šäº†ä¸¤ä¸ªé›†åˆä¹‹é—´å…ƒç´ çš„å˜åŠ¨ã€‚ é¦–å…ˆæ˜¯å¯¹æ–°é›†åˆçš„éå†ï¼Œå› ä¸º newResults å¯ä»¥è¯´å°±æ˜¯ new é€šè¿‡ map å¾—åˆ°çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ newIndex ç›´æ¥ä» newResults ä¸­è¿›è¡Œå–å€¼ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ˜¯å¦ä¼šè¶Šç•Œã€‚ ä½ åº”è¯¥è¿˜è®°å¾—ï¼Œentry å¯¹è±¡ä¸­å­˜å‚¨ç€è¯¥ id å¯¹åº”çš„å…ƒç´ åœ¨æ–°ã€è€é›†åˆä¸­å¯¹åº”çš„ç´¢å¼•ã€‚å¦‚æœåœ¨æ–°ã€è€é›†åˆä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå¯¹åº”çš„ç´¢å¼•ä¹Ÿå°±ä¸å­˜åœ¨ã€‚æ‰€ä»¥é€šè¿‡ popOldIndex() æ–¹æ³•ï¼ˆé€šè¿‡æ–¹æ³•åä¹Ÿèƒ½çœ‹å‡ºå®ƒçš„ä½œç”¨ï¼‰ï¼Œå¯ä»¥é€šè¿‡ entry å¯¹è±¡åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ—§çš„å…ƒç´ ã€‚ åˆ°è¿™ä¸€æ­¥æˆ‘ä»¬åº”è¯¥èƒ½çŸ¥é“ï¼šå¦‚æœ newResults ä¸­çš„æŸä¸€ä¸ªå…ƒç´ çš„ correspondingOldIndex æ˜¯ nilï¼Œé‚£ä¹ˆè¯¥å…ƒç´ å°±æ˜¯æ–°å¢çš„ã€‚é‚£ä¹ˆåè¿‡æ¥ï¼ŒoldResults ä¸­çš„é€»è¾‘ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ å®é™…ä¸Šä¸Šä¸€èŠ‚ä¸­ï¼Œå…³äº correspondingOldIndex å’Œ correspondingNewIndex è¿™ä¸¤ä¸ªå±æ€§çš„ä½œç”¨ï¼Œä¹Ÿæ˜¯æˆ‘é€šè¿‡è¿™ä¸ªå¾ªç¯æ¨æ–­å‡ºæ¥çš„ã€‚ æ¥ç€å¾€ä¸‹çœ‹ã€‚å¦‚æœå­˜åœ¨æ—§çš„å…ƒç´ ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦æ¯”è¾ƒæ–°æ—§ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™é€šè¿‡ entry.isUpdated è®°å½•è¯¥å…ƒç´ å‘ç”Ÿäº†æ›´æ–°ã€‚ æœ€ååœ¨ newResults å’Œ oldResults ä¸­è®°å½•è¯¥å…ƒç´ åœ¨å¦å¤–ä¸€ä¸ªæ•°ç»„ä¸­çš„ä½ç½®ã€‚ ä¸­åœºä¼‘æ¯ åˆ°äº†è¿™é‡Œï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å°ç»“ä¸€ä¸‹ï¼Œå…ˆæ€»ç»“ä¸€ä¸‹ newResultsã€oldResults å’Œ entries ä¸‰ä¸ªå˜é‡çš„ä½œç”¨ã€‚ entries çš„ä¸»è¦å°±æ˜¯å°†æ–°æ—§ä¸¤ä¸ªæ•°ç»„ï¼Œé€šè¿‡ç›¸åŒçš„ id åšä¸€ä¸ªåŒ¹é…ï¼ŒåŒæ—¶è®°å½•ç›¸åº”çš„ç´¢å¼•ã€‚åŒ¹é…åˆ°ä¸€èµ·ä¹‹åç”¨æ¥åˆ›å»º newResults å’Œ oldResults å¯¹è±¡ã€‚è¯¥å˜é‡ä¸»è¦ä½œç”¨äºç®—æ³•çš„å‰åŠéƒ¨åˆ†ï¼Œä¸ºåˆ›å»º newResults å’Œ oldResults è€Œç”Ÿï¼Œåˆ›å»ºå®Œä¹‹åå®ƒçš„ä»»åŠ¡å°±ç»“æŸäº†ã€‚ newResults å’Œ oldResults è¿™ä¸¤ä¸ªå˜é‡æœ€ä¸»è¦çš„ä½œç”¨ï¼ŒæŒ‰æˆ‘çš„ç†è§£å°±æ˜¯ï¼šâ€œé€šè¿‡ä¸€ä¸ªInt ç±»å‹çš„å¯é€‰å€¼ï¼Œè®°å½•äº† entry çš„å‰ä¸–ä»Šç”Ÿâ€ã€‚ correspondingXXXIndex çš„å­˜åœ¨æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š æ˜¯å¦ä¸ºç©ºæ„å‘³ç€æœ‰å‰ä¸–ï¼Œæˆ–è€…æœ‰ä»Šç”Ÿ ä¸åªæ˜¯æœ‰ï¼Œè¿˜èƒ½æ‹¿åˆ°å¯¹åº”çš„ä½ç½® æ„Ÿæ…¨ä¸€ä¸‹å¦‚æœæ²¡æœ‰ â€œå¯é€‰å€¼â€ è¿™ä¸ªæ¦‚å¿µï¼Œåˆ™éœ€è¦å€ŸåŠ© Bool + Int ä¸¤ä¸ªå˜é‡æ¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚æˆ–è€…åˆ¤æ–­ä¸€ä¸‹ nilï¼Ÿ åˆ é™¤ã€æ–°å¢ä¸ç§»åŠ¨ åœ¨å¾—åˆ° newResults å’Œ oldResults ä¸¤ä¸ªå¯¹è±¡åï¼Œè¦è®¡ç®—å‡ºä¸¤ä¸ªé›†åˆä¹‹é—´çš„å·®å¼‚å°±æ¯”è¾ƒç®€å•äº†ã€‚ åˆ é™¤ åé¢çš„ç®—æ³•é¦–å…ˆå¤„ç†çš„æ˜¯åˆ é™¤æ“ä½œã€‚ var deletes = [Int]() var deleteOffsets = [Int]() deleteOffsets.reserveCapacity(old.count) var runningDeleteOffset = 0 for index in old.indices { deleteOffsets.append(runningDeleteOffset) let record = oldResults[index] if record.correspondingNewIndex == nil { deletes.append(index) runningDeleteOffset += 1 } } å…¶å®ä¸Šæ–‡å·²ç»åšäº†è§£é‡Šï¼šå¦‚æœ correspondingNewIndex æ˜¯ nilï¼Œåˆ™æ„å‘³ç€è¯¥å…ƒç´ æ˜¯è¢«åˆ é™¤çš„å…ƒç´ ã€‚æ‰€ä»¥è¿™æ¬¡æ˜¯å¯¹ old è¿›è¡Œéå†ï¼Œè€Œä¸æ˜¯éå† new ã€‚ é™¤äº†å°†è¢«åˆ é™¤çš„å…ƒç´ è®°å½•åˆ° deletes ä¹‹å¤–ï¼Œè¯¥å¾ªç¯è¿˜å°† â€œåœ¨è¿™ä¸ªä½ç½®ä¹‹å‰ï¼Œæœ‰å¤šå°‘ä¸ªè¢«åˆ é™¤äº†å¤šå°‘ä¸ªå…ƒç´ â€ è®°å½•åˆ°äº† deleteOffsets æ•°ç»„ä¸­ã€‚ ä¾‹å¦‚ [1, 2, 3, 4, 5, 6, 7] å’Œ [2, 3, 5, 7] è¿™ä¸¤ä¸ªé›†åˆåšæ¯”è¾ƒï¼Œé‚£ä¹ˆ deleteOffsets çš„å€¼å°±æ˜¯ [0, 1, 1, 1, 2, 2, 3]ã€‚ä»£è¡¨ç€ â€œ5è¿™ä¸ªå…ƒç´ ä¹‹å‰ï¼Œæœ‰ä¸¤ä¸ªå…ƒç´ è¢«åˆ é™¤æ‰äº†â€ã€‚ è¯¥ç®—æ³•æ˜¯å…ˆå°† runningDeleteOffset æ·»åŠ åˆ° deleteOffsets é‡Œï¼Œå†åšé€’å¢æ“ä½œã€‚æ‰€ä»¥è®°å½•çš„æ˜¯ â€œæœ¬å…ƒç´ ä¹‹å‰ï¼Œè¢«åˆ é™¤äº†å¤šå°‘ä¸ªå…ƒç´ â€ã€‚ æ–°å¢å’Œç§»åŠ¨ var inserts = [Int]() var updates = [(Int, Int)]() var moves = [(Int, Int)]() var insertOffsets = [Int]() insertOffsets.reserveCapacity(new.count) var runningInsertOffset = 0 for index in new.indices { insertOffsets.append(runningInsertOffset) let record = newResults[index] if let oldArrayIndex = record.correspondingOldIndex { if record.entry.isUpdated { updates.append((oldArrayIndex, index)) } let insertOffset = insertOffsets[index] let deleteOffset = deleteOffsets[oldArrayIndex] if (oldArrayIndex - deleteOffset + insertOffset) != index { moves.append((oldArrayIndex, index)) } } else { inserts.append(index) runningInsertOffset += 1 } } é¦–å…ˆæˆ‘ä»¬å‘ç°éå†çš„å¼€å¤´ï¼Œç”¨äº† record.correspondingOldIndex æ¥åšåˆ¤æ–­ï¼Œæ„å‘³ç€ â€œè¯¥å…ƒç´ æœ‰æ²¡æœ‰å¯¹åº”çš„è€å…ƒç´ â€ã€‚ ç„¶åä»ä¸‹å¾€ä¸Šçœ‹ else çš„é€»è¾‘ï¼Œå’Œåˆ é™¤çš„æ—¶å€™ä¸€æ ·ï¼Œè¿™æ¬¡å¾ªç¯é€šè¿‡ inserts è®°å½•äº† â€œè¯¥å…ƒç´ ä¹‹å‰ï¼Œæ’å…¥äº†å¤šå°‘ä¸ªå…ƒç´ â€ã€‚è¿™é‡Œæˆ‘å°±ä¸ç”¨å…·ä½“çš„ä¾‹å­ä¸¾ä¾‹äº†ï¼Œå¤§å®¶åº”è¯¥å¯ä»¥æ˜ç™½ã€‚ é‚£ä¹ˆå†å›åˆ° if é‡Œçš„é€»è¾‘ï¼Œé¦–å…ˆ isUpdated æ˜¯ä¹‹å‰å·²ç»åˆ¤æ–­è¿‡äº†çš„ã€‚ é‚£ä¹ˆ (oldArrayIndex - deleteOffset + insertOffset) != index è¯¥æ€ä¹ˆç†è§£å‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬æ˜ç¡®æ¯ä¸ªå‚æ•°çš„å«ä¹‰ï¼š index æ˜¯æŸä¸ªå…ƒç´ åœ¨ â€œæ–°é›†åˆâ€ ä¸­çš„ä½ç½®ã€‚ oldArrayIndex æ˜¯è¯¥å…ƒç´ åœ¨ â€œæ—§é›†åˆâ€ ä¸­çš„ä½ç½®ã€‚ deleteOffset æ„å‘³ç€è¯¥å…ƒç´ ä¹‹å‰åˆ é™¤äº†å‡ ä¸ªå…ƒç´ ã€‚ insertOffset æ„å‘³ç€è¯¥å…ƒç´ ä¹‹å‰æ·»åŠ äº†å‡ ä¸ªå…ƒç´ ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç†è§£äº†ï¼šå¯¹äºæ—§é›†åˆè€Œè¨€ï¼Œå¦‚æœå»æ‰è¢«åˆ é™¤çš„ï¼Œå†åŠ ä¸Šæ–°å¢çš„ï¼Œå¦‚æœç´¢å¼•ä½ç½®ä¸å˜ï¼Œé‚£ä¹ˆè¯¥å…ƒç´ çš„ä½ç½®æ²¡æœ‰å‘ç”Ÿç§»åŠ¨ã€‚ é€šè¿‡å…·ä½“çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹ï¼š [1, 2, 3, 4, 5, 6, 7] å’Œ [2, 3, 7, 5]ã€‚æˆ‘ä»¬éå†çš„æ˜¯åè€…ï¼Œå³æ–°é›†åˆã€‚deleteOffsets æ˜¯ [0, 1, 1, 1, 2, 2, 3]ã€‚ å‡è®¾æ­¤æ—¶æˆ‘ä»¬éå†åˆ°äº†æ–°é›†åˆä¸­çš„ 3ã€‚ é‚£ä¹ˆ index æ˜¯ 1ï¼ŒoldArrayIndex æ˜¯ 2ï¼ŒdeleteOffset æ˜¯ 1ï¼ŒinsertOffset æ˜¯ 0ã€‚è¡¨è¾¾å¼ä¸º 2 - 1 - 0 == 1ï¼Œä¸ç¬¦åˆæ¡ä»¶ï¼ˆæ³¨æ„ä»£ç ä¸­ç”¨çš„æ˜¯ != å·ï¼‰ï¼Œé‚£ä¹ˆåˆ™ä¸ä¼šæ·»åŠ åˆ° moves é‡Œï¼Œæ„å‘³ç€ 3 è¿™ä¸ªå…ƒç´ æ²¡æœ‰è¢«ç§»åŠ¨ã€‚ å†å‡è®¾æ­¤æ—¶æˆ‘ä»¬éå†åˆ°äº†æ–°é›†åˆä¸­çš„ 7ã€‚ é‚£ä¹ˆ index æ˜¯ 2ï¼ŒoldArrayIndex æ˜¯ 6ï¼ŒdeleteOffset æ˜¯ 3ï¼ŒinsertOffset æ˜¯ 0ã€‚è¡¨è¾¾å¼ä¸º 6 - 3 - 0 != 2ï¼Œç¬¦åˆæ¡ä»¶ï¼Œæ‰€ä»¥åˆ¤æ–­ 7 å‘ç”Ÿäº†ç§»åŠ¨ã€‚ æœ€åéå†åˆ° 5 çš„æ—¶å€™ï¼Œ index æ˜¯ 3ï¼ŒoldArrayIndex æ˜¯ 4ï¼ŒdeleteOffset æ˜¯ 2ï¼ŒinsertOffset æ˜¯ 0ã€‚è¡¨è¾¾å¼ä¸º 4 - 2 - 0 != 3ï¼Œç¬¦åˆæ¡ä»¶ï¼Œæ‰€ä»¥åˆ¤5 ä¹Ÿæ˜¯å‘ç”Ÿäº†ç§»åŠ¨ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç­›é€‰å‡ºå“ªäº›å…ƒç´ å‘ç”Ÿäº†ç§»åŠ¨ã€‚ æ€»ç»“ epoxy çš„ Diffing ç®—æ³•å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸€ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š å°†è¾“å…¥è½¬æ¢ä¸º ContiguousArray ç±»å‹ï¼Œæå‡æ•ˆç‡ã€‚ ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œå°†åŒä¸€ä¸ª id çš„å…ƒç´ ä»æ–°æ—§ä¸¤ä¸ªé›†åˆä¸­æ‘˜å‡ºæ¥ï¼ŒåšåŒ¹é…ï¼ŒåŒæ—¶è®°å½•åŸæœ¬çš„ä½ç½®ã€‚ åˆ©ç”¨è¿™ä¸ªå“ˆå¸Œè¡¨ï¼Œé…åˆ LCS ç®—æ³•ï¼Œæ‰¾å‡ºå“ªäº›å…ƒç´ è¢«åˆ é™¤ï¼Œå“ªäº›å…ƒç´ æ˜¯æ–°å¢çš„ã€‚ æ ¹æ®éœ€æ±‚ï¼Œè¿›ä¸€æ­¥å°†ç¬¬ä¸‰æ­¥çš„ç»“æœè¿›è¡Œå¤„ç†ã€‚ æœ€åè´´ä¸Šä¸€ä¸‹æˆ‘è‡ªå·±å¯¹æºä»£ç åšçš„æ³¨é‡Šï¼š /// å¯¹ä¸¤ä¸ª `Diffable` å…ƒç´ é›†åˆï¼ˆä¾‹å¦‚ `Array`ï¼‰è¿›è¡Œå·®å¼‚åŒ–å¤„ç†ï¼Œè¿”å›ä¸€ä¸ª `IndexChangeset`ï¼Œè¡¨ç¤ºä» `other` åˆ°æ­¤é›†åˆçš„æœ€å°æ›´æ”¹é›†åˆã€‚ /// /// - Parameters: /// - from other: æ—§æ•°æ®é›†åˆã€‚ public func makeChangeset(from other: Self) -&gt; IndexChangeset { // åœ¨è¿›è¡Œå·®å¼‚åŒ–å¤„ç†ä¹‹å‰å°†å…ƒç´ è¿ç»­æ’åˆ—å¯ä»¥æé«˜å¤§çº¦40%çš„æ€§èƒ½ã€‚ let new = ContiguousArray(self) let old = ContiguousArray(other) // é€šè¿‡ `dataID`ï¼Œå°† `self` å’Œ `other` çš„å¯¹åº”å…ƒç´ å­˜å‚¨åˆ° `entries` é‡Œã€‚ var entries = [AnyHashable: Entry](minimumCapacity: new.count) var duplicates = [Entry]() // ç”¨æ¥è®°å½•æ–°å…ƒç´ ï¼ˆ`self`ï¼‰å’Œæ—§ç´¢å¼•çš„ä¸€ä¸ªå¯¹åº”å…³ç³» var newResults = ContiguousArray&lt;NewRecord&gt;() newResults.reserveCapacity(new.count) // for index in new.indices { // `new` å…¶å®å°±æ˜¯ `self`ï¼Œä» `self` é‡Œæ‹¿æ ‡è¯†ç¬¦ let id = new[index].diffIdentifier let entry = entries[id, default: Entry()] // 1. è®°å½•è¿™ä¸ªæ–°å…ƒç´ çš„ä½ç½® // 2. åˆ¤æ–­å½“å‰æ•°ç»„çš„é‡å¤æ€§ï¼Œå› ä¸ºæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥å†…éƒ¨æ•°æ®æœ‰å¯èƒ½ä¼šæœ‰é‡å¤çš„æƒ…å†µã€‚ if entry.trackNewIndex(index) { duplicates.append(entry) } entries[id] = entry // `correspondingOldIndex` é»˜è®¤æ˜¯ `nil` newResults.append(NewRecord(entry: entry)) } // ç”¨æ¥è®°å½•æ—§å…ƒç´ ï¼ˆ`other`ï¼‰å’Œæ–°ç´¢å¼•çš„ä¸€ä¸ªå¯¹åº”å…³ç³» var oldResults = ContiguousArray&lt;OldRecord&gt;() oldResults.reserveCapacity(old.count) for index in old.indices { // ä» `other` é‡Œæ‹¿æ ‡è¯†ç¬¦ let id = old[index].diffIdentifier // ç”¨ `other` çš„ `id`ï¼Œå» `self` é‡Œæ‰¾å¯¹åº”çš„å€¼ let entry = entries[id] // å¦‚æœæ‰¾åˆ°çš„è¯ï¼Œå°±å°†æ—§çš„ç´¢å¼•å­˜å‚¨åˆ° `entry` é‡Œã€‚ // `entry` é‡Œæ—¢å­˜å‚¨äº†æ–°ï¼ˆ`self`ï¼‰çš„ç´¢å¼•ï¼Œåˆå­˜å‚¨äº†æ—§ï¼ˆ`other`ï¼‰çš„ç´¢å¼•ã€‚ // å› ä¸º `id` æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å°±é€šè¿‡ `id` æŠŠæ–°æ—§ä¸¤ä¸ªå…ƒç´ çš„ç´¢å¼•å¯¹åº”èµ·æ¥äº†ã€‚ entry?.pushOldIndex(index) // `correspondingNewIndex` é»˜è®¤æ˜¯ `nil` oldResults.append(OldRecord(entry: entry)) } for newIndex in new.indices { // `newResults` æ˜¯é€šè¿‡éå† new å¾—åˆ°çš„ // æ‰€ä»¥ `index` æ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨ `new` çš„ `index` æ‹¿åˆ° `newResults` çš„å…ƒç´  let entry = newResults[newIndex].entry // å¦‚æœå­˜åœ¨æ–°å…ƒç´ å¯¹åº”çš„è€å…ƒç´ çš„è¯ï¼Œå¯èƒ½å¯¹åº”æ›´æ–°æ“ä½œ if let oldIndex = entry.popOldIndex() { let newItem = new[newIndex] let oldItem = other[oldIndex] // å¦‚æœä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼Œåˆ™æ˜¯æ›´æ–°æ“ä½œ if !oldItem.isDiffableItemEqual(to: newItem) { entry.isUpdated = true } // è®°å½•ä¸¤ä¸ªå…ƒç´ ç›¸å¯¹çš„ä½ç½® // å¯èƒ½ä» `old` æ›´æ–°åˆ° `new`ï¼Œæ‰€ä»¥ç´¢å¼•æ˜¯æœ‰éœ€è¦çš„ newResults[newIndex].correspondingOldIndex = oldIndex oldResults[oldIndex].correspondingNewIndex = newIndex } } // åˆ é™¤æ“ä½œ var deletes = [Int]() var deleteOffsets = [Int]() deleteOffsets.reserveCapacity(old.count) var runningDeleteOffset = 0 for index in old.indices { deleteOffsets.append(runningDeleteOffset) let record = oldResults[index] // è¿™é‡Œç­‰äº `nil`ï¼Œæ„å‘³ç€åœ¨ä¸Šä¸€ä¸ªå¾ªç¯ä¸­ï¼Œæ²¡æœ‰åŒ¹é…åˆ°å¯¹åº”çš„ `new` å…ƒç´  // æ‰€ä»¥æ„å‘³ç€åœ¨ `new` æ•°ç»„ä¸­ï¼Œæ²¡æœ‰è¯¥å…ƒç´ å­˜åœ¨ï¼Œæ‰€ä»¥è¯¥å…ƒç´ è¢«åˆ é™¤äº† if record.correspondingNewIndex == nil { deletes.append(index) runningDeleteOffset += 1 } } var inserts = [Int]() var updates = [(Int, Int)]() var moves = [(Int, Int)]() var insertOffsets = [Int]() insertOffsets.reserveCapacity(new.count) var runningInsertOffset = 0 for index in new.indices { insertOffsets.append(runningInsertOffset) let record = newResults[index] // æœ‰æ–°ï¼Œæœ‰è€ if let oldArrayIndex = record.correspondingOldIndex { if record.entry.isUpdated { // æ›´æ–°ï¼Œè®°å½•å…ƒç´ çš„å¯¹åº”å…³ç³» updates.append((oldArrayIndex, index)) } // `insertOffsets` å’Œ `deleteOffsets` é‡Œçš„å€¼ï¼Œç±»ä¼¼äº `[0, 0, 1, 1, 1]` è¿™ç§å½¢å¼ // å…¶é•¿åº¦åˆ†åˆ«ç­‰äº `new` å’Œ `old`ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”çš„ `index` å–å€¼ä¸ä¼šå¯¼è‡´æº¢å‡º let insertOffset = insertOffsets[index] let deleteOffset = deleteOffsets[oldArrayIndex] // æ—§ä½ç½® - åˆ é™¤äº†çš„å…ƒç´ ä¸ªæ•° + æ–°å¢äº†çš„å…ƒç´ ä¸ªæ•° != æ–°ä½ç½® -&gt; ç§»åŠ¨äº† if (oldArrayIndex - deleteOffset + insertOffset) != index { moves.append((oldArrayIndex, index)) } } // æœ‰æ–°ï¼Œæ²¡è€ else { // æ„å‘³ç€æ–°çš„å…ƒç´ ç›¸å¯¹äºè€çš„å…ƒç´ æ¥è¯´æ˜¯æ’å…¥è¿›æ¥çš„ inserts.append(index) runningInsertOffset += 1 } } EpoxyLogger.shared.assert( old.count + inserts.count - deletes.count == new.count, &quot;Failed sanity check for old count with changes matching new count.&quot;) return IndexChangeset( inserts: inserts, deletes: deletes, updates: updates, moves: moves, newIndices: oldResults.map { $0.correspondingNewIndex }, duplicates: duplicates.map { $0.newIndices }) } åè®° æ–‡ç« ç®—æ˜¯å†™å®Œäº†ï¼Œä½†æ˜¯æ„Ÿæ…¨è‡ªå·±è™½ç„¶èŠ±äº†å¾ˆå¤šæ—¶é—´ï¼Œç®—æ˜¯ â€œå¼„æ˜ç™½â€ äº†æœ¬ç®—æ³•ï¼Œä½†æ˜¯ä¹Ÿä»…é™äºçœ‹æ‡‚ï¼Œç„¶åæ„Ÿæ…¨å®ƒçš„ç²¾å¦™ã€‚ç”šè‡³ä¸æ•¢è‚¯å®šä»¥åé‡åˆ°ç›¸ä¼¼çš„éœ€æ±‚æ—¶ï¼Œèƒ½ç”¨ä¸Šè¯¥ç®—æ³•ã€‚å“ï¼Œå¸Œæœ›ä»Šåè¿˜èƒ½æœ‰æ‰€é•¿è¿›ã€‚ ","link":"https://blog.rakuyoo.top/epoxy-source-code-notes-1/"},{"title":"åŠ é€Ÿ Swift Package Manager","content":"è™½ç„¶å›½å†…å®é™…å¼€å‘ç”¨ Swift Package Managerï¼ˆåç§° SPMï¼‰çš„æ¯”è¾ƒå°‘ï¼Œä½†æ˜¯å›½å¤–çš„ä¸€äº›å¼€æºåº“é‡Œå´ç»å¸¸ç”¨åˆ°ã€‚æ‰€ä»¥ç»å¸¸é‡åˆ°é¡¹ç›® clone ä¸‹æ¥ä¹‹åï¼ŒSPM åŠ è½½å¤±è´¥å¯¼è‡´é¡¹ç›®æ— æ³•è¿è¡Œçš„é—®é¢˜ã€‚ ç½‘ä¸Šå…³äº SPM åŠ é€Ÿçš„æ–‡ç« ä¹Ÿæœ‰å¾ˆå¤šï¼Œæ–¹æ³•ä¹Ÿæ˜¯äº”èŠ±å…«é—¨ï¼Œæœ¬æ–‡æŒ‘é€‰å‡ ä¸ªè¿›è¡Œè®°å½•ã€‚ æ ¹æœ¬é—®é¢˜ æ ¹æœ¬é—®é¢˜è¿˜æ˜¯ Xcode å†…éƒ¨æœåŠ¡æ— æ³•è¿æ¥ä»£ç†ï¼Œå¯¼è‡´è®¿é—® Github ç»å¸¸è¶…æ—¶ã€‚ æ‰€ä»¥è§£å†³æ–¹æ¡ˆè¿˜æ˜¯è¦ä»ä»£ç†å…¥æ‰‹ã€‚ è§£å†³æ–¹æ¡ˆ å…ˆåˆ—ä¸¾ä¸€ä¸‹æœ¬æ–‡è®°å½•çš„å‡ ç§è§£å†³æ–¹æ¡ˆï¼š è·¯ç”±å™¨ç«¯ç›´æ¥è®¾ç½®ä»£ç† é€šè¿‡å‘½ä»¤è¡Œç›´æ¥æ‹‰å– ClashX å¢å¼ºæ¨¡å¼ ä»£ç† Xcode è®¾ç½® SPM Mirror ä»¥ä¸Šæ–¹æ³•åœ¨æˆ‘çœ‹æ¥è°ˆä¸ä¸Šå“ªä¸ªæ›´å¥½ã€‚å¼€å‘åº”å½“åœ¨åˆé€‚çš„æ—¶å€™é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚ è·¯ç”±å™¨ç«¯ç›´æ¥è®¾ç½®ä»£ç† åœ¨è·¯ç”±å™¨ä¸Šç›´æ¥è®¾ç½®ä»£ç†ï¼Œä»ç½‘ç»œæºå¤´è§£å†³é—®é¢˜ã€‚ä½†æ˜¯å“ªæ€•æ˜¯åœ¨ä¸€äº›å…¬å¸ï¼Œä¹Ÿä¸å¤ªæ–¹ä¾¿æ·»åŠ è½¯è·¯ç”±ç­‰æ–¹æ³•åšè¿™äº›æ“ä½œã€‚æœ‰æ¡ä»¶çš„ä¸ªäººå¯ä»¥æä¸€ä¸‹ã€‚ é€šè¿‡å‘½ä»¤è¡Œç›´æ¥æ‹‰å– å‚è€ƒ å¦‚ä½•è®©swift package managerèµ°ä»£ç† å…·ä½“æ–¹æ³•ï¼š é¦–å…ˆæ˜¯æ‰“å¼€ç»ˆç«¯ï¼Œç„¶ååœ¨ç»ˆç«¯å†…æŒ‰ç…§ â€œä¸ºç»ˆç«¯è®¾ç½®ä»£ç†â€ çš„æ–¹æ³•ï¼Œè®¾ç½® https_proxy ã€ http_proxy å’Œ all_proxy åœ¨ é¡¹ç›®æ ¹ç›®å½•ä¸‹ æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š xcodebuild -resolvePackageDependencies -scmProvider system é€šè¿‡å‘½ä»¤è¡Œç›´æ¥æ‹‰å– SPM ä¾èµ–ï¼Œæ‰§è¡Œå®Œæˆåæ‰“å¼€é¡¹ç›®å³å¯ã€‚ æœ‰çš„æ–‡ç« å¯èƒ½æåˆ°å¯ä»¥ä¸º git config è®¾ç½®ä»£ç†ï¼Œå…¶å‘½ä»¤ä¸ºï¼š # éœ€è¦å°†ç«¯å£æ›¿æ¢æˆè‡ªå·±çš„ç«¯å£ git config --global http.proxy 'http://127.0.0.1:1080' git config --global https.proxy 'http://127.0.0.1:1080' è¿™é‡Œæˆ‘æ²¡æœ‰è¿›è¡Œå°è¯•ï¼Œæœ‰æƒ³æ³•çš„è¯»è€…å¯ä»¥è‡ªè¡Œå°è¯•ã€‚ ClashX å¢å¼ºæ¨¡å¼ ClashX Pro çš„å¢å¼ºæ¨¡å¼å¯ä»¥ç©¿é€ç»å¤§å¤šæ•°è½¯ä»¶ï¼ŒåŒ…æ‹¬ç»ˆç«¯ã€Xcodeã€‚å¼€å¯åç›´æ¥ä½¿ç”¨ Xcode å³å¯ä¸‹è½½ä¾èµ–ã€‚ è¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼šå¢å¼ºæ¨¡å¼ä¼šå¯¼è‡´ä¸€äº›å†…ç½‘æœåŠ¡ä¸å¯ç”¨ï¼Œæ‰€ä»¥å»ºè®®ä»…åœ¨éœ€è¦æ—¶ä¸´æ—¶æ‰“å¼€ï¼Œä¸å»ºè®®å¸¸é©»ä½¿ç”¨ã€‚æ‰€ä»¥ä½ éœ€è¦è®°å¾—åœ¨ Fetch æˆåŠŸåå…³é—­å¢å¼ºæ¨¡å¼ã€‚ å¦‚æœå¥½å¥‡ ClashX åšäº†ä»€ä¹ˆï¼Œå¯ä»¥å‚è€ƒï¼šè¯·é—®ä¸‹å¢å¼ºæ¨¡å¼æ˜¯åšäº†ä»€ä¹ˆå¤„ç† ä»£ç† Xcode å¦‚æœä½ æ²¡æœ‰æˆ–è€…ä¸æƒ³ä½¿ç”¨ ClashXï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ Proxifier è¿›è¡Œæ‹¦æˆªï¼Œç„¶åå†èµ°ä»£ç†ã€‚ï¼ˆä¸è¿‡è™½ç„¶ Proxifier æä¾›äº†å…è´¹è¯•ç”¨ï¼Œä½†ä»ç„¶ç®—æ˜¯æ”¶è´¹é‚£ä¸€æ¡£çš„ï¼‰ æœ‰æ¡ä»¶çš„ä¼™ä¼´å¯ä»¥æŸ¥çœ‹ Xcodeè®¾ç½®SPMä»£ç† è¿™ç¯‡æ–‡ç« ï¼Œé‡Œé¢æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ è®¾ç½® SPM Mirror ä»‹ç»å’Œä½¿ç”¨æ–¹æ³• æœ€è¿‘å¶ç„¶é—´å‘ç°ï¼ŒSPM åœ¨ Swift 5 æä¾›äº†ä¸€ä¸ª Mirror é•œåƒåŠŸèƒ½ï¼Œææ¡ˆåœ¨è¿™é‡Œï¼šPackage Manager Dependency Mirroring å³å¦‚ä¸‹å‘½ä»¤ï¼š swift package config set-mirror --original https://github.com/QMUI/LookinServer.git --mirror http://git.aaaaaa.top/LookinServer.git --original æ˜¯åŸåœ°å€ï¼Œè€Œ --mirror åˆ™æ˜¯é•œåƒä»“åº“çš„ urlã€‚ æ‰€ä»¥æœ‰æ¡ä»¶çš„é€šè¿‡å¯ä»¥åœ¨å†…ç½‘ Git ä¸Š Fork Github Repoï¼Œæˆ–è€…åœ¨å›½å†…æ‰¾å¯»ç°æœ‰é•œåƒï¼Œç„¶åé€šè¿‡ Mirror ä¸‹è½½ä¾èµ–ã€‚ ä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šææ¡ˆä¸­æœ‰å¦‚ä¸‹è¿™ä¹ˆä¸€å¥è¯ï¼š The Package.resolved file will contain the mirror URLs that were used during dependency resolution. ä½†æ˜¯åœ¨ Xcode 15 ä¸Šå®è·µåå‘ç° Package.resolved æ˜¾ç¤ºçš„è¿˜æ˜¯ Original URLï¼Œä¸æ˜¯ Mirror URLã€‚ æœç´¢åå‘ç°æœ‰è¿™ä¹ˆä¸€ä¸ª issueï¼šSwiftPM: mirrored URLs end up in Package.resolved fileã€‚ä¹Ÿå°±æ˜¯è¯´ Package.resolved æ–‡ä»¶ä¸­æ˜¾ç¤º Original URL åœ¨ç°åœ¨æ˜¯æ­£ç¡®è¡Œä¸ºã€‚è‡³äº Fetch æ—¶ä½¿ç”¨çš„å“ªä¸ª urlï¼Œå¯ä»¥åœ¨ Report navigator ä¸­æŸ¥çœ‹å…·ä½“çš„ logã€‚ Package.swift å¦‚æœä½ å¼€å‘çš„æ˜¯ä¸€ä¸ª Swift æ¡†æ¶ï¼Œè¦ç®¡ç† Package.swift ä¸­çš„ä¾èµ–ï¼ˆä½¿ç”¨è¯¥æ–‡ä»¶æ‰“å¼€é¡¹ç›®ï¼‰ï¼Œ é‚£ä¹ˆå¯ä»¥ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä¸Šè¿°å‘½ä»¤ã€‚ xcodeproj ä½†æ˜¯å¦‚æœä½ æ˜¯æƒ³ä¸º xcodeproj ä¸­æ·»åŠ çš„ä¾èµ–è®¾ç½® mirrorï¼Œé‚£ä¹ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ä½¿ç”¨ swift package config set-mirror å‘½ä»¤æ˜¯ä¼šæŠ¥é”™çš„ï¼šerror: Could not find Package.swift in this directory or any of its parent directories. é€šè¿‡æŠ¥é”™å¯çŸ¥è¯¥æ–¹æ³•ä»…é€‚ç”¨äº Package.swift ç®¡ç†çš„é¡¹ç›®ã€‚ä½†æ˜¯åˆ«ç€æ€¥ã€‚ åœ¨ Apple æ–‡æ¡£ Adding package dependencies to your app ä¸­æœ‰è¿™ä¹ˆä¸€å°æ®µæè¿°ï¼š You can find the Package.resolved file inside your .xcodeproj directory at [appName].xcodeproj/project.workspace/xcshareddata/swiftpm/Package.resolved. é€šè¿‡è¿™æ®µæè¿°æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œproject.workspace é‡Œé¢æœ‰ä¸€ä¸ª swiftpm ç›®å½•ï¼Œè¿›å…¥åä¼šå‘ç°è¯¥ç›®å½•ä¸‹å°±æœ‰ä¸€ä¸ª configuration æ–‡ä»¶å¤¹ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å°† set-mirror å‘½ä»¤ç”Ÿæˆçš„ mirrors.json æ–‡ä»¶æ”¾åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œå³å¯å®Œæˆé•œåƒè®¾ç½®ã€‚ æ³¨æ„ï¼šä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬çš„ .gitignore æ–‡ä»¶é…ç½®ä¼šå¯¼è‡´è¯¥è·¯å¾„ä¸ä¼šè¢«æäº¤åˆ° git ä¸Šã€‚è¿™ç‚¹è¯·æ‚¨æ³¨æ„ã€‚ æ­¤æ—¶å›åˆ° Xcode ä¸­æ·»åŠ ä¾èµ–ï¼Œå°±ä¼šå‘ç°é€Ÿåº¦ ... å¥½åƒæ²¡æœ‰å˜åŒ–ã€‚è¿™å°±ååˆ†å°´å°¬äº†... é€šè¿‡è¿›ä¸€æ­¥è§‚å¯Ÿã€æŸ¥çœ‹ log ä»¥åŠæœç´¢ç›¸å…³èµ„æ–™ã€‚æˆ‘è¿›ä¸€æ­¥ç¡®å®šï¼šmirror è¿™ä¸ªé…ç½®ä»…é€‚ç”¨äº Package.swift è½¯ä»¶åŒ…ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨ Xcode é‡Œé€šè¿‡ä¸€ä¸ª github çš„ url æ¥æ·»åŠ ä¾èµ–ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸ä¼šèµ° mirror é…ç½®çš„ã€‚ä½†æ˜¯è¯¥ä¾èµ–æ‰€ä¾èµ–çš„å…¶ä»–ç»„ä»¶ï¼Œåˆèƒ½èµ° mirror é…ç½®ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª Package.swift è½¯ä»¶åŒ…ã€‚ æ‰€ä»¥å›åˆ°è¿™å°èŠ‚è®¨è®ºçš„é—®é¢˜ä¸Šï¼šä½ åªèƒ½ä½¿ç”¨ä¸Šé¢æåˆ°çš„å…¶ä»–æ–¹æ³•ï¼Œæ¥è§£å†³åœ¨ Xcode é‡Œå‘ project æ·»åŠ ä¾èµ–çš„é—®é¢˜ã€‚ æˆ‘ä»¬è¦æ”¾å¼ƒå—ï¼Ÿå¹¶ä¸æ˜¯ï¼Œæˆ‘æƒ³åˆ°äº†ä¸€ä¸ªæŠ˜ä¸­/å–å·§çš„æ–¹æ³•æ¥è§£å†³è¯¥é—®é¢˜ã€‚è¯¦è§æˆ‘åœ¨ stackoverflow ä¸Šçš„å›ç­”ã€‚ æ€»ç»“ è®©æˆ‘ä»¬å›åˆ°å®é™…åœºæ™¯ä¸‹æ¥çœ‹çœ‹ä¸Šè¿°æåˆ°çš„å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼š ä½ çš„ CI/CD åªèƒ½è®¿é—®å†…éƒ¨ç½‘ç»œï¼š ä¸è®ºä½ æ˜¯åœ¨å¼€å‘åº”ç”¨ç¨‹åºï¼Œè¿˜æ˜¯ä½ æˆ–ä½ çš„å…¬å¸åœ¨å¼€å‘ SPM è½¯ä»¶åŒ…ã€‚åœ¨åªèƒ½è®¿é—®å†…éƒ¨ç½‘ç»œï¼Œå®Œå…¨æ— æ³•è®¿é—® Github çš„æƒ…å†µä¸‹ï¼Œä½ åªèƒ½é€šè¿‡ mirror çš„æ–¹å¼æ¥ä½¿ç”¨ SPMã€‚ ä½ çš„å…¬å¸æ²¡æœ‰é‚£ä¹ˆå¤šè¦æ±‚ï¼Œè€Œä¸”äººå‡å…·å¤‡æ­æ¢¯å­çš„èƒ½åŠ›/ä½ æ˜¯å…·æœ‰æ­æ¢¯å­èƒ½åŠ›çš„ä¸ªäººå¼€å‘è€…ï¼š é‚£ä¹ˆå…¶ä»–å‡ ç§æ–¹æ³•éƒ½å¯ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚ ","link":"https://blog.rakuyoo.top/accelerated-swift-package-manager/"},{"title":"åœ†è§’ & ç¦»å±æ¸²æŸ“å®è·µ","content":"ä¸‹æ–‡ä¸»è¦é’ˆå¯¹å„ç§åŠ åœ†è§’çš„æƒ…å†µè¿›è¡Œå®è·µï¼Œçœ‹çœ‹ä¼šä¸ä¼šå‡ºç°ç¦»å±æ¸²æŸ“çš„æƒ…å†µã€‚ æµ‹è¯•æ¡ä»¶ æµ‹è¯•å¹³å°ï¼šiPhone 12ï¼ŒiOS 16.3.1ï¼ŒXcode 14.2ã€‚ æµ‹è¯•æ–¹æ³•ï¼šè¿è¡Œé¡¹ç›®åï¼Œé€šè¿‡ Xcode è®¾ç½® â€œDebug -&gt; View Debugging -&gt; Rendering -&gt; Color Off-screen Renderedâ€ æ¥æ‰“å¼€ç¦»å±æ¸²æŸ“æ£€æµ‹ã€‚ ä¸»è¦æµ‹è¯•ç‚¹ï¼š æ˜¯å¦å¼€å¯ masksToBounds æ˜¯å¦è®¾ç½®å›¾ç‰‡ æ˜¯å¦è®¾ç½®èƒŒæ™¯è‰²â€ çˆ¶è§†å›¾æ˜¯å¦å…·æœ‰é€æ˜åº¦ ç»“è®º è¿™é‡Œå…ˆæŠŠç»“è®ºæ”¾åˆ°æœ€å‰é¢ï¼Œåé¢æ‚¨å¯ä»¥è·³è¿‡å®è·µè¿‡ç¨‹ï¼Œç›´æ¥åˆ‡åˆ°è§£å†³æ–¹æ¡ˆä¸€èŠ‚ã€‚ âœ… ä»£è¡¨ä¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼›âŒ ä»£è¡¨ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ã€‚ UIView UIImageView UIButtonï¼ˆåªæœ‰æ–‡å­—ï¼‰ UIButtonï¼ˆå›¾ç‰‡/èƒŒæ™¯å›¾ï¼‰ ç›´æ¥è®¾ç½® âœ… âœ… âœ… âŒ èƒŒæ™¯è‰²ï¼ˆéé€æ˜ï¼‰ âœ… âŒ âœ… âŒ çˆ¶è§†å›¾å…·æœ‰é€æ˜åº¦ï¼ˆalphaï¼‰ âŒ âŒ âŒ âŒ ä¸‹é¢é‡ç‚¹è¯´ä¸€ä¸‹ UIImageView å’Œ UIButton çš„æµ‹è¯•è¿‡ç¨‹ï¼š UIImageView iOS 9 å¯¹ UIImageView è¿›è¡Œäº†ä¸€ç³»åˆ—ä¼˜åŒ–ï¼Œç›¸æ¯”è¾ƒè¿‡å»è€Œè¨€ï¼Œè§¦å‘ç¦»å±æ¸²æŸ“çš„åœºæ™¯è¦å°äº†ä¸å°‘ ç›´æ¥è®¾ç½® lazy var testView = UIImageView().then { $0.image = UIImage(named: &quot;Forms/share-cover&quot;) $0.layer.masksToBounds = true $0.layer.cornerRadius = 30 } ä¸€ä¸ªè®¾ç½®äº†å›¾ç‰‡çš„ UIImageViewã€‚ç¤ºä¾‹ä¸­åŒæ—¶è®¾ç½®äº† masksToBounds å’Œ cornerRadiusã€‚ä»å›¾ç‰‡ä¸Šå¯ä»¥çœ‹å‡ºæ¥ï¼Œå¹¶ä¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼š UIImageView ä¸è®¾ç½® masksToBoundsï¼Œåªè®¾ç½® cornerRadius çš„è¯ä¸ä¼šæ˜¾ç¤ºåœ†è§’ã€‚ æ·»åŠ èƒŒæ™¯è‰² é‚£å¦‚æœæˆ‘ä»¬æ‰‹è´±å†ç»™å®ƒæ·»åŠ ä¸€ä¸ªèƒŒæ™¯è‰²å‘¢ï¼Ÿ lazy var testView = UIImageView().then { $0.image = UIImage(named: &quot;Forms/share-cover&quot;) $0.layer.masksToBounds = true $0.layer.cornerRadius = 30 $0.backgroundColor = .white // æ·»åŠ ä¸€ä¸ªç™½è‰²çš„èƒŒæ™¯è‰² } æœç„¶æ‰‹è´±æ˜¯æ²¡æœ‰å¥½å¤„çš„ï¼Œè®¾ç½®äº†èƒŒæ™¯è‰²ååˆ™ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ã€‚ UIButton UIButton é»˜è®¤ä¹Ÿæ˜¯æ²¡æœ‰èƒŒæ™¯è‰²çš„ï¼Œéœ€è¦åŒæ—¶è€ƒè™‘æ–‡å­—å’Œå›¾ç‰‡ä¸¤ç§æƒ…å†µã€‚ æ–‡å­— å¦‚æœä¸è®¾ç½®èƒŒæ™¯è‰²çš„è¯ï¼Œåªæœ‰æ–‡å­—çš„ UIButton å¯¹è±¡æ˜¯æ˜¾ç¤ºä¸å‡ºæ¥åœ†è§’çš„ï¼Œä¸è¿‡æˆ‘ä¹Ÿæ˜¯åˆ†åˆ«æµ‹äº†ä¸€ä¸‹ã€‚ lazy var testView = UIButton(type: .custom).then { $0.setTitle(&quot;è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜&quot;, for: .normal) $0.layer.cornerRadius = 30 } ç»“è®ºæ˜¯ï¼šä¸è®ºè®¾ç½®ä¸è®¾ç½®èƒŒæ™¯è‰²ï¼Œåªæœ‰æ–‡å­—çš„ UIButton å¯¹è±¡æ·»åŠ åœ†è§’åéƒ½ä¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ã€‚ åŒæ—¶åªéœ€è¦è®¾ç½® cornerRadiusï¼Œä¸éœ€è¦å¼€å¯ masksToBounds å°±å¯ä»¥æ˜¾ç¤ºå‡ºæ¥åœ†è§’ã€‚ å›¾ç‰‡ &amp; èƒŒæ™¯å›¾ å› ä¸ºç°è±¡ä¸€è‡´ï¼Œæ‰€ä»¥å›¾ç‰‡å’ŒèƒŒæ™¯å›¾åœ¨è¿™é‡Œå½’ä½ä¸€ç±»è¿›è¡Œè®¨è®ºã€‚ å¸¦å›¾ç‰‡çš„ UIButton æ˜¯é‡ç‚¹æµ‹è¯•å¯¹è±¡ï¼Œåˆ†ä¸‹é¢å‡ ç§æƒ…å†µï¼š ç›´æ¥è®¾ç½® lazy var testView = UIButton(type: .custom).then { $0.setTitle(&quot;è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜&quot;, for: .normal) $0.layer.masksToBounds = true $0.layer.cornerRadius = 30 $0.setImage(UIImage(named: &quot;Forms/share-cover&quot;), for: .normal) } å¦‚æœ UIButton åªè®¾ç½® cornerRadius è€Œä¸å¼€å¯ masksToBoundsï¼Œé‚£ä¹ˆå›¾ç‰‡æ˜¯ä¸ä¼šæ˜¾ç¤ºå‡ºåœ†è§’çš„ã€‚ ä»å›¾ä¸Šçœ‹ï¼Œæ˜¯ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ã€‚ å°è¯•è§£å†³ç¦»å±æ¸²æŸ“é—®é¢˜ å®è·µäº†å“ªäº›æƒ…å†µä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼Œæ¥ä¸‹æ¥å°±æƒ³åŠæ³•å°è¯•è§£å†³è¿™äº›é—®é¢˜ã€‚ ç”¨çˆ¶è§†å›¾è¿›è¡ŒåŒ…è£¹ æœ‰çš„æ–‡ç« ä¼šæåˆ°ç”¨ä¸€ä¸ªçˆ¶è§†å›¾åŒ…è£¹éœ€è¦æ·»åŠ åœ†è§’çš„è§†å›¾ï¼Œç„¶åå°†åœ†è§’æ·»åŠ åˆ°çˆ¶è§†å›¾ä¸Šã€‚ å®è·µå‘ç°è¯¥æ–¹æ³•å¹¶ä¸èƒ½è§£å†³ç¦»å±æ¸²æŸ“é—®é¢˜ã€‚ é¿å…å¼€å¯ masksToBounds UIImageView è§†å›¾å¯ä»¥åœ¨ä¸å¼€å¯ masksToBoundsï¼Œä»…è®¾ç½® cornerRadius çš„æƒ…å†µä¸‹æ˜¾ç¤ºåœ†è§’ï¼ŒåªåŒ…å«æ–‡å­—çš„ UIButton å¯¹è±¡ä¹Ÿä¸€æ ·ã€‚ æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸å¼€å¯ masksToBounds ä¹Ÿå¯ä»¥é¿å…è§¦å‘ç¦»å±æ¸²æŸ“ã€‚ ä¸ºå›¾ç‰‡æ·»åŠ åœ†è§’ ç›´æ¥ä¸ºå›¾ç‰‡æ·»åŠ åœ†è§’æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„é¿å…ç¦»å±æ¸²æŸ“çš„æ–¹æ³•ã€‚åªä¸è¿‡ç°åœ¨æ¯”è¾ƒå¸¸ç”¨çš„ UIImageView è§†å›¾å·²ç»ä¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“äº†ï¼Œä½†æ˜¯ UIButton ä¾ç„¶å¯ä»¥è¿™ä¹ˆåšã€‚ ä¸‹é¢æå‡ ç‚¹å®é™…éœ€æ±‚é‡Œå¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š â€œæ‹¼æ¥å›¾ç‰‡â€ ä¾‹å¦‚å¾®ä¿¡çš„ç¾¤èŠå¤´åƒï¼Œå¯èƒ½æ¶‰åŠåˆ°å¤šä¸ªå›¾ç‰‡åœ¨ä¸€ä¸ªè§†å›¾æ§ä»¶ä¸­è¿›è¡Œå±•ç¤ºã€‚ è¿™ä¸ªæ—¶å€™æœ€å¥½å°†å¤šå¼ å›¾ç‰‡æ‹¼åˆ°ä¸€èµ·ï¼Œç„¶åå¯¹è¿™å¼ å›¾ç‰‡æ•´ä½“è®¾ç½®åœ†è§’ã€‚è€Œä¸æ˜¯åœ¨ä¸€ä¸ª UIView ä¸­å°è¯•æ·»åŠ å¤šä¸ª UIImageVIewï¼Œå†å¯¹ UIView è®¾ç½®åœ†è§’ã€‚ è§†å›¾å°ºå¯¸ä¸å›ºå®š ä¸€èˆ¬ UIButton ä¼šé‡åˆ° â€œå°ºå¯¸ä¸å›ºå®š + éœ€è¦åœ†è§’ + èƒŒæ™¯è‰²â€ çš„æƒ…å†µã€‚ ä¾‹å¦‚é¡µé¢æŸä¸ªä½ç½®æœ‰ä¸€ä¸ª â€œè·ç¦»å±å¹•ä¸¤ä¾§ 10pxï¼Œå¯ç”¨çŠ¶æ€èƒŒæ™¯è‰²ä¸ºè“è‰²ï¼Œä¸å¯ç”¨çŠ¶æ€ä¸‹ä¸ºç°è“è‰²â€ çš„æŒ‰é’®ã€‚ æ­¤æ—¶å¯ä»¥è€ƒè™‘æ‰¾ UI åˆ‡ä¸€ä¸ªå¸¦åœ†è§’çš„çº¯è‰²å›¾ç‰‡ç›´æ¥ç”¨ä½œåº•è‰²ï¼Œä½†æ˜¯æˆ‘ä»¬å¼€å‘ä¹Ÿå¯ä»¥è‡ªå·±ç”Ÿæˆè¿™æ ·ä¸€å¼ å›¾ç‰‡ï¼Œç„¶åé€šè¿‡æ‹‰ä¼¸æ¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚ é¦–å…ˆæˆ‘ä»¬å…ˆæ‰¾å–µç¥å€Ÿç”¨ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æšä¸¾ï¼Œæ¥è¡¨ç¤ºåœ†è§’ï¼š extension UIImage { enum Radius { /// åœ†è§’åŠå¾„åº”è¯¥æŒ‰ç…§å›¾ç‰‡**å®½åº¦**çš„æ¯”ä¾‹è®¡ç®—ã€‚ /// é€šå¸¸å…³è”çš„å€¼åº”è¯¥åœ¨0å’Œ0.5ä¹‹é—´ï¼Œå…¶ä¸­0è¡¨ç¤ºæ²¡æœ‰åœ†è§’ï¼Œ0.5è¡¨ç¤ºä½¿ç”¨å›¾ç‰‡å®½åº¦çš„ä¸€åŠä½œä¸ºåœ†è§’åŠå¾„ã€‚ case widthFraction(CGFloat) /// åœ†è§’åŠå¾„åº”è¯¥æŒ‰ç…§å›¾ç‰‡**é«˜åº¦**çš„æ¯”ä¾‹è®¡ç®—ã€‚ /// é€šå¸¸å…³è”çš„å€¼åº”è¯¥åœ¨0å’Œ0.5ä¹‹é—´ï¼Œå…¶ä¸­0è¡¨ç¤ºæ²¡æœ‰åœ†è§’ï¼Œ0.5è¡¨ç¤ºä½¿ç”¨å›¾ç‰‡é«˜åº¦çš„ä¸€åŠä½œä¸ºåœ†è§’åŠå¾„ã€‚ case heightFraction(CGFloat) /// ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„ç‚¹å€¼ä½œä¸ºåœ†è§’åŠå¾„ã€‚ case point(CGFloat) func compute(with size: CGSize) -&gt; CGFloat { let cornerRadius: CGFloat switch self { case .point(let point): cornerRadius = point case .widthFraction(let widthFraction): cornerRadius = size.width * widthFraction case .heightFraction(let heightFraction): cornerRadius = size.height * heightFraction } return cornerRadius } } } ä¹‹åç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼š extension UIImage { static func color( _ color: UIColor, size: CGSize = .init(width: 1, height: 1), radius: Radius? = nil ) -&gt; UIImage { let cornerRadius = radius?.compute(with: size) let renderer = UIGraphicsImageRenderer(size: size) let image = renderer.image { _ in let rect = CGRect(origin: .zero, size: size) let path: UIBezierPath if let cornerRadius = cornerRadius { path = .init(roundedRect: rect, cornerRadius: cornerRadius) } else { path = .init(rect: rect) } color.setFill() path.fill() } guard let cornerRadius = cornerRadius else { return image } let insets = { UIEdgeInsets(top: $0, left: $0, bottom: $0, right: $0) }(cornerRadius) return image.resizableImage(withCapInsets: insets, resizingMode: .stretch) } } ä½ è¿˜å¯ä»¥æ‰©å±•è¿™ä¸ªæ–¹æ³•ï¼Œé…ç½®éœ€è¦åœ†è§’çš„ä½ç½®ï¼Œè€Œä¸æ˜¯ä¸ºå››ä¸ªè¾¹éƒ½æ·»åŠ åœ†è§’ï¼Œæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚ ","link":"https://blog.rakuyoo.top/off-screen-rendering-practice/"},{"title":"iOSè‡ªç¼–ç¬”è¯•é¢˜","content":"æœ€è¿‘è¦è´Ÿè´£é¢è¯•ï¼Œäºæ˜¯å„å¤„æœç½—äº†ä¸€äº›é¢è¯•é¢˜ï¼Œç”¨äºç¬”è¯•ï¼ˆä¸åŒ…å«ç®—æ³•ï¼‰ï¼Œä¹Ÿå½“ä½œè‡ªå·±çš„ä¸€ä¸ªå¤ä¹ ã€‚ é¢è¯•é¢˜éƒ¨åˆ†è¯·å‚è€ƒï¼šiOSè‡ªç¼–é¢è¯•é¢˜ è§„åˆ™ï¼š 40åˆ†é’Ÿä½œç­”æ—¶é—´ã€‚ ç¦æ­¢ä½¿ç”¨æ‰‹æœºæŸ¥é˜…ç­”æ¡ˆã€‚ç¦æ­¢ä½¿ç”¨ ChatGPT ç±»è½¯ä»¶æŸ¥é˜…ç­”æ¡ˆã€‚ ç±»åã€å˜é‡åä»¥åŠæ–¹æ³•åï¼Œä¸è®°å¾—å…¨æ‹¼çš„å…è®¸ä½¿ç”¨ç¼©å†™ã€‚ æ³¨ï¼š æœ¬é¢˜ç›®å¤šæ•°ç”± ChatGPT ç”Ÿæˆï¼Œå¯¹åº”ç­”æ¡ˆå·²è®°å½•åœ¨å†Œã€‚ Swift Swiftä¸­çš„letå’Œvaræœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä½•æ—¶åº”è¯¥ä½¿ç”¨letï¼Ÿ Swiftä¸­çš„å±æ€§ï¼ˆPropertyï¼‰æœ‰å“ªäº›ç±»å‹ï¼Ÿå®ƒä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ Swiftçš„å¸¸é‡ï¼ˆstaticï¼‰åœ¨ä»€ä¹ˆæ—¶å€™ç¡®å®šï¼Ÿ åœ¨Swiftä¸­ï¼Œswitch case ä¸€ä¸ª NSObject å­ç±»æ—¶ï¼Œæ¯”è¾ƒçš„æ˜¯ä»€ä¹ˆï¼Ÿ è¯·è§£é‡Š Swift ä¸­çš„èŒƒå‹æ“¦é™¤ï¼ˆGeneric Erasureï¼‰æ˜¯ä»€ä¹ˆï¼Œå¹¶æä¾›ä¸€ä¸ªèŒƒå‹æ“¦é™¤çš„ä¾‹å­ã€‚ iOS å¼€å‘ ä½ åœ¨å®é™…å·¥ä½œä¸­ä½¿ç”¨è¿‡UICollectionViewCompositionalLayoutå—ï¼Ÿå¦‚æœä½¿ç”¨è¿‡ï¼Œè¯·è¯¦ç»†æè¿°ä¸€ä¸‹å®ç°çš„åŠŸèƒ½ã€‚ è¯·åˆ—ä¸¾5-10ä¸ªä½ æœ€å¸¸ç”¨çš„ä¸‰æ–¹åº“ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªä½ æœ€å–œæ¬¢çš„è¿›è¡Œä»‹ç»ï¼Œé˜è¿°åŸå› ã€‚ æ¶æ„ç›¸å…³ï¼š ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿåœ¨iOSå¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹ï¼Ÿ ä»£ç æ ¼å¼è§„èŒƒ è¯·åˆ—å‡ºä½ è®¤ä¸ºçš„ Swift ä»£ç æ ¼å¼è§„èŒƒï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç¼©è¿›ã€ç©ºæ ¼ã€å‘½åç­‰æ–¹é¢ã€‚ åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ å¦‚ä½•ç¡®ä¿ä»£ç æ ¼å¼çš„ä¸€è‡´æ€§ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚ è¯·è®¾è®¡ä¸€ä¸ªå°æ¨¡å—ï¼Œå°½å¯èƒ½å…¨é¢åœ°å‘æˆ‘å±•ç¤ºä½ è‡ªå·±çš„ç¼–ç é£æ ¼ã€‚ ","link":"https://blog.rakuyoo.top/ios-self-paced-test-questions/"},{"title":"iOSè‡ªç¼–é¢è¯•é¢˜","content":"æœ€è¿‘è¦è´Ÿè´£é¢è¯•ï¼Œäºæ˜¯å„å¤„æœç½—äº†ä¸€äº›é¢è¯•é¢˜ï¼Œç”¨äºå½“é¢é¢è¯•ä½¿ç”¨ï¼ˆéç¬”è¯•é¢˜ï¼‰ï¼Œä¹Ÿå½“ä½œè‡ªå·±çš„ä¸€ä¸ªå¤ä¹ ã€‚åŒæ—¶æä¾›äº†ä¸€ä¸ªæˆ‘è‡ªå·±è§’åº¦çš„è¯„åˆ¤ï¼Œä»…ä¾›å‚è€ƒã€‚ ç¬”è¯•é¢˜éƒ¨åˆ†è¯·å‚è€ƒï¼šiOSè‡ªç¼–ç¬”è¯•é¢˜ ä»¥ä¸‹æ‰€ä»¥ç­”æ¡ˆï¼Œå¦‚æœé¢è¯•æ—¶æœªèƒ½å›ç­”ï¼Œä½œä¸ºè¡¥å……é—®é¢˜å›ç­”æ­£ç¡®åï¼Œç›¸åº”åˆ†å€¼ - 1ã€‚ å›ç­”äº†å…¶ä»–ç­”æ¡ˆï¼Œæ­£ç¡®ä¸”åˆç†çš„æƒ…å†µä¸‹ï¼Œé…Œæƒ…ç»™åˆ†ã€‚ Swift ç›¸å…³ ä¸»è¦è€ƒå¯ŸSwiftè¯­æ³•ç›¸å…³å†…å®¹ åŸºç¡€ ä»€ä¹ˆæ˜¯Swiftæ–¹æ³•é»˜è®¤å€¼ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨å®ƒï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 åœ¨å®šä¹‰å‡½æ•°æ—¶ç»™å‚æ•°èµ‹ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè°ƒç”¨è¯¥å‡½æ•°æ—¶å¯ä»¥ä¸ä¼ è¯¥å‚æ•°å€¼ 3 å‡å°‘å‡½æ•°é‡è½½çš„éœ€è¦ 1 é¿å…åœ¨è°ƒç”¨å‡½æ•°æ—¶å¤šæ¬¡è¾“å…¥ç›¸åŒçš„å€¼ ä»€ä¹ˆæ˜¯Optionalç±»å‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨Optionalç±»å‹ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 2 ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå€¼å¯èƒ½å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨çš„æƒ…å†µ 1 Optional ç±»å‹çš„ä½œç”¨æ˜¯ä¸ºé¿å…å› ä¸ºæ²¡æœ‰å¤„ç† nil è€Œå¯¼è‡´ç¨‹åºå´©æºƒçš„é—®é¢˜ 1 Optional ç±»å‹å¯ä»¥é€šè¿‡åœ¨ç±»å‹åååŠ ä¸€ä¸ª ? æ¥å®šä¹‰ 2 å¦‚æœä¸€ä¸ª Optional ç±»å‹çš„å˜é‡æœ‰å€¼ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¯é€‰ç»‘å®š ï¼ˆif letï¼‰å°†å…¶å–å‡º 3 åœ¨ä½¿ç”¨ Optional ç±»å‹æ—¶ï¼Œå°½é‡é¿å…ä½¿ç”¨å¼ºåˆ¶è§£åŒ… 3 Optional çš„å®é™…å®ç°æ˜¯ä¸€ä¸ªæšä¸¾ Swiftä¸­çš„structå’Œclassæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨structï¼Ÿ åŒºåˆ«ï¼š å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 class æ”¯æŒç»§æ‰¿ï¼Œè€Œ struct ä¸æ”¯æŒç»§æ‰¿ - 1 class æ”¯æŒç±»å‹è½¬æ¢ï¼Œè€Œ struct ä¸æ”¯æŒç±»å‹è½¬æ¢ è¿™é‡Œçš„ç±»å‹è½¬æ¢æŒ‡çš„æ˜¯å­ç±»å’Œçˆ¶ç±»ä¹‹é—´çš„éšå¼ç±»å‹è½¬æ¢ 1 class æ˜¯å¼•ç”¨ç±»å‹ï¼Œè€Œ struct æ˜¯å€¼ç±»å‹ - ä½¿ç”¨æƒ…å†µï¼š å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 å¦‚æœå¯¹è±¡çš„å¤æ‚åº¦è¾ƒé«˜ï¼Œå¹¶éœ€è¦æ”¯æŒç»§æ‰¿å’Œç±»å‹è½¬æ¢ï¼Œåº”è¯¥ä½¿ç”¨ class 1 å¦‚æœå¯¹è±¡æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”éœ€è¦é«˜æ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ struct ä»€ä¹ˆæ˜¯ Swift ä¸­çš„è®¿é—®æ§åˆ¶ï¼ˆAccess Controlï¼‰ï¼Ÿå®ƒæœ‰å“ªäº›çº§åˆ«ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1/3 Open: å¯ä»¥è¢«åŒä¸€æ¨¡å—å†…å’Œå¤–éƒ¨æ¨¡å—çš„ä»£ç è®¿é—®ï¼Œå…è®¸è¢«ç»§æ‰¿å’Œé‡å†™ æåˆ°å¤–éƒ¨æ¨¡å—è®¡3åˆ†ï¼Œå¦åˆ™1åˆ† 1/3 Public: å¯ä»¥è¢«åŒä¸€æ¨¡å—å†…å’Œå¤–éƒ¨æ¨¡å—çš„ä»£ç è®¿é—®ï¼Œä½†æ˜¯åœ¨å¤–éƒ¨æ¨¡å—ä¸èƒ½è¢«é‡å†™æˆ–ç»§æ‰¿ï¼Œå†…éƒ¨æ¨¡å—å¯ä»¥ æåˆ°å¤–éƒ¨æ¨¡å—è®¡3åˆ†ï¼Œå¦åˆ™1åˆ† 1/3 Internal: åªèƒ½è¢«åŒä¸€æ¨¡å—å†…çš„ä»£ç è®¿é—®ï¼Œä¸èƒ½è¢«å¤–éƒ¨æ¨¡å—è®¿é—®ï¼ˆé»˜è®¤è®¿é—®çº§åˆ«ï¼‰ æåˆ°æ˜¯é»˜è®¤æƒé™è®¡3åˆ†ï¼Œå¦åˆ™1åˆ† 1 fileprivate: åªèƒ½è¢«åŒä¸€æºæ–‡ä»¶å†…çš„ä»£ç è®¿é—® - 1 private: åªèƒ½åœ¨æ‰€å®šä¹‰çš„ä½œç”¨åŸŸå†…è®¿é—®ï¼ˆæ¯”å¦‚å‡½æ•°ã€æ–¹æ³•ã€ç±»ã€ç»“æ„ä½“ç­‰ï¼‰ï¼Œä¸èƒ½è¢«åŒä¸€æ–‡ä»¶ä¸­çš„å…¶ä»–ä½œç”¨åŸŸè®¿é—®ã€‚ - 2 Xcode ç”Ÿæˆçš„ struct çš„åˆå§‹åŒ–æ–¹æ³•æ˜¯ Internal å±æ€§ï¼Œæœ‰å¤–éƒ¨è®¿é—®éœ€æ±‚çš„è¯è¦æ‰‹åŠ¨å®ç° init æ–¹æ³• - ä»€ä¹ˆæ˜¯ Swiftå±æ€§è§‚å¯Ÿå™¨ï¼ˆProperty Observerï¼‰ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 çŸ¥é“å±æ€§è§‚å¯Ÿå™¨æ˜¯ willSet å’Œ didSet - 1 åªèƒ½åº”ç”¨äºå­˜å‚¨å±æ€§ï¼Œè€Œä¸èƒ½åº”ç”¨äºè®¡ç®—å±æ€§ - 2+1 å¦‚æœå±æ€§æ˜¯åœ¨åˆå§‹åŒ–æœŸé—´ï¼ˆinitå’Œå®šä¹‰æ—¶èµ‹å€¼ï¼‰è®¾ç½®çš„ï¼Œåˆ™ä¸ä¼šè°ƒç”¨ willSet å’Œ didSet è§‚å¯Ÿå™¨ å›ç­” initï¼Œ2åˆ†ï¼Œå›ç­”å®šä¹‰æ—¶ï¼Œ1åˆ†ï¼Œæ€»åˆ†3åˆ† Swiftä¸­ä¸€ä¸ªæ–¹æ³•å¦‚ä½•è¿”å›å¤šä¸ªå€¼ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 å¯ä»¥ä½¿ç”¨å…ƒç»„ï¼ˆTupleï¼‰æ¥å®ç°ä¸€ä¸ªæ–¹æ³•è¿”å›å¤šä¸ªå€¼çš„æ•ˆæœ 0 è‡ªå®šä¹‰ç±»å‹ã€æ•°ç»„ã€å­—å…¸ç­‰ ä»€ä¹ˆæ˜¯ Swift ä¸­çš„ Extensionï¼ˆæ‰©å±•ï¼‰ï¼Ÿå¦‚ä½•ä½¿ç”¨ Extensionï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 å…è®¸å¼€å‘è€…å‘å·²æœ‰çš„ç±»å‹æ·»åŠ æ–°çš„æ–¹æ³•ã€è®¡ç®—å±æ€§ç­‰ï¼Œè€Œæ— éœ€ç»§æ‰¿å­ç±»æˆ–ä½¿ç”¨ Objective-C runtime 1 ä¸èƒ½æ·»åŠ å­˜å‚¨å±æ€§æˆ–å±æ€§è§‚å¯Ÿå™¨ 1 æ‰©å±•ä¸­çš„æ–¹æ³•ä¸èƒ½å’Œå·²æœ‰æ–¹æ³•é‡å 2 ä½¿å¾—ä»£ç æ›´åŠ æ¨¡å—åŒ–ï¼Œæ˜“äºç»´æŠ¤ 2 ä¹Ÿå¯ä»¥å¯¹ç¬¬ä¸‰æ–¹ç±»è¿›è¡Œæ‰©å±•ï¼Œè€Œæ— éœ€æ”¹åŠ¨åŸä»£ç ï¼Œæ›´åŠ æ–¹ä¾¿åœ°æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ Swiftä¸­çš„åè®®ï¼ˆprotocolï¼‰æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ å¦‚æœå›ç­”ä¸­åŒ…å«äº†åè®®ä¸­çš„èŒƒå‹ç­‰å†…å®¹ï¼Œå‚è€ƒ ä»€ä¹ˆæ˜¯èŒƒå‹ ä¸€é¢˜ä¸­çš„åˆ†å€¼ã€‚ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 åè®®å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ã€å±æ€§ - 1 å¯ä»¥è¢«ç±»ã€ç»“æ„ä½“å’Œæšä¸¾ç±»å‹å®ç°ï¼Œç„¶åå®ç°æ–¹å°±å¯ä»¥ä½¿ç”¨åè®®ä¸­æä¾›çš„å†…å®¹ - 3 æé«˜ä»£ç çš„æ¨¡å—åŒ–ç¨‹åº¦ã€å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå‡å°‘ä»£ç çš„è€¦åˆæ€§ - 1/2 å¯ä»¥æ‰©å±•åè®®ï¼Œä¸ºåè®®æ·»åŠ é»˜è®¤å®ç° å¦‚æœé¢è¯•è€…æ²¡æœ‰æï¼Œå¯ä»¥è¿›è¡Œæé—®â€œSwift åè®®å¦‚ä½•åšé»˜è®¤å®ç°ï¼Ÿâ€ 5 ä¹ æƒ¯ä½¿ç”¨æ‰©å±•éµå¾ªåè®®ï¼Œè€Œä¸æ˜¯åœ¨å£°æ˜ç±»å‹æ—¶ - -5 ä¹ æƒ¯åœ¨å£°æ˜ç±»å‹æ—¶éµå¾ªåè®® - 1/3/10 æåˆ°äº†é¢å‘åè®®ç¼–ç¨‹ ä»…ä»…æåˆ°ï¼Œè®¡1åˆ†ï¼›æœ‰å¯¹åº”æè¿°ã€è§£é‡Šï¼Œè®¡3åˆ†ï¼›æè¿°è¯¦ç»†ï¼Œå¹¶é…åˆç¤ºä¾‹ï¼Œè®¡10åˆ† ä»€ä¹ˆæ˜¯æ³›å‹ï¼ˆGenericï¼‰ç±»å‹ï¼Ÿå®ƒä»¬åœ¨Swiftä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ç¬”è¯•é¢˜ä¸­åŒ…å«èŒƒå‹æ“¦å‡ºï¼Œæ‰€ä»¥æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿé¢è¯•è€…æœ‰æ²¡æœ‰ â€œç”¨èŒƒå‹æé«˜ä»£ç å¯è¯»æ€§ã€ç»´æŠ¤æ€§â€ çš„æ„è¯†ã€‚ åœ¨è¿™é‡Œä¸å¿…å›ç­”èŒƒå‹æ“¦å‡ºã€‚å›ç­”èŒƒå‹æ“¦å‡ºä¸é¢å¤–è®¡åˆ†ã€‚ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 å¯ä»¥ç”¨äºå®šä¹‰å‡½æ•°ã€ç±»ã€ç»“æ„ä½“ã€æšä¸¾ç­‰å¤šç§ç±»å‹çš„é€šç”¨ç±»å‹æœºåˆ¶ 2 æ³›å‹ç±»å‹å¯ä»¥ç”¨äºæ¶ˆé™¤ä»£ç é‡å¤ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ 1 å®šä¹‰åè®®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…³è”ç±»å‹æ¥å®ç°æ›´åŠ çµæ´»çš„æ•°æ®å¤„ç† ä»€ä¹ˆæ˜¯Swiftå­—é¢é‡åè®®ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 ExpressibleByNilLiteral 1 ExpressibleByIntegerLiteralï¼šå…è®¸ç±»å‹ä»æ•´æ•°å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByFloatLiteralï¼šå…è®¸ç±»å‹ä»æµ®ç‚¹æ•°å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByBooleanLiteralï¼šå…è®¸ç±»å‹ä»å¸ƒå°”å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByStringLiteralï¼šå…è®¸ç±»å‹ä»å­—ç¬¦ä¸²å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByArrayLiteralï¼šå…è®¸ç±»å‹ä»æ•°ç»„å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByDictionaryLiteralï¼šå…è®¸ç±»å‹ä»å­—å…¸å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ åªè¦æåˆ°æœ‰è¿™ä¹ˆå‡ ä¸ªåè®®ï¼ˆä¸ç”¨è¯´å‡ºå…·ä½“çš„åå­—ï¼‰ï¼Œå¯ä»¥é€šè¿‡æ•°å­—ã€å­—ç¬¦ä¸²ã€Boolã€æ•°ç»„ã€å­—å…¸å­—é¢é‡æ¥åˆå§‹åŒ–å¯¹åº”çš„ç±»å‹å³å¯ã€‚ ä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½ï¼ˆæ‡’åŠ è½½ï¼ŒLazy Loadingï¼‰ï¼Ÿåœ¨Swiftä¸­ä½ ä¸€èˆ¬ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 åœ¨Swiftä¸­ï¼Œå»¶è¿ŸåŠ è½½å¯ä»¥é€šè¿‡ä½¿ç”¨ lazy å…³é”®å­—æ¥å®ç° - 1 lazy å…³é”®å­—å¯ä»¥ç”¨äºå±æ€§ - 1 åœ¨ç¬¬ä¸€æ¬¡è®¿é—®è¯¥å˜é‡æˆ–å±æ€§æ—¶ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œç›¸åº”çš„ä»£ç è¿›è¡Œåˆå§‹åŒ– - 5 å‡ ä¹æ— è„‘ä½¿ç”¨æ‡’åŠ è½½æ¥å®šä¹‰ä»»ä½•çš„å±æ€§ - Swiftä¸­çš„é«˜é˜¶å‡½æ•°ï¼ˆHigher Order Functionï¼‰æœ‰å“ªäº›ï¼Ÿè¯·åˆ†åˆ«è¯´æ˜å®ƒä»¬çš„ä½œç”¨ã€‚ ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªå³å¯ï¼Œå…¶ä½™çš„ä¾‹å¦‚ containsã€allSatisfy ç­‰è¯´äº†ä¹Ÿè®¡1åˆ†ã€‚ å¦‚æœåªè¯´å‡ºäº†å‡½æ•°åï¼Œæ²¡æœ‰è¯´æ˜ä½œç”¨ï¼Œä¾ç„¶å¾—åˆ†ã€‚æˆ–è€…èƒ½è¯´å‡ºæ¥åŠŸèƒ½ï¼Œå…·ä½“å‡½æ•°åæ‹¼ä¸å…¨ä¹Ÿå¯ã€‚ å¦‚æœä¸‹é¢è¿™äº›æ²¡æœ‰è¯´å…¨ï¼Œé¢è¯•å®˜å¯æç¤º â€œè¿˜æœ‰æ²¡æœ‰äº†ï¼Ÿâ€ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 mapï¼šå°†ä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°æ˜ å°„ä¸ºå¦ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„é›†åˆ - 1 filterï¼šè¿‡æ»¤ä¸€ä¸ªé›†åˆä¸­ç¬¦åˆç‰¹å®šæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„é›†åˆ - 1 reduceï¼šé€šè¿‡å¯¹ä¸€ä¸ªé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œç´¯åŠ æˆ–ç´¯ç§¯æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæœ€ç»ˆçš„ç»“æœ - 1 flatMapï¼šå°†ä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°æ˜ å°„ä¸ºå¦ä¸€ä¸ªé›†åˆï¼Œç„¶åå°†æ‰€æœ‰é›†åˆä¸­çš„å…ƒç´ åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„é›†åˆ - 1 compactMapï¼šå¯¹ä¸€ä¸ªåºåˆ—è¿›è¡Œå˜æ¢æ“ä½œï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„åºåˆ—ï¼Œè¯¥åºåˆ—å°†æ‰€æœ‰çš„ nil å…ƒç´ å»é™¤ - 1 sortedï¼šå¯¹ä¸€ä¸ªé›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ’åºåçš„é›†åˆ - 1 forEachï¼šå¯¹ä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€æ®µç‰¹å®šçš„ä»£ç  - flatMap å’Œ compactMap è¿™ä¸¤ä¸ªä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 flatMap ç”¨äºé«˜ç»´æ•°ç»„çš„é™ç»´ï¼Œä¾‹å¦‚äºŒç»´æ•°ç»„æ‹å¹³ä¸ºä¸€ç»´æ•°ç»„ - 1 compactMap ç”¨äºè¿‡æ»¤æ•°ç»„ä¸­çš„å¯é€‰å€¼ï¼Œå»æ‰æ‰€æœ‰è¿”å› nil çš„å…ƒç´  - 3 Swift 4.2 ä¸­å°†è¿™ä¸¤ä¸ªå‡½æ•°æ‹†å¼€ï¼Œä¸å¯æ··ç”¨ æåˆ°ä¸å¯æ··ç”¨å³å¯ è¿›é˜¶ åœ¨Swiftä¸­å¦‚ä½•å®ç°ä¸€æ®µä»£ç åœ¨æ•´ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå†…åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 0 dispatch_once ä¸å¾—åˆ†ï¼ŒSwift 3 åŠä»¥ä¸Šç‰ˆæœ¬å·²åºŸå¼ƒ 0 å•ä¾‹ ä¸å¾—åˆ†ï¼Œé¢˜ç›®è¦æ±‚çš„æ˜¯ â€œä¸€æ®µä»£ç â€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ 3 (lazy var)/static + Void ç±»å‹çš„å±æ€§ï¼Œå®šä¹‰æ—¶ä½¿ç”¨ {}() åŒ…æ‹¬éœ€è¦æ‰§è¡Œçš„ä»£ç ã€‚å€ŸåŠ©äº†æ‡’åŠ è½½çš„ç‰¹æ€§ Swiftä¸­çš„ç±»å‹æ¨æ–­ï¼ˆType Inferenceï¼‰æ˜¯ä»€ä¹ˆï¼Ÿè¯·è¯´æ˜å®ƒçš„ä½œç”¨ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 2 ç¼–è¯‘å™¨èƒ½å¤Ÿæ¨æ–­å‡ºå˜é‡æˆ–å¸¸é‡çš„ç±»å‹è€Œä¸éœ€è¦æ˜¾å¼å£°æ˜å…¶ç±»å‹ - 2 ä½¿ä»£ç æ›´åŠ ç®€æ´ï¼Œå‡å°‘äº†ç±»å‹å£°æ˜çš„å†—ä½™ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†å› ç±»å‹å£°æ˜é”™è¯¯è€Œå¼•èµ·çš„ç¼–è¯‘é”™è¯¯çš„å¯èƒ½æ€§ - -10 ä¸å»ºè®®ä½¿ç”¨ å¦‚æœé¢è¯•è€…è¯´å»ºè®®æ˜¾å¼å£°æ˜ç±»å‹ï¼ˆé™¤éæ˜¯ä¸ºäº†è§£å†³Xcodeä»£ç æç¤ºçš„bugï¼‰ï¼Œå¦åˆ™æ‰£10åˆ† Swiftä¸­çš„finalå…³é”®å­—æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1+2+2 final å…³é”®å­—å¯ä»¥ä¿®é¥°ç±»ã€æ–¹æ³•å’Œå˜é‡ æåˆ°ç±»è®¡1åˆ†ï¼›æåˆ°æ–¹æ³•ã€å˜é‡æ¯ä¸ª2åˆ†ï¼Œæ€»åˆ†5åˆ† 1 final ä¿®é¥°åä¸å¯é›†æˆã€ä¸å¯é‡å†™ - 3 private çš„ç±»å‹ï¼Œå…¶å†…çš„å±æ€§å’Œæ–¹æ³•ä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨æ·»åŠ  final - Swiftä¸­çš„Stringç±»å‹å’ŒObjCä¸­çš„NSStringç±»å‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 åº•å±‚å®ç°ä¸åŒï¼ŒSwift çš„ String ç±»å‹æ˜¯ä¸€ä¸ªå€¼ç±»å‹ï¼Œè€ŒObjCçš„ NSString ç±»å‹æ˜¯ä¸€ä¸ªç±» 1 Swiftçš„ String ç±»å‹å¯ä»¥æ— ç¼åœ°ä¸ObjCä¸­çš„ NSString ç±»å‹äº’ç›¸è½¬æ¢ 2 Swiftä¸­çš„å­—ç¬¦ä¸²æ˜¯Unicodeå…¼å®¹çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Unicodeå­—ç¬¦å’Œè¡¨æƒ…ç¬¦å·ï¼Œè€ŒObjCä¸­çš„å­—ç¬¦ä¸²æ˜¯åŸºäºASCIIç¼–ç çš„ï¼Œæ— æ³•ç›´æ¥å¤„ç†Unicodeå­—ç¬¦å’Œè¡¨æƒ…ç¬¦å· Swiftä¸­çš„æšä¸¾ç›¸æ¯”è¾ƒObjCä¸­çš„æšä¸¾æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 2 æ¯ä¸ªæšä¸¾æˆå‘˜å¯ä»¥æœ‰è‡ªå·±çš„å…³è”å€¼ï¼Œè¿™ä½¿å¾—æšä¸¾æ›´åŠ çµæ´»ã€‚è€ŒObjCä¸­çš„æšä¸¾åªèƒ½åŒ…å«æ•´æ•° 3 æšä¸¾æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œå®ƒå’Œç±»ã€ç»“æ„ä½“ç­‰ç±»å‹ä¸€æ ·ï¼Œå¯ä»¥æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œç”šè‡³éµå¾ªåè®®ã€‚ Swiftä¸­çš„å»¶è¿Ÿï¼ˆDeferï¼‰è¯­å¥æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 0/2/3 Deferè¯­å¥å¯ä»¥ç”¨æ¥åœ¨å‡½æ•°/ä½œç”¨åŸŸæ‰§è¡Œå®Œæ¯•ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œ å›ç­” â€œå‡½æ•°â€ 0åˆ†ï¼Œâ€œä½œç”¨åŸŸâ€ 2åˆ†ï¼Œèƒ½ç»™å‡ºä½œç”¨åŸŸçš„ä¾‹å­ï¼Œä¾‹å¦‚ if ä¸­ä½¿ç”¨çš„æƒ…å†µï¼Œ3åˆ†ã€‚å¦‚æœé¢è¯•è€…æ²¡æåˆ°ä½œç”¨åŸŸé—®é¢˜ï¼Œåˆ™å¯ä»¥å½“ä½œè¿›é˜¶é—®é¢˜æŠ›å‡º 1 Deferè¯­å¥å¯ä»¥ç”¨æ¥æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œ - 1 æ— è®ºå‡½æ•°æ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œ - 1 è™½ç„¶å½¢å¼ä¸Šåƒæ˜¯é—­åŒ…ï¼Œä½†æ›´åƒæ˜¯è¯­æ³•ç³–ï¼Œæ‰€ä»¥ä¸ä¼šæ•è·å˜é‡ - 2 å½“å‡½æ•°å†…æœ‰å¤šä¸ª defer è¯­å¥æ—¶ï¼Œå°†æŒ‰ç…§å€’åºçš„é¡ºåºæ‰§è¡Œï¼Œå³æœ€åä¸€ä¸ª defer å…ˆæ‰§è¡Œ å¦‚æœé¢è¯•è€…æ²¡å›ç­”ï¼Œåˆ™å¯ä»¥å½“ä½œè¿›é˜¶é—®é¢˜æŠ›å‡º ä»€ä¹ˆæ˜¯Swiftæ–¹æ³•æ´¾å‘ï¼Ÿæœ‰å“ªå‡ ç§ï¼Ÿ æ–¹æ³•è°ƒåº¦å’Œæ–¹æ³•æ´¾å‘æ˜¯ä¸€å›äº‹ï¼Œä¸åŒçš„ç¿»è¯‘ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 å®è§‚ä¸Šåˆ†ä¸ºé™æ€ï¼ˆç›´æ¥ï¼‰æ´¾å‘å’ŒåŠ¨æ€æ´¾å‘ä¸¤ç§ - 3 å…¶ä¸­åŠ¨æ€æ´¾å‘åˆåŒ…å«ä¸¤ç§ï¼šè¡¨æ´¾å‘/å‡½æ•°è¡¨æ´¾å‘å’Œæ¶ˆæ¯æ´¾å‘ - 5/6 é™æ€æ´¾å‘ï¼šç¼–è¯‘æ—¶æ‰¾åˆ°æŒ‡ä»¤æ‰€åœ¨çš„ä½ç½®ã€‚æ‰€ä»¥æ‰§è¡Œé€Ÿåº¦å¿«ï¼Œè¿˜å…è®¸ç¼–è¯‘æœŸåšå„ç§ä¼˜åŒ–ï¼Œä¾‹å¦‚å†…è” æåˆ°å†…è”ï¼Œé¢å¤–åŠ 1åˆ†ï¼Œå…±6åˆ† 5/6 è¡¨æ´¾å‘ï¼šè¿è¡Œæ—¶å†³å®šå®ç°æ–¹å¼ï¼Œç†è®ºä¸Šé€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œç¼–è¯‘æœŸå†³å®šå‡½æ•°è¡¨ æåˆ°ç¼–è¯‘æœŸå†³å®šå¯’æš‘è¡¨ï¼Œé¢å¤–åŠ 1åˆ†ï¼Œå…±6åˆ† 5 æ¶ˆæ¯æ´¾å‘ï¼šObjective-C çš„é€»è¾‘ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹æ¶ˆæ¯æ¥æ”¶å¯¹è±¡ - 5 ä¼šé€šè¿‡çœ‹ SIL ç¡®å®šæ´¾å‘æ–¹å¼ - è¯·è¯´æ˜Swiftä¸­Arrayç±»å‹çš„åº•å±‚å®ç°æ–¹å¼ æ€»åˆ†å€¼10åˆ† Array ä½¿ç”¨äº†ä¸€ä¸ªåä¸ºâ€œç¼“å†²åŒºâ€ï¼ˆbufferï¼‰çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨å…ƒç´ ã€‚ ç¼“å†²åŒºç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š æŒ‡å‘å…ƒç´ å­˜å‚¨ä½ç½®çš„æŒ‡é’ˆ ç¼“å†²åŒºçš„å®¹é‡å¤§å° ç¼“å†²åŒºçš„å…ƒç´ ä¸ªæ•° Swiftçš„switchè¯­æ³•å’ŒObjCçš„switchè¯­æ³•ï¼Œåœ¨åº•å±‚å®ç°æ–¹å¼ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æ€»åˆ†å€¼10åˆ† ObjC çš„ switch è¿˜æ˜¯æŸç§æ„ä¹‰ä¸Šçš„ goto è¯­æ³•ï¼Œå‘½ä¸­çš„æ—¶å€™ä¼šè·³åˆ°å¯¹åº”çš„ä»£ç çš„åœ°å€ï¼Œè¿™æ®µä»£ç æ˜¯è¿ç»­çš„ï¼Œéœ€è¦ break æ¥å†³å®šæ‰§è¡Œåˆ°å“ªé‡Œã€‚è¿™ç§å®ç°æ–¹å¼ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿ä»æ—©æœŸ C è¯­è¨€ä¸­ç»§æ‰¿è€Œæ¥ã€‚ è€Œ swift çš„ switch ä¼šè¢«ç¼–è¯‘æˆç±»ä¼¼ if else çš„è¯­æ³•ï¼Œä½œç”¨åŸŸæ›´æ˜ç¡®ã€‚ SILæ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå°†Swiftä»£ç è½¬æ¢ä¸ºSILä»£ç ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 SILæ˜¯Swiftä¸­é—´è¯­è¨€ï¼Œæ˜¯æºä»£ç å’Œæœºå™¨ä»£ç ä¹‹é—´çš„ä¸€ç§ä¸­é—´ä»£ç  - 1/2 ç¼–è¯‘å™¨ä¼šå°†Swiftä»£ç ç¼–è¯‘æˆSILï¼Œç„¶åå¯¹SILè¿›è¡Œä¼˜åŒ–å’Œè½¬æ¢ï¼Œæœ€åå°†å…¶ç¼–è¯‘æˆæœºå™¨ä»£ç  æåˆ°ç¼–è¯‘å™¨å¯¹ SIL è¿›è¡Œä¼˜åŒ–ï¼Œè®¡2åˆ†ï¼Œå¦åˆ™è®¡1åˆ† 3 ä½¿ç”¨ swiftc -emit-sil + &lt;file_name.swift&gt; å°† swift æ–‡ä»¶è½¬æ¢ä¸º SIL ä»£ç  - è¯·ç®€è¿° Swift extension çš„å®ç°åŸç† æ€»åˆ†10åˆ† åœ¨ Swift å†…éƒ¨ï¼Œæ¯ä¸ªç±»æˆ–ç»“æ„ä½“éƒ½æœ‰ä¸€ä¸ªåä¸º vtableï¼ˆè™šå‡½æ•°è¡¨ï¼‰çš„è¡¨æ ¼ï¼Œå…¶ä¸­è®°å½•äº†ç±»æˆ–ç»“æ„ä½“çš„æ–¹æ³•çš„åœ°å€ã€‚å½“ Swift è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒä¼šå…ˆæ£€æŸ¥ç±»æˆ–ç»“æ„ä½“çš„ç±»å‹ï¼Œç„¶åæŸ¥æ‰¾è¯¥ç±»å‹çš„ vtable è¡¨æ ¼ï¼Œä»¥è·å–è¯¥æ–¹æ³•çš„åœ°å€å¹¶è°ƒç”¨å®ƒã€‚ å½“æˆ‘ä»¬åœ¨ Extension ä¸­å®šä¹‰ä¸€ä¸ªæ–°æ–¹æ³•æ—¶ï¼ŒSwift ç¼–è¯‘å™¨ä¼šå°†å…¶æ·»åŠ åˆ° vtable è¡¨æ ¼ä¸­ï¼Œå¹¶æ ¹æ®éœ€è¦é‡æ–°ç”Ÿæˆ vtable è¡¨æ ¼ï¼Œä»¥ç¡®ä¿æ‰€æœ‰æ–¹æ³•éƒ½åœ¨æ­£ç¡®çš„ä½ç½®ã€‚è¿™å°±æ˜¯ Swift Extension å®ç°çš„åº•å±‚åŸç†ã€‚ iOS å¼€å‘ç›¸å…³ ä¸»è¦è€ƒå¯Ÿ iOS å¼€å‘ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œå’Œå…·ä½“å¼€å‘è¯­è¨€æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ã€‚ åŸºç¡€ è¯·ç®€è¿°iOSå¼€å‘ä¸­ï¼ŒAPNSçš„æ¨é€æœºåˆ¶ æ€»åˆ†5åˆ† APNSçš„æ¨é€æœºåˆ¶åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š åº”ç”¨ç¨‹åºåœ¨è®¾å¤‡ä¸Šæ³¨å†Œè¿œç¨‹é€šçŸ¥ã€‚æ³¨å†ŒæˆåŠŸåï¼Œè®¾å¤‡ä¼šäº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„ä»¤ç‰Œï¼ˆdevice tokenï¼‰ï¼Œç”¨äºæ ‡è¯†è¯¥è®¾å¤‡ã€‚ åº”ç”¨ç¨‹åºå°†ä»¤ç‰Œå‘é€ç»™åå°æœåŠ¡å™¨ï¼Œåå°æœåŠ¡å™¨å°†ä»¤ç‰Œä¸è®¾å¤‡ç»‘å®šèµ·æ¥ã€‚ å½“éœ€è¦å‘è®¾å¤‡å‘é€é€šçŸ¥æ—¶ï¼Œåå°æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¨é€é€šçŸ¥è¯·æ±‚åˆ°APNSæœåŠ¡å™¨ã€‚ APNSæœåŠ¡å™¨å°†æ¨é€é€šçŸ¥å‘é€åˆ°æŒ‡å®šçš„è®¾å¤‡ä¸Šã€‚ è®¾å¤‡æ¥æ”¶åˆ°æ¨é€é€šçŸ¥åï¼Œæ ¹æ®æ¨é€é€šçŸ¥çš„å†…å®¹æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œä¾‹å¦‚æ‰“å¼€åº”ç”¨ç¨‹åºã€æ˜¾ç¤ºæé†’ç­‰ã€‚ å¸¸è§çš„è§¦å‘ç¦»å±æ¸²æŸ“çš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ æ€»åˆ†10åˆ† è¿›é˜¶ ç¦»å±æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¼šè§¦å‘ç¦»å±æ¸²æŸ“ æ€»åˆ†15åˆ† ä»€ä¹ˆæ˜¯RunLoopï¼ŸRunLoopçš„è¿è¡Œæ¨¡å¼æœ‰å“ªå‡ ç§ï¼Ÿ æ€»åˆ†10åˆ† RunLoopæ˜¯iOSä¸­çš„ä¸€ä¸ªäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼Œå¦‚è§¦æ‘¸äº‹ä»¶ã€å®šæ—¶å™¨äº‹ä»¶ã€ç½‘ç»œè¯·æ±‚äº‹ä»¶ç­‰ï¼ŒåŒæ—¶è¿˜è¦å¤„ç†UIæ›´æ–°ã€çº¿ç¨‹é€šä¿¡ç­‰ä»»åŠ¡ã€‚ RunLoopä¼šå°†äº‹ä»¶æºåˆ†å‘åˆ°ç›¸åº”çš„å¤„ç†å™¨è¿›è¡Œå¤„ç†ï¼Œå¦‚æœRunLoopæ²¡æœ‰äº‹ä»¶éœ€è¦å¤„ç†ï¼Œé‚£ä¹ˆå®ƒä¼šè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°çš„äº‹ä»¶åˆ°æ¥ã€‚ å¸¸è§çš„RunLoopè¿è¡Œæ¨¡å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š DefaultRunLoopModeï¼šé»˜è®¤æ¨¡å¼ï¼Œå¤„ç†UIäº‹ä»¶ã€å®šæ—¶å™¨ã€ç½‘ç»œäº‹ä»¶ç­‰ã€‚ UITrackingRunLoopModeï¼šå¤„ç†UIScrollViewæ»‘åŠ¨è¿‡ç¨‹ä¸­çš„äº‹ä»¶ï¼Œä¼˜å…ˆçº§é«˜äºDefaultRunLoopModeã€‚ CommonModesï¼šæ˜¯ä¸€ä¸ªé›†åˆæ¨¡å¼ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªæ¨¡å¼ï¼ŒåŒ…æ‹¬DefaultRunLoopModeå’ŒUITrackingRunLoopModeç­‰ï¼Œç”¨äºå¤„ç†éœ€è¦åŒæ—¶å“åº”å¤šä¸ªæ¨¡å¼ä¸‹çš„äº‹ä»¶ã€‚ åœ¨è¿è¡ŒRunLoopæ—¶ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªè¿è¡Œæ¨¡å¼ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä¼šä½¿ç”¨DefaultRunLoopModeã€‚ iOSå¼€å‘ä¸­çš„å“åº”é“¾æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ æ€»åˆ†15åˆ† åœ¨iOSåº”ç”¨ä¸­ï¼Œå°†ç”¨æˆ·çš„è§¦æ‘¸äº‹ä»¶ï¼ˆtouch eventï¼‰ä¼ é€’åˆ°æ­£ç¡®çš„è§†å›¾ï¼ˆviewï¼‰æˆ–è€…æ§åˆ¶å™¨ï¼ˆcontrollerï¼‰çš„è¿‡ç¨‹å°±æ˜¯å“åº”é“¾ã€‚ å½“ç”¨æˆ·åœ¨å±å¹•ä¸Šè¿›è¡Œè§¦æ‘¸æ—¶ï¼Œè§¦æ‘¸äº‹ä»¶ä¼šè¢«UIWindowæ•è·ï¼Œå¹¶ä»UIWindowå¼€å§‹å‘ä¸‹ä¼ é€’ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„å“åº”è€…å¤„ç†äº‹ä»¶ä¸ºæ­¢ã€‚ å½“ç”¨æˆ·è§¦æ‘¸åˆ°ç•Œé¢ä¸Šçš„æŒ‰é’®æ—¶ï¼ŒiOSç³»ç»Ÿä¼šå°†æ­¤äº‹ä»¶å°è£…æˆä¸€ä¸ª UIEvent å¯¹è±¡ï¼Œå¹¶é€šè¿‡ UIApplication å¯¹è±¡å°†è¯¥äº‹ä»¶å‘é€ç»™å½“å‰ UIWindow å¯¹è±¡ã€‚æ¥ç€ï¼Œè¯¥ UIWindow å¯¹è±¡ä¼šå°†è¯¥äº‹ä»¶å‘é€ç»™æœ€å‰ç«¯çš„ UIResponder å¯¹è±¡ï¼Œå³å½“å‰å±•ç¤ºåœ¨å±å¹•ä¸Šçš„ UIViewController çš„ view å±æ€§å¯¹åº”çš„ UIView å¯¹è±¡ã€‚è¿™ä¸€è¿‡ç¨‹å³ä¸ºå“åº”é“¾çš„å¼€å§‹ã€‚ æ¥ç€ï¼Œè¯¥ UIView å¯¹è±¡ä¼šé€šè¿‡ hitTest:withEvent: æ–¹æ³•åˆ¤æ–­å½“å‰è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨è¯¥ UIView å¯¹è±¡å†…ã€‚å¦‚æœåœ¨ï¼Œåˆ™è¯¥ UIView å¯¹è±¡ä¼šå°†è¯¥äº‹ä»¶ä¼ é€’ç»™è‡ªå·±çš„ touchesBegan:withEvent: æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚å¦‚æœä¸åœ¨ï¼Œåˆ™è¯¥ UIView å¯¹è±¡ä¼šå°†è¯¥äº‹ä»¶ä¼ é€’ç»™å…¶å­è§†å›¾è¿›è¡Œå¤„ç†ã€‚è¿™ä¸€è¿‡ç¨‹å°±æ˜¯å“åº”é“¾çš„ä¼ é€’è¿‡ç¨‹ã€‚ å½“å­è§†å›¾æ¥æ”¶åˆ°äº‹ä»¶åï¼Œä¼šæŒ‰ç…§ç›¸åŒçš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚å¦‚æœè¯¥å­è§†å›¾çš„ userInteractionEnabled å±æ€§ä¸º NOï¼Œåˆ™è¯¥è§†å›¾å°†ä¸ä¼šå“åº”è¯¥äº‹ä»¶ï¼Œå¹¶å°†è¯¥äº‹ä»¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå“åº”è€…ã€‚å¦‚æœå­è§†å›¾çš„ userInteractionEnabled å±æ€§ä¸º YESï¼Œåˆ™è¯¥è§†å›¾ä¼šå…ˆè¿›è¡Œ hitTest:withEvent: æ–¹æ³•çš„åˆ¤æ–­ï¼Œå¦‚æœè§¦æ‘¸ç‚¹åœ¨è¯¥è§†å›¾å†…ï¼Œåˆ™è¯¥è§†å›¾å°†è¯¥äº‹ä»¶ä¼ é€’ç»™è‡ªå·±çš„ touchesBegan:withEvent: æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™å°†è¯¥äº‹ä»¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå“åº”è€…ã€‚ æœ€ç»ˆï¼Œå¦‚æœæ‰€æœ‰çš„å­è§†å›¾éƒ½æ²¡æœ‰å¤„ç†è¯¥äº‹ä»¶ï¼Œåˆ™è¯¥äº‹ä»¶ä¼šä¼ é€’ç»™è¯¥ UIView å¯¹è±¡çš„çˆ¶è§†å›¾è¿›è¡Œå¤„ç†ï¼Œä¸€ç›´ä¼ é€’åˆ° UIWindow å¯¹è±¡å’Œ UIApplication å¯¹è±¡ã€‚å¦‚æœè¯¥äº‹ä»¶éƒ½æ²¡æœ‰è¢«å¤„ç†ï¼Œåˆ™è¯¥äº‹ä»¶å°†è¢«ä¸¢å¼ƒã€‚ æ¶æ„ç›¸å…³ ä¸»è¦è€ƒå¯Ÿæ¶æ„ã€è®¾è®¡èƒ½åŠ› åŸºç¡€ ä»€ä¹ˆæ˜¯MVCæ¶æ„ï¼Ÿå®ƒçš„ç»„æˆéƒ¨åˆ†æ˜¯ä»€ä¹ˆï¼Ÿåœ¨iOSå¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°MVCæ¶æ„ï¼Ÿ æ€»åˆ†10åˆ† ä»€ä¹ˆæ˜¯MVVMæ¶æ„ï¼Ÿå®ƒçš„ç»„æˆéƒ¨åˆ†æ˜¯ä»€ä¹ˆï¼Ÿåœ¨iOSå¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°MVVMæ¶æ„ï¼Ÿ æ€»åˆ†15åˆ† ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ¨¡å¼ï¼Ÿåœ¨Swiftä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 è£…é¥°å™¨æ¨¡å¼å…è®¸å¼€å‘è€…åœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ·»åŠ è¡Œä¸ºã€‚ 3 åœ¨ Swift ä¸­ï¼Œè£…é¥°å™¨æ¨¡å¼å¯ä»¥é€šè¿‡ä½¿ç”¨åè®®å’Œæ‰©å±•æ¥å®ç°ã€‚ 5 å…·ä½“æ¥è¯´ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªåè®®æ¥è¡¨ç¤ºè¢«è£…é¥°è€…çš„åŸºæœ¬è¡Œä¸ºï¼Œç„¶ååˆ›å»ºä¸€ä¸ªè£…é¥°å™¨åè®®ï¼Œè¯¥åè®®ç»§æ‰¿è‡ªè¢«è£…é¥°è€…åè®®ï¼Œå¹¶æ·»åŠ äº†é¢å¤–çš„è¡Œä¸ºã€‚æœ€åï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªç±»æ¥å®ç°è£…é¥°å™¨åè®®ï¼Œè¯¥ç±»é€šè¿‡å­˜å‚¨è¢«è£…é¥°è€…å¯¹è±¡çš„å¼•ç”¨æ¥å®ç°å¯¹è¢«è£…é¥°è€…å¯¹è±¡çš„åŒ…è£…ã€‚ è¿›é˜¶ ä»€ä¹ˆæ˜¯å°¾é€’å½’ä¼˜åŒ–ï¼ˆTail-Call Optimizationï¼‰ï¼Ÿåœ¨Swiftä¸­å¦‚ä½•å®ç°å°¾é€’å½’ä¼˜åŒ–ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 2 å°¾é€’å½’ä¼˜åŒ–æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒå¯ä»¥é¿å…åœ¨é€’å½’ç®—æ³•ä¸­å‡ºç°æ ˆæº¢å‡ºçš„é—®é¢˜ 3 åœ¨é€’å½’å‡½æ•°çš„æœ€åä¸€ä¸ªæ“ä½œæ˜¯è°ƒç”¨è‡ªèº«ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–æ“ä½œæ—¶ï¼Œå°¾é€’å½’ä¼˜åŒ–å¯ä»¥å°†é€’å½’è½¬æ¢ä¸ºå¾ªç¯ï¼Œé¿å…äº†æ ˆçš„å¢é•¿ ä»€ä¹ˆæ˜¯å‡½æ•°æŸ¯é‡ŒåŒ–ï¼ˆFunction Curryingï¼‰ï¼Ÿåœ¨Swiftä¸­å¦‚ä½•å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 2 å‡½æ•°æŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å°†å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢ä¸ºä¸€ç³»åˆ—åªæœ‰å•ä¸ªå‚æ•°çš„å‡½æ•°çš„æŠ€æœ¯ 3 åœ¨swiftä¸­ï¼Œå¯ä»¥é€šè¿‡å°†å‡½æ•°è¿”å›å€¼å£°æ˜ä¸ºé—­åŒ…ç±»å‹ï¼Œå°†åŸæœ¬éœ€è¦çš„å‚æ•°æ”¾åˆ°è¿”å›å€¼çš„é—­åŒ…ä¸­ï¼Œæ¥å®ç°å‡½æ•°æŸ¯é‡ŒåŒ– è®¾è®¡ åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ æ˜¯å¦‚ä½•åˆ’åˆ†æ¨¡å—ï¼ˆModuleï¼‰å’Œå±‚çº§ï¼ˆLayerï¼‰çš„ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚ æ€»åˆ†10åˆ† å¼€æ”¾å¼é¢˜ç›®ã€‚ ä¸ç”¨ target-action çš„æ–¹å¼å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·¯ç”±ç»„ä»¶ï¼Ÿ æ€»åˆ†20åˆ† å¼€æ”¾å¼é¢˜ç›®ã€‚ å½“ä½ ä»ObjCè½¬åˆ°Swiftä¹‹åï¼Œä½ æœ€å¤§çš„æ„Ÿè§¦æ˜¯ä»€ä¹ˆï¼Ÿ æ€»åˆ†20åˆ† å¼€æ”¾å¼é¢˜ç›®ã€‚ å½“ä½ ä»ObjCè½¬åˆ°Swiftä¹‹åï¼Œä½ åšäº†å“ªäº›äº‹è®©ä½ çš„Swiftä»£ç çœ‹ä¸Šå»ä¸é‚£ä¹ˆObjCï¼Ÿ æ€»åˆ†30åˆ† å¼€æ”¾å¼é¢˜ç›®ã€‚ä¸‹é¢æä¾›å‡ ä¸ªç¤ºä¾‹ï¼š ä½¿ç”¨Swiftçš„æ•°æ®ç»“æ„å’Œç±»å‹ï¼šä½¿ç”¨Swiftçš„Arrayã€Dictionaryç­‰æ•°æ®ç»“æ„ï¼Œé¿å…ä½¿ç”¨NSArrayå’ŒNSDictionaryç­‰ã€‚ ä½¿ç”¨Swiftçš„å¯é€‰å‹ï¼ˆOptionalï¼‰ï¼šä½¿ç”¨å¯é€‰å‹æ¥å¤„ç†å˜é‡æ˜¯å¦å­˜åœ¨çš„æƒ…å†µï¼Œè€Œä¸æ˜¯å®šä¹‰0ï¼Œç©ºå­—ç¬¦ä¸²ï¼Œæˆ–è€…ä½¿ç”¨ObjCä¸­çš„nilæˆ–NSNotFoundç­‰ã€‚ ä½¿ç”¨Swiftçš„è¯­è¨€ç‰¹æ€§ï¼šä½¿ç”¨Swiftä¸­çš„é«˜é˜¶å‡½æ•°å’Œé—­åŒ…ç­‰è¯­è¨€ç‰¹æ€§ï¼Œé¿å…ä½¿ç”¨ObjCä¸­çš„å¾ªç¯å’Œå‡½æ•°æŒ‡é’ˆç­‰ã€‚ å‡å°‘ä½¿ç”¨å…¨å±€å˜é‡ï¼šå°½é‡é¿å…ä½¿ç”¨å…¨å±€å˜é‡ï¼Œè€Œé‡‡ç”¨æ›´å…·ä½“å’Œå±€éƒ¨çš„æ–¹å¼æ¥ä¼ é€’æ•°æ®ã€‚ å‡å°‘ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼šå°½é‡é¿å…ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè€Œé‡‡ç”¨æ›´å®‰å…¨å’Œä¼˜é›…çš„æ–¹å¼æ¥å¤„ç†ç±»å‹è½¬æ¢ã€‚ ","link":"https://blog.rakuyoo.top/ios-self-paced-interview-questions/"},{"title":"Pythonï¼šCelery çš„ç®€å•ä½¿ç”¨","content":"æœ€è¿‘å†™çš„åç«¯é¡¹ç›®éœ€è¦ç”¨åˆ°é˜Ÿåˆ—ï¼Œå…¶ä¸­æœ‰ä¸€äº›ä¸œè¥¿æŠ˜è…¾äº†å¥½ä¸€ä¼šå„¿ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚ Celery æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¯å®ç°å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ã€å®šæ—¶ä»»åŠ¡ã€ä»»åŠ¡ç»“æœå¤„ç†ç­‰åŠŸèƒ½ã€‚ æœ¬æ–‡åŸºäº Celery 5.2.7 ç‰ˆæœ¬ç¼–å†™ã€‚ æ¦‚è§ˆ Celery å…¶å®åŒ…å«äº†å‡ ä¸ªæ¦‚å¿µï¼šCelery å®¢æˆ·ç«¯ã€æ¶ˆæ¯ä¸­é—´ä»¶ Brokerã€ç»“æœå­˜å‚¨ Backend ä»¥åŠ ä»»åŠ¡æ‰§è¡Œå•å…ƒ Workerã€‚ å¤§è‡´çš„æµç¨‹æ˜¯ï¼šCeler å®¢æˆ·ç«¯å‘èµ·ä»»åŠ¡ -&gt; ç›¸å…³ä¿¡æ¯å­˜å‚¨åˆ°æ¶ˆæ¯ä¸­é—´ä»¶ Broker ä¸­ -&gt; ä»»åŠ¡æ‰§è¡Œå•å…ƒ Worker ä» Broker ä¸­è¯»å–ä»»åŠ¡ï¼ˆTaskï¼‰ç„¶åæ‰§è¡Œ -&gt; å°†æ‰§è¡Œç»“æœå­˜å‚¨åˆ° Backend ä¸­ -&gt; Celery å®¢æˆ·ç«¯ä» Backend ä¸­è¯»å–ç»“æœã€‚ Celery æ”¯æŒå¤šç§æ¶ˆæ¯ä¸­é—´ä»¶å’Œç»“æœå­˜å‚¨ï¼Œæœ¬æ–‡ä¸»è¦ä½¿ç”¨ Redis ä½œä¸ºä¸­é—´ä»¶å’Œç»“æœå­˜å‚¨ã€‚ Celery å¯¹è±¡çš„åˆå§‹åŒ– &amp; é…ç½® åœ¨ Celery ç±»ç”¨ __init__ æ–¹æ³•åˆå§‹åŒ–ä¹‹åï¼Œæœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼š __init__ å¯ä»¥åœ¨åˆå§‹åŒ– Celery å¯¹è±¡çš„åŒæ—¶ä¼ å…¥å¯¹åº”çš„é…ç½®ã€‚æœ‰ä»¥ä¸‹å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„å‚æ•°ï¼š mainï¼šä¸»æ¨¡å—çš„åç§° brokerï¼šæ¶ˆæ¯ä¸­é—´ä»¶å­˜å‚¨çš„è®¿é—®åœ°å€ backendï¼šç»“æœå­˜å‚¨æœåŠ¡çš„è®¿é—®åœ°å€ï¼ˆå¯é€‰çš„ï¼‰ ä¾‹å¦‚è¯´ä¸€ä¸ªå¯èƒ½çš„ Celery å¯¹è±¡çš„åˆå§‹åŒ–ä»£ç ä¸ºï¼š from celery import Celery celery = Celery('flaskr', broker='redis://localhost:6379/0', backend='redis://localhost:6379/0') å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ª Redis æœåŠ¡åŒæ—¶ä½œä¸ºä¸­é—´ä»¶å’Œç»“æœå­˜å‚¨ã€‚ flaskr æ˜¯åŒ…å« Celery å®¢æˆ·ç«¯çš„ Python ç¨‹åºçš„åç§°ï¼Œå¦‚æœä½¿ç”¨ Flask æ¡†æ¶å¼€å‘ï¼Œé‚£ä¹ˆåº”å½“æ˜¯å’Œåˆå§‹åŒ– Flask å¯¹è±¡æ—¶ä½¿ç”¨çš„åç§°ä¸€è‡´ã€‚ ä¸Šæ–‡æœ‰æåˆ° backend æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ä¼ è¯¥å‚æ•°ï¼Œé‚£ä¹ˆå°±æ— æ³•é€šè¿‡ Celery æŸ¥è¯¢åˆ°ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚ config_from_object Celery ç±»è¿˜æä¾›äº†ä¸€ä¸ª config_from_object æ–¹æ³•ï¼Œæ”¯æŒé€šè¿‡ â€œPython é…ç½®æ–‡ä»¶â€ è¿›è¡Œé…ç½®ã€‚ä½¿ç”¨ä¸Šä»£ç ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š from celery import Celery celery = Celery('flaskr') celery.config_from_object('flaskr.tools.celery_config') celery_config æ˜¯æ–‡ä»¶åã€‚flaskr.tools.celery_config æ˜¯è¿™ä¸ªæ–‡ä»¶çš„ â€œè·¯å¾„â€ï¼Œæˆ–è€…è¯´å½“æˆ‘ä»¬æƒ³è¦åœ¨ä»£ç ä¸­ import è¯¥ python æ–‡ä»¶æ—¶ä½¿ç”¨çš„è·¯å¾„ã€‚ celery_config.py æ–‡ä»¶ä¸­çš„å†…å®¹ä¸ºï¼š from os import environ CELERY_REDIS_URL = &quot;redis://&quot; + \\ &quot;:&quot; + \\ environ.get(&quot;REDIS_PASSWD&quot;) + \\ &quot;@&quot; + \\ environ.get(&quot;REDIS_HOST&quot;) + \\ &quot;:&quot; + \\ environ.get(&quot;REDIS_PORT&quot;) + \\ &quot;/&quot; + \\ environ.get(&quot;REDIS_DATABASE&quot;) BROKER_URL = CELERY_REDIS_URL CELERY_RESULT_BACKEND = CELERY_REDIS_URL åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–é…ç½®ï¼Œæˆ–è€…ç›´æ¥å†™æ­»äº†æˆ‘ä»¬æ‰€éœ€è¦çš„é…ç½®å­—æ®µã€‚ æ³¨æ„ Celery å¯¹è±¡çš„åˆå§‹åŒ–ä»¥åŠé…ç½®å¿…é¡»è¦æ”¾åœ¨é¡¶å±‚ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸è¡Œçš„ï¼š from celery import Celery celery = Celery('flaskr') def init_app(app): celery.config_from_object('flaskr.tools.celery_config') å› ä¸ºåç»­ Worker å°†ä¼šæ ¹æ®é…ç½®çš„è·¯å¾„ï¼Œå¯»æ‰¾ Celery å¯¹è±¡ï¼Œä»è¯¥å¯¹è±¡ä¸­è·å–ç›¸åº”çš„é…ç½®ã€‚ è¯¥è¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºï¼šâ€œä¸æ˜¯è·å–ä¸€ä¸ªå·²ç»åˆå§‹åŒ–å¥½äº†çš„å¯¹è±¡ï¼Œè€Œæ˜¯æ ¹æ®é…ç½®çš„è·¯å¾„ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶/æ¨¡å—ï¼Œé‡æ–°åˆå§‹åŒ– Celery å¯¹è±¡â€ã€‚ è¯¥è¿‡ç¨‹åªä¼šæ‰§è¡Œé¡¶å±‚å±æ€§ã€æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸ä¼šè°ƒç”¨ä½ çš„ init_app æ–¹æ³•ï¼Œæ‰€ä»¥è¿™ä¹ˆå†™ä¹‹å Worker ä¾§çš„ Celery å¯¹è±¡å±äºåªæ˜¯è¢«åˆå§‹åŒ–ä½†æ˜¯æ²¡æœ‰è¢«é…ç½®è¿‡çš„çŠ¶æ€ï¼Œæ‰€æœ‰çš„é…ç½®é¡¹éƒ½ä¼šæ˜¯é»˜è®¤å€¼ã€‚ Worker Worker æœåŠ¡æ˜¯ç‹¬ç«‹äº Celery å®¢æˆ·ç«¯ç¨‹åºçš„ï¼Œéœ€è¦å•ç‹¬å¦èµ·ä¸€ä¸ªæœåŠ¡ã€‚ åœ¨ç»ˆç«¯æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ Worker æœåŠ¡ï¼š celery -A flaskr.libs.system worker -l info å…¶ä¸­ -A å‚æ•°åé¢æ¥ç€çš„ flaskr.libs.system æ˜¯ Celery å¯¹è±¡æ‰€åœ¨çš„æ¨¡å—/æ–‡ä»¶è·¯å¾„ã€‚å’Œ config_from_object ä¸€æ ·ï¼Œè¿™é‡Œä¹Ÿæ˜¯ â€œå½“æˆ‘ä»¬æƒ³è¦åœ¨ä»£ç ä¸­ import è¯¥ python æ–‡ä»¶æ—¶ä½¿ç”¨çš„è·¯å¾„â€ã€‚è¦ç¡®ä¿è¯¥è·¯å¾„ä¸‹åŒ…å«ç€ Celery å¯¹è±¡ã€‚ -l å‚æ•°æ˜¯æ—¥å¿—ç­‰çº§ï¼Œç¤ºä¾‹ä¸­æŒ‡å®šåˆ° info çº§åˆ«ã€‚ Celery çš„ä½¿ç”¨ ä¸‹é¢ç®€å•çš„ä»‹ç»ä¸€ä¸‹ Celery æ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ã€‚ ä¸Šæ–‡ä¸­æœ‰æåˆ°ï¼ŒWorker ä¼šåœ¨è¿è¡Œæ—¶è¯»å– Celery å®¢æˆ·ç«¯ä¸­çš„ Task ä»»åŠ¡å¹¶æ‰§è¡Œã€‚ å®šä¹‰ä»»åŠ¡ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Task çš„å®šä¹‰ï¼š # in tasks.py from flaskr.libs.system import celery @celery.task def add(x, y): return x + y ä½ å¯ä»¥å°†å…¶å®šä¹‰ä¸ºé¡¶å±‚/å…¨å±€æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å°†å…¶åŒ…è£¹åœ¨ç±»ä¸­ã€‚ å¦‚æœåŒ…è£¹åœ¨ç±»ä¸­ï¼Œä¼šæ¶‰åŠåˆ° self å‚æ•°é—®é¢˜ï¼Œè¯·å‚è€ƒåé¢çš„å°èŠ‚ï¼šä»»åŠ¡ä¸­çš„ self ä¸Šæ–‡æˆ‘ä»¬åœ¨ flaskr.libs.system æ¨¡å—ä¸‹å®šä¹‰äº† celery å¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥åœ¨ tasks.py æ–‡ä»¶ä¸­ä½¿ç”¨ @celery.task è£…é¥°å™¨ï¼Œä½¿ä¸€ä¸ªæ–¹æ³•æˆä¸º Celery ä»»åŠ¡ã€‚ æ³¨æ„ï¼šå¦‚æœä½ çš„ Celery å¯¹è±¡ä¸å« celery è€Œæ˜¯å…¶ä»–åå­—ï¼Œä¾‹å¦‚ appã€‚é‚£ä¹ˆä½ çš„è£…é¥°å™¨åº”è¯¥æ˜¯ @app.task â€”â€” task æ˜¯ Celery å¯¹è±¡çš„æ–¹æ³•ã€‚ åœ¨ Task ä»»åŠ¡å†…ï¼Œreturn ç»“æœä»£è¡¨ç€ â€œä»»åŠ¡æ‰§è¡ŒæˆåŠŸâ€ï¼Œé€šè¿‡ raise æŠ›å‡ºå¼‚å¸¸æ„å‘³ç€ â€œä»»åŠ¡æ‰§è¡Œå¤±è´¥ã€‚â€ æ‰§è¡Œä»»åŠ¡ å¯¹ä»»åŠ¡æ–¹æ³•è°ƒç”¨ delay æ–¹æ³•ä»¥ä¼ é€’å‚æ•°å¹¶æ‰§è¡Œä»»åŠ¡ï¼š # ä½¿ç”¨å‚æ•° 4ï¼Œ5 è°ƒç”¨ä»»åŠ¡ add result = add.delay(4, 5) # å¯¹æ‰§è¡Œç»“æœè°ƒç”¨ get() æ–¹æ³•ä»¥è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ print(result.get()) get() æ–¹æ³•è·å–çš„æ˜¯ä»»åŠ¡æ‰§è¡ŒæˆåŠŸä¹‹åçš„ç»“æœï¼Œå³ return çš„ç»“æœã€‚ å¦‚æœè¦è·å– raise æŠ›å‡ºçš„å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ result.result æ–¹æ³•è·å–å¼‚å¸¸ã€‚ åˆ¤æ–­çŠ¶æ€ åœ¨è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœä¹‹å‰ï¼Œæˆ‘å»ºè®®æ‚¨å…ˆåˆ¤æ–­å½“å‰ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚ Celery æ¡†æ¶æä¾›äº† AsyncResult ç±»æ¥æŸ¥è¯¢ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ï¼š def exec_task(self): &quot;&quot;&quot;æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶è¿”å›ä»»åŠ¡ ID&quot;&quot;&quot; result = add.delay(4, 5) task_id = result.task_id return task_id def check_status(self, task_id): &quot;&quot;&quot;æ ¹æ®ä»»åŠ¡ ID æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€&quot;&quot;&quot; from flaskr.libs.system import celery result = celery.AsyncResult(task_id) æœ‰ä¸€äº›æ–‡ç« ä¼šæ‰§è¡Œä½¿ç”¨ AsyncResult ç±»ï¼Œè€Œä¸æ˜¯é€šè¿‡ celery å¯¹è±¡è°ƒç”¨ AsyncResultã€‚ ä½†æ˜¯åœ¨æˆ‘å®é™…æ“ä½œè¿‡ç¨‹ä¸­å‘ç°ï¼Œä¸é€šè¿‡ celery å¯¹è±¡è°ƒç”¨çš„è¯ä¼šæ‰¾ä¸åˆ° Backendï¼Œæ€€ç–‘ä¹Ÿæ˜¯å’Œé…ç½®æœ‰å…³ã€‚ result å¯¹è±¡æœ‰ä¸€ä¸ª task_id å±æ€§ï¼Œä½¿ç”¨è¯¥å±æ€§å€¼ä½œä¸ºå‚æ•°åˆå§‹åŒ– AsyncResult å¯¹è±¡ï¼Œå°±å¯ä»¥æŸ¥è¯¢è¯¥ä»»åŠ¡çš„çŠ¶æ€ï¼š result.stateï¼šè·å–å½“å‰ä»»åŠ¡çš„çŠ¶æ€ï¼ˆå­—ç¬¦ä¸²ï¼‰ result.ready()ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»ç»“æŸï¼ˆæˆåŠŸ or å¤±è´¥ï¼‰ result.successful()ï¼šåˆ¤è¯»ä»»åŠ¡æ˜¯å¦æˆåŠŸ result.get()ï¼šå’Œä¸Šæ–‡æåŠçš„ä¸€æ ·ï¼Œè·å–æ‰§è¡ŒæˆåŠŸçš„ä»»åŠ¡çš„ç»“æœï¼ˆreturnï¼‰ result.resultï¼šå’Œä¸Šæ–‡æåŠçš„ä¸€æ ·ï¼Œè·å–æ‰§è¡Œå¤±è´¥çš„ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆraiseï¼‰ ä¸€ç§æœ‰å¯èƒ½çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š def check_status(self, task_id): # æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ from flaskr.libs.system import celery result = celery.AsyncResult(task_id) logging.info(f&quot;æŸ¥è¯¢ä»»åŠ¡ç»“æœï¼Œä»»åŠ¡IDï¼ˆ{task_id}ï¼‰å¯¹åº”çš„çŠ¶æ€ä¸ºï¼š{result.state}&quot;) # ä»»åŠ¡ä»åœ¨æ‰§è¡Œä¸­ if not result.ready(): return { &quot;code&quot;: &quot;105&quot;, &quot;message&quot;: &quot;ä»»åŠ¡ä»åœ¨æ‰§è¡Œä¸­&quot; } # ä»»åŠ¡å¤±è´¥ if not result.successful(): error = result.result return { &quot;code&quot;: &quot;9999&quot;, &quot;message&quot;: f&quot;{str(error)}&quot; } # è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ task_result = result.get() return { &quot;code&quot;: &quot;200&quot;, &quot;data&quot;: task_result, &quot;message&quot;: &quot;ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ&quot; } ä»»åŠ¡ä¸­çš„ self .task() æ–¹æ³•æœ‰ä¸€ä¸ª bind å‚æ•°ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯ Falseã€‚è¯¥å‚æ•°å¯ä»¥æ§åˆ¶æ˜¯å¦å°†ä»»åŠ¡ç»‘å®šåˆ°å®ä¾‹å¯¹è±¡ä¸Šã€‚è¿™å…³ä¹åˆ° self å‚æ•°çš„å…·ä½“å€¼ã€‚ å®šä¹‰åœ¨ç±»ä¸­çš„ä»»åŠ¡ å¦‚æœä½ çš„ä»»åŠ¡å®šä¹‰æ˜¯åŒ…è£¹åœ¨ç±»ä¸­ï¼Œåƒæ˜¯è¿™æ ·ï¼š from flaskr.libs.system import celery class Tasks(object): def __init__(self, value): self.value = value @celery.task def add(self, x): return x + self.value é‚£ä¹ˆæ­¤æ—¶éœ€è¦æ³¨æ„ï¼Œå› ä¸º bind å‚æ•°çš„é»˜è®¤å€¼æ˜¯ Falseï¼Œæ‰€ä»¥æ­¤æ—¶ add ä»»åŠ¡æ²¡æœ‰è¢«ç»‘å®šåˆ° Tasks ç±»å®ä¾‹ä¸Šï¼Œæ‰€ä»¥æ­¤æ—¶ self å‚æ•°æŒ‡çš„æ˜¯ä»»åŠ¡æœ¬èº«ï¼Œè€Œä¸æ˜¯ Tasks ç±»çš„å®ä¾‹å¯¹è±¡ã€‚æ­¤æ—¶åœ¨ add æ–¹æ³•ä¸­ï¼Œä½ å°†æ— æ³•è·å–åˆ° self.value çš„å€¼ã€‚ å¦‚æœä½ æƒ³åœ¨ add æ–¹æ³•ä¸­ä½¿ç”¨ self.valueï¼Œä½ éœ€è¦å°† bind å‚æ•°è®¾ç½®ä¸º Trueï¼Œåƒæ˜¯è¿™æ ·ï¼š ... @celery.task(bind=True) def add(self, x): return x + self.value ... æ­¤æ—¶ä½ å¯ä»¥é¡ºåˆ©çš„è·å–åˆ° self.value çš„å€¼ã€‚ å®šä¹‰åœ¨é¡¶å±‚çš„ä»»åŠ¡ å¦‚æœä»»åŠ¡ç›´æ¥å®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š from flaskr.libs.system import celery @celery.task def add(x, y): return x + y é‚£ä¹ˆé¦–å…ˆï¼Œæ­¤æ—¶ bind å‚æ•°çš„å€¼æ˜¯ Falseã€‚è¿™ä¸ªæ—¶å€™æ‚¨æ— æ³•åœ¨ add æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ  selfï¼Œä¹Ÿæ— æ³•åœ¨æ–¹æ³•å®ç°å†…ä½¿ç”¨ self å‚æ•°ï¼Œè¿™ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚ å¦‚æœä½ å°† bind è®¾ç½®ä¸º Trueï¼Œé‚£ä¹ˆå°±å¯ä»¥æ·»åŠ  self å‚æ•°äº†ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š from flaskr.libs.system import celery @celery.task(bind=True) def add(self, x, y): return x + y é‚£ä¹ˆæ­¤æ—¶ self ä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿ ä¸Šæ–‡æœ‰æåˆ°ï¼Œbind å‚æ•°ç”¨äºå°†ä»»åŠ¡ç»‘å®šåˆ°ç±»å®ä¾‹ã€‚ å®é™…ä¸Šï¼Œæ­¤æ—¶ Celery ä¼šåœ¨åå°è‡ªåŠ¨å°†è¯¥ä»»åŠ¡è½¬æ¢ä¸ºä¸€ä¸ªå¸¦æœ‰å®ä¾‹æ–¹æ³•çš„ç±»ï¼Œä½¿ä½ å¯ä»¥åœ¨ä»»åŠ¡å‡½æ•°ä¸­è®¿é—®å®ä¾‹å±æ€§å’Œæ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œself å‚æ•°è¡¨ç¤ºå½“å‰ä»»åŠ¡çš„å®ä¾‹å¯¹è±¡ï¼Œå°±åƒåœ¨ç±»ä¸­å®šä¹‰ä»»åŠ¡ä¸€æ ·ã€‚ é‡è¯• Celery æ¡†æ¶æœ¬èº«æ”¯æŒ â€œé‡è¯•â€ åŠŸèƒ½ï¼ŒåŒ…å«è‡ªåŠ¨é‡è¯•å’Œæ‰‹åŠ¨é‡è¯•ä¸¤ç§æ–¹æ³•ã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹æ‰‹åŠ¨é‡è¯•çš„ç”¨æ³•ã€‚ retry æ–¹æ³•çš„è°ƒç”¨ # in tasks.py from flaskr.libs.system import celery @celery.task(bind=True) def add(self, x, y): try: # æŸäº›å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³• return __some_method_may_throw_exceptions() except Exception as e: # å‡ºé”™æ¯15ç§’å°è¯•ä¸€æ¬¡ï¼Œæ€»å…±å°è¯•3æ¬¡ raise self.retry(exc=e, countdown=15, max_retries=3) finally: pass è¯¥ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨æ–‡ä»¶å†…ç›´æ¥å®šä¹‰äº†ä¸€ä¸ªä»»åŠ¡ï¼Œè€Œä¸” bind å‚æ•°è¢«è®¾ç½®ä¸ºäº† Trueã€‚æ­¤æ—¶æˆ‘ä»¬è¦é€šè¿‡ self å‚æ•°æ¥è°ƒç”¨ retry æ–¹æ³•ï¼Œæ‰§è¡Œæ‰‹åŠ¨é‡è¯•ã€‚ é‚£å¦‚æœ bind æ˜¯ False çš„æƒ…å†µå‘¢ï¼Ÿæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ add.retry(...) æ¥è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¦‚æœä»»åŠ¡å®šä¹‰åœ¨ç±»ä¸­ï¼š å¦‚æœ bind æ˜¯ Falseï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ self.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¦‚æœ bind æ˜¯ Trueï¼Œåˆ™éœ€è¦ä½¿ç”¨ add.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ æ€»ç»“ä¸€ä¸‹ä¸åŒçš„åœºæ™¯ï¼š ä»»åŠ¡å®šä¹‰åœ¨ç±»ä¸­ï¼š å¦‚æœ bind æ˜¯ Falseï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ self.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¦‚æœ bind æ˜¯ Trueï¼Œåˆ™éœ€è¦ä½¿ç”¨ add.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ ä»»åŠ¡å®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼š å¦‚æœ bind æ˜¯ Falseï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ add.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¦‚æœ bind æ˜¯ Trueï¼Œåˆ™éœ€è¦ä½¿ç”¨ self.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¯ä»¥è¯´å®šä¹‰åœ¨ç±»ä¸­å’Œå®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼Œå¯¹äºç›¸åŒçš„ bind å‚æ•°ï¼Œè°ƒç”¨æ–¹å¼æ˜¯ç›¸åçš„ã€‚ retry æ–¹æ³•çš„å‚æ•° è¯´å®Œäº†è°ƒç”¨ï¼Œæˆ‘ä»¬æ¥è¯´ä¸€ä¸‹å‚æ•°ã€‚ countdown å®šä¹‰é‡è¯•çš„é—´éš”ï¼Œmax_retries å®šä¹‰æœ€å¤šé‡è¯•å‡ æ¬¡ã€‚ exc å‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå®ƒä»£è¡¨ç€ â€œå½“å‰ä»»åŠ¡å¤±è´¥æ—¶äº§ç”Ÿçš„å¼‚å¸¸â€ã€‚é€šè¿‡å°† e å‚æ•°ä¼ é€’åˆ° retry æ–¹æ³•ä¸­ï¼Œå¯ä»¥è®©é‡è¯•å¤±è´¥åæŠ›å‡ºæœ€å¼€å§‹çš„å¼‚å¸¸ã€‚æ‚¨ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è¯¥å¼‚å¸¸å‚æ•°ã€‚ åœ¨ä½¿ç”¨ retry æ–¹æ³•æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š exc å‚æ•°ï¼ŒCelery æ¡†æ¶å°†é»˜è®¤å°†ä»»åŠ¡çš„å¼‚å¸¸ä¿¡æ¯ä¼ é€’ç»™ retry æ–¹æ³•ã€‚å¦‚æœæŒ‡å®šäº† exc å‚æ•°ï¼Œåˆ™ä¼šå°†æŒ‡å®šçš„å¼‚å¸¸å¯¹è±¡ä¼ é€’ç»™ retry æ–¹æ³•ã€‚ retry æ–¹æ³•çš„ç»“æœ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† raise å°† retry å¤±è´¥åçš„å¼‚å¸¸æŠ›å‡ºï¼Œæ„å‘³ç€ä»»åŠ¡å¤±è´¥ã€‚ åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥ä¸ä½¿ç”¨è¯¥å‚æ•°ï¼Œåœ¨é‡è¯•å¤±è´¥ä¹‹åæ‰‹åŠ¨å¤„ç†å¼‚å¸¸ï¼Œä¾‹å¦‚ï¼š # in tasks.py from flaskr.libs.system import celery @celery.task(bind=True) def add(self, x, y): try: return __some_method_may_throw_exceptions() except Exception as e: max_retries = 3 # è¶…è¿‡æœ€å¤§æ¬¡æ•°ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ if self.request.retries &gt;= max_retries: return __create_error_response() self.retry(exc=e, countdown=15, max_retries=max_retries) finally: pass åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœè¶…è¿‡äº†æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å°†é‡è¯•çš„å¼‚å¸¸æŠ›ç»™å¤–ç•Œï¼Œæ‰€ä»¥åœ¨æœ€åä¸€æ¬¡é‡è¯•å¤±è´¥ä¹‹åä¼šå†æ¬¡è§¦å‘ exceptï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ„å‘³ç€é‡è¯•å¤±è´¥ã€‚ å½“é‡è¯•å¤±è´¥åï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œå¤±è´¥å¤„ç†ã€‚ ","link":"https://blog.rakuyoo.top/simple-use-of-python-celery/"},{"title":"å¯ç»„åˆçš„ UICollectionView å¸ƒå±€ï¼šUICollectionViewCompositionalLayout","content":"UICollectionViewCompositionalLayout æ˜¯ Apple åœ¨ iOS 13 å¼•å…¥çš„ï¼Œç”¨äºæ„å»ºåŸºäºç»„åˆçš„ UICollectionView å¸ƒå±€çš„ç±»ã€‚å®ƒå…è®¸å¼€å‘è€…æ ¹æ®ä¸€ç³»åˆ—çš„ç»„åˆå¸ƒå±€ï¼Œæ›´è½»æ¾ã€æ›´çµæ´»åœ°åˆ›å»ºå¤æ‚çš„ UICollectionView å¸ƒå±€ã€‚ æœ¬æ–‡ä¸»è¦å›´ç»• UICollectionViewCompositionalLayout ä¸­ â€œå¯ç»„åˆâ€ è¿™ä¸ªç‰¹æ€§è¿›è¡Œè®¨è®ºã€‚ æœ¬æ–‡å»ºç«‹åœ¨æ‚¨å·²ç»å¤§è‡´äº†è§£è¿‡ UICollectionViewCompositionalLayoutï¼ŒçŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼Œä»¥åŠåŸºç¡€çš„ç”¨æ³•ã€‚ä¸‹æ–‡å°†ä¸å†å¯¹å…¶è¿›è¡Œè®²è§£ã€‚ ç»„åˆç±» FlowLayout å¸ƒå±€ åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  NSCollectionLayoutGroup ä¹‹å­è§†å›¾çš„å¡«å…… çš„æœ€åæœ‰æåˆ°ä¸€ä¸ªåœºæ™¯ï¼Œè¿™é‡Œå¤ç”¨ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘æœ‰è¯´ä¸­é—´çš„ â€œå·¥å…·Groupâ€ ä¸èƒ½ä½¿ç”¨ subitems çš„å½¢å¼è¿›è¡Œåˆå§‹åŒ–ï¼Œåº”è¯¥ä½¿ç”¨ subitem + count çš„å½¢å¼åˆå§‹åŒ– â€”â€” å…¶å®è¿™ä¸å®Œå…¨å¯¹ã€‚ å®é™…éœ€æ±‚ä¸Šï¼Œå¦‚å›¾è¿™ç§ç±» FlowLayout çš„å¸ƒå±€å¾€å¾€ä¼šè¦æ±‚ â€œæ¯è¡ŒXä¸ªâ€ï¼Œå³å¹³åˆ†å±•ç¤ºã€‚ æ­¤æ—¶å¦‚æœä½ ä»¬éœ€è¦è€ƒè™‘ä¸‹é¢çš„åœºæ™¯ï¼š å±å¹•æ—‹è½¬ã€‚ iPad ç­‰å±å¹•å°ºå¯¸ä¼šå‘ç”Ÿå˜åŒ–çš„æƒ…å†µã€‚ AutoLayout ä¾§ä¸æƒ³è¦è·å–å±å¹•å°ºå¯¸å»è®¡ç®—å‡º cell å®½åº¦ã€‚ é‚£ä¹ˆ subitem + count å°±æ²¡æ³•åšäº†ï¼šsubitem + count ä¼šå¿½ç•¥å¸ƒå±€æ–¹å‘ä¸Šçš„å°ºå¯¸ï¼Œæ‰€ä»¥æ­¤æ—¶å¾ˆéš¾å•çº¯ç”¨ AutoLayout åšå‡ºå¹³åˆ†çš„æ•ˆæœï¼Œæˆ–è€…è¯´ä¸ºäº†å®ç°å¹³åˆ†ï¼Œéœ€è¦å¤šæ¬¡åˆ·æ–°é¡µé¢å¸ƒå±€ã€‚ æ­¤æ—¶æœ‰ä¸€ç§ç”¨ subitems å®ç°çš„æ–¹å¼ï¼šä»¥æ¯è¡Œ/åˆ—ä½œä¸ºä¸€ä¸ª Groupï¼ŒGroup å†…ä½¿ç”¨ subitemsã€‚å¤§è‡´çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š let itemSize = NSCollectionLayoutSize( widthDimension: .fractionalWidth(1/4), heightDimension: .estimated(69) ) let normalLayoutSize = NSCollectionLayoutSize( widthDimension: .fractionalWidth(1), heightDimension: .estimated(500) ) let toolsListGroup = NSCollectionLayoutGroup.horizontal( layoutSize: normalLayoutSize, subitems: [ .init(layoutSize: itemSize) ] ) let rows = 5 let toolsGroup = NSCollectionLayoutGroup.vertical( layoutSize: normalLayoutSize, subitems: [ [toolsTitleItem], Array(repeating: toolsListGroup, count: rows), [ toolsFooterItem, sectionPaddingItem ], ].flatMap { $0 } ) ä¸Šé¢çš„ä»£ç é¦–å…ˆå®šä¹‰äº†2ä¸ª Sizeï¼Œä¸€ä¸ªæ˜¯ Item çš„å°ºå¯¸ï¼Œå¦å¤–ä¸€ä¸ªç®—æ˜¯ä¸€ä¸ª â€œå ä½ç¬¦â€ã€‚ ç„¶åæ˜¯2ä¸ª Groupï¼š toolsListGroup ä»¥è¡Œä¸ºå•ä½å±•ç¤º cellã€‚ toolsGroup åˆ™æ˜¯æœ€å¤–é¢çš„ Groupï¼Œå®ƒçš„ subitems åŒ…å«å¤šä¸ªä¸åŒçš„ Groupã€‚å…¶ä¸­çš„ Array(repeating: toolsListGroup, count: $0) åˆ™æ˜¯æ ¹æ®è¡Œæ•°ç”Ÿæˆå¯¹åº”æ•°é‡çš„ Groupã€‚ è¿™ç§å†™æ³•æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹è¿˜æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼š æ³¨æ„ç‚¹æ˜¯ï¼šå½“ cell çš„æ•°é‡ä¸æ˜¯è¡Œçš„æ•´æ•°å€çš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºå ä½ cellã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œcell æœ‰ 5 ä¸ªï¼Œå¯¹åº”çš„å°±æ˜¯2è¡Œï¼Œcell åˆ†å¸ƒæ˜¯ 4 + 1ã€‚æ­¤æ—¶å› ä¸ºåé¢è¿˜æœ‰å…¶ä»–ç­‰å¾…è¢«å¡«å……çš„ Item/Groupï¼Œå¦‚æœæ²¡æœ‰åˆ›å»ºå ä½ cellï¼Œåˆ™åé¢çš„ cell ä¼šè¢«æå‰ï¼Œä½¿ç”¨ toolsListGroup é‡Œçš„ Item å¸ƒå±€ã€‚ ç–‘æƒ‘çš„æ˜¯ï¼šæˆ‘å¹¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¹ˆåšèƒ½ç”Ÿæ•ˆã€‚ æŒ‰ç†è¯´ subitems çš„å¸ƒå±€æ–¹å¼æ˜¯ä¸ä¼šé™åˆ¶å†…å®¹çš„æ•°é‡çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå®ƒèƒ½æ¯è¡Œæ­£å¥½è£…4ä¸ªï¼ˆå°±è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œæ¯ä¸ªCellçš„å®½åº¦æ˜¯å±å¹•çš„1/4ï¼‰ï¼Œä¸‹ä¸€è¡Œçš„ Cell åˆ™ä½¿ç”¨ä¸‹ä¸€ä¸ª Group çš„å¸ƒå±€ï¼Ÿ æœ‰å…³äº UICollectionViewCompositionalLayout ç»„åˆå¤æ‚å¸ƒå±€çš„æ–‡æ¡£è¿˜æ˜¯å¤ªå°‘ï¼Œç›®å‰è¿˜æ²¡æ‰¾åˆ°è¿™ä¹ˆåšèƒ½ç”Ÿæ•ˆçš„åŸå› ã€‚ ","link":"https://blog.rakuyoo.top/composable-uicollectionview-layout-uicollectionviewcompositionallayout/"},{"title":"NSCollectionLayoutGroup ä¹‹å­è§†å›¾çš„å¡«å……","content":"æœ¬ç¯‡ä¸»è¦è®²è§£ NSCollectionLayoutGroup å†… â€œå­è§†å›¾â€ çš„å¡«å……æ–¹å¼ã€‚ ç®—æ˜¯ä¸º UICollectionViewCompositionalLayout çš„è®²è§£åšä¸€äº›é“ºå«ï¼Œæ¯•ç«ŸæŠŠ Item çš„å¡«å……æ–¹å¼äº†è§£æ¸…æ¥šäº†ä¹‹åï¼Œæ‰èƒ½ç»„åˆå¤šç§ Group æ¥è¿›è¡Œæ›´å¤æ‚çš„å¸ƒå±€ã€‚ NSCollectionLayoutGroup ä¸è€ƒè™‘æ–¹å‘çš„è¯ï¼Œæœ‰ä¸¤ç§å¡«å……å­è§†å›¾çš„æ–¹æ³•ã€‚ æ¦‚è§ˆ é€šè¿‡å¤´æ–‡ä»¶æ‚¨èƒ½æŸ¥åˆ°å¦‚ä¸‹å‡ ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼š open class func vertical(layoutSize: NSCollectionLayoutSize, subitems: [NSCollectionLayoutItem]) -&gt; Self @available(iOS, introduced: 13.0, deprecated: 16.0) open class func vertical(layoutSize: NSCollectionLayoutSize, subitem: NSCollectionLayoutItem, count: Int) -&gt; Self @available(iOS 16.0, *) open class func vertical(layoutSize: NSCollectionLayoutSize, repeatingSubitem subitem: NSCollectionLayoutItem, count: Int) -&gt; Self @available(iOS, introduced: 16.0, deprecated: 16.0, renamed: &quot;vertical(layoutSize:repeatingSubitem:count:)&quot;) public class func verticalGroup(with size: NSCollectionLayoutSize, repeatingSubitem subitem: NSCollectionLayoutItem, count: Int) -&gt; NSCollectionLayoutGroup ç¬¬ä¸‰ä¸ªæ–¹æ³•æ˜¯ iOS 16 æ–°å‡ºçš„ï¼ŒåŒæ—¶åºŸå¼ƒäº†ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œè€Œç¬¬å››ä¸ªæ–¹æ³•åœ¨ iOS 16 å¼•å…¥åŒæ—¶åˆåœ¨ iOS 16 åºŸé™¤ã€‚ åæ–‡å°†å›´ç»•å‰ä¸¤ä¸ªæ–¹æ³•å±•å¼€è®¨è®ºï¼Œä¸æ¶‰åŠåˆ°åä¸¤ä¸ªæ–¹æ³•ã€‚ subitem + count è¿™ç§åˆå§‹åŒ–æ–¹å¼å°†åœ¨æ¯ä¸ª Group ä¸­é‡å¤ count ä¸ª itemã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œåœ¨ä¸åŒçš„æ–¹å‘ä¸Šï¼ŒlayoutSize ä¼šæœ‰ä¸åŒçš„è¡¨ç°ï¼š vertical func vertical(layoutSize: NSCollectionLayoutSize, subitem: NSCollectionLayoutItem, count: Int) -&gt; NSCollectionLayoutGroup åœ¨çºµå‘ä¸Šï¼ŒNSCollectionLayoutItem çš„ widthDimension ç”Ÿæ•ˆï¼Œä½†æ˜¯heightDimension å°†è¢«å¿½ç•¥ã€‚ Item çš„å®é™…é«˜åº¦ä¼šæ˜¯ .fractionalHeight(1/count)ã€‚ å‡è®¾ç°åœ¨æœ‰ä¸‹é¢è¿™äº›ä»£ç ï¼š let itemSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1/3), heightDimension: .absolute(100)) let item = NSCollectionLayoutItem(layoutSize: itemSize) let groupSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1), heightDimension: .absolute(100)) let group = NSCollectionLayoutGroup.vertical(layoutSize: groupSize, subitem: item, count: 2) æ­¤æ—¶ Item çš„å®é™…é«˜åº¦ä¼šæ˜¯ 50ï¼Œç›¸å½“äºä¸€ä¸ªé«˜åº¦ä¸º 100 çš„ Group å†…æœ‰2ä¸ªé«˜åº¦ä¸º 50 çš„ Itemã€‚ horizontal func horizontal(layoutSize: NSCollectionLayoutSize, subitem: NSCollectionLayoutItem, count: Int) -&gt; NSCollectionLayoutGroup å’Œ vertical æ—¶çš„æƒ…å†µç›¸å¯¹åº”ï¼š åœ¨æ¨ªå‘ä¸Šï¼ŒNSCollectionLayoutItem çš„ heightDimension ç”Ÿæ•ˆï¼Œä½†æ˜¯widthDimension å°†è¢«å¿½ç•¥ã€‚ Item çš„å®é™…å®½åº¦ä¼šæ˜¯ .fractionalWidth(1/count)ã€‚ è¿™é‡Œå°±ä¸å†ç”¨ä»£ç ä¸¾ä¾‹è¯´æ˜äº†ã€‚ subitems å’Œä¸Šä¸€ç§åˆå§‹åŒ–æ–¹æ³•ç›¸æ¯”ï¼Œä½¿ç”¨ subitems çš„æ–¹å¼æ¥è¿›è¡Œåˆå§‹åŒ–è¦ç®€å•çš„å¤šï¼Œå› ä¸ºå®ƒå†…éƒ¨çš„ Item çš„å¤§å°å®Œå…¨å–å†³äº Item è‡ªèº«ã€‚è€ƒè™‘å¦‚ä¸‹ä»£ç ï¼š let itemSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1/3), heightDimension: .absolute(100)) let item = NSCollectionLayoutItem(layoutSize: itemSize) let groupSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1), heightDimension: .absolute(300)) let group = NSCollectionLayoutGroup.vertical(layoutSize: groupSize, subitems: [item]) è¯¥ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ª Item çš„é«˜åº¦å°±æ˜¯ 100ï¼Œè€Œå®½åº¦æ˜¯ Group çš„ 1/3ã€‚æ¯ä¸ª Group ä¸­æœ‰å¤šå°‘ä¸ª Item å–å†³äºæ•°æ®æºä¼ é€’ç»™ UICollectionView çš„æ•°é‡ã€‚ æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGroup åªæ˜¯ç”¨æ¥è¾…åŠ©å¸ƒå±€çš„ï¼Œå®ƒæœ¬èº«å¹¶ä¸ä¼šç”Ÿæˆä»»ä½•è§†å›¾ã€‚æ‰€ä»¥å°½ç®¡åœ¨æœ¬ç¤ºä¾‹ä¸­å®ƒçš„é«˜åº¦åªæœ‰ 300ï¼Œä¸è¶³ UICollectionView çš„é«˜åº¦ï¼Œä½†æ˜¯ Item ä¾ç„¶ä¼šå……æ»¡æ•´ä¸ª UICollectionViewï¼Œè€Œä¸æ˜¯ä»…ä»…åœ¨é«˜åº¦ä¸º 300 çš„èŒƒå›´å†…è¿›è¡Œæ»‘åŠ¨ã€‚ æˆ‘å¹¶ä¸èƒ½è‚¯å®šè¿™ç§ç°è±¡å¯ä»¥ç§°ä¹‹ä¸º â€œå¿½ç•¥ Group çš„ layoutSizeâ€ï¼Œæ‰€ä»¥æ²¡æœ‰ä½¿ç”¨è¿™ç§è¡¨è¿°ã€‚ æ€»ç»“ è¿™ä¸¤ç§åˆå§‹åŒ–æ–¹å¼å„æœ‰å„çš„ç”¨é€”ï¼š åœ¨ä¸è€ƒè™‘åµŒå¥—å¸ƒå±€ï¼ˆGroup ä¸­åµŒå¥— Item å’Œ Groupï¼‰çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ç§å¸ƒå±€çš„ä½¿ç”¨åœºæ™¯å¤§ä½“ä¸Šä¸€è‡´ï¼Œåªéœ€è¦æ³¨æ„å„è‡ªå¯¹ Item å¤§å°çš„è®¡ç®—è§„åˆ™å³å¯ã€‚ç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘è‡ªå·±ä¼šé€‰æ‹© subitems çš„åˆå§‹åŒ–æ–¹å¼ï¼Œå› ä¸º Item çš„å¤§å°è®¡ç®—è§„åˆ™æ›´ä¸ºç›´è§‚ã€‚ ä½†æ˜¯åœ¨åµŒå¥—å¸ƒå±€çš„å‰æä¸‹ï¼Œè¿™ä¸¤ç§åˆå§‹åŒ–æ–¹å¼å°±ä¼šæœ‰æ¯”è¾ƒå¤§çš„å·®å¼‚ã€‚ é¦–å…ˆåµŒå¥—å¸ƒå±€çš„æœ€å¤–å±‚åªèƒ½ä½¿ç”¨ subitems çš„æ–¹å¼åˆå§‹åŒ–ï¼Œæ•°ç»„ä¸­åŒ…å«å¤šç§ä¸åŒçš„ Item æˆ–è€… Groupã€‚ å…¶æ¬¡å¦‚æœéœ€è¦æŒ‡å®š Item çš„æ•°é‡ï¼Œé‚£ä¹ˆå°±åªèƒ½ä½¿ç”¨ subitem + count çš„åˆå§‹åŒ–å½¢å¼ã€‚ è€ƒè™‘ä¸‹å›¾çš„åœºæ™¯ï¼š å¦‚æœç°åœ¨è¦æ±‚é¡¶éƒ¨çš„æ ‡é¢˜ã€ä¸­é—´çš„å·¥å…·å’Œä¸‹æ–¹çš„ç°è‰²åˆ†éš”æ¡ï¼Œä¸‰éƒ¨åˆ†æ”¾åˆ°ä¸€ä¸ª NSCollectionLayoutGroup å¯¹è±¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ [æ ‡é¢˜Item + å·¥å…·Group + ç°æ¡Item] çš„ç»„åˆå¸ƒå±€å½¢å¼ã€‚ æ­¤æ—¶ â€œå·¥å…·Groupâ€ å°±ä¸èƒ½ä½¿ç”¨ subitems çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–äº†ï¼Œå¿…é¡»è¦æŒ‡å®šå·¥å…·çš„æ•°é‡ï¼Œå¦åˆ™ UICollectionView ä¼šæŠŠä¸‹æ–¹çš„ç°æ¡ä¹Ÿèåˆ°å·¥å…· Group ä¸­ã€‚ ","link":"https://blog.rakuyoo.top/notes-of-nscollectionlayoutgroup/"},{"title":"NSCollectionLayoutSection æ³¨æ„äº‹é¡¹ä¹‹ orthogonalScrollingBehavior","content":"æœ¬ç¯‡æ–‡ç« è®°å½•ä½¿ç”¨ NSCollectionLayoutSection ç±»çš„ orthogonalScrollingBehavior å±æ€§çš„è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚ é€šè¿‡è®¾ç½®è¯¥å±æ€§å¯ä»¥æ§åˆ¶å¯¹åº” Section çš„æ»‘åŠ¨æ•ˆæœã€‚ åœ¨é˜…è¯»ä»¥ä¸‹å†…å®¹æ—¶ï¼Œæˆ‘å°†é»˜è®¤æ‚¨å·²ç»æŒæ¡äº† UICollectionViewCompositionalLayout çš„åŸºç¡€ç”¨æ³•ï¼Œä¸å†å¯¹ä¸€äº›ç»†èŠ‚è¿›è¡Œè¡¥å……è¯´æ˜ã€‚ Orthogonal Scroll View è¿™ä¸€èŠ‚æˆ‘ä»¬ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªç³»ç»Ÿçš„ç§æœ‰ç±»å‹ï¼š_UICollectionViewOrthogonalScrollView å’Œ _UICollectionViewOrthogonalScrollerEmbeddedScrollView å› ä¸ºè¿™ä¸¤ä¸ªç±»å‹çš„åç§°å¤ªé•¿ï¼ŒåŒæ—¶ä¼šå¤šæ¬¡é‡å¤æåŠï¼Œæ•…ä¸‹æ–‡ä½¿ç”¨ _UIOrthogonalScrollView ä»£æ›¿ã€‚ è¿™ä¸¤ä¸ªç±»å‹å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªï¼Œæ—©æœŸ Apple ä½¿ç”¨çš„æ˜¯ _UICollectionViewOrthogonalScrollerEmbeddedScrollView è¿™ä¸ªåç§°ï¼ŒåæœŸåœ¨æŸä¸ªç‰ˆæœ¬ä¸­æ”¹ä¸º _UICollectionViewOrthogonalScrollViewã€‚ orthogonalScrollingBehavior çš„é»˜è®¤å€¼æ˜¯ .noneï¼Œå½“æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºå…¶ä»–å€¼åï¼Œç³»ç»Ÿå°±ä¼šåœ¨ UICollectionView ä¸Šæ·»åŠ ä¸€å±‚ç±»å‹ä¸º _UIOrthogonalScrollView çš„ UIScrollView å­ç±»ä½œä¸º Cell çš„çˆ¶è§†å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ­¤æ—¶ Cell çš„çˆ¶è§†å›¾ä¸å†æ˜¯ UICollectionVIewã€‚ æˆ‘ä»¬æµ‹è¯•è¿‡ä»¥ä¸‹æƒ…å†µï¼š UICollectionViewCompositionalLayout åªæœ‰ä¸€ç§å¸ƒå±€ã€‚ NSCollectionLayoutGroup çš„æ»‘åŠ¨æ–¹å‘å’Œ UICollectionView çš„æ»‘åŠ¨æ–¹å‘ä¸€è‡´æˆ–ä¸ä¸€è‡´ã€‚ NSCollectionLayoutSection çš„å°ºå¯¸å’Œ UICollectionView ç›¸ç­‰æˆ–ä¸ç›¸ç­‰ã€‚ åœ¨è¿™ä¸‰ç§æƒ…å†µä¸‹ï¼Œåªè¦ä¿®æ”¹äº† orthogonalScrollingBehavior å±æ€§ï¼Œå°±ä¼šæ·»åŠ  _UIOrthogonalScrollView è§†å›¾ã€‚ åœ¨æ­£å¼å±•å¼€è¯´æ˜ä¹‹å‰æ’ä¸€å¥ï¼šæœ¬æ–‡åé¢æ‰€æåŠçš„å†…å®¹ï¼Œéƒ½æ˜¯åœ¨ä¸‹é¢è¿™ä¸ªå¸ƒå±€çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹çš„ï¼š let itemSize = NSCollectionLayoutSize( widthDimension: .fractionalWidth(1/3), heightDimension: .absolute(50)) let item = NSCollectionLayoutItem(layoutSize: itemSize) let group = NSCollectionLayoutGroup.horizontal( layoutSize: .init( widthDimension: .fractionalWidth(1), heightDimension: .fractionalHeight(0.5)), subitems: [item]) let section = NSCollectionLayoutSection(group: group) return section è·å–æ—¶æœº é‚£ä¹ˆè¯¥å¦‚ä½•è·å–è¯¥è§†å›¾å‘¢ï¼Œç»è¿‡ä¸å®Œå…¨æµ‹è¯•ï¼Œåˆ—è¡¨ä¸åŒ…å«ä»»ä½• Cell æ—¶ï¼Œä¸ä¼šæ·»åŠ è¯¥è§†å›¾ã€‚ è¯¥è§†å›¾å¯åœ¨ viewDidLayoutSubviews æ–¹æ³•ä¸­é€šè¿‡éå†å­è§†å›¾è·å¾—ã€‚ /// `orthogonalScrollView` å¯èƒ½çš„ç±»å‹ /// /// ç›®å‰å°šæ— æ³•ç¡®å®šå“ªä¸ªç‰ˆæœ¬çš„ç³»ç»Ÿä½¿ç”¨äº†å“ªä¸ªç±»å‹ï¼Œæ‰€ä»¥ä¸ºäº†ç¨³å¦¥èµ·è§ï¼Œä½¿ç”¨æ•°ç»„è¿›è¡Œåˆ¤æ–­ private var orthogonalScrollViewTypes: [String] { [ &quot;_UICollectionViewOrthogonalScrollView&quot;, &quot;_UICollectionViewOrthogonalScrollerEmbeddedScrollView&quot; ] } var orthogonalScrollView: UIScrollView? { subviews.first { orthogonalScrollViewTypes.contains(&quot;\\(type(of: $0))&quot;) } as? UIScrollView } clipsToBounds _UIOrthogonalScrollView çš„ clipsToBounds å±æ€§é»˜è®¤æ˜¯ falseï¼Œè¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼š å¦‚æœæ‚¨çš„ Section è®¾ç½®äº† contentInsets ä¹‹ç±»çš„å±æ€§ï¼Œå¯¼è‡´æ¯” UICollectionView å°ï¼Œé‚£ä¹ˆåœ¨æ»‘åŠ¨ _UIOrthogonalScrollView çš„æ—¶å€™ï¼Œå…¶å†…å®¹ä¼šè¶…å‡º Section çš„èŒƒå›´ã€‚ iOS 15 åŠä»¥ä¸Š _UIOrthogonalScrollView æ˜¯ä¸¥æ ¼è·Ÿç€ Section èŒƒå›´èµ°çš„ï¼Œä¾‹å¦‚ä¸‹å›¾ï¼š è“è‰²é€‰ä¸­çš„èŒƒå›´æ˜¯ _UIOrthogonalScrollViewï¼Œå¯ä»¥çœ‹åˆ°æ»‘åŠ¨çš„æ—¶å€™ Cell æ˜æ˜¾è¶…å‡ºäº†å®ƒçš„èŒƒå›´ã€‚ ä¸Šæ–‡æœ‰æåˆ°è·å– _UIOrthogonalScrollView çš„æ—¶æœºï¼Œæ‚¨å¯ä»¥åœ¨è·å–åé€šè¿‡æ‰‹åŠ¨å°† clipsToBounds è®¾ç½®ä¸º ture æ¥è§£å†³è¯¥é—®é¢˜ã€‚ iOS 15 ä»¥ä¸‹ ç»ä¸å®Œå…¨æµ‹è¯•ï¼ŒiOS 14.7.1 åŠä»¥ä¸‹ç‰ˆæœ¬ç¬¦åˆè¯¥å°èŠ‚å†…å®¹ã€‚iOS 14.7.1 - iOS 15 ä¹‹é—´çš„ç‰ˆæœ¬æ²¡æœ‰ç»è¿‡æµ‹è¯•ï¼Œä¸ç¡®å®šç¬¦åˆä¸Šä¸€å°èŠ‚è¿˜æ˜¯è¯¥å°èŠ‚ã€‚ _UIOrthogonalScrollView çš„èŒƒå›´æ˜¯è·Ÿç€ UICollectionView èµ°çš„ï¼Œç”±ä¸‹å›¾æ‰€ç¤ºï¼š å’Œä¸Šä¸€å¼ å›¾å¯¹æ¯”ä¹‹åï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„å‘ç°åŒºåˆ«ï¼ˆä»£ç ç›¸åŒï¼‰ã€‚å€¼å¾—ä¸€æçš„æ˜¯æ­¤æ—¶ _UIOrthogonalScrollView çš„ contentInset æ˜¯ .zero æ­¤æ—¶è®¾ç½® clipsToBounds å°±æ²¡æœ‰ç”¨äº†ã€‚ è·Ÿéšæ»‘åŠ¨ å¦‚æœæ‚¨å‡†å¤‡ç”¨ UICollectionViewCompositionalLayout å®ç°ç±»ä¼¼å¦‚ä¸Šå›¾çš„æ•ˆæœï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ç¡®ä¿æ»‘å—æ˜¯æ·»åŠ åˆ° _UIOrthogonalScrollView ä¸Šã€‚ è€ƒè™‘åˆ°è¯¥è§†å›¾çš„è·å–æ—¶æœºï¼Œæˆ‘å»ºè®®æ‚¨è¿˜æ˜¯æ”¹ç”¨ UICollectionViewFlowLayout å®ç°ã€‚ .continuous åŸæœ¬ä»¥ä¸ºé…åˆ UICollectionLayoutSectionOrthogonalScrollingBehavior.continuousï¼Œæœ€ç»ˆå¯ä»¥è¾¾åˆ°å’Œ UICollectionViewCompositionalLayout ä¸€æ ·çš„æ•ˆæœï¼Œä½†æ˜¯äº‹å®æ˜¯å¹¶ä¸ä¼šã€‚ æœ¬æ–‡ä½¿ç”¨çš„ä¾‹å­é‡ŒåŒ…å«ä¸€ä¸ªæ¨ªæ»‘çš„ groupï¼Œitem çš„å®½åº¦æ˜¯ group çš„ 1/3ï¼Œgroup çš„å®½åº¦å’Œ UICollectionView å®½åº¦ä¸€è‡´ã€‚ä½†æ˜¯å¦‚æœæŠŠ item çš„å®½åº¦æ”¹ä¸ºæŸä¸ªå›ºå®šçš„å€¼ï¼Œä¾‹å¦‚ 50ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç°ï¼šå±å¹•ä¸Šåªä¼šæ˜¾ç¤ºå®Œæ•´çš„ Cellã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å³ä¾§å‰©ä½™çš„å®½åº¦ä¸å¤Ÿç¬¬å››ä¸ª Cell æ˜¾ç¤ºå‡ºæ¥ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šéšè—æ‰ï¼Œåœ¨åé¢å†æ˜¾ç¤ºï¼š å¦‚æœä¸ä¿®æ”¹ orthogonalScrollingBehaviorï¼ˆå³å€¼ä¸º .noneï¼‰ï¼Œåˆ™ä¸ä¼šæœ‰è¯¥é—®é¢˜ï¼Œä½†æ˜¯ Cell åœ¨è¶…å‡ºå±å¹•åä¼šæ¢è¡Œå±•ç¤ºï¼Œå› ä¸ºæ²¡æœ‰ _UIOrthogonalScrollView ... æ‰€ä»¥å»ºè®®è¿™ç§éœ€æ±‚è¿˜æ˜¯ä½¿ç”¨ UICollectionViewFlowLayout ç»„åˆå®ç°ã€‚ æˆ–è€…æ‚¨çŸ¥é“ä»€ä¹ˆæ›´å¥½çš„æ–¹å¼ï¼Œè¯·åœ¨è¯„è®ºåŒºç•™è¨€å‘Šè¯‰æˆ‘ï¼Œè°¢è°¢ã€‚ ","link":"https://blog.rakuyoo.top/note-of-orthogonalscrollingbehavior/"},{"title":"fastlane match error: 503","content":"ä½¿ç”¨ match å‘½ä»¤æ›´æ–°å¼€å‘è¯ä¹¦çš„æ—¶å€™ï¼Œé‡åˆ°äº† 503 Service Temporarily Unavailable çš„æŠ¥é”™ï¼Œæœåˆ°è§£å†³æ–¹æ¡ˆåæƒ³ç€è¿˜æ˜¯è®°å½•ä¸€ä¸‹å§ã€‚ æœ¬æ–‡è½¬è½½è‡ª Fastlane 503 Service Temporarily Unavailable ç©¶å…¶åŸå› æ˜¯å› ä¸º match å‘½ä»¤è°ƒç”¨ Apple æœåŠ¡å¤ªé¢‘ç¹/é‡è¿‡å¤§ï¼Œå¯¼è‡´ 503 æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚ æ­¤æ—¶å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œæ¸…é™¤ fastlane spaceship çš„ cookie æ¥è¾¾åˆ°é‡åˆ¶çš„ç›®çš„ï¼š rm $HOME/.fastlane/spaceship/*/cookie ä¹‹åé‡æ–°è°ƒç”¨ fastlane match å‘½ä»¤å³å¯ã€‚ ","link":"https://blog.rakuyoo.top/fastlane-match-error-503/"},{"title":"VPN é…ç½®åœ¨ iOS å’Œ macOS ä¸‹çš„åŒºåˆ«","content":"æœ€è¿‘å°è¯•ä½¿ç”¨ Mac Catalyst å°† App ç§»æ¤åˆ° macOS ä¸Šï¼Œæ‰“åŒ…æ—¶é‡åˆ°äº†è¯¥é—®é¢˜ï¼Œæ•…è®°å½•ä¸€ä¸‹ã€‚ åœ¨ .entitlements æ–‡ä»¶ä¸­ï¼Œéœ€è¦ä½¿ç”¨ key com.apple.developer.networking.networkextension æ¥æ ‡è®°éœ€è¦ VPN æƒé™ã€‚ ä½†æ˜¯è¿™ä¸ª key çš„å€¼åœ¨ iOS å’Œ macOS ä¸Šæ˜¯ä¸åŒçš„ï¼š iOSï¼špacket-tunnel-provider macOSï¼špacket-tunnel-provider-systemextension åŒºåˆ«å°±åœ¨äº macOS ä¸‹å¤šäº† -systemextension è¿™éƒ¨åˆ†ï¼Œæ‰€ä»¥å¦‚æœ App æä¾› VPN åŠŸèƒ½ï¼Œé‚£ä¹ˆ Mac Catalyst å’Œé Mac Catalyst çš„ Settings å°±ä¸èƒ½ä½¿ç”¨åŒä¸€ä»½ .entitlements æ–‡ä»¶äº†ã€‚ ","link":"https://blog.rakuyoo.top/difference-between-vpn-entitlement-config-in-ios-and-macos/"},{"title":"Combine æ“ä½œç¬¦é€ŸæŸ¥è¡¨","content":"æ–‡ç« ä»¥å›¾æ–‡çš„å½¢å¼ï¼Œè®°å½• Combine ä¸­å„æ“ä½œç¬¦çš„ç”¨æ³•ä»¥åŠæ•ˆæœã€‚ä¸‹æ–‡ä¸ºåŸæ–‡ç« å†…å®¹çš„è½¬è½½ + ç¿»è¯‘ã€‚ æœ¬æ–‡è½¬è½½è‡ª Cheat sheet on s for iOS development ç‚¹å‡»æŸ¥çœ‹åŸæ–‡ä»¥æ›´å¥½çš„æ•ˆæœæŸ¥çœ‹å†…å®¹ã€‚ allSatisfy(_:) Publishes true if all elements match the condition. Publishes false &amp; completes if it receives an element that does not match the condition. å¦‚æœæ‰€æœ‰çš„å…ƒç´ éƒ½ç¬¦åˆæ¡ä»¶ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœæ”¶åˆ°ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œåˆ™è¿”å› false å¹¶å®Œæˆä¿¡å·ã€‚ append(_:) Appends the specified elements after the upstream publisher completes. åœ¨ä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆåæ·»åŠ æŒ‡å®šçš„å…ƒç´ ã€‚ collect(_:) Collects up to the specified number of elements and emits them in an array. æ”¶é›†å¤šè¾¾æŒ‡å®šæ•°é‡çš„å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬å‘å°„åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ combineLatest(_:) Publishes a tuple of the most recent element from multiple publishers when any of them emits a value. å½“ä»»ä½•ä¸€ä¸ªå‘å¸ƒè€…å‘å‡ºä¸€ä¸ªå€¼æ—¶ï¼Œå‘å¸ƒä¸€ä¸ªæ¥è‡ªå¤šä¸ªå‘å¸ƒè€…çš„æœ€æ–°å…ƒç´ çš„å…ƒç»„ã€‚ compactMap(_:) Transforms each element with the provided closure and publishes any returned non-nil optional result. ç”¨æä¾›çš„é—­åŒ…å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œè½¬æ¢ï¼Œå¹¶å…¬å¸ƒä»»ä½•è¿”å›çš„éé›¶çš„å¯é€‰ç»“æœã€‚ contains(_:) Publishes true &amp; completes after receiving a matching value, or false when upstream publisher completes without producing a matching value. åœ¨æ”¶åˆ°ä¸€ä¸ªåŒ¹é…çš„å€¼åå‘å¸ƒçœŸå€¼&amp;å®Œæˆï¼Œæˆ–è€…åœ¨ä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆåæ²¡æœ‰äº§ç”Ÿä¸€ä¸ªåŒ¹é…çš„å€¼æ—¶å‘å¸ƒå‡å€¼ã€‚ count() Publishes the count of all received elements when the upstream publisher completes. å½“ä¸Šæ¸¸å‘å¸ƒå™¨å®Œæˆæ—¶ï¼Œå‘å¸ƒæ‰€æœ‰æ”¶åˆ°çš„å…ƒç´ çš„è®¡æ•°ã€‚ dropFirst(_:) Omits a specified number of elements, then republishes all remaining elements. çœç•¥æŒ‡å®šæ•°é‡çš„å…ƒç´ ï¼Œç„¶åé‡æ–°å‘å¸ƒæ‰€æœ‰å‰©ä½™çš„å…ƒç´ ã€‚ drop(while:) Omits elements until a given closure returns false, then republishes all remaining elements. çœç•¥å…ƒç´ ï¼Œç›´åˆ°ä¸€ä¸ªç»™å®šçš„é—­åŒ…è¿”å›é”™è¯¯ï¼Œç„¶åé‡æ–°å‘å¸ƒæ‰€æœ‰å‰©ä½™çš„å…ƒç´ ã€‚ filter(_:) Republishes all elements that match a provided closure. é‡æ–°å‘å¸ƒæ‰€æœ‰ç¬¦åˆæ‰€æä¾›çš„é—­åŒ…çš„å…ƒç´ ã€‚ first() Publishes the first element of the upstream publisher, then completes. å‘å¸ƒä¸Šæ¸¸å‘å¸ƒå™¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå®Œæˆã€‚ first(where:) Publishes the first element of a stream that satisfies a condition, then completes. å‘å¸ƒä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æµçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå®Œæˆã€‚ flatMap(maxPublishers:_:) Transforms all elements from an upstream publisher into a new publisher. å°†ä¸Šæ¸¸å‘å¸ƒå™¨ä¸­çš„æ‰€æœ‰å…ƒç´ è½¬åŒ–ä¸ºä¸€ä¸ªæ–°çš„å‘å¸ƒå™¨ã€‚ ignoreOutput() Ignores all elements and passes along only the upstream publisher's completion state. å¿½ç•¥æ‰€æœ‰å…ƒç´ ï¼Œåªä¼ é€’ä¸Šæ¸¸å‘å¸ƒè€…çš„å®ŒæˆçŠ¶æ€ã€‚ last() Publishes the last element of the upstream publisher after it completes. åœ¨ä¸Šæ¸¸å‘å¸ƒå™¨å®Œæˆåï¼Œå‘å¸ƒå®ƒçš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ last(where:) Publishes the last element that satisfies a condition after the upstream publisher completes. åœ¨ä¸Šæ¸¸å‘å¸ƒå™¨å®Œæˆåï¼Œå‘å¸ƒæ»¡è¶³æ¡ä»¶çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ map(_:) Transforms each element it receives from the upstream publisher with the provided closure. ç”¨æ‰€æä¾›çš„é—­åŒ…å¯¹å®ƒä»ä¸Šæ¸¸å‘å¸ƒè€…é‚£é‡Œæ”¶åˆ°çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œè½¬æ¢ã€‚ max() Publishes the maximum value received after the upstream publisher completes. åœ¨ä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆåï¼Œå‘å¸ƒæ”¶åˆ°çš„æœ€å¤§å€¼ã€‚ merge(with:) Publishes an element whenever any of the upstream publishers emits an element. æ¯å½“ä»»ä½•ä¸€ä¸ªä¸Šæ¸¸å‘å¸ƒè€…å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå°±å‘å¸ƒä¸€ä¸ªå…ƒç´ ã€‚ min() Publishes the minimum value received after the upstream publisher completes. å‘å¸ƒä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆåæ”¶åˆ°çš„æœ€å°å€¼ã€‚ output(at:) Republishes an element specified by its position, or completes if upstream publisher completes before the specified element. é‡æ–°å‘å¸ƒä¸€ä¸ªç”±å…¶ä½ç½®æŒ‡å®šçš„å…ƒç´ ï¼Œå¦‚æœä¸Šæ¸¸å‘å¸ƒè€…åœ¨æŒ‡å®šçš„å…ƒç´ ä¹‹å‰å®Œæˆï¼Œåˆ™å®Œæˆã€‚ output(in:) Republishes elements specified by a range of positions. é‡æ–°å‘å¸ƒç”±æŸä¸ªä½ç½®èŒƒå›´æŒ‡å®šçš„å…ƒç´ ã€‚ prefix(_:) Republishes elements up to a specified maximum count. é‡æ–°å‘å¸ƒå…ƒç´ ï¼Œç›´åˆ°æŒ‡å®šçš„æœ€å¤§æ•°é‡ã€‚ prefix(while:) Emits values while elements meet the specified condition, otherwise it completes. å½“å…ƒç´ æ»¡è¶³æŒ‡å®šçš„æ¡ä»¶æ—¶å‘å‡ºæ•°å€¼ï¼Œå¦åˆ™å°±ä¼šå®Œæˆã€‚ prepend(_:) Prepends elements with the specified values. ç”¨æŒ‡å®šçš„å€¼å¯¹å…ƒç´ è¿›è¡Œé¢„ç½®ã€‚ reduce(_:_:) Applies a closure to all elements and publishes a final result when the upstream publisher completes. å¯¹æ‰€æœ‰å…ƒç´ åº”ç”¨ä¸€ä¸ªé—­åŒ…ï¼Œå¹¶åœ¨ä¸Šæ¸¸å‘å¸ƒå™¨å®Œæˆåå‘å¸ƒä¸€ä¸ªæœ€ç»ˆç»“æœã€‚ removeDuplicates() Publishes an element only if it doesn't match the previous element. åªåœ¨ä¸€ä¸ªå…ƒç´ ä¸å‰ä¸€ä¸ªå…ƒç´ ä¸åŒ¹é…æ—¶æ‰å‘å¸ƒã€‚ replaceNil(with:) Replaces nil elements with the provided element. ç”¨æ‰€æä¾›çš„å…ƒç´ æ›¿æ¢nilå…ƒç´ ã€‚ scan(_:_:) Transforms elements by applying a closure that receives its previous return value and the next element from the upstream publisher. é€šè¿‡åº”ç”¨ä¸€ä¸ªé—­åŒ…æ¥è½¬æ¢å…ƒç´ ï¼Œè¯¥é—­åŒ…ä»ä¸Šæ¸¸å‘å¸ƒè€…é‚£é‡Œæ¥æ”¶å…¶å…ˆå‰çš„è¿”å›å€¼å’Œä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ switchToLatest() Republishes elements sent by the most recently received publisher. é‡æ–°å‘å¸ƒç”±æœ€è¿‘æ”¶åˆ°çš„å‘å¸ƒè€…å‘é€çš„å…ƒç´ ã€‚ zip(_:) Waits until both publishers emit an element, then publishes the oldest unconsumed element from each one as a tuple. ç­‰å¾…ï¼Œç›´åˆ°ä¸¤ä¸ªå‘å¸ƒè€…éƒ½å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå°†æ¯ä¸ªå‘å¸ƒè€…ä¸­æœ€å¤è€çš„æœªè¢«å¸æ”¶çš„å…ƒç´ ä½œä¸ºä¸€ä¸ªå…ƒç»„å‘å¸ƒã€‚ ","link":"https://blog.rakuyoo.top/cheatsheet-combine-operators/"},{"title":"GitLab-CIï¼ˆä¸‰ï¼‰ï¼šé…ç½® GitLab-Runner","content":" æœ¬æ–‡é’ˆå¯¹ GitLab-Runner çš„é…ç½®è¿›è¡Œè®²è§£è¯´æ˜ã€‚ GitLab-CI ç³»åˆ—æ–‡ç« ç›®å‰æœ‰ä¸‰ç¯‡ï¼Œä¸»è¦è®²è§£ GitLab-CI çš„ç¯å¢ƒæ­å»ºä¸é…ç½®ã€‚æœ¬æ–‡ä¸ºè¯¥ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ã€‚ ç›®å½•ï¼š GitLab-CIï¼ˆä¸€ï¼‰ï¼šæ­å»º iOS CI ç¯å¢ƒ GitLab-CIï¼ˆäºŒï¼‰ï¼šæ³¨å†Œ GitLab-Runner GitLab-CIï¼ˆä¸‰ï¼‰ï¼šé…ç½® GitLab-Runner config.tom æ–‡ä»¶é…ç½® åœ¨ç»ˆç«¯å†…è¾“å…¥ gitlab-runner list å‘½ä»¤ï¼Œè·å–åˆ° config.toml æ–‡ä»¶è·¯å¾„ï¼Œåç»­å°†é’ˆå¯¹è¯¥æ–‡ä»¶è¿›è¡Œè®²è§£è¯´æ˜ã€‚ concurrent è¯¥æ–‡ä»¶é¡¶éƒ¨çš„ concurrent å­—æ®µæ„å‘³ç€æœ¬å°æœºå™¨æœ€å¤šå¯ä»¥åŒæ—¶è¿è¡Œçš„ä½œä¸šæ•°é‡ã€‚ è¯·æ ¹æ®éœ€æ±‚ä¸ CI æœºå™¨çš„æ€§èƒ½ä¿®æ”¹è¯¥å­—æ®µã€‚ ä¾‹å¦‚ concurrent = 2 æ„å‘³ç€ â€œè¯¥å°ç”µè„‘åŒä¸€æ—¶é—´åªèƒ½è¿è¡Œ2ä¸ªä½œä¸šâ€ã€‚è€ƒè™‘åˆ°å®é™…æƒ…å†µï¼ˆä¸€ä¸ªä½œä¸šå¯¹åº”ä¸€ä¸ªæ‰“åŒ…ä»»åŠ¡ï¼‰ï¼Œå³åŒä¸€æ—¶é—´å†…åªèƒ½åŒæ—¶æ‰“2ä¸ªåŒ…ã€‚ å»ºè®®8gå†…å­˜çš„æœºå™¨å°†è¯¥å€¼è®¾ç½®ä¸º2ï¼Œä»¥ä¸Šå†…å­˜çš„æœºå™¨å¯å°†è¯¥å€¼è®¾ç½®ä¸º4ã€‚ runners name å³æ³¨å†Œ Runner æ—¶å¡«å†™çš„ descriptionï¼Œå¯é€šè¿‡ä¿®æ”¹è¯¥å€¼è¾¾åˆ°ä¿®æ”¹ Runner åç§°çš„ç›®çš„ã€‚ åœ¨ä¸‹æ–‡ä»‹ç»çš„æè¿°ä¸­ï¼Œä¹Ÿå¯ä¿®æ”¹ã€‚ åœ¨ GitLab - CI/CD ç•Œé¢é…ç½® æ‰¾åˆ°ç¾¤ç»„/é¡¹ç›®å·¦ä¾§å¯¼èˆªæ æœ€ä¸‹æ–¹çš„è®¾ç½®æŒ‰é’®ï¼Œä¾æ¬¡é€‰æ‹© â€œè®¾ç½®ï¼ˆSettingsï¼‰ -&gt; CI/CD -&gt; Runnersâ€ï¼Œè¿›å…¥ Runner è®¾ç½®é¡µé¢ã€‚ æ‰¾åˆ°éœ€è¦ç¼–è¾‘/é…ç½®çš„ Runnerï¼Œç‚¹å‡»å³ä¾§é“…ç¬”å½¢çŠ¶çš„ â€œç¼–è¾‘æŒ‰é’®â€ï¼Œè¿›å…¥ç¼–è¾‘é¡µé¢ã€‚ å¯ç”¨ é€šè¿‡å‹¾é€‰æˆ–å–æ¶ˆå‹¾é€‰è¯¥é€‰é¡¹ï¼Œå¯å¼€å¯/å…³é—­è¯¥ Runnerï¼Œè¢«å…³é—­çš„ Runner å°†æ— æ³•æ¥æ”¶æ–°çš„ä»»åŠ¡ã€‚ æè¿° å³æ³¨å†Œ Runner æ—¶å¡«å†™çš„ descriptionï¼Œå¯é€šè¿‡ä¿®æ”¹è¯¥å€¼è¾¾åˆ°ä¿®æ”¹ Runner åç§°çš„ç›®çš„ã€‚ æœ€å¤§ä½œä¸šè¶…æ—¶ å¯è®¾ç½®ä»»åŠ¡è¶…æ—¶æ—¶é—´ã€‚ è¶…æ—¶æ—¶é—´æœ‰3ç§ï¼š Runner å¤„é…ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œå³æ­¤å¤„é…ç½®çš„è¶…æ—¶æ—¶é—´ã€‚ä¼˜å…ˆçº§æœ€é«˜ã€‚ Git é¡¹ç›®çš„è¶…æ—¶æ—¶é—´ï¼Œå¯åœ¨ â€œè®¾ç½®ï¼ˆSettingsï¼‰ -&gt; CI/CD -&gt; æµæ°´çº¿é€šç”¨è®¾ç½®â€ å¤„è¿›è¡Œè®¾ç½®ã€‚ä¼˜å…ˆçº§æœ€ä½ã€‚ ä»»åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œåœ¨å…·ä½“çš„ .yml æ–‡ä»¶ä¸­è®¾ç½®ã€‚ä¼˜å…ˆçº§å±…ä¸­ã€‚ ä¾‹å¦‚ï¼š Runner é…ç½®äº† 2å°æ—¶ è¶…æ—¶ è¯¥ git é¡¹ç›®é…ç½®äº† 1å°æ—¶ è¶…æ—¶ æ‰€è¦æ‰§è¡Œçš„ä»»åŠ¡é…ç½®äº† 1.5å°æ—¶ è¶…æ—¶ åˆ™ä½¿ç”¨è¯¥ Runner æ‰§è¡Œçš„ä»»åŠ¡çš„æœ€ç»ˆè¶…æ—¶æ—¶é—´ä¸º 1.5 å°æ—¶ã€‚ æ ‡ç­¾ å¯é…ç½®è¯¥ Runner å¯æ¥æ”¶çš„ä»»åŠ¡çš„æ ‡ç­¾ã€‚ä¸€ä¸ª Runner å¯ä»¥è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼Œä¹‹é—´ç”¨ , å·è¿›è¡Œåˆ†å‰²ã€‚ åªæœ‰å½“ Runner çš„æ ‡ç­¾åˆ—è¡¨åŒ…å«å°†è¦æ‰§è¡Œçš„ä»»åŠ¡çš„æ ‡ç­¾æ—¶ï¼Œæ‰ä¼šé€‰æ‹©è¯¥ Runner å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚å¦åˆ™å³ä½¿è¯¥ Runer å¤„äºç©ºé—²çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šè¢«ä½¿ç”¨ã€‚ ","link":"https://blog.rakuyoo.top/gitlab-ci-config-runner/"},{"title":"GitLab-CIï¼ˆäºŒï¼‰ï¼šæ³¨å†Œ GitLab-Runner","content":" æœ¬æ–‡ä»…é’ˆå¯¹ macOS å’Œ Linux å¹³å°ï¼Œè®²è§£å¦‚ä½•æ³¨å†Œ GitLab-Runnerã€‚Windows å¹³å°ä¸åŒ…å«åœ¨æœ¬æ–‡ä»‹ç»èŒƒå›´å†…ã€‚ GitLab-CI ç³»åˆ—æ–‡ç« ç›®å‰æœ‰ä¸‰ç¯‡ï¼Œä¸»è¦è®²è§£ GitLab-CI çš„ç¯å¢ƒæ­å»ºä¸é…ç½®ã€‚æœ¬æ–‡ä¸ºè¯¥ç³»åˆ—çš„ç¬¬äºŒç¯‡ã€‚ ç›®å½•ï¼š GitLab-CIï¼ˆä¸€ï¼‰ï¼šæ­å»º iOS CI ç¯å¢ƒ GitLab-CIï¼ˆäºŒï¼‰ï¼šæ³¨å†Œ GitLab-Runner GitLab-CIï¼ˆä¸‰ï¼‰ï¼šé…ç½® GitLab-Runner Runner çš„åˆ†ç±» Runner æŒ‰ç…§é€‚ç”¨èŒƒå›´åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š é¡¹ç›® Runnerï¼šä»…æŸä¸ªé¡¹ç›®å¯ä»¥ä½¿ç”¨è¯¥ Runnerï¼Œå…¶ä»–é¡¹ç›®ä¸å¯ä½¿ç”¨ã€‚ ç¾¤ç»„ Runnerï¼šæŸä¸ªç¾¤ç»„ä¸‹çš„é¡¹ç›®éƒ½å¯ä»¥ä½¿ç”¨è¯¥ Runnerï¼Œå…¶ä»–ç¾¤ç»„ä¸‹çš„é¡¹ç›®ä¸å¯ä½¿ç”¨ã€‚ å…±äº« Runnerï¼šæ•´ä¸ª GitLab ç³»ç»Ÿä¸­çš„æ‰€æœ‰é¡¹ç›®éƒ½å¯ä»¥ä½¿ç”¨è¯¥ Runnerã€‚ æ³¨å†Œ Runner å‰æœŸå‡†å¤‡ æ‰“å¼€å¹¶ç™»å½• GitLabã€‚ æ€è€ƒä½ éœ€è¦æ³¨å†Œå“ªç§ Runnerã€‚ å¦‚æœä½ éœ€è¦æ³¨å†Œç¬¬ä¸€ç§ â€œé¡¹ç›® Runnerâ€ï¼Œé‚£ä¹ˆä½ éœ€è¦æ‰“å¼€æŸä¸ªå…·ä½“çš„ git é¡¹ç›®ã€‚ å¦‚æœä½ éœ€è¦æ³¨å†Œç¬¬äºŒç§ â€œç¾¤ç»„ Runnerâ€ï¼Œé‚£ä¹ˆä½ éœ€è¦æ‰“å¼€æŸä¸ªå…·ä½“çš„ç¾¤ç»„ã€‚ æ‰¾åˆ°å·¦ä¾§å¯¼èˆªæ æœ€ä¸‹æ–¹çš„è®¾ç½®æŒ‰é’®ï¼Œä¾æ¬¡é€‰æ‹© â€œè®¾ç½®ï¼ˆSettingsï¼‰ -&gt; CI/CD -&gt; Runnersâ€ã€‚ ç‚¹å‡» Runner å³ä¾§çš„ â€œå±•å¼€â€ æŒ‰é’®ã€‚ åœ¨å±•å¼€å†…å®¹çš„å·¦ä¾§ï¼Œæ‰¾åˆ° â€œSet up a specific Runner manuallyâ€ ä¸­çš„å†…å®¹ã€‚ åç»­å°†ä½¿ç”¨ â€œSet up a specific Runner manuallyâ€ ä¸­çš„å†…å®¹æ³¨å†Œ Runnerã€‚ æ³¨å†Œ åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¼€å§‹æ³¨å†Œæµç¨‹ï¼š æ³¨æ„ï¼š å¦‚æœæ˜¯åœ¨ Linux å¹³å°ä¸Šæ³¨å†Œï¼Œè¯·ä½¿ç”¨ sudo æ‰§è¡Œ register å‘½ä»¤ï¼ŒmacOS åˆ™ç›´æ¥æ‰§è¡Œä¸‹æ–¹å‘½ä»¤å³å¯ã€‚ gitlab-runner register é’ˆå¯¹é¡¶éƒ¨é»„è‰²WARNINGè­¦å‘Šçš„è¯´æ˜è¯·å‚è€ƒï¼šé¡¶éƒ¨é»„è‰²WARNINGè­¦å‘Šã€‚ 1. è¾“å…¥ GitLab URL æ‰§è¡Œå®Œå‘½ä»¤åï¼Œé¦–å…ˆè¦æ±‚è¾“å…¥ GitLab çš„ urlã€‚å¡«å…¥ä½ ä»¬ GitLab çš„åœ°å€å³å¯ã€‚ ç»†å¿ƒçš„ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œâ€œSet up a specific Runner manuallyâ€ ä¸­çš„ url æ˜¯ httpï¼Œè¿™é‡Œå†™çš„å´æ˜¯ httpsã€‚ å…¶å®æ­£ç¡®çš„åº”è¯¥æ˜¯ httpsã€‚å¦‚æœä½ ä½¿ç”¨ http è¿›è¡Œæ³¨å†Œï¼Œé‚£ä¹ˆè¿›è¡Œåˆ°æœ€åä½ å°†æ”¶åˆ° â€œè®¤è¯å¤±è´¥â€ çš„é”™è¯¯ã€‚ 2. è¾“å…¥ Token è¿™é‡Œçš„ token æ¥è‡ª â€œå‰æœŸå‡†å¤‡â€ ä¸€èŠ‚ä¸­ â€œSet up a specific Runner manuallyâ€ é‡Œæ˜¾ç¤ºçš„ Tokenã€‚ å¤åˆ¶è¯¥ token å¹¶è´´å…¥è¿™é‡Œï¼ŒæŒ‰å›è½¦è¿›å…¥ä¸‹ä¸€æ­¥ã€‚ 3. ç»™ Runner èµ·ä¸€ä¸ªåå­— è¯¥å€¼åç»­å¯è¿›è¡Œä¿®æ”¹ï¼Œè¯¦è§ é…ç½® GitLab-Runner ç¬¬ä¸‰æ­¥è¦æ±‚è¾“å…¥ä¸€ä¸ª description æè¿°ï¼Œå…¶å®ç†è§£ä¸º Runner çš„åå­—ä¼šæ›´å¥½ä¸€ç‚¹ã€‚ ä¸€èˆ¬ä½¿ç”¨è‹±æ–‡ï¼Œä¾‹å¦‚ â€œsever_xxx_ios_project_spareâ€ã€‚ 4. è®¾ç½® Runner çš„æ ‡ç­¾ è¯¥å€¼åç»­å¯è¿›è¡Œä¿®æ”¹ï¼Œè¯¦è§ é…ç½® GitLab-Runner æ ‡ç­¾åˆ—è¡¨ï¼ˆtagï¼‰å†³å®šç€ Runner å¯ä»¥æ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼ˆjobï¼‰ã€‚ åœ¨è¿™ä¸€æ­¥æ‚¨å¯ä»¥è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼Œä¹‹é—´ä½¿ç”¨ , å·åˆ†å‰²å³å¯ã€‚ ä¸€ä¸ªæ¸…æ™°ã€ç®€çŸ­å¹¶ä¸”å¯ä»¥è¡¨è¾¾ Runner èŒè´£çš„æ ‡ç­¾åæ‰æ˜¯ä¸€ä¸ªå¥½çš„æ ‡ç­¾åã€‚ é’ˆå¯¹ tag çš„ç®€å•è¯´æ˜ ä¸Šæ–‡æœ‰æåˆ°ï¼ŒRunner é¦–å…ˆä¼šè¢«é¡¹ç›®ã€ç¾¤ç»„ç­‰èŒƒå›´é™åˆ¶ç€ã€‚ ä½†æ˜¯è¿™æ ·è¿˜ä¸å¤Ÿï¼Œåœ¨ä¸‹é¢è¿™ä¸ªç°å®åœºæ™¯ä¸­ï¼Œå°±ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼š å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªâ€œé¡¹ç›®Runnerâ€ï¼š è¯¥ git é¡¹ç›®è®¾ç½®äº†å¤šä¸ªCI/CDä»»åŠ¡ è¯¥ git é¡¹ç›®å†…è¿˜æ³¨å†Œäº†å¤šä¸ª Runnerï¼Œç”šè‡³è¿˜æœ‰ç»§æ‰¿è‡ªç¾¤ç»„çš„ Runner æ­¤æ—¶å¦‚æœä½ æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œéœ€è¦ä»»åŠ¡Aå¿…é¡»æ‰§è¡Œåœ¨RunnerAä¸Šï¼Œè¯¥å¦‚ä½•åšï¼Ÿ è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ â€œæ ‡ç­¾â€ æ¥åšåˆ°è¿™ç‚¹ï¼Œåªéœ€è¦ç¡®ä¿RunnerAçš„æ ‡ç­¾åŒ…å«ä»»åŠ¡Açš„æ ‡ç­¾å³å¯ã€‚ åªæœ‰å½“ Runner çš„æ ‡ç­¾åˆ—è¡¨åŒ…å«å°†è¦æ‰§è¡Œçš„ä»»åŠ¡çš„æ ‡ç­¾æ—¶ï¼Œæ‰ä¼šé€‰æ‹©è¯¥ Runner å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚å¦åˆ™å³ä½¿è¯¥ Runer å¤„äºç©ºé—²çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šè¢«ä½¿ç”¨ã€‚ 5. æ— è§†è¿™ä¸€æ­¥ ç›´æ¥æŒ‰å›è½¦å³å¯ã€‚ 6. é€‰æ‹©æ‰§è¡Œå™¨ å½“ä½ è¾“å…¥æ­£ç¡®çš„ url å’Œ tokenï¼Œé‚£ä¹ˆä½ å°†æœ€åä¸€æ­¥ï¼šé€‰æ‹© Runner çš„æ‰§è¡Œå™¨ï¼š åœ¨è¿™ä¸€æ­¥è¾“å…¥ä½ æƒ³é€‰æ‹©çš„æ‰§è¡Œå™¨çš„åç§°ï¼Œè¾“å…¥å›è½¦å³å¯å®Œæˆ Runner çš„æ³¨å†Œã€‚ æœ‰å…³æ‰§è¡Œå™¨çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚è€ƒ GitLab çš„å®˜æ–¹æ–‡æ¡£ã€‚è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹æ¯”è¾ƒå¸¸ç”¨çš„ä¸¤ç§æ‰§è¡Œå™¨ï¼šshell å’Œ dockerã€‚ shell shell æ‰§è¡Œå™¨æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š å½“å‰ä»»åŠ¡åœ¨ æœ¬æœºçš„shellç¯å¢ƒ ä¸‹æ‰§è¡Œï¼Œæ„å‘³ç€å½“å‰ä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶å°†ç›´æ¥ç”Ÿæˆåœ¨æœ¬æœºè·¯å¾„å†…ï¼Œä¸éœ€è¦åšä»»ä½•å¤–çš„é…ç½®ï¼Œä»»åŠ¡å°±å¯ä»¥è®¿é—®æœ¬æœºä¸­ä»»æ„æ–‡ä»¶ã€‚ æ¯ä¸ªä»»åŠ¡å’Œæ¯ä¸ªä»»åŠ¡ä¹‹é—´æ²¡æœ‰éš”ç¦»ï¼Œæ„å‘³ç€å½“å‰ä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–é…ç½®ï¼Œå°±èƒ½å¤Ÿè¢«ä¸‹ä¸ªä»»åŠ¡ç›´æ¥è¯»å–ä½¿ç”¨ã€‚ shell æ‰§è¡Œå™¨ä¸€èˆ¬ç”¨äºæ‰§è¡Œçº¯ shell å‘½ä»¤ã€è„šæœ¬ï¼ŒåŒæ—¶å¯¹ä»»åŠ¡ä¹‹é—´çš„éš”ç¦»ä¸æ•æ„Ÿçš„ä»»åŠ¡ã€‚ iOSã€macOS App æ‰“åŒ…å¿…é¡»é€‰æ‹© shell æ‰§è¡Œå™¨ï¼Œæ— æ³•ä½¿ç”¨ docker æ‰§è¡Œã€‚ docker ç®€å•åœ°ã€æŒ‰ç…§æœ¬æ–‡ä½œè€…çš„ä¸ªäººç†è§£ï¼Œè§£é‡Šä¸€ä¸‹ docker æ˜¯ä»€ä¹ˆï¼š docker æŠ€æœ¯å³å®¹å™¨æŠ€æœ¯ï¼ŒåŸºäº docker å¯ä»¥å¿«é€Ÿåœ°é…ç½®å¥½ç”¨æˆ·æ‰€éœ€çš„å¼€å‘ç¯å¢ƒï¼ŒåŒæ—¶åŸºäº dockerï¼Œå¯ä»¥å®ç°å®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„éš”ç¦»ã€‚ å½“æˆ‘ä»¬é€‰æ‹© docker æ‰§è¡Œå™¨åï¼Œä¸‹ä¸€æ­¥ä¼šè®©æˆ‘ä»¬å¡«å†™ä¸€ä¸ªé»˜è®¤çš„ docker é•œåƒåç§°ï¼Œè¯¥åç§°åç»­å¯æ›´æ”¹ã€‚ Android æ‰“åŒ…ã€ä¸Šä¼  bugly ç­‰æ“ä½œå‡å¯ä½¿ç”¨ docker æ‰§è¡Œå™¨æ‰§è¡Œã€‚ æ€»ç»“ iOSã€macOS App æ‰“åŒ…åªèƒ½é€‰æ‹© shellã€‚ ä¸éœ€è¦è€ƒè™‘ä»»åŠ¡ä¸ä»»åŠ¡ä¹‹é—´äº’ç›¸éš”ç¦»çš„ã€è½»é‡åŒ–çš„ä»»åŠ¡å¯ä»¥é€‰æ‹© shellã€‚ éœ€è¦å¤æ‚çš„å¼€å‘ç¯å¢ƒï¼Œä»»åŠ¡ä¸ä»»åŠ¡ä¹‹é—´éœ€è¦äº’ç›¸éš”ç¦»ï¼Œæˆ–è€…è¾ƒä¸ºç¹æ‚çš„ä»»åŠ¡å¯ä»¥é€‰æ‹© dockerã€‚ é¡¶éƒ¨é»„è‰²WARNINGè­¦å‘Š é¦–å…ˆï¼Œå¦‚æœæ˜¯åœ¨ macOS ç¯å¢ƒä¸‹ï¼Œé‚£ä¹ˆæ— è§†è¯¥è­¦å‘Šå³å¯ï¼› å¦‚æœæ˜¯åœ¨ Linux ç¯å¢ƒä¸‹ï¼Œåˆ™æ˜¯å› ä¸ºæ‰§è¡Œ gitlab-runner register å‘½ä»¤æ—¶æ²¡æœ‰æ·»åŠ  sudo å¯¼è‡´çš„ï¼Œä¸­æ–­å½“å‰æµç¨‹ï¼Œé‡æ–°æ‰§è¡Œ sudo gitlab-runner register å³å¯ã€‚ é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼ŒiOS æ‰“åŒ…å¿…é¡»åœ¨ shell ç¯å¢ƒä¸‹æ‰§è¡Œï¼Œæ‰“åŒ…è¿‡ç¨‹ä¸­ä½¿ç”¨å½“å‰ç”¨æˆ·ç”³è¯·å»æ‰§è¡Œç›¸å…³ gitlab-runner å‘½ä»¤ï¼Œæ‰€ä»¥åœ¨æ³¨å†Œ runner æ—¶ï¼Œæ— æ³•ä½¿ç”¨ sudo æ‰§è¡Œã€‚ GitLab-Runner æ²¡æœ‰å¯¹æ­¤è¿›è¡Œé¢å¤–çš„åˆ¤æ–­ï¼Œæ‰€ä»¥åªè¦ä¸åŠ  sudoï¼Œå°±æ˜¯ user-modeï¼Œå°±ä¼šè¾“å‡ºè¯¥è­¦å‘Šã€‚ ","link":"https://blog.rakuyoo.top/gitlab-ci-register-runner/"},{"title":"GitLab-CIï¼ˆä¸€ï¼‰ï¼šæ­å»º iOS CI ç¯å¢ƒ","content":" æœ¬æ–‡æ¡£ç”¨äºä»‹ç»å¦‚ä½•æ­å»ºé€‚ç”¨äºæ„å»º iOS é¡¹ç›®çš„ GitLab-CI ç¯å¢ƒã€‚ GitLab-CI ç³»åˆ—æ–‡ç« ç›®å‰æœ‰ä¸‰ç¯‡ï¼Œä¸»è¦è®²è§£ GitLab-CI çš„ç¯å¢ƒæ­å»ºä¸é…ç½®ã€‚æœ¬æ–‡ä¸ºè¯¥ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ã€‚ ç›®å½•ï¼š GitLab-CIï¼ˆä¸€ï¼‰ï¼šæ­å»º iOS CI ç¯å¢ƒ GitLab-CIï¼ˆäºŒï¼‰ï¼šæ³¨å†Œ GitLab-Runner GitLab-CIï¼ˆä¸‰ï¼‰ï¼šé…ç½® GitLab-Runner macOS æ„å»º iOS é¡¹ç›®å¿…é¡»è¦åŸºäº macOS æ“ä½œç³»ç»Ÿã€‚ æ— æ³•ä¸Šäº‘ï¼ˆå› ä¸ºå…¬æœ‰äº‘ä¸æ”¯æŒ CPU è™šæ‹ŸåŒ–ï¼‰ï¼Œä¸”ç›®å‰æ²¡æœ‰æä¾›çš„ macOS æœåŠ¡å™¨ï¼Œæ•…éœ€è¦ä¸€å°æœ¬åœ°ç¡¬ä»¶æ¥æä¾› CI/CD æœåŠ¡ã€‚ æœ€ä½è¦æ±‚ macOS çš„ç³»ç»Ÿç‰ˆæœ¬è¦æ±‚ç¬¦åˆå¼€å‘æ‰€ä½¿ç”¨çš„ Xcode æ‰€è¦æ±‚çš„æœ€ä½ç³»ç»Ÿç‰ˆæœ¬ã€‚ å› ä¸ºä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªå¼€å‘ç»„å†…çš„ç³»ç»Ÿç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œæ•… CI æœºå™¨çš„ç³»ç»Ÿç‰ˆæœ¬åº”å½“å°½é‡ä¿æŒä¸€è‡´ã€‚ å¯æŸ¥é˜… Apple å®˜æ–¹çš„ Xcode - æ”¯æŒ æ–‡æ¡£ï¼ŒæŸ¥çœ‹ç³»ç»Ÿæœ€ä½è¦æ±‚ã€‚ å¦‚æœä½¿ç”¨ Xcode 14.2 &amp; macOS 13 ç‰ˆæœ¬çš„ç³»ç»Ÿè¿›è¡Œå¼€å‘ï¼Œåˆ™ CI æœºå™¨æœ€ä½åº”ä½¿ç”¨ macOS 12.5 ç‰ˆæœ¬ã€‚ ç¿»å¢™ VPN å› ä¸ºåç»­è¯¸å¤šæ­¥éª¤éœ€è¦ç¿»å¢™æ‰èƒ½æé«˜è®¿é—®é€Ÿåº¦ï¼Œç”šè‡³éœ€è¦ç¿»å¢™æ‰èƒ½å®‰è£…æˆåŠŸï¼Œæ‰€ä»¥å»ºè®®å…ˆæŠŠç¿»å¢™VPNé…ç½®å¥½ã€‚ å¼€å‘ç¯å¢ƒ Xcode åœ¨ macOS ä¸Šï¼ŒXcode æ˜¯å¤§éƒ¨åˆ†ç¼–ç¨‹ç¯å¢ƒçš„åŸºç¡€ï¼›Xcode åŒ…å«ä¾‹å¦‚ git åœ¨å†…çš„ä¸€ç³»åˆ—å¼€å‘å·¥å…·ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬åº”å½“å…ˆä¸‹è½½ Xcodeï¼Œä¹‹åå†æ‰§è¡Œå…¶ä»–æ“ä½œã€‚ é€šè¿‡ Mac App Store ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Xcodeï¼Œæˆ–å»å®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ Xcodeã€‚ å¦‚ä¸Šæ‰€è¿°ï¼ŒCI æœºå™¨ä¸Šçš„ Xcode ç‰ˆæœ¬åº”å½“ä¸å¼€å‘æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ã€‚ ä¸‹è½½å®‰è£…å¥½ Xcode ä¹‹åï¼Œåº”å½“å…ˆæ‰“å¼€ä¸€æ¬¡ Xcodeï¼Œå®Œæˆåç»­æµç¨‹ï¼Œç›´è‡³çœ‹åˆ°æ¬¢è¿é¡µé¢ã€‚ å‘½ä»¤è¡Œå·¥å…· æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£… Xcode å‘½ä»¤è¡Œå·¥å…·ï¼š xcode-select --install åœ¨å¼¹å‡ºçš„å¼¹çª—å†…ï¼Œé€‰æ‹©å®‰è£…ï¼Œå¹¶æ ¹æ®æç¤ºå®Œæˆåç»­å®‰è£…å³å¯ã€‚ Git é…ç½® å®‰è£… Xcode çš„è¿‡ç¨‹ä¸­ï¼Œå°†è‡ªåŠ¨å®‰è£… git æœåŠ¡ã€‚æ­¤æ—¶æ‚¨éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­è¿›è¡Œä¸€äº›é¢å¤–çš„é…ç½®ï¼š git config --global user.name &quot;gitè´¦æˆ·å&quot; git config --global user.email &quot;æ³¨å†Œgitæ‰€ç”¨é‚®ç®±&quot; SSH æ‚¨éœ€è¦é…ç½® SSHï¼Œå°†æœ¬æœºçš„ SSH æ·»åŠ åˆ° GitLab ç³»ç»Ÿä¸­ã€‚ é¦–å…ˆè¿›å…¥ .ssh ç›®å½•ï¼š cd ~/.ssh # å¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™éœ€è¦æ‚¨æ‰‹åŠ¨ä½¿ç”¨ mkdir ~/.ssh è¿›è¡Œåˆ›å»º æ¥ç€åˆ›å»º ssh æ–‡ä»¶ï¼š ssh-keygen -t rsa -C &quot;æ³¨å†Œgitæ‰€ç”¨é‚®ç®±&quot; è¾“å…¥å‘½ä»¤ä¹‹åï¼Œè¿ç»­æ•²å‡»3ä¸ªå›è½¦å®Œæˆåˆ›å»ºï¼ˆè¯·å‹¿è®¾ç½®å¯†ç ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ä¸€äº›é—®é¢˜ï¼‰ æœ€åï¼Œä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„å…¬é’¥ï¼Œå¹¶å¤åˆ¶åˆ° GitLab ä¸­å³å¯ï¼š cat id_rsa.pub ç¯å¢ƒåˆå§‹åŒ– åšä¸»è‡ªå·±å†™äº†ä¸€ä¸ªç”¨äºåˆå§‹åŒ–ç¯å¢ƒçš„è„šæœ¬ï¼š /bin/zsh -c &quot;$(curl -fsSL ä»¥åçš„è„šæœ¬è·¯å¾„)&quot; ci åœ¨ç»ˆç«¯ä¸­ï¼Œè¾“å…¥ä¸Šè¿°å‘½ä»¤åï¼Œå°†å®‰è£…å¦‚ä¸‹æœåŠ¡ï¼š Homebrewï¼ˆå®‰è£…è¿‡ç¨‹ä¸­éœ€è¦ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©å›½å†…é•œåƒæºï¼‰ RVMï¼Œå¹¶ç¡®ä¿ ruby ç‰ˆæœ¬ä¸º 2.7.4 ç‰ˆæœ¬ Bundle Mint åœ¨ ~ ç›®å½•ä¸‹æ·»åŠ å¼€æœºè§£é”å¯†ç ï¼ˆé»˜è®¤ä¸º qazxsw2ï¼‰ æ‚¨å¯ä»¥ fork è¯¥è„šæœ¬åä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œä»¥å®‰è£…é€‚ç”¨äºæ‚¨è‡ªå·±çš„å¼€å‘ç¯å¢ƒã€‚ é’ˆå¯¹ Homebrew çš„é¢å¤–é…ç½® æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬æ—¶ï¼Œå¯èƒ½å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š No remote 'origin' in ... fatal: not in a git directory Error æ­¤æ—¶åˆå§‹åŒ–è„šæœ¬ä¼šè¢«ä¸­æ–­ã€‚æˆ‘ä»¬å¯ä»¥æ‰§è¡Œ brew -v å‘½ä»¤æŸ¥çœ‹æç¤ºï¼Œå¹¶æŒ‰ç…§æç¤ºæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š git config --global --add safe.directory homebrew-coreè·¯å¾„ git config --global --add safe.directory homebrew-caskè·¯å¾„ git config --global --add safe.directory homebrew-servicesè·¯å¾„ å°† homebrew-coreã€homebrew-cask å’Œ homebrew-services çš„è·¯å¾„æ·»åŠ åˆ° git config ä¸­å³å¯ã€‚ ä¹‹åå†é‡æ–°æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬å³å¯ã€‚ å†…ç½‘ VPN ä¸€èˆ¬æ¥è¯´ GitLab æœåŠ¡éƒ½å®‰è£…åœ¨å…¬å¸å†…ç½‘ï¼Œéœ€è¦è¿æ¥å†…ç½‘æ‰èƒ½è¿›è¡Œè®¿é—®ã€‚ æ‚¨éœ€è¦åœ¨è¿™ä¸€æ­¥ä¸­æ ¹æ®æ‚¨è‡ªèº«çš„æƒ…å†µï¼Œç¡®ä¿ CI ç”µè„‘å¯ä»¥é¡ºåˆ©è®¿é—®å…¬å¸å†…ç½‘æœåŠ¡ã€‚ GitLab-Runner æ•´ä½“å®‰è£…ã€é…ç½®æµç¨‹å¯å‚è€ƒ å®˜æ–¹æ–‡æ¡£ï¼Œæœ¬èŠ‚å†…å®¹ä»…ä½œä¸ºè¡¥å……è¯´æ˜ä½¿ç”¨ã€‚å…¶å†…å®¹ä¸å®˜æ–¹æ–‡æ¡£åŸºæœ¬ä¸€è‡´ã€‚ ä¸‹è½½å®‰è£… å› ä¸ºå®˜æ–¹ä½¿ç”¨çš„æ˜¯äºšé©¬é€Šçš„ s3 æœåŠ¡å™¨ï¼Œåœ¨å¢™å†…ä¸‹è½½ä¼šæ¯”è¾ƒæ…¢ï¼Œå»ºè®®å¼€å¯ç¿»å¢™ VPN æˆ–åœ¨æ—©ä¸Šæˆ–è€…ç½‘ç»œæ¡ä»¶æ¯”è¾ƒå¥½çš„æ—¶å€™ä¸‹è½½ã€‚ GitLab-Runner ä½œä¸º GitLab-CI çš„åŸºç¡€ï¼Œå…¶ç‰ˆæœ¬åº”è¯¥å’Œ GitLab çš„ç‰ˆæœ¬æœ‰æ‰€å¯¹åº”ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°ä¸åŒ¹é…çš„æƒ…å†µã€‚ 14.8.1-jh ç‰ˆæœ¬çš„ GitLab å¯ä»¥ä½¿ç”¨ 15.1.0 ç‰ˆæœ¬çš„ Runnerã€‚ åœ¨ç»ˆç«¯è¾“å…¥ä¸‹é¢çš„é“¾æ¥ä¸‹è½½å®‰è£…åŒ…ï¼š è¯¥å®‰è£…åŒ…é€‚ç”¨äº Intel èŠ¯ç‰‡çš„ Macï¼Œå¦‚æœæ˜¯ M ç³»åˆ—èŠ¯ç‰‡çš„ Macï¼Œåˆ™éœ€è¦å°†æœ€åçš„ amd64 ä¿®æ”¹ä¸º arm64ã€‚ sudo curl --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/v15.1.0/binaries/gitlab-runner-darwin-amd64 èµ‹äºˆæƒé™ sudo chmod +x /usr/local/bin/gitlab-runner åœ¨ç»ˆç«¯è¾“å…¥ä¸Šè¿°å‘½ä»¤åï¼Œå³å¯åœ¨ç»ˆç«¯å†…ä½¿ç”¨ gitlab-runner å‘½ä»¤ã€‚ æ³¨å†Œ Runner è¯¦ç»†æ³¨å†Œæµç¨‹è¯·å‚è€ƒ æ³¨å†Œ GitLab-Runner å¯åŠ¨ Runner é¦–å…ˆæ‰“å¼€ç»ˆç«¯ï¼Œåˆ‡æ¢åˆ°å½“å‰ç™»é™†ç”¨æˆ·ï¼š su - &lt;username&gt; æ¥ç€å®‰è£… Runner æœåŠ¡å¹¶å¯åŠ¨ï¼š cd ~ gitlab-runner install gitlab-runner start æœ€åé‡å¯ç”µè„‘å³å¯å®Œæˆ Runner çš„å®‰è£…ã€‚ å¯ä»¥åœ¨ç»ˆç«¯å†…è¾“å…¥ gitlab-runner list å‘½ä»¤ï¼ŒæŸ¥çœ‹è¾“å‡ºï¼Œå¹¶æ£€æŸ¥ config.toml æ–‡ä»¶è·¯å¾„ã€‚ é…ç½® Runner è¯·å‚è€ƒ é…ç½® GitLab-Runner æ–‡æ¡£ä¸­ concurrent ä¸€èŠ‚è¿›è¡Œé…ç½®ã€‚ è‡³æ­¤ï¼Œè¿™å°ç”µè„‘å®Œæˆäº† CI/CD çš„ç›¸å…³é…ç½®ã€‚ ","link":"https://blog.rakuyoo.top/gitlab-ci-build-ios-environment/"},{"title":"Objective-C delegate æ€§èƒ½å°ä¼˜åŒ–","content":"ä¹‹å‰ä¹Ÿæ˜¯å¯¹ delegate æ€¨å¿µé¢‡æ·±â€”â€”æ¯æ¬¡éƒ½éœ€è¦æ£€æŸ¥ deleagte å¹¶ä¸”æ£€æŸ¥æ˜¯å¦å“åº”äº†æŸä¸ªæ–¹æ³•ã€‚ä¸è¿‡é‚£ä¸ªæ—¶å€™çš„æ€¨å¿µæ˜¯æ¥è‡ªäº éœ€è¦å†™é‚£ä¹ˆä¸€å¤§æ®µä»£ç ï¼Œè€Œä¸æ˜¯æ€¨å¿µæ€§èƒ½ã€‚ è¿‡å»çš„è§£å†³æ–¹æ³• å½“æ—¶çš„è§£å†³åŠæ³•æ˜¯å†™äº†è¿™ä¹ˆä¸€ä¸ª å® ï¼š #define MBCCheckDelegate(methodName) (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(methodName)]) å®é™…ä¸Šå†™æˆ å†…è”å‡½æ•° ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¸è¿‡åˆ°äº†è¿™ä¸€æ­¥åˆå¼€å§‹æœ‰ç‚¹çŠ¯æ‡’äº†ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æœ‰ç»§ç»­ã€‚ ä¼˜åŒ– ç›´åˆ°ä»Šå¤©çœ‹åˆ°äº† å‚è€ƒ1 çš„è¿™ç¯‡æ–‡ç« ã€‚æ–‡ç« ä¸­æåˆ°äº†å¯ä»¥ç¼“å­˜ respondsToSelector: æ–¹æ³•çš„ç»“æœï¼Œè®©æˆ‘æ„Ÿæ…¨åŸæ¥è¿˜èƒ½è¿™ä¹ˆåšï¼ @protocol SomethingDelegate &lt;NSObject&gt; @optional - (void)something:(id)something didFinishLoadingItem:(id)item; - (void)something:(id)something didFailWithError:(NSError *)error; @end @interface Something : NSObject @property (nonatomic, weak) id &lt;SomethingDelegate&gt; delegate; @end @implementation Something { struct { unsigned int didFinishLoadingItem:1; unsigned int didFailWithError:1; } delegateRespondsTo; } @synthesize delegate; - (void)setDelegate:(id &lt;JSSomethingDelegate&gt;)aDelegate { if (delegate != aDelegate) { delegate = aDelegate; delegateRespondsTo.didFinishLoadingItem = [delegate respondsToSelector:@selector(something:didFinishLoadingItem:)]; delegateRespondsTo.didFailWithError = [delegate respondsToSelector:@selector(something:didFailWithError:)]; } } @end å¦‚ä¸Šæ‰€ç¤ºï¼Œä¾¿æ˜¯ä½¿ç”¨ ç»“æ„ä½“ æ¥ç¼“å­˜ç»“æœã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ•°æ®ç»“æ„æ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚ ç„¶ååœ¨å®é™…é€šè¿‡ delegate å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œåªéœ€è¦åˆ¤æ–­å¯¹åº”çš„å±æ€§å³å¯ã€‚ ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦ç•™æ„ï¼ŒObjective-C å¯ä»¥åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œæ‰€ä»¥è®¾ç½®æ—¶çš„æƒ…å†µæœªå¿…èƒ½ä»£è¡¨è°ƒç”¨æ—¶çš„æƒ…å†µã€‚å…·ä½“è¦ä¸è¦ç”¨è¿™ç§æ–¹æ³•è¿˜è¦è€ƒè™‘å›¢é˜Ÿå†…çš„å¼€å‘æ°›å›´ã€‚ ç®€å†™çš„ delegate åœ¨æœ‰ protocol ä¹‹å‰ï¼Œä¸€èˆ¬æ˜¯ç»™ NSObject åŠ ä¸€ä¸ª category æ¥å£°æ˜ delegate å¯ä»¥å®ç°çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œç°å¦‚ä»Š CALayer è¿˜æœ‰ï¼š @interface NSObject(CALayerDelegate) - (void)displayLayer:(CALayer *)layer; // ... other methods here @end æ„æ€æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œä»»ä½•å¯¹è±¡éƒ½å¯ä»¥å®ç° displayLayer: æ–¹æ³•ã€‚ å¦‚æœè¿™æ ·å†™çš„è¯ï¼Œåœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰ä¹Ÿè¦åŒæ ·è¦ç”¨ä¸Šé¢æåˆ°çš„ -respondsToSelector: æ¥æ£€æŸ¥ã€‚åªè¦è®© delegate å¯¹è±¡å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œç„¶åæŠŠå®ƒä¿å­˜åœ¨ delegate å±æ€§é‡Œå°±è¡Œäº†ï¼Œä¸ç”¨å†™ protocol ä»€ä¹ˆçš„ã€‚ è‹¹æœå®˜æ–¹çš„åº“é‡Œæœ‰ä¸å°‘è¿™æ ·çš„ä¸œè¥¿ï¼Œä½†æ˜¯æ–°å†™çš„ä»£ç æœ€å¥½è¿˜æ˜¯ç”¨ä¸Šé¢å£°æ˜ protocol çš„æ­£è§„å†™æ³•ã€‚ å› ä¸ºè¿™ç§ç®€å†™æ–¹æ³•ä¼šæ±¡æŸ“NSObjectï¼ˆä¼šå¹²æ‰°ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿè®©ç¼–è¯‘å™¨ä¸æ˜“æ£€æŸ¥å‡ºæ‰“é”™å­—ä¹‹ç±»çš„ errorã€‚ å‚è€ƒ [çˆ†æ ˆçƒ­é—¨ iOS é—®é¢˜â€”â€”æˆ´ä»“è–¯] å¦‚ä½•å†™å¥½ä¸€ä¸ª delegate ","link":"https://blog.rakuyoo.top/objc-delegate-optimization/"},{"title":"C ä¸ Objective-C ä¸­çš„æšä¸¾","content":"æœ¬æ–‡ä»‹ç» C ä¸ Objective-C ä¸­çš„æšä¸¾ï¼ŒåŒæ—¶å¯¹ Objective-C ä¸­çš„å­—ç¬¦ä¸²æšä¸¾è¿›è¡Œä»‹ç» Cè¯­è¨€ä¸­çš„æšä¸¾ Cè¯­è¨€ä¸­ä¹Ÿæ˜¯æœ‰æšä¸¾çš„ï¼Œæˆ–è€…è¯´æšä¸¾æ­£æ˜¯ä»Cè¯­è¨€ä¸­è¯ç”Ÿçš„ã€‚åœ¨Cè¯­è¨€ä¸­ï¼Œæšä¸¾ä½¿ç”¨ enum å…³é”®å­—å£°æ˜ï¼Œè¾…ä»¥ typedefã€‚è®©æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š typedef enum RKOEnumType { RKOEnumTypeNone = 0, RKOEnumTypeNormal, ... } RKOEnumType; ä¸Šé¢çš„ä»£ç ä¾¿å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»å‹ RKOEnumTypeï¼Œä½¿ç”¨å®ƒå£°æ˜å˜é‡æ—¶æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š RKOEnumType type = RKOEnumTypeNone; è€Œç”¨å®ƒè¿›è¡Œåˆ¤æ–­æ—¶åˆ™æ˜¯è¿™æ ·çš„ï¼š switch (type) { case RKOEnumTypeNone: // some code break; case RKOEnumTypeNormal: // some code break; ... } Objective-C ä¸­çš„æšä¸¾ åœ¨ Objective-C è¯­è¨€ä¸­ï¼ŒFoundaation æ¡†æ¶ä¸ºæˆ‘ä»¬å°è£…äº†ä¸€å¥—æ›´æ–¹ä¾¿çš„æšä¸¾å®šä¹‰æ–¹æ³•ã€‚é‚£ä¾¿æ˜¯ NS_ENUM å’Œ NS_OPTIONSã€‚ NS_ENUM NS_ENUM ç”¨æ¥ç”³æ˜å•é€‰ç±»å‹çš„æšä¸¾ï¼Œå³æšä¸¾å˜é‡ä¸­åªå¯ä»¥æœ‰ä¸€ç§å€¼ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ —å­ï¼š typedef NS_ENUM(NSInteger, RKOEnumType) { RKOEnumTypeNone = 0, RKOEnumTypeNormal, ... }; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œç”¨ NSInteger å£°æ˜äº†æšä¸¾å˜é‡çš„ç±»å‹ï¼Œå³æ•´æ•°ç±»å‹ï¼Œå…¶åœ¨ä½¿ç”¨æ—¶å’Œ Cè¯­è¨€ å¹¶æ— åŒºåˆ«ï¼Œä¾ç„¶ä½¿ç”¨ switch è¯­æ³•ç”¨ä»¥åŒºåˆ†æ¯ç§ä¸åŒçš„æšä¸¾å˜é‡ã€‚ NS_OPTIONS é™¤äº† NS_ENUM ä¹‹åï¼ŒObjective-C è¿˜ä¸ºæˆ‘ä»¬å°è£…äº†ä¸€å¥— NS_OPTIONSã€‚æœ‰çš„æ—¶å€™å•ä¸€çš„æšä¸¾å€¼å¹¶ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä¾‹å¦‚åœ¨å¦‚ä¸‹åœºæ™¯æ—¶ï¼šæˆ‘ä»¬å¸Œæœ›è®¾ä¸€ä¸ªè§†å›¾çš„å¯é€‰è½¬æ–¹å‘ï¼Œå®ƒå³å¯å‘å·¦æ—‹è½¬ï¼Œåˆå¯å‘å³æ—‹è½¬ã€‚è¿™æ—¶å¦‚æœæˆ‘ä»¬ä½¿ç”¨æšä¸¾æ¥ä»£è¡¨æ—‹è½¬æ–¹å‘çš„è¯ï¼Œæ˜¾ç„¶æˆ‘ä»¬ä¸åº”è¯¥è®¾ç½®ä¸€ä¸ªæšä¸¾å€¼ä¸ºâ€œæ—¢å¯å‘å·¦åˆå¯å‘å³â€ï¼Œæˆ‘ä»¬ä¾ç„¶å®šä¹‰ä¸€ä¸ª RKORotatTypeLeft ä¸€ä¸ª RKORotatTypeRightï¼Œç„¶åå¤šé€‰å®ƒä»¬ã€‚é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å®šä¹‰å‘¢ï¼Ÿä¸‹é¢æ¥ä¸¾ä¸ªä¾‹å­ï¼š typedef NS_OPTIONS(NSUInteger, RKORotatType) { RKORotatTypeRightNone = 0, // 2è¿›åˆ¶ä¸­çš„ 0000 RKORotatTypeRight = 1 &lt;&lt; 0, // å€¼ä¸º2çš„0æ¬¡æ–¹ï¼ŒäºŒè¿›åˆ¶ä¸­çš„ 0001 RKORotatTypeLeft = 1 &lt;&lt; 1, // å€¼ä¸º2çš„1æ¬¡æ–¹ï¼ŒäºŒè¿›åˆ¶ä¸­çš„ 0010 ... }; è¿™æ ·æˆ‘ä»¬ä½¿ç”¨ NS_OPTIONSï¼Œç»“åˆä½ç§»æ“ä½œï¼Œå°±å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥è¿›è¡Œå¤šé€‰çš„æšä¸¾ç±»å‹äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNS_OPTIONS ä½¿ç”¨çš„å˜é‡ç±»å‹ä¸º NSUIntegerã€‚è€Œä¸æ˜¯ NS_ENUM çš„ NSIntegerã€‚ åœ¨å¯¹å˜é‡èµ‹å€¼æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ | æˆ–è¿ç®—ç¬¦è¿æ¥å¤šä¸ªä¸åŒçš„æšä¸¾å€¼ï¼Œä¾‹å¦‚ï¼š RKORotatType type = RKORotatTypeRight | RKORotatTypeLeft; åˆ¤æ–­ NS_OPTIONS åœ¨å¯¹å˜é‡çš„åˆ¤æ–­ä¸Šä¸ NS_ENUM ä¸åŒï¼Œå› ä¸ºå˜é‡ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸æ–¹ä¾¿ä½¿ç”¨ switch æ¥è¿›è¡Œåˆ¤æ–­äº†ã€‚ ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ if æ¥è¿›è¡Œ NS_OPTIONS ç±»å‹çš„æšä¸¾çš„å€¼åˆ¤è¯»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š // RKORotatTypeRight if (type &amp; RKORotatTypeRight) { // some code } // åŒ…å« RKORotatTypeLeft if (type &amp; RKORotatTypeLeft) { // some code } ä½¿ç”¨ if åˆ¤æ–­ï¼Œç»“åˆ &amp; ä¸è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬å³å¯åˆ¤æ–­å˜é‡ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…·ä½“çš„æšä¸¾å€¼ï¼Œè¿›è€Œæ‰§è¡Œæ“ä½œã€‚ æ’é™¤ æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿ï¼Œæœ‰å¯èƒ½å®šä¹‰ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ªé€‰é¡¹æšä¸¾ï¼š typedef NS_OPTIONS(NSUInteger, RKORotatType) { RKORotatTypeRightNone = 0, RKORotatTypeRight = 1 &lt;&lt; 0, RKORotatTypeLeft = 1 &lt;&lt; 1, RKORotatTypeTop = 1 &lt;&lt; 2, RKORotatTypeBottom = 1 &lt;&lt; 3, RKORotatTypeAll = RKORotatTypeRight | RKORotatTypeLeft | RKORotatTypeTop | RKORotatTypeBottom, }; è¿™é‡Œæˆ‘é¢å¤–å®šä¹‰äº†ä¸€ä¸ªæšä¸¾é€‰é¡¹ä¸º RKORotatTypeAllï¼Œä»£è¡¨æ‰€æœ‰çš„æ—‹è½¬ç±»å‹ã€‚ç°åœ¨æˆ‘ä»¬æœ‰å¯èƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼Œç‚¹å‡»æŸä¸ªæŒ‰é’®ï¼Œæˆ–è€…æ‰§è¡Œäº†æŸä¸ªæ“ä½œä¹‹åï¼Œè¦ç¦æ­¢è¿™ä¸ªè§†å›¾å‘å·¦æ—‹è½¬ã€‚ æˆ‘ä»¬å¯ä»¥é‡æ–°å¯¹ type è¿›è¡Œèµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼Œå°† RKORotatTypeLeft ä» type ä¸­æ’é™¤æ‰ï¼š type = type &amp; (~RKORotatTypeLeft); å°† RKORotatTypeLeft å–ååå†ä¸ type è¿›è¡Œä¸æ“ä½œï¼Œå³å¯ä» type ä¸­ç§»é™¤ RKORotatTypeLeft é€‰é¡¹ã€‚ Cæ•°ç»„ä¸å­—ç¬¦ä¸²æšä¸¾ å¦‚ä¸Šæ‰€è¿°ï¼Œc ä¸ Objective-C çš„å¸¸è§æšä¸¾éƒ½æ˜¯ int ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²æšä¸¾å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥å€ŸåŠ© c æ•°ç»„æ¥å®ç°ã€‚é¦–å…ˆå®šä¹‰ä¸€ä¸ªå¸¸è§çš„ Objective-C æšä¸¾ï¼š typedef NS_ENUM(NSUInteger, KLType) { KLTypeRed = 1, KLTypeGreen = 2, KLTypeOrange = 3, }; éšåä½¿ç”¨è¯¥ Objective-C æšä¸¾ä½œä¸ºä¸‹æ ‡ï¼Œå®šä¹‰ c æ•°ç»„ï¼š // è¿™ä¸ªæ˜¯ Map NSString * ç±»å‹çš„æ•°ç»„ NSString *KLTypeStringMap[] = { [KLTypeRed] = @&quot;çº¢è‰²&quot;, [KLTypeGreen] = @&quot;ç»¿è‰²&quot;, [KLTypeOrange] = @&quot;æ©˜è‰²&quot; }; // ä½¿ç”¨ï¼š KLTypeStringMap[KLTypeRed]; å‚è€ƒ iOS Enum-æšä¸¾çš„æ­£ç¡®ä½¿ç”¨â€”â€”Snow_xueY NS_OPTIONSæšä¸¾çš„ç”¨æ³•â€”â€”Channe OCä¸­æšä¸¾å†™æ³• ä»¥åŠ å­—ç¬¦ä¸²ç±»å‹æšä¸¾å®ç°æ¢ç´¢ ","link":"https://blog.rakuyoo.top/enums-in-objc/"},{"title":"SQL åŸºç¡€è¯­å¥ä¸ SQLite åŸºç¡€æ“ä½œ","content":"è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å›´ç»• SQLiteï¼Œè®°å½•æ€»ç»“ SQL çš„ä¸€äº›ç”¨æ³•ã€‚ è‡³äº iOS ä¸­å…¶ä½™çš„å‡ ç§å­˜å‚¨æ–¹å¼ä¾‹å¦‚ .plist ç­‰ï¼Œä»¥åŠæ•°æ®åº“çš„æ¦‚å¿µï¼ŒSQL çš„æ¦‚å¿µç­‰ï¼Œå…ˆä¸åšä»‹ç»ã€‚ SQL çš„ç‰¹ç‚¹ ä¸åŒºåˆ†å¤§å°å†™ã€‚ æ¯æ¡è¯­å¥å¿…é¡»ä»¥åˆ†å· ; ç»“å°¾ã€‚ ä¸å¯ä»¥ä½¿ç”¨å…³é”®å­—æ¥å‘½åè¡¨ã€å­—æ®µã€‚ï¼ˆå…³é”®å­—è§ä¸‹ä¸€å°èŠ‚ï¼‰ SQL ä¸­çš„å…³é”®å­— select ã€ insert ã€ update ã€ delete ã€ from ã€ create ã€ where ã€ desc ã€ order ã€ by ã€ group ã€ table ã€ alter ã€ view ã€ index etc. æ³¨æ„ï¼Œä¸ºäº†ä¿æŒè‰¯å¥½çš„æ•°æ®åº“ç¼–ç¨‹ä¹ æƒ¯ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ SQL è¯­å¥çš„æ—¶å€™ï¼Œåº”å½“é‡‡ç”¨å…³é”®å­—å¤§å†™çš„å½¢å¼ã€‚ SQL è¯­å¥çš„ç§ç±» DDL æ•°æ®å®šä¹‰è¯­å¥ æ•°æ®å®šä¹‰è¯­å¥ DDL çš„å…¨ç§°æ˜¯ Data Definition Languageã€‚ å…¶åŒ…å« create ã€ drop ç­‰æ“ä½œã€‚create å³ åˆ›å»ºè¡¨ (create table) ã€‚drop åˆ™æ˜¯ åˆ é™¤è¡¨ ï¼ˆdrop tableï¼‰ã€‚ DML æ•°æ®æ“ä½œè¯­å¥ æ•°æ®æ“ä½œè¯­å¥ DML çš„å…¨ç§°æ˜¯ Data Manipulation Languageã€‚ åŒ…æ‹¬ insert ã€ update ã€ delete ç­‰æ“ä½œã€‚ ç¬¬ä¸€æ¬¡æ¥è§¦çš„æ—¶å€™ï¼Œåªçœ‹è¿™äº›å…³é”®è¯çš„è¯å¯ä»¥ä¼šè¯¯è§£ delete ä¸ºåˆ é™¤è¡¨çš„æ“ä½œã€‚å®åˆ™ä¸ç„¶ï¼ŒDML å…¨éƒ¨éƒ½æ˜¯å¯¹ æ•°æ® çš„æ“ä½œï¼ŒDDL æ‰æ˜¯å¯¹äºè¡¨çš„æ“ä½œã€‚ æ‰€ä»¥è¿™é‡Œ insert ä¸ºåœ¨è¡¨ä¸­ æ·»åŠ  ï¼ˆæ’å…¥ï¼‰æ•°æ®ï¼Œupdate ä¸º ä¿®æ”¹ è¡¨ä¸­çš„æ•°æ®ï¼Œdelete ä¸º åˆ é™¤ è¡¨ä¸­çš„æ•°æ®ã€‚ DQL æ•°æ®æŸ¥è¯¢è¯­å¥ æ•°æ®æŸ¥è¯¢è¯­å¥ DQL çš„å…¨ç§°æ˜¯ Data Query Languageã€‚ç”¨äºæŸ¥è¯¢å¹¶è·å¾—è¡¨ä¸­çš„æ•°æ®ã€‚ å…³é”®å­— select æ˜¯ DQL ï¼ˆä¹Ÿæ˜¯æ‰€æœ‰ SQL ï¼‰ç”¨çš„æœ€å¤šçš„æ“ä½œã€‚ å…¶ä»–çš„ DQL å¸¸ç”¨çš„å…³é”®å­—æœ‰ where ã€order by ã€ group by ã€ having ç­‰ã€‚ SQLåŸºç¡€æ“ä½œ ä»¥ä¸‹å†…å®¹å°±æ˜¯é‡ç‚¹è¦è®°å½•çš„éƒ¨åˆ†äº†ã€‚ä¸ºäº†æ›´åŠ æ¸…æ™°çš„åˆ’åˆ†å„ä¸ªæ¨¡å—ï¼Œä»¥ä¸‹å†…å®¹å°†ä½¿ç”¨åˆ†å‰²çº¿æ¥å¯¹å„ä¸ªæ¨¡å—è¿›è¡Œåˆ’åˆ†ã€‚ åˆ›è¡¨ CREATE TABLE è¡¨å (å­—æ®µå1 å­—æ®µç±»å‹1, å­—æ®µå2 å­—æ®µç±»å‹2, ...); ä¸Šé¢ä¸ªè¿™æ¡è¯­å¥æ˜¯æœ€åŸºæœ¬çš„åˆ›è¡¨è¯­å¥ï¼Œcreate å…³é”®å­— å’Œ table å…³é”®å­—è¿ç”¨ï¼Œç”¨äºåˆ›å»ºä¸€å¼ è¡¨ï¼Œç”¨ () è‹±æ–‡æ‹¬å·å°†å¤šä¸ª å­—æ®µå å’Œ å­—æ®µç±»å‹ æ‹¬èµ·æ¥ã€‚ ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ä¸Šé¢é‚£æ¡è¯­å¥ï¼Œä¸ºäº†æ›´åŠ çš„å®‰å…¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ ä¸‹é¢è¿™ç§å†™æ³•è¿›è¡Œè¡¨çš„åˆ›å»º ï¼š CREATE TABLE IF NOT EXISTS è¡¨å (å­—æ®µå1 å­—æ®µç±»å‹1, å­—æ®µå2 å­—æ®µç±»å‹2, ...); IF NOT EXISTS ç”¨äºåˆ¤æ–­æ‰€è¦åˆ›å»ºçš„ è¡¨æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯æ‰ä¼šåˆ›å»ºã€‚ ä¸¾ä¸ªä¾‹å­çš„è¯åˆ›å»ºä¸€å¼ è¡¨çš„å®é™…è¯­å¥æ˜¯è¿™æ ·çš„ï¼š CREATE TABLE IF NOT EXISTS t_student (id integer, name text, age inetger, score real); tip: åˆä¸€åˆ™è‰¯å¥½çš„ SQL ç¼–ç ä¹ æƒ¯â€”â€”åœ¨åˆ›å»ºè¡¨æ—¶ï¼Œè¡¨åå‰åŠ ä¸Š t_ æ¥è¡¨æ˜è¿™æ˜¯ä¸€å¼ è¡¨ï¼ŒåŒç†ï¼Œåˆ›å»ºè§†å›¾æ—¶ä½¿ç”¨ v_ æ¥è¡¨æ˜è§†å›¾ã€‚ ç„¶è€Œï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¾‹å¦‚ Navicat Premium ç­‰è½¯ä»¶ï¼Œåœ¨ GUI ä¸­åˆ›å»ºè¡¨ï¼Œç„¶åä½¿ç”¨ DDL æŸ¥çœ‹è¯¥è¡¨çš„åˆ›è¡¨è¯­æ³•æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹çš„è¯­å¥ï¼š CREATE TABLE &quot;t_shop&quot; ( &quot;name&quot; text, &quot;price&quot; real, &quot;left_count&quot; integer ); è¡¨åå’Œå­—æ®µåéƒ½åŠ äº†å¼•å·ã€‚æˆ‘ç¨å¾®æŸ¥äº†ä¸€ä¸‹ï¼Œå¥½åƒ oracle æ˜¯éœ€è¦åŠ å¼•å·çš„ï¼Œå¥½åƒå’Œå¤§å°å†™æœ‰å…³ã€‚ä¸è¿‡åœ¨ SQLite ä¸­ä¸åŠ å¼•å·å³å¯ã€‚æ¯•ç«Ÿ Navicat Premium ä¸­é›†æˆäº†å¤šç§æ•°æ®åº“ï¼Œä¸æ˜¯ä»…æœ‰ SQLiteã€‚ å­—æ®µç±»å‹ SQLite å°†æ•°æ®åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ç§å­˜å‚¨ç±»å‹ï¼š åç§° å«ä¹‰ integer æ•´å‹å€¼ real æµ®ç‚¹å€¼ text æ–‡æœ¬å­—ç¬¦ä¸² blob äºŒè¿›åˆ¶æ•°æ®ï¼ˆæ¯”å¦‚æ–‡ä»¶ï¼‰ ç„¶è€Œå‘¢ï¼Œå®é™…ä¸Š SQLite æ˜¯ æ— ç±»å‹ çš„ã€‚å°±ç®—æˆ‘ä»¬å°†ä¸€ä¸ªå­—æ®µå£°æ˜ä¸º integerï¼Œè¿˜èƒ½å¯ä»¥å­˜å‚¨ç±»å¦‚ å­—ç¬¦ä¸²ä¹‹ç±»çš„æ•°æ®ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œ ä¸»é”®é™¤å¤–ï¼‰ã€‚ è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬åœ¨å»ºè¡¨çš„æ—¶å€™å®é™…ä¸Šæ˜¯å¯ä»¥ä¸å£°æ˜ç±»å‹çš„ï¼Œåªå£°æ˜åç§°å³å¯ã€‚ä½†æ˜¯ä¸ºäº†ä¿æŒè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œå¯å¯è¯»æ€§ç­‰ç­‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯åº”è¯¥å£°æ˜ç±»å‹çš„ã€‚ åˆ è¡¨ åˆ è¡¨çš„æ—¶å€™ä½¿ç”¨å…³é”®å­— dropï¼Œå’Œåˆ›è¡¨æ—¶ä¸€æ ·ï¼Œåˆ†ä¸ºæ™®é€šçš„å†™æ³•å’Œæˆ‘ä»¬å¹³æ—¶ä¼šç”¨åˆ°çš„å†™æ³•ã€‚è¿™é‡Œå°±ç›´æ¥ç»™å‡ºåè€…äº†ï¼š DROP TABLE IF EXISTS è¡¨å; ä¸¾ä¸ªä¾‹å­ï¼š DROP TABLE IF EXISTS t_student; æ’å…¥æ•°æ® INSERT INTO è¡¨å (å­—æ®µ1, å­—æ®µ2, ...) values (å­—æ®µ1çš„å€¼, å­—æ®µ2çš„å€¼, ...); æç‚¼ä¸€ä¸‹ä¸Šè¿°è¯­æ³•ï¼Œå³ insert into ... values ...ã€‚æ„Ÿè§‰è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼šæ’å…¥åˆ°... å®ƒçš„å€¼æ˜¯ ... ä¸¾ä¾‹æ¥è¯´ï¼š INSERT INTO t_student (name, age) VALUE ('mj', 10); æ³¨æ„ï¼š åœ¨å­˜å‚¨ å­—ç¬¦ä¸² æ—¶ï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨ å•å¼•å· å°†å…¶æ‹¬èµ·æ¥ã€‚ åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå¹¶ä¸ä¸€å®šè¦æ¯ä¸ªå­—æ®µéƒ½æœ‰å€¼ï¼Œå³è¡¨ååé¢çš„é‚£ä¸ªæ‹¬å·ï¼Œä¸å¿…åŒ…å«è¡¨ä¸­çš„æ‰€æœ‰å­—æ®µã€‚ æ›´æ–°æ•°æ® UPDATE è¡¨å SET å­—æ®µ1 = å­—æ®µ1çš„å€¼, å­—æ®µ2 = å­—æ®µ2çš„å€¼, ...; ä¸Šé¢ä¾¿æ˜¯æ›´æ–°æ•°æ®çš„è¯­æ³•æ ¼å¼ï¼Œä½†æ˜¯å¦‚æœä»…ä»…æ˜¯å¥—ç”¨è¿™ä¸ªæ ¼å¼çš„è¯ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ¡è¯­å¥ï¼š UPDATE t_student SET name = 'jack', age = 20; è¿™æ¡è¯­å¥å°†ä¼šå°†æ•´å¼ è¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œname å­—æ®µçš„å€¼éƒ½æ”¹ä¸º jackï¼Œage å­—æ®µçš„å€¼éƒ½æ”¹ä¸º20ã€‚ æ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬è¿˜è¦ç»“åˆä¸‹ä¸€å¤§èŠ‚çš„æ¡ä»¶è¯­å¥è¿›è¡Œä½¿ç”¨ã€‚ åˆ é™¤æ•°æ® DELETE FROM è¡¨å; åˆ é™¤æ•°æ®çš„ä¸€èˆ¬è¯­æ³•ä¹Ÿå¾ˆç®€å•ï¼Œä½†æ˜¯å’Œæ›´æ–°æ•°æ®ä¸€æ ·ã€‚æ‰§è¡Œäº†ä¸Šé¢çš„æ“ä½œä¹‹åï¼Œæ•´å¼ è¡¨çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«åˆ é™¤ã€‚æ‰€ä»¥ä¹Ÿè¦ç»“åˆæ¡ä»¶è¯­å¥è¿›è¡Œä½¿ç”¨ã€‚ æ¡ä»¶è¯­å¥ åœ¨ åˆ›è¡¨ å’Œ åˆ è¡¨ æ—¶ï¼Œæˆ‘ä»¬æ›¾ç»ä½¿ç”¨è¿‡ if è¿™ä¸ªå…³é”®è¯ï¼Œå¯ä»¥ç†è§£ä¸ºå¦‚æœã€‚ä½†æ˜¯è¿™ä¸ª if å¹¶ä¸æ˜¯æ¡ä»¶åˆ¤æ–­è¯­å¥çš„ç”¨è¯ã€‚ åœ¨æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ where å…³é”®å­—ï¼Œå¯ä»¥ç¿»è¯‘ä¸º å½“....æ—¶ï¼Œåˆæ¬¡æ¥è§¦æ—¶æˆ‘å¾ˆå¥½å¥‡ï¼Œå¦‚æœä¸ä½¿ç”¨ if çš„è¯ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ when å‘¢ï¼Ÿæ„Ÿè§‰è¿™é‡Œå¯èƒ½æ›´æ˜¯ä¸ºäº†çªå‡º åœ¨æŸè¡Œè®°å½• çš„è¿™ä¸ªæ¦‚å¿µå§ã€‚ æ¡ä»¶è¯­å¥çš„æ ¼å¼ä¹Ÿå¾ˆå¥½è®°å¿†ï¼Œå³åœ¨éœ€è¦æ¡ä»¶åˆ¤æ–­çš„è¯­å¥åé¢ï¼Œè·Ÿä¸Šç”± where å¼€å¤´çš„æ¡ä»¶åˆ¤æ–­è¯­å¥å³å¯ã€‚ æ ¼å¼ å«ä¹‰ WHERE å­—æ®µ = æŸä¸ªå€¼ å­—æ®µçš„å€¼æ˜¯å¦ç­‰äºæŸä¸ªå€¼ WHERE å­—æ®µ != æŸä¸ªå€¼ å­—æ®µçš„å€¼æ˜¯å¦ä¸ç­‰äºæŸä¸ªå€¼ WHERE å­—æ®µ &gt; æŸä¸ªå€¼ å­—æ®µçš„å€¼æ˜¯å¦å¤§äºæŸä¸ªå€¼ WHERE å­—æ®µ &lt; æŸä¸ªå€¼ å­—æ®µçš„å€¼æ˜¯å¦å°äºæŸä¸ªå€¼ WHERE å­—æ®µ1 = æŸä¸ªå€¼ AND å­—æ®µ2 &gt; æŸä¸ªå€¼ å…³é”®å­— AND ç”¨äºè¿æ¥ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶ WHERE å­—æ®µ1 = æŸä¸ªå€¼ OR å­—æ®µ2 &gt; æŸä¸ªå€¼ å…³é”®å­— OR ç”¨äºè¿æ¥ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶ ä¸¾ä¾‹ï¼š -- å°† t_student è¡¨ä¸­å¹´é¾„å¤§äº10å¹¶ä¸”å§“åä¸ç­‰äºjackçš„è®°å½•ï¼Œå¹´é¾„éƒ½æ”¹ä¸º5ã€‚ UPDATE t_student SET age = 5 WHERE age &gt; 10 AND name != 'jack'; -- åˆ é™¤ t_student è¡¨ä¸­å¹´é¾„å°äºç­‰äº 10 æˆ–è€… å¹´é¾„å¤§äº 30 çš„è®°å½•ã€‚ DELETE FROM t_student WHERE age &lt; 10 OR age &gt; 30; -- å°† t_student è¡¨ä¸­åå­—ç­‰äº jack çš„è®°å½•ï¼Œscore å­—æ®µçš„å€¼éƒ½æ”¹ä¸º age å­—æ®µçš„å€¼ã€‚ UPDATE t_student SET score = age WHERE name = 'jack'; ç‰¹åˆ«æ³¨æ„ï¼šåœ¨ SQLite ä¸­ï¼Œç­‰äº è¿™ä¸ªæ¦‚å¿µä½¿ç”¨çš„æ˜¯ å•ç‹¬çš„ç­‰å·ã€‚å’Œ Obj-C ä»¥åŠå…¶ä»–å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€éƒ½ä¸ç›¸åŒã€‚ æŸ¥è¯¢æ•°æ® æŸ¥è¯¢æ“ä½œä½¿ç”¨å…³é”®å­— selectã€‚æ ¼å¼ä¸ºï¼š SELECT å­—æ®µ1, å­—æ®µ2, ... FROM è¡¨å; å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æ•´å¼ è¡¨çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ * å·æ¥ä»£æ›¿å­—æ®µåï¼Œå³ SELECT * FROM è¡¨å; ä¸¾ä¸ªä¾‹å­ï¼š SELECT name, age FROM t_student; SELECT * FROM t_student WHERE age &gt; 10; åˆ«å åœ¨è¿›è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º å­—æ®µ å’Œ è¡¨ èµ·ä¸€ä¸ª åˆ«åï¼Œä»è€Œæˆ‘ä»¬æˆ‘ä»¬æŸ¥çœ‹æˆ–è€…è¿›è¡ŒæŸäº›æ“ä½œã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ«å é¡¾åæ€ä¹‰ï¼Œåªæ˜¯å¦å¤–ä¸€ä¸ªç§°å‘¼ï¼Œå¹¶ä¸ä¼šä¿®æ”¹å­—æ®µæœ¬èº«çš„åç§°ã€‚ åˆ«å ä½¿ç”¨å…³é”®å­— asï¼Œä¸è¿‡è¯¥å…³é”®å­—æ˜¯å¯ä»¥çœç•¥çš„ï¼Œè€Œä¸”ï¼Œè¿™ä¸ªåˆ«åå¯ä»¥ä½¿ç”¨ ä¸­æ–‡ã€‚å…¶æ ¼å¼å¦‚ä¸‹ï¼š -- æœ€åŸºæœ¬çš„å†™æ³•ä¸ºï¼š SELECT å­—æ®µ1 AS åˆ«å1, å­—æ®µ2 AS åˆ«å2, ... FROM è¡¨å AS è¡¨åˆ«å; -- å½“éšè— AS æ—¶ SELECT å­—æ®µ1 åˆ«å1, å­—æ®µ2 åˆ«å2, ... FROM è¡¨å è¡¨åˆ«å; åŒæ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä¸ºè¡¨èµ·äº†ä¸€ä¸ª åˆ«åï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æŸ¥è¯¢æ—¶å°±å¯ä»¥è¿™ä¹ˆå®šä¹‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µï¼š SELECT è¡¨åˆ«å.å­—æ®µ1 åˆ«å1, è¡¨åˆ«å.å­—æ®µ2 åˆ«å2, ... FROM è¡¨å è¡¨åˆ«å; å³ç”¨ è¡¨åˆ«å åæ¥ . å†æ¥å­—æ®µåçš„æ ¼å¼ï¼Œç”¨ è¡¨åˆ«å æ¥å¼•ç”¨è¡¨ä¸­çš„å­—æ®µã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œåœ¨ä½¿ç”¨å¦‚ Navicat Premium æ—¶ï¼Œå¯ä»¥æç¤ºè¯¥è¡¨æœ‰å“ªäº›å­—æ®µï¼Œä»¥é˜²å­—æ®µå¤ªå¤šæˆ‘ä»¬è®°ä¸æ¸…æ¥šã€‚è€Œä¸”å½“å¤šè¡¨è”æŸ¥æ—¶å‡ºç°äº†å­—æ®µåé‡åçš„é—®é¢˜çš„è¯ï¼Œè¡¨åˆ«å ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³åŠæ³•ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š SELECT s.name å§“å, s.age å¹´é¾„ FROM t_student s; è®¡ç®—è®°å½•çš„æ•°é‡ åœ¨ SQL ä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•° count() ï¼Œå…¶ä½œç”¨ä¸ºè®°å½•æŸä¸ªå­—æ®µçš„æ•°é‡ã€‚æ ¼å¼ä¸ºï¼š SELECT COUNT(å­—æ®µå) FROM è¡¨å; ä¸è¿‡ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ * å·æ¥ä»£æ›¿å­—æ®µåã€‚å³ï¼š SELECT COUNT(*) FROM è¡¨å; ä¸¾ä¸ªä¾‹å­ï¼š SELECT COUNT(*) FROM t_student WHERE score &gt;= 60; æŸ¥è¯¢ç»“æœæ’åº æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…³é”®å­— order by å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºï¼Œå…¶æ ¼å¼ä¸ºï¼š SELECT å­—æ®µå FROM è¡¨å ORDER BY å­—æ®µå æ’åºè§„åˆ™; å…¶é»˜è®¤æ˜¯æŒ‰ç…§ asc ï¼Œå³å‡åºæ’åˆ—ã€‚æˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºçš„ä¿®æ”¹æ’åºè§„åˆ™ï¼Œæ”¹ä¸º descï¼Œ å³é™åºæ’åˆ—ã€‚å¦‚æœçœç•¥æ’åºè§„åˆ™çš„è¯ï¼Œåˆ™æ˜¯é»˜è®¤çš„å‡åºæ’åˆ—ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š -- çœç•¥æ’åºè§„åˆ™ã€‚(æŒ‰ç…§å‡åºæ’åˆ— SELECT * FROM t_student ORDER BY age; -- é™åºæ’åˆ— SELECT * FROM t_student ORDER BY age DESC; åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šæŒ‰ç…§å¤šä¸ªå­—æ®µè¿›è¡Œæ’åºï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ¡è¯­å¥ï¼š SELECT * FROM t_student ORDER BY age ASC, height DESC; è¿™æ¡è¯­å¥ä¼šå°†æŸ¥è¯¢ç»“æœæŒ‰ç…§å­—æ®µ age å‡åºæ’åˆ—ï¼Œå¹´é¾„ç›¸ç­‰çš„è¯å°±ä¼šæŒ‰ç…§å­—æ®µ height é™åºæ’åˆ—ã€‚ æœªå®Œå¾…ç»­ ... ","link":"https://blog.rakuyoo.top/sql-basic-and-sqlite-basic/"},{"title":"å»æ‰éšå¼åŠ¨ç”»","content":"å®é™…ä¸Š iOS å¥½åƒæ˜¯ä¼šåœ¨å¾ˆå¤šåœ°æ–¹é»˜è®¤æ·»åŠ ä¸ŠåŠ¨ç”»çš„ã€‚è¿™äº›åŠ¨ç”»å€’ä¹Ÿè¿˜å¥½ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™å°±å’Œéœ€æ±‚ä¸ç¬¦å°±æ¯”è¾ƒçƒ¦äººäº†ã€‚ å‰å‡ å¤©å¶ç„¶çš„å†æ¬¡æŸ¥åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œäºæ˜¯å†³å®šå¼€ä¸ªæ–‡ç« è®°å½•ä¸€ä¸‹ã€‚ æ„Ÿè°¢å‚è€ƒ1ï¼ŒåŸä½œè€…çš„æ€»ç»“ã€‚æœ¬æ–‡åŸºæœ¬å¼•ç”¨è‡ªå‚è€ƒ1ã€‚ è¯´åˆ°éšå¼åŠ¨ç”»ï¼Œä¹‹å‰åœ¨åšæ‰‹åŠ¿æ§ä»¶çš„æ—¶å€™ï¼Œå¯¹äº CALayer çš„ä¸€äº›æ“ä½œå°±ä¼šæœ‰éšå¼åŠ¨ç”»ï¼Œä¾‹å¦‚è¯´ä¸‹é¢è¿™è¡Œä»£ç å°±ä¼šæœ‰éšå¼åŠ¨ç”»ï¼š self.frameLayer.frame = self.frameView.bounds; è¿™é‡Œä»‹ç»å‡ ç§å¯ä»¥å»æ‰ç³»ç»ŸåŠ¨ç”»çš„æ–¹æ³•ã€‚å¦‚æœæ‚¨æƒ³éšè—çš„æ˜¯ CALayer ç›¸å…³çš„åŠ¨ç”»ï¼Œè¯·ç›´æ¥å‚è€ƒ æ–¹æ³•ä¸‰ã€‚ æ–¹æ³•ä¸€ æ–¹æ³•ä¸€æ˜¯ä½¿ç”¨ UIView ç±»çš„ç±»æ–¹æ³•ï¼š performWithoutAnimation [UIView performWithoutAnimation:^{ // your code }]; å¦‚æœä½ çš„ App éœ€è¦æœ€å°‘æ”¯æŒåˆ° iOS 7 ã€‚é‚£ä¹ˆæ¨èä½ ä½¿ç”¨è¯¥æ–¹æ³•ã€‚ æ–¹æ³•äºŒ è¯¥æ–¹æ³•å¯è¡Œï¼Œä½†æ˜¯å®åœ¨æ˜¯å¤ªè ¢äº†ï¼Œä¸å»ºè®®ä½¿ç”¨ åœ¨ä½ çŸ¥é“ä¼šäº§ç”ŸåŠ¨ç”»çš„ä»£ç å¤„ï¼Œå†æ¬¡æ·»åŠ ä¸€ä¸ªåŠ¨ç”»ï¼Œåªä¸è¿‡å°†è¿™ä¸ªåŠ¨ç”»çš„æ—¶é—´è®¾ä¸º0ï¼š [UIView animateWithDuration:0 animations:^{ [collectionView performBatchUpdates:^{ [collectionView reloadItemsAtIndexPaths:@[[NSIndexPath indexPathForItem:index inSection:0]]]; } completion:nil]; }]; æ–¹æ³•ä¸‰ æ–¹æ³•å››æ˜¯é’ˆå¯¹ CALayer çš„éšå¼åŠ¨ç”»çš„ã€‚è¿™ç§æƒ…å†µä¸‹ä¸Šé¢çš„ä¸‰ç§æ–¹æ³•æ˜¯æ— æ•ˆçš„ï¼Œåªèƒ½é‡‡ç”¨æ–¹æ³•å››ï¼š [CATransaction begin]; [CATransaction setDisableActions:YES]; // CALayer åŠ¨ç”» self.frameLayer.frame = self.frameView.bounds; [CATransaction commit]; å‚è€ƒ iOSå¼€å‘å°æŠ€å·§-å¦‚ä½•å»æ‰éšå¼åŠ¨ç”»â€”â€”æœ¨å¤´åŠ ç™½æ°´ ","link":"https://blog.rakuyoo.top/remove-implicit-animation/"},{"title":"PushKit çš„é›†æˆ","content":"å®é™…ä¸Šé¡¹ç›®ä¸­å¾ˆæ—©å°±ç”±æˆ‘æå‡ºè¦å°†ç°æœ‰çš„ APNs æ›´æ”¹ä¸º PushKit äº†ã€‚åªä¸è¿‡å½“åˆåç«¯çš„åŒå­¦å¾ˆå¿™ï¼Œæ²¡æœ‰æ—¶é—´æè¿™ä¸ª... ç°åœ¨å› ä¸ºè¦æ¥å…¥ CallKitï¼Œæ‰€ä»¥è¿™ä¸ªä¸æä¸è¡Œäº†ã€‚é‚£ä¹ˆä¹Ÿæ¥è®°å½•ä¸€ä¸‹å§ã€‚ è¿™ç¯‡æ–‡ç« ä¸­æ²¡æœ‰æ¶‰åŠåˆ°è¯ä¹¦çš„ç”³è¯·ï¼Œè¿™å—å„¿æˆ‘è¿˜ä¸å¤ªä¼šï¼Œç­‰åˆ°æœªæ¥æ¥è§¦äº†ä¼šå›è¿‡æ¥è¡¥å……çš„ æµç¨‹ å¯¼å…¥æ¡†æ¶ Xcodeè®¾ç½® è¿™é‡Œè¦åŒºåˆ†ä¸€ä¸‹ Xcode çš„ç‰ˆæœ¬ã€‚å¦‚æœä½ çš„ç‰ˆæœ¬æ˜¯ Xcode 9 ä»¥å‰çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆè¯·æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤é…ç½®ï¼š åœ¨ Xcode ä¸­é€‰ä¸­ä½ çš„é¡¹ç›®ï¼Œåˆ‡æ¢åˆ°ä¸» Target ä¸‹ã€‚ ç‚¹å‡» capabilities é€‰é¡¹å¡ï¼Œæ‰¾åˆ° Background Modes è¿™ä¸€é¡¹ã€‚ å‹¾é€‰ Voice over IP ä»¥åŠ Remote notifications ä¸¤é¡¹å³å¯ã€‚ å¦‚æœä½ çš„ Xcode ç‰ˆæœ¬æ˜¯ Xcode 9 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¾ˆé—æ†¾ã€‚è‹¹æœåœ¨ Background Modes ä¸­ç§»é™¤äº† Voice over IP è¿™ä¸€é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½é€‰æ‹©æ‰‹åŠ¨åœ°åœ¨ info.plist æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼š æˆ‘ä»¬å¯ä»¥é€‰æ‹© Open As Source Code æ¨¡å‹ï¼Œç„¶åæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ‰“å¼€ info.plist æ–‡ä»¶ï¼Œç„¶ååœ¨ Required background modes ä¸­æ·»åŠ å›¾ä¸­çš„è¿™é¡¹ã€‚ æœ€åæˆ‘ä»¬åœ¨ Build Phases çš„ Link Binary With Libraries ä¸­æ·»åŠ  PushKit çš„ç³»ç»Ÿåº“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š AppDelegate.m é¦–å…ˆæˆ‘ä»¬åœ¨ AppDelegate.m ä¸­å¯¼å…¥å¤´æ–‡ä»¶ï¼š #import &lt;PushKit/PushKit.h&gt; å…¶æ¬¡æˆ‘ä»¬è¿˜éœ€è¦éµå®ˆ PKPushRegistryDelegate åè®®ã€‚ æ³¨å†Œæ¨é€ æˆ‘ä»¬åœ¨ AppDelegate.m æ–‡ä»¶ä¸­ï¼Œç¼–å†™å¦‚ä¸‹æ–¹æ³•ï¼š // æ³¨å†ŒpushKitæ¨é€ - (void)registerPushKitNotification { if ([UIDevice currentDevice].systemVersion.floatValue &gt;= 8.0) { PKPushRegistry *pushRegistry = [[PKPushRegistry alloc] initWithQueue:dispatch_get_main_queue()]; pushRegistry.delegate = self; pushRegistry.desiredPushTypes = [NSSet setWithObject:PKPushTypeVoIP]; } } æ³¨æ„ï¼š PushKit çš„æ”¯æŒæ˜¯éœ€è¦ iOS ç³»ç»Ÿå¤§äº 8.0 çš„ã€‚ PKPushTypeVoIP æ˜¯ä¸€ä¸ª key å€¼ï¼Œå…·ä½“çš„ä¼šæ”¾åœ¨åé¢è®²è§£ã€‚ ä¹‹åæˆ‘ä»¬åœ¨ application:didFinishLaunchingWithOptions: æ–¹æ³•ä¸­è°ƒç”¨ä¸Šè¿°æ–¹æ³•å³å¯ã€‚ ä»£ç†æ–¹æ³• pushRegistry:didUpdatePushCredentials: PKPushRegistryDelegate åè®®ä¸­æœ‰ä¸€ä¸ªå¿…é¡»è¦å®ç°çš„ä»£ç†æ–¹æ³•ï¼š - (void)pushRegistry:(PKPushRegistry *)registry didUpdatePushCredentials:(PKPushCredentials *)pushCredentials forType:(PKPushType)type; ç®€å•è¯´ä¸€ä¸‹ï¼Œå°±æ˜¯å½“æ”¶åˆ°ä¸€ä¸ªæŒ‡å®šçš„ PKPushTypeï¼ˆè¿™æ˜¯ä¸€ä¸ªæšä¸¾ï¼‰ç±»å‹çš„æ–°çš„ credentialsï¼ˆå‡­è¯/è¯ä¹¦ï¼‰ï¼ˆåŒ…æ‹¬ push tokenï¼‰æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è·å– token å€¼ï¼Œç„¶åå°†å…¶ç¼“å­˜èµ·æ¥ï¼š - (void)pushRegistry:(PKPushRegistry *)registry didUpdatePushCredentials:(PKPushCredentials *)credentials forType:(NSString *)type { NSLog(@&quot;--- Token ---%@ ====%@&quot;, credentials.token, [credentials.token description]) NSString *deviceTokenStr = [[credentials.token description] stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;]; deviceTokenStr = [deviceTokenStr stringByReplacingOccurrencesOfString:@&quot;&lt;&quot; withString:@&quot;&quot;]; deviceTokenStr = [deviceTokenStr stringByReplacingOccurrencesOfString:@&quot;&gt;&quot; withString:@&quot;&quot;]; NSUserDefaults *groupDefault = [[NSUserDefaults alloc] initWithSuiteName:GroupDefaultsName]; [groupDefault setValue:deviceTokenStr forKey:DeviceTokenKey]; [groupDefault synchronize]; } pushRegistry:didInvalidatePushTokenForType: æ¥ç€æˆ‘ä»¬å¯ä»¥åœ¨ pushRegistry: didInvalidatePushTokenForType: æ–¹æ³•ä¸­æ¸…é™¤ Token - (void)pushRegistry:(PKPushRegistry *)registry didInvalidatePushTokenForType:(PKPushType)type { NSUserDefaults *groupDefault = [[NSUserDefaults alloc] initWithSuiteName:GroupDefaultsName]; [groupDefault setValue:@&quot;&quot; forKey:DeviceTokenKey]; [groupDefault synchronize]; } pushRegistry:didReceiveIncomingPushWithPayload: æ¥ä¸‹æ¥çš„ä»£ç†æ–¹æ³•ç‰¹åˆ«é‡è¦ï¼Œé‚£å°±æ˜¯ pushRegistry:didReceiveIncomingPushWithPayload: ã€‚è¿™ä¸ªæ–¹æ³•ä¸æ˜¯å¿…é¡»å®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬å°†ä¸šåŠ¡é€»è¾‘å†™åœ¨è¯¥æ–¹æ³•ä¸­ã€‚ ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œ CallKit ç›¸å…³çš„ä»£ç ï¼Œæˆ–è€…ç»“åˆæœ¬åœ°æ¨é€è¿›è¡Œæ“ä½œã€‚ - (void)pushRegistry:(PKPushRegistry *)registry didReceiveIncomingPushWithPayload:(PKPushPayload *)payload forType:(PKPushType)type { // your code } å‚è€ƒ è®ºå…»æˆä¸€ä¸ªå¥½çš„ä¹ æƒ¯æœ‰å¤šé‡è¦.....å½“åˆå†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å±…ç„¶å¿˜è®°è®°å½•å‚è€ƒäº†ï¼Œç»“æœç°åœ¨å›è¿‡å¤´æ¥è¡¥å……çš„æ—¶å€™æ‰¾ä¸åˆ°å½“åˆçš„å‚è€ƒäº†....å¦‚æœæ‚¨å‘ç°è¿™ç¯‡æ–‡ç« å¼•ç”¨äº†æ‚¨çš„æ–‡ç« ï¼Œè¯·è¯„è®ºæˆ–è€…é‚®ä»¶å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œå¼•ç”¨ä¸Šæ‚¨çš„æ–‡ç« é“¾æ¥ã€‚è°¢è°¢ï¼ ","link":"https://blog.rakuyoo.top/pushKit-integration/"},{"title":"ä» Share Extension è·³è½¬åˆ° Containing App","content":"Share Extension è¿™ç¯‡æ–‡ç« å°±ä¸å¤šè®²äº†ã€‚ å•çº¯çš„è¯´ä¸€ä¸‹ä»å‰è¾ˆé‚£é‡Œè¯·æ•™æ¥çš„å¦‚ä½•ä» Share Extension è·³è½¬åˆ° Containing App å§ã€‚ ä»£ç  NSURL *customURL = [NSURL URLWithString:@&quot;ShareKit://&quot;]; SEL sel = NSSelectorFromString(@&quot;openURL:&quot;); NSExtensionContext *context = [[NSExtensionContext alloc]init]; [context openURL:customURL completionHandler:nil]; UIResponder *responder = self; while (responder != nil){ if ([responder respondsToSelector:sel]) { [responder performSelector:sel withObject:customURL]; } responder = responder.nextResponder; } åŸç† ä»£ç æ˜¯ä»å‰è¾ˆé‚£é‡Œè¯·æ•™è¿‡æ¥çš„ï¼ŒåŸç†å°±æ˜¯åˆ©ç”¨ UIResponder æŸ¥æ‰¾å“åº”é“¾ã€‚ç›´æ¥åœ¨ Extension ä¸­è°ƒ openURL æ–¹æ³•æ˜¯ä¼šé—ªé€€çš„ï¼Œå› ä¸ºå“åº”ä¸äº†æ–¹æ³•ã€‚ æ‰€ä»¥ä½¿ç”¨ UIResponderï¼Œä»å“åº”æ ‘ä¸ŠæŸ¥æ‰¾èƒ½å¤Ÿå“åº”è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ Safariï¼Œæˆ–è€…å…¶ä»–ä½¿ç”¨åŸç”Ÿåˆ†äº«çš„ Appã€‚ ç”¨é€” ç”¨é€”è¿™å—å®é™…ä¸Šä¹Ÿæ²¡å¿…è¦å¤šè¯´ï¼Œä¸è¿‡è¯´ä¸€ç‚¹ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸Šæ¶ä¸ä¼šè¢«æ‹’ï¼Œåƒæ˜¯ QQæµè§ˆå™¨ï¼Œå¾®ä¿¡ï¼Œ æ”¯ä»˜å® ç­‰ç­‰éƒ½æœ‰è¿™ç§è·³è½¬çš„åŠŸèƒ½ï¼Œä¸è¿‡ å¾®ä¿¡ çš„åŠå…¶éšè”½ã€‚æ‰€ä»¥å¤§å®¶åœ¨ä½¿ç”¨ä¸­å¯èƒ½è¿˜æ˜¯å¾—æŠŠå…¥å£è—å¾—æ·±ä¸€äº›äº†ã€‚ ","link":"https://blog.rakuyoo.top/jump-from-share-extension-to-app/"},{"title":"Xcode9 å¿«æ·é”®","content":"å¼€ä¸ªè´´è®°å½•ä¸€ä¸‹ Xcode 9 ä¸‹è‡ªå·±å¸¸ç”¨çš„å‡ ä¸ªå‘ç”Ÿäº†å˜åŒ–çš„å¿«æ·é”®ã€‚ å¿«é€Ÿè·³è½¬è‡³å®šä¹‰ Xcode 9 ä¸‹æœ‰è¿™ä¹ˆä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œcommand + é¼ æ ‡å·¦é”® ä¹‹åä¼šå¼¹å‡ºä¸‹å›¾çš„è¿™ä¸ªèœå•ã€‚ ä½†æ˜¯è¿™é‡Œéƒ¨åˆ†çš„åŠŸèƒ½å¾ˆå°‘ç”¨åˆ°ï¼Œå†åŠ ä¸Šä¹‹å‰å·²æœ‰çš„ä¹ æƒ¯ï¼Œæ‰€ä»¥è¿™ä¸ªæ”¹åŠ¨çœŸçš„è®©äººå¾ˆéš¾å—ã€‚è€Œä¸”å®ƒæä¾›çš„å¿«æ·é”® control + command æœ‰çš„æ—¶å€™è¿˜æŒ‰ä¸å‡ºæ¥ã€‚ å®é™…ä¸Šè¿™é‡Œæœ‰ä¸ªæ–°çš„å¿«æ·é”®ï¼š command + é¼ æ ‡å³é”® å¤§å®¶å¯ä»¥å›å»è¯•ä¸€ä¸‹ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°å®šä¹‰ã€‚ ä»£ç æŠ˜å  ä»£ç æŠ˜å çš„æ–¹å¼ä¹Ÿæ”¹äº†ï¼Œç°åœ¨çš„å¿«æ·é”®æ˜¯ï¼š å±€éƒ¨æŠ˜å ï¼ˆæŠ˜å ä¸€ä¸ªå‡½æ•°ï¼‰ Command + Option + æ–¹å‘é”®å·¦/å³ å…¨å±€æŠ˜å ï¼ˆæŠ˜å å½“å‰æ–‡ä»¶ä¸‹çš„å…¨éƒ¨å‡½æ•°ï¼‰ Shift + Command + Option + æ–¹å‘é”®å·¦ / å³ æŠ˜å æ³¨é‡Šå—ï¼šï¼ˆ/* */ä¹‹é—´çš„æ–‡å­—ï¼‰ Ctrl + Shift + Command + æ–¹å‘é”®å·¦ / å³ éšè—/æ˜¾ç¤ºå·¦ä¾§è¾¹æ  Command + 0 æˆ‘çš„ macOS ç‰ˆæœ¬æ˜¯ macOS 10.12.6ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸‹ï¼ŒXcode 9 ä¸èƒ½åšåˆ°ä¸¤ä¸ªé¡¹ç›®åˆ†å±.... ä¸çŸ¥é“å’Œç³»ç»Ÿæˆ–è€… Xcode ç‰ˆæœ¬æœ‰æ²¡æœ‰å…³ç³»... æ‰€ä»¥è¿™é‡Œåªèƒ½æ›²çº¿æ•‘å›½ä¸€ä¸‹ï¼Œæ‰“å¼€å•ä¸ªçš„ä»£ç æ–‡ä»¶ï¼Œç„¶åç”¨è¿™ä¸ªæ–‡ä»¶å’Œé¡¹ç›®è¿›è¡Œåˆ†å±ã€‚ ä½†æ˜¯è¿™æ ·æ‰€å¯¼è‡´çš„é—®é¢˜å°±æ˜¯ï¼Œè¿è¡Œé¡¹ç›®åï¼Œä»£ç æ–‡ä»¶ é‚£è¾¹å·¦ä¾§çš„è¾¹æ ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†æ˜¯å› ä¸ºæ˜¯å•ç‹¬çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æ²¡æœ‰å³ä¸Šè§’çš„å¿«æ·æŒ‰é’®... æ‰€ä»¥è¿™ä¸ªå°èŠ‚ä»‹ç»çš„å¿«æ·é”®å°±å¾ˆé‡è¦äº†ã€‚ å‚è€ƒ Xcode 9 å¿«é€Ÿè·³è½¬åˆ°å®šä¹‰æ–°å§¿åŠ¿ï¼ˆJump to Definitionï¼‰ Xcode 9 ä»£ç æŠ˜å ï¼Œå…¨å±€æŠ˜å ï¼Œå¿«æ·é”® ","link":"https://blog.rakuyoo.top/xcode9-shortcuts/"},{"title":"iOS å¼€å‘ä¹‹é€‚é… iOS11","content":"å¥½äº†ï¼Œç°åœ¨ Xcode 9 çš„æ­£å¼ç‰ˆç»ˆäºæ¨é€äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿè¯¥é€‚é… iOS 11äº†ã€‚ iOS 11çš„æ”¹åŠ¨è¿˜æ˜¯æŒºå¤§çš„ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦åªæ˜¯æŠŠè‡ªå·±é‡åˆ°çš„é—®é¢˜è®°å½•ä¸‹æ¥ï¼Œæ²¡æœ‰é‡åˆ°çš„æš‚æ—¶å…ˆä¸ä¼šå‡ºç°åœ¨æ–‡ç« å†…ã€‚ç­‰æœ‰æ—¶é—´çš„è¯ä¼šå»ç½‘ä¸Šæ‰¾ä¸€æ‰¾ç„¶åæ€»ç»“ä¸‹æ¥çš„ã€‚ NavigationBar TitleView å®½åº¦ æˆ‘çš„ App ä¸­æ˜¯æœ‰è¿™ä¹ˆä¸€ä¸ªè‡ªå®šä¹‰çš„NavigationBar TitleViewçš„ï¼Œå…¶å®½åº¦åŸæœ¬åº”è¯¥ä¸å±å¹•å®½åº¦ä¸€è‡´ã€‚åœ¨ iOS 10 ä»¥åŠ Xcode 8.3.3 ä¸Šä¸€åˆ‡å®‰ç„¶æ— æ™ã€‚ä½†æ˜¯åœ¨ iOS 11 ä»¥åŠ Xcode 9 ä¸Šå°±å˜æˆäº†ä¸‹å›¾æ‰€ç¤ºçš„æ¨¡æ ·ï¼ŒæŒ¤åˆ°äº†ä¸€èµ·ã€‚ æˆ‘ä»¬æŸ¥çœ‹å±‚æ¬¡ç»“æ„å¯ä»¥å‘ç°ï¼ŒTitleViewå˜å¾—è¿™ä¹ˆå°äº†ã€‚ è§£å†³æ–¹æ³• æˆ‘ä»¬å…ˆæ¥çœ‹è§£å†³æ–¹æ³•ï¼Œå†æ¥è¯´åŸå› ã€‚ è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œåœ¨è‡ªå®šä¹‰çš„ TitleView çš„ç±»ä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼Œå°±okäº†ã€‚ // é€‚é…iOS11çš„NavigationBar Tiltleå®½åº¦ã€‚ - (CGSize)intrinsicContentSize { return UILayoutFittingExpandedSize; } ç°åœ¨æˆ‘ä»¬å†è¿è¡Œç¨‹åºï¼Œä¸€åˆ‡æ­£å¸¸ï¼š åŸå›  é€šè¿‡å‚è€ƒ1ï¼Œé‡Œé¢æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š As an explanation: the titleView is now laid out with Auto Layout. Since it looks for the intrinsicContentSize, this is what worked. æˆ‘ç¿»è¯‘ä¸å¥½å°±ä¸ç¿»è¯‘äº†ï¼Œå¤§æ¦‚çš„æ„æ€å¥½åƒå°±æ˜¯ç°åœ¨ TitleView ä¼šå»å¯»æ‰¾ intrinsicContentSize è¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨å¦‚æœéœ€è¦å»é‡å†™ä¸€ä¸‹è¿™ä¸ªå±æ€§çš„ getæ–¹æ³• ã€‚ ç„¶è€Œè¿™ä¸ªå±æ€§æ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¹ˆé‡å†™è¿™ä¸ªå±æ€§ï¼Œç„¶åç»™å®ƒèµ‹å€¼ï¼Œè¦ä¹ˆé‡å†™ getæ–¹æ³• ï¼Œç›´æ¥ return ã€‚ æ›´åŠ è¯¦ç»†çš„å¯ä»¥ç§»æ­¥åˆ°å‚è€ƒ1å»æŸ¥çœ‹ã€‚ å³ä¾§è§†å›¾ ä»Šå¤©æµ‹è¯•å¦¹å­æäº†è¿™ä¹ˆä¸€ä¸ª bugï¼Œæ“ä½œæ­¥éª¤ç®€åŒ–ä¸€ä¸‹æ˜¯è¿™æ ·çš„ï¼š ç‚¹å‡»é¡µé¢ï¼ˆè¯¥é¡µé¢ NavigationBar åŒ…å«ä¸€ä¸ªè‡ªå®šä¹‰çš„ rightBarButtonItem ï¼‰ä¸­çš„ä¸€ä¸ª UISearchBar ï¼Œè°ƒç”¨ä¸€ä¸ªç‚¹å‡»æ‰‹åŠ¿ï¼Œpush åˆ°ä¸€ä¸ªæ–°çš„é¡µé¢ newViewControllerã€‚ newViewController çš„ NavigationBar çš„ titleView æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„è§†å›¾ã€‚å…¶åŒ…å«äº†ä¸€ä¸ª UISearchBar å’Œä¸€ä¸ªå–æ¶ˆæŒ‰é’®ã€‚åŒæ—¶ NavigationBar çš„å·¦ä¾§æ˜¯æ²¡æœ‰è¿”å›æŒ‰é’®çš„ã€‚ ç†æƒ³çš„æ•ˆæœæ˜¯ï¼Œåœ¨è¿›å…¥ newViewController çš„åŒæ—¶ï¼Œå…¶ NavigationBar ä¸Šçš„ UISearchBar åº”è¯¥å˜æˆç¬¬ä¸€å“åº”è€…å¹¶å¼¹å‡ºé”®ç›˜ã€‚ ä½†æ˜¯å®é™…ä¸Šï¼Œé”®ç›˜æ˜¯å‡ºç°äº†ä¸€ç¬é—´ï¼Œç„¶åå°±æ¶ˆå¤±äº†ã€‚ è§£å†³æ–¹æ³• åœ¨ç‚¹å‡»æ‰‹åŠ¿çš„æ–¹æ³•ä¸­ï¼Œå°† NavigationBar çš„ rightBarButtonItem ç½®ä¸º nilã€‚ç„¶ååœ¨ viewWillAppear ä¸­å¯¹ rightBarButtonItem é‡æ–°èµ‹å€¼ã€‚ æ³¨æ„ï¼šéšè—æ˜¯æ— æ•ˆçš„ï¼Œå¿…é¡»ç½® nil æ‰å¯ä»¥ã€‚ åŸå›  è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥š....æ‰¾äº†ä¸€ä¸Šåˆå®åœ¨æ‰¾ä¸åˆ°ï¼Œå‘ç°å’Œ UISearchBar ä»¥åŠæ§åˆ¶å™¨æœ¬èº«æ— å…³ã€‚å’Œ NavigationBarï¼ˆç©ºç™½çš„ï¼‰ä¹Ÿæ— å…³ã€‚æ— å¥ˆåªèƒ½æŒ¨ä¸ªæ³¨é‡Šæ¨¡å—ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†è¿™ä¸ª rightBarButtonItem çš„é—®é¢˜ã€‚ æ¨æµ‹ä¸ iOS 11 ä¸­ rightBarButtonItem çš„å ä½æœ‰å…³ã€‚ä½†æ˜¯ä¸ºä½•ä¼šå¯¼è‡´é”®ç›˜æ¶ˆå¤±è¿˜æ˜¯ä¸å¤ªæ¸…æ¥š.... TabaleView åˆ‡æ¢æ—¶çš„æ»‘åŠ¨åŠ¨ç”» åœ¨ iOS 11 ä¸Šï¼Œpush è¿›å…¥ Table View æˆ–è€… pop å‡º Table View çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ª è‡ªä¸‹è€Œä¸Š çš„æ»‘åŠ¨æ•ˆæœã€‚ è§£å†³æ–¹æ³• å°† Table View çš„ contentInsetAdjustmentBehavior å±æ€§è®¾ä¸º UIScrollViewContentInsetAdjustmentNever å³å¯ã€‚ æ³¨æ„ï¼šéœ€è¦åšç‰ˆæœ¬åˆ¤æ–­ã€‚è¿™ä¸ªå±æ€§æ˜¯ä» iOS 11 å¼€å§‹æ‰æœ‰çš„ã€‚ å‚è€ƒä»£ç å¦‚ä¸‹ï¼š if (@available(iOS 11.0, *)) { self.tableView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever; self.tableView.contentInset = UIEdgeInsetsMake(0, 0, [[UIScreen mainScreen] bounds].size.height == 812 ? 83 : 49, 0); self.tableView.scrollIndicatorInsets = _tableView.contentInset; } åŸå›  è¿™ä¸ªæ•ˆæœå®é™…ä¸Šä¸æ˜¯ Table View çš„ã€‚è€Œæ˜¯ Scroll View çš„ï¼Œè¯¦æƒ…è§ä¸‹é¢çš„ Scroll View å°èŠ‚ã€‚ ScrollView Scroll Viewåœ¨ iOS 11 æ–°å¢çš„ä¸¤ä¸ªå±æ€§ï¼šadjustContentInset å’Œ contentInsetAdjustmentBehaviorã€‚ adjustContentInset è¡¨ç¤º contentView.frame.origin åç§»äº†scrollview.frame.origin å¤šå°‘ï¼›æ˜¯ç³»ç»Ÿè®¡ç®—å¾—æ¥çš„ï¼Œè®¡ç®—æ–¹å¼ç”± contentInsetAdjustmentBehavior å†³å®šã€‚ contentInsetAdjustmentBehavior æ˜¯ä¸ªç»“æ„ä½“ï¼Œå…·ä½“å¦‚ä¸‹ï¼š typedef NS_ENUM(NSInteger, UIScrollViewContentInsetAdjustmentBehavior) { UIScrollViewContentInsetAdjustmentAutomatic, UIScrollViewContentInsetAdjustmentScrollableAxes, UIScrollViewContentInsetAdjustmentNever, UIScrollViewContentInsetAdjustmentAlways, } æ¯ä¸€ç§åˆ†åˆ«ä»£è¡¨ç€ä¸€ç§è®¡ç®—æ–¹å¼ï¼š UIScrollViewContentInsetAdjustmentAutomaticï¼šå¦‚æœ Scroll View åœ¨ä¸€ä¸ª automaticallyAdjustsScrollViewContentInset = YES çš„ æ§åˆ¶å™¨ ä¸Šï¼Œå¹¶ä¸”è¿™ä¸ª æ§åˆ¶å™¨ åŒ…å«åœ¨ä¸€ä¸ª Navigation Controller ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šè®¾ç½®åœ¨ top &amp; bottom ä¸Š adjustedContentInset = safeAreaInset + contentInset ä¸ç®¡æ˜¯å¦æ»šåŠ¨ã€‚å…¶ä»–æƒ…å†µä¸‹ä¸ç¬¬äºŒä¸ªçš„ UIScrollViewContentInsetAdjustmentScrollableAxes ç›¸åŒã€‚ UIScrollViewContentInsetAdjustmentScrollableAxesï¼šåœ¨å¯æ»šåŠ¨æ–¹å‘ä¸Š adjustedContentInset = safeAreaInset + contentInset ï¼Œåœ¨ä¸å¯æ»šåŠ¨æ–¹å‘ä¸Š adjustedContentInset = contentInset ï¼›ä¾èµ–äº Scroll Enabled å’ŒalwaysBounceHorizontal / vertical = YESï¼ŒscrollEnabled é»˜è®¤ä¸º yesï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè®¡ç®—æ–¹å¼è¿˜æ˜¯ adjustedContentInset = safeAreaInset + contentInset UIScrollViewContentInsetAdjustmentNeverï¼šadjustedContentInset = contentInsetã€‚ adjustContentInset å€¼ä¸å— SafeAreaInset å€¼çš„å½±å“ã€‚ UIScrollViewContentInsetAdjustmentAlwaysï¼š adjustedContentInset = safeAreaInset + contentInset æƒé™ ä¿å­˜å›¾ç‰‡ åœ¨ iOS 11 ä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨ XCode 9 åŠä»¥ä¸Šç‰ˆæœ¬æ‰“åŒ…ã€‚é‚£ä¹ˆåœ¨ä¿å­˜å›¾ç‰‡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸‹é¢è¿™ä¸ªå´©æºƒï¼š This app has crashed because it attempted to access privacy-sensitive data without a usage description. The app's Info.plist must contain an NSPhotoLibraryAddUsageDescription key with a string value explaining to the user how the app uses this data. è§£å†³æ–¹æ³• æˆ‘ä»¬å¯ä»¥ç”¨ Source Code çš„æ–¹å¼æ‰“å¼€ info.plist æ–‡ä»¶ è¾“å…¥ä¸‹é¢çš„ä»£ç ï¼š &lt;key&gt;NSPhotoLibraryAddUsageDescription&lt;/key&gt; &lt;string&gt;Appéœ€è¦æ‚¨çš„åŒæ„,æ‰èƒ½ä¿å­˜å›¾ç‰‡&lt;/string&gt; åˆæˆ–è€…é€‰æ‹© Property List æ–¹æ³•ï¼Œåœ¨ App Transport Security Settings é¡¹ä¸­ç‚¹å‡»åŠ å·ï¼Œæ·»åŠ  Photo Library Additions Usage Description å­—æ®µã€‚Type é€‰æ‹© Stringï¼Œç„¶ååœ¨ Value ä¸­æ·»åŠ æç¤ºè¯­ã€‚ åŸå›  è¿™ä¸ªå´©æºƒçš„åŸå› æ˜¯å› ä¸ºï¼Œåœ¨ iOS 11 ä¸­ï¼Œä¿å­˜å›¾ç‰‡ä¹Ÿåƒè°ƒç”¨ç›¸æœºä¸€æ ·ï¼Œéœ€è¦è·å–æƒé™äº†ã€‚ å‚è€ƒ iOS 11 navigationItem.titleView Width Not Set ä½ å¯èƒ½éœ€è¦ä¸ºä½ çš„APPé€‚é…iOS11 iOS 11ä¸­APPä¸­tableViewå†…å®¹ä¸‹ç§»20ptæˆ–ä¸‹ç§»64ptçš„é—®é¢˜é€‚é…çš„ä¸€ä¸ªæ€»ç»“ iOS 11 NSPhotoLibraryAddUsageDescription é”™è¯¯çš„è§£å†³åŠæ³• ","link":"https://blog.rakuyoo.top/available-for-ios11/"},{"title":"Objective-C ä¸­çš„ nullableã€__nullable å’Œ _Nullable","content":"è¿™æ¬¡çš„å†…å®¹æ˜¯å…³äº nullableã€__nullable å’Œ _Nullable çš„ã€‚å¯¹äºæˆ‘ä»¬è¿™æ ·çš„åˆå­¦è€…ï¼Œåœ¨çœ‹ç¬¬ä¸‰æ–¹æ¡†æ¶æˆ–è€…å®˜æ–¹æ–‡æ¡£çš„æ—¶å€™ç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„å­—æ ·ã€‚ç„¶è€Œå¹³æ—¶ä¹Ÿæ²¡æœ‰å»ç ”ç©¶å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆï¼Œè¿™æ¬¡å°±æ¥å¥½å¥½è®°å½•ä¸€ä¸‹ä¸€ä¸‹å§ã€‚ æœ¬æ¬¡çš„å†…å®¹è½¬è½½è‡ªå‚è€ƒ1ï¼Œæ„Ÿè§‰åŸä½œè€…çš„åˆ†äº«ä¸è´¡çŒ®ã€‚ å‰è¨€ åœ¨ Swift ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ ? å’Œ ! å»æ˜¾å¼å£°æ˜ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ–¹æ³•çš„å‚æ•°æ˜¯ optional è¿˜æ˜¯ non-optional ï¼Œè€Œåœ¨ Objective-C ä¸­åˆ™æ²¡æœ‰è¿™ä¸€åŒºåˆ†ï¼Œè¿™æ ·å°±ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šåœ¨ Swift ä¸ Objective-C æ··ç¼–æ—¶ï¼ŒSwift ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“ä¸€ä¸ª Objective-C å¯¹è±¡æˆ–è€…ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°åˆ°åº•æ˜¯ optional è¿˜æ˜¯ non-optional ï¼Œå› æ­¤è¿™ç§æƒ…å†µä¸‹ç¼–è¯‘å™¨ä¼šéšå¼åœ°éƒ½å½“æˆæ˜¯ non-optional æ¥å¤„ç†ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¤ªå¥½çš„ã€‚ è§£å†³æ–¹æ¡ˆ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè‹¹æœåœ¨ Xcode 6.3 å¼•å…¥äº†ä¸€ä¸ª Objective-C çš„æ–°ç‰¹æ€§ï¼š Nullability Annotations ï¼Œè¿™ä¸€æ–°ç‰¹æ€§çš„æ ¸å¿ƒæ˜¯ä¸¤ä¸ªæ–°çš„ç±»å‹ä¿®é¥°ï¼š __nullable å’Œ __nonnull ã€‚ä»å­—é¢ä¸Šæˆ‘ä»¬å¯çŸ¥ï¼Œ __nullable è¡¨ç¤ºå¯¹è±¡å¯ä»¥æ˜¯ NULL æˆ– nilï¼Œè€Œ __nonnull è¡¨ç¤ºå¯¹è±¡ä¸åº”è¯¥ä¸ºç©ºã€‚å½“æˆ‘ä»¬ä¸éµå¾ªè¿™ä¸€è§„åˆ™æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šç»™å‡ºè­¦å‘Šã€‚ åœ¨ Xcode 7 ä¸­ï¼Œä¸ºäº†é¿å…ä¸ç¬¬ä¸‰æ–¹åº“æ½œåœ¨çš„å†²çªï¼Œè‹¹æœæŠŠ __nonnull/__nullable æ”¹æˆ _Nonnull/_Nullable ã€‚å†åŠ ä¸Šè‹¹æœåŒæ ·æ”¯æŒäº†æ²¡æœ‰ä¸‹åˆ’çº¿çš„å†™æ³• nonnull/nullable ï¼Œäºæ˜¯å°±é€ æˆç°åœ¨æœ‰ä¸‰ç§å†™æ³•è¿™æ ·æ··ä¹±çš„å±€é¢ã€‚ ä½†æ˜¯è¿™ä¸‰ç§å†™æ³•æœ¬è´¨ä¸Šéƒ½æ˜¯äº’é€šçš„ï¼Œåªæ˜¯æ”¾çš„ä½ç½®ä¸åŒï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š æ–¹æ³•è¿”å›å€¼ä¿®é¥°ï¼š - (nullable NSString *)method; - (NSString* __nullable)method; - (NSString* _Nullable)method; å£°æ˜å±æ€§çš„ä¿®é¥°ï¼š @property (nonatomic, copy, nullable) NSString *aString; @property (nonatomic, copy) NSString *__nullable aString; @property (nonatomic, copy) NSString *_Nullable aString; æ–¹æ³•å‚æ•°ä¿®é¥°ï¼š - (void)methodWithString:(nullable NSString*)aString; - (void)methodWithString:(NSString * _Nullable)aString; - (void)methodWithString:(NSString * __nullable)aString; è€Œå¯¹äº åŒæŒ‡é’ˆç±»å‹å¯¹è±¡ ã€ Block çš„è¿”å›å€¼ ã€ Block çš„å‚æ•° ç­‰ï¼Œè¿™æ—¶å€™å°±ä¸èƒ½ç”¨ nonnull/nullable ä¿®é¥°ï¼Œåªèƒ½ç”¨å¸¦ä¸‹åˆ’çº¿çš„ __nonnull/__nullable æˆ–è€… _Nonnull/_Nullable ï¼š - (void)methodWithError:(NSError* _Nullable * _Nullable)error - (void)methodWithError:(NSError* __nullable* __null_unspecified)error; // ä»¥åŠå…¶ä»–çš„ç»„åˆæ–¹å¼ - (void)methodWithBlock:(nullable void(^)())block; // æ³¨æ„ä¸Šé¢çš„ nullable ç”¨äºä¿®é¥°æ–¹æ³•ä¼ å…¥çš„å‚æ•° Block å¯ä»¥ä¸ºç©ºï¼Œè€Œä¸æ˜¯ä¿®é¥° Block è¿”å›å€¼ï¼› - (void)methodWithBlock:(void(^ _Nullable)())block; - (void)methodWithBlock:(void(^ __nullable)())block; - (void)methodWithBlock:(nullable id __nonnull(^)(id __nullable params))block; // æ³¨æ„ä¸Šé¢çš„ nullable ç”¨äºä¿®é¥°æ–¹æ³•ä¼ å…¥çš„å‚æ•° Block å¯ä»¥ä¸ºç©ºï¼Œè€Œ __nonnull ç”¨äºä¿®é¥° Block è¿”å›å€¼ id ä¸èƒ½ä¸ºç©ºï¼› - (void)methodWithBlock:(id __nonnull(^ __nullable)(id __nullable params))block; - (void)methodWithBlock:(id _Nonnull (^ _Nullable)(id _Nullable params))block; // the method accepts a nullable block that returns a nonnull value // there are some more combinations here, you get the idea ä½¿ç”¨è§„èŒƒ åœ¨çœ‹äº†åŸç”Ÿ iOS SDK é‡Œ Foundation å’Œ UIKit çš„å¤´æ–‡ä»¶ä»¥åŠè‹¹æœçš„åšæ–‡ ã€ŠNullability and Objective-Cã€‹ ï¼Œæˆ‘ä»¬æ€»ç»“å¦‚ä¸‹ä½¿ç”¨è§„èŒƒï¼š å¯¹äºå±æ€§ã€æ–¹æ³•è¿”å›å€¼ã€æ–¹æ³•å‚æ•°çš„ä¿®é¥°ï¼Œä½¿ç”¨ï¼š nonnull/nullableï¼› å¯¹äº C å‡½æ•°çš„å‚æ•°ã€Blockçš„å‚æ•°ã€Blockè¿”å›å€¼çš„ä¿®é¥°ï¼Œä½¿ç”¨ï¼š _Nonnull/_Nullableï¼Œ å»ºè®®å¼ƒç”¨ __nonnull/__nullable ã€‚ Nonnull Audited Regions å¦‚æœéœ€è¦æ¯ä¸ªå±æ€§æˆ–æ¯ä¸ªæ–¹æ³•éƒ½å»æŒ‡å®š nonnull å’Œ nullable ï¼Œå°†æ˜¯ä¸€ä»¶éå¸¸ç¹ççš„äº‹ã€‚ è‹¹æœä¸ºäº†å‡è½»æˆ‘ä»¬çš„å·¥ä½œé‡ï¼Œä¸“é—¨æä¾›äº†ä¸¤ä¸ªå®ï¼š NS_ASSUME_NONNULL_BEGIN å’Œ NS_ASSUME_NONNULL_END ã€‚åœ¨è¿™ä¸¤ä¸ªå®ä¹‹é—´çš„ä»£ç ï¼Œæ‰€æœ‰ç®€å•æŒ‡é’ˆå¯¹è±¡éƒ½è¢«å‡å®šä¸º nonnull ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å»æŒ‡å®šé‚£äº› nullable æŒ‡é’ˆå¯¹è±¡å³å¯ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š NS_ASSUME_NONNULL_BEGIN @interface myClass() @property (nonatomic, copy)NSString *aString; - (id)methodWithString:(nullable NSString*)str; @end NS_ASSUME_NONNULL_END åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ aString å±æ€§é»˜è®¤æ˜¯ nonnull çš„ï¼Œ methodWithString:æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿæ˜¯ nonnull ï¼Œè€Œæ–¹æ³•çš„å‚æ•° str è¢«æ˜¾å¼æŒ‡å®šä¸º nullable ã€‚ ä¸è¿‡ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè‹¹æœè¿˜åˆ¶å®šäº†ä»¥ä¸‹å‡ æ¡è§„åˆ™ï¼š é€šè¿‡ typedef å®šä¹‰çš„ç±»å‹çš„ nullability ç‰¹æ€§é€šå¸¸ä¾èµ–äºä¸Šä¸‹æ–‡ï¼Œå³ä½¿æ˜¯åœ¨ Audited Regions ä¸­ï¼Œä¹Ÿä¸èƒ½å‡å®šå®ƒä¸º nonnullï¼› å¯¹äºå¤æ‚çš„æŒ‡é’ˆç±»å‹ï¼ˆå¦‚ id * ï¼‰å¿…é¡»æ˜¾å¼å»æŒ‡å®šæ˜¯ nonnull è¿˜æ˜¯ nullableã€‚ä¾‹å¦‚ï¼ŒæŒ‡å®šä¸€ä¸ªæŒ‡å‘ nullable å¯¹è±¡çš„ nonnull æŒ‡é’ˆï¼Œå¯ä»¥ä½¿ç”¨ __nullable id * __nonnull ï¼› æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ NSError ** é€šå¸¸æ˜¯è¢«å‡å®šä¸ºä¸€ä¸ªæŒ‡å‘ nullable NSError å¯¹è±¡çš„ nullable æŒ‡é’ˆ ç–‘é—® è™½ç„¶åœ¨ Xcode 7 é‡Œé¢ï¼Œè‹¹æœå»ºè®®æˆ‘ä»¬æ”¾å¼ƒä½¿ç”¨ __nonnull/__nullable ï¼Œæ”¹ç”¨ _Nonnull/_Nullable æ¥ä¿®é¥°å¯¹è±¡å¯å¦ä¸ºç©ºï¼Œä½†å³ä½¿æ˜¯åœ¨æœ€æ–° ios 9.3 SDK çš„ Foundation å’Œ UIKit çš„å¤´æ–‡ä»¶é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®˜æ–¹åŸç”Ÿç±»çš„æ–¹æ³•å‚æ•°ä»ç„¶åœ¨ç”¨ __nonnull/__nullable ä¿®é¥°ã€‚ å¦å¤–ä¸ºä»€ä¹ˆå·²ç»æœ‰äº† nonnull/nullable ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¢åŠ  _Nonnull/_Nullable ï¼Ÿè¿™åˆ°åº•æ˜¯å‡ºäºä»€ä¹ˆè€ƒè™‘ï¼Ÿè‹¹æœåœ¨å®ƒçš„åšæ–‡ ã€ŠNullability and Objective-Cã€‹ ä¸­ä¹Ÿæ²¡æœ‰å…·ä½“è§£é‡Šï¼Œäºæ˜¯ StackOverflow ä¸Šæœ‰ä¸ªå…³äºæ­¤é—®é¢˜çš„è®¨è®ºï¼š Difference between nullable, __nullable and _Nullable in Objective-C ã€‚ å‚è€ƒ nullableã€__nullableã€_Nullable ç©¶ç«Ÿæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿâ€”â€”bravegogo æ³¨æ„ï¼šä¸Šé¢çš„blogæ ‡å‡†è¯¥åšæ–‡æœªè½¬å¸–ï¼Œç„¶è€Œå¹¶æ²¡æœ‰æ ‡æ³¨åŸå¸–åœ°å€ï¼Œæ•…åªèƒ½åœ¨æ­¤æ”¾å‡ºè½¬å¸–åœ°å€ã€‚ ","link":"https://blog.rakuyoo.top/nullable-of-objc/"},{"title":"Objective-C ä¹‹ Block åŸºç¡€ç”¨æ³•","content":"è¿™ä¸¤å¤©æ”¹bugæ”¹çš„å¤ªå¿™äº†....å®é™…ä¸Šè¯¥æ•´ç†çš„çŸ¥è¯†ç‚¹æŒºå¤šçš„ï¼Œä»Šå¤©å°±å…ˆè¯´ä¸€ä¸‹ Block å§ã€‚ æœ¬ç¯‡æ–‡ç« ä¸­å¤§é‡å†…å®¹å‚è€ƒã€è½¬è½½è‡ªæ–‡ç« æœ«å°¾çš„å‚è€ƒ1ï¼Œæ„Ÿè°¢åŸä½œè€…çš„æ€»ç»“ä¸åˆ†äº«ã€‚åŸæ–‡ä¸­è¿˜æœ‰æ›´å¤šæ›´è¯¦ç»†çš„å†…å®¹ï¼Œæ¬¢è¿å¤§å®¶ç‚¹å‡»åŸæ–‡å­¦ä¹ æ›´å¤šå†…å®¹ã€‚ ä»€ä¹ˆæ˜¯Block è®©æˆ‘ä»¬å…ˆç®€å•çš„ä»‹ç»ä¸€ä¸‹Block ä»£ç å—Blockæ˜¯è‹¹æœåœ¨iOS4å¼€å§‹å¼•å…¥çš„å¯¹Cè¯­è¨€çš„æ‰©å±•,ç”¨æ¥å®ç°åŒ¿åå‡½æ•°çš„ç‰¹æ€§ï¼ŒBlockæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œå…¶å¯ä»¥æ­£å¸¸å®šä¹‰å˜é‡ã€ä½œä¸ºå‚æ•°ã€ä½œä¸ºè¿”å›å€¼ï¼Œç‰¹æ®Šåœ°ï¼ŒBlockè¿˜å¯ä»¥ä¿å­˜ä¸€æ®µä»£ç ï¼Œåœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨ï¼Œç›®å‰Blockå·²ç»å¹¿æ³›åº”ç”¨äºiOSå¼€å‘ä¸­ï¼Œå¸¸ç”¨äºGCDã€åŠ¨ç”»ã€æ’åºåŠå„ç±»å›è°ƒã€‚ ç»¼ä¸Šæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼š Blockæ˜¯ä¸€ç§æ•°æ®ç±»å‹ã€‚ Blockå¯ä»¥åšå˜é‡ï¼Œä¹Ÿå¯ä»¥åšå‚æ•°ï¼Œè¿˜å¯ä»¥åšä¸ºè¿”å›å€¼ï¼Œç”šè‡³ç”¨æ¥ä¿å­˜ä¸€æ®µä»£ç ã€‚ Blockå˜é‡ Blockçš„å£°æ˜ Blockçš„å£°æ˜æ ¼å¼ä¸ºï¼šè¿”å›å€¼(^Blockåç§°)(å‚æ•°åˆ—è¡¨)ï¼Œè®©æˆ‘ä»¬æ¥ä¸¾ä¸ªæ —å­: NSString *(^aBlock)(NSString *str, NSArray *arr); å¦‚ä¸Šæ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºNSStringï¼Œåç§°ä¸ºaBlockï¼Œæ‹¥æœ‰2ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºNSStringå’ŒNSArrayçš„ä¸€ä¸ªBlockä»£ç å—ã€‚ æ³¨æ„ï¼š å…¶ä¸­å½¢å‚çš„å½¢å‚åï¼Œå³æ —å­ä¸­çš„strå’Œarrå¯ä»¥çœç•¥ä¸è®°ã€‚ è¿™é‡Œçš„åç§°æˆ‘ä»¬ä¾¿å¯ä»¥å°†å®ƒæƒ³è±¡æˆå‡½æ•°åã€‚ ç»™Blockå˜é‡èµ‹å€¼ æˆ‘ä»¬å£°æ˜å®ŒBlockä¹‹åï¼Œå°±è¯¥ç»™å˜é‡èµ‹å€¼äº†ã€‚ è¿™ç§æƒ…å†µä¸‹çš„æ ¼å¼ä¸ºï¼šå˜é‡å = ^è¿”å›å€¼ç±»å‹(å‚æ•°ç±»å‹){å‡½æ•°ä½“}ã€‚ä¸¾ä¸ªæ —å­ï¼š aBlock = ^NSString *((NSString *str, NSArray *arr) { NSLog(@&quot;%@, %@&quot;, str, arr); return str; }; è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯æŠŠä¸€ä¸ªå‡½æ•°ä½“èµ‹å€¼ç»™äº†Blockå˜é‡ã€‚ä»è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥Blockçš„ä¸€ä¸ªé‡è¦ç”¨æ³•ï¼Œé‚£å°±æ˜¯ç”¨æ¥å­˜å‚¨å‡½æ•°ä½“ã€‚ æ³¨æ„ï¼š è¿™é‡Œçš„è¿”å›å€¼ç±»å‹å¯ä»¥ä¸ç”¨å£°æ˜ï¼Œç›´æ¥çœç•¥ã€‚å› ä¸ºç¼–è¯‘å™¨å¯ä»¥ä»å­˜å‚¨ä»£ç å—çš„å˜é‡ä¸­ç¡®å®šè¿”å›å€¼çš„ç±»å‹ã€‚ å¦‚æœæ²¡æœ‰å‚æ•°åˆ—è¡¨ï¼Œåœ¨èµ‹å€¼çš„æ—¶å€™å¯ä»¥çœç•¥ã€‚ å£°æ˜çš„åŒæ—¶èµ‹å€¼ æŠŠä¸Šé¢ä¸¤ç‚¹ç»¼åˆèµ·æ¥å°±å°±å¯ä»¥äº†ï¼Œè¿™é‡Œç›´æ¥ç»™ä¸ªæ —å­å§ã€‚ NSString *(^aBlock)(NSString *, NSArray *) = ^(NSString *str, NSArray *arr) { NSLog(@&quot;%@, %@&quot;, str, arr); return str; }; è°ƒç”¨Blockå˜é‡ Blockå˜é‡çš„è°ƒç”¨å®é™…ä¸Šå’ŒCè¯­è¨€å‡½æ•°çš„è°ƒç”¨éå¸¸æ¥è¿‘ã€‚ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œè¿™é‡Œçš„å‚æ•°str1å’Œarræˆ‘åªè¿›è¡Œäº†åˆå§‹åŒ–ï¼Œæ²¡æœ‰èµ‹å€¼ã€‚ NSString *str1 = [[NSString alloc] init]; NSArray *arr = [NSArray array]; NSString *str = aBlock(str1, arr); NSLog(@&quot;%@&quot;,aBlock(str1, arr)); æ˜¯ä¸æ˜¯å’ŒCè¯­è¨€å¾ˆåƒå‘¢ã€‚ ä½¿ç”¨typedefå®šä¹‰Blockç±»å‹ åœ¨å®é™…ä½¿ç”¨Blockçš„è¿‡ç¨‹ä¸­,æˆ‘ä»¬å¯èƒ½éœ€è¦é‡å¤åœ°å£°æ˜å¤šä¸ªç›¸åŒè¿”å›å€¼ç›¸åŒå‚æ•°åˆ—è¡¨çš„Blockå˜é‡,å¦‚æœæ€»æ˜¯é‡å¤åœ°ç¼–å†™ä¸€é•¿ä¸²ä»£ç æ¥å£°æ˜å˜é‡ä¼šéå¸¸ç¹ç,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨typedefæ¥å®šä¹‰Blockç±»å‹ã€‚ // å®šä¹‰ä¸€ç§æ— è¿”å›å€¼æ— å‚æ•°åˆ—è¡¨çš„Blockç±»å‹ typedef void(^SayHello)(); // æˆ‘ä»¬å¯ä»¥åƒOCä¸­å£°æ˜å˜é‡ä¸€æ ·ä½¿ç”¨Blockç±»å‹SayHelloæ¥å£°æ˜å˜é‡ SayHello hello = ^() { NSLog(@&quot;hello&quot;); }; // è°ƒç”¨åæ§åˆ¶å°è¾“å‡º&quot;hello&quot; hello(); æ³¨æ„ï¼Œåœ¨ä½¿ç”¨typedefçš„æ—¶å€™ï¼Œ(^)å†…çš„Blockåå·²ç»è¢«å½“åšäº†æ•´ä¸ªBlockç±»å‹çš„åç§°ï¼Œè€Œä¸å•å•æ˜¯ä¸€ä¸ªBlockçš„åç§°ã€‚ åœ¨å‡½æ•°å½¢å‚ä¸­ä½¿ç”¨Block å½¢å‚ä½¿ç”¨Blockæ—¶å‡½æ•°çš„å£°æ˜ Blockä½œä¸ºå‡½æ•°å½¢å‚æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç”¨æ³•ï¼Œ å¾ˆå¤šçŸ¥åçš„ç¬¬ä¸‰æ–¹åº“æˆ–è€…ç½‘ç»œè¯·æ±‚ä¸­éƒ½ä¼šåœ¨å‡½æ•°çš„å½¢å‚ä¸­ç”¨åˆ°Blockã€‚æˆ‘ä»¬è‡ªå·±å†™ä»£ç çš„æ—¶å€™ï¼Œå¶å°”ä¸ºäº†æ–¹ä¾¿é«˜æ•ˆï¼Œæˆ–è€…ä¸ºäº†å°è£…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Blockã€‚ å…¶æ ¼å¼ä¸ºï¼š-ï¼ˆè¿”å›å€¼ï¼‰å‡½æ•°åç§°ï¼šï¼ˆBlockè¿”å›ç±»å‹ï¼ˆ^ï¼‰ï¼ˆå‚æ•°åˆ—è¡¨ï¼‰ï¼‰å‡½æ•°å‚æ•°å æ³¨æ„ï¼š ä¸ºäº†çœ‹èµ·æ¥æ¸…æ™°ï¼Œåœ¨ä¸Šé¢çš„æ ¼å¼ä¸­ï¼Œæˆ‘ä½¿ç”¨çš„éƒ½æ˜¯ä¸­æ–‡æ ‡ç‚¹ï¼Œå®é™…ä½¿ç”¨ä¸­è‚¯å®šéƒ½è¦æ˜¯è‹±æ–‡æ ‡ç‚¹çš„ã€‚ åœ¨ä½œä¸ºå½¢å‚ä½¿ç”¨æ—¶ï¼Œå°†Blockå†™åœ¨å‡½æ•°å®šä¹‰/å£°æ˜çš„å½¢å‚ä½ç½®æ—¶ï¼ŒBlockæ²¡æœ‰Blockåç§°ã€‚ ä¸‹é¢æ˜¯æˆ‘è‡ªå·±çš„åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å®šä¹‰çš„ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä½¿ç”¨åˆ°äº†Blockä½œä¸ºå½¢å‚ã€‚åœ¨è¿™é‡Œå¤§å®¶ç†è§£è¿™ç§å£°æ˜çš„æ ¼å¼å³å¯ã€‚ - (void)autoresizingMaskOfChildView:(NSMutableArray&lt;NSNumber *&gt; *(^)())autoMaskArr { NSMutableArray *tempArrM = [NSMutableArray arrayWithArray:autoMaskArr()]; } ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªè¿”å›å€¼ä¸ºç©ºvoidï¼Œåç§°ä¸ºautoresizingMaskOfChildViewï¼Œæ‹¥æœ‰ä¸€ä¸ªBlockå‚æ•°çš„å‡½æ•°ã€‚ å…¶ä¸­Blockå‚æ•°æ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºå­˜å‚¨NSNumberçš„NSMutableArrayï¼Œæ²¡æœ‰å‚æ•°åˆ—è¡¨ã€‚ è°ƒç”¨å½¢å‚ä½¿ç”¨Blockçš„å‡½æ•° æ²¡æœ‰å‚æ•°çš„Blockå½¢å‚ ä¸Šé¢é‚£ä¸ªæ —å­ä¸­çš„å‡½æ•°ï¼Œå…¶è°ƒç”¨çš„æ—¶å€™ä¼šæ˜¯è¿™æ ·çš„ï¼š [self.view autoresizingMaskOfChildView:^NSMutableArray&lt;NSNumber *&gt; *{ &lt;#code#&gt; }]; æˆ‘ä»¬åœ¨&lt;#code#&gt;ä¸­è¾“å…¥è‡ªå·±çš„ä»£ç ï¼Œè¿™ä¸€éƒ¨åˆ†çš„ä»£ç ç›¸å½“äºæ˜¯èµ‹å€¼ç»™äº†Blockå½¢å‚ã€‚ æœ‰å‚æ•°çš„Blockå½¢å‚ æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ–¹æ³•ä¸­å®šä¹‰äº†ä¸€ä¸ªblockæ•°æ®ç±»å‹å‚æ•°ï¼ˆè¿”å›å€¼ä¸ºintç±»å‹çš„ï¼Œä¸”å¸¦æœ‰ä¸€ä¸ªintç±»å‹çš„å½¢å‚ï¼‰ - (void)calculate:(int (^)(int)) calculateBlock { //calculateBlockæ¥å—å¤–ç•Œä¼ å…¥çš„ä»£ç å—ï¼Œä¹Ÿå°±æ„å‘³ç€æ€ä¹ˆå»æ“ä½œæ˜¯ç”±å¤–ç•Œè°ƒç”¨è€…å†³å®šçš„ self.result = calculateBlock(_result);//å°†_resultçš„å€¼ä½œä¸ºå®å‚ä¼ å…¥ } å¤–éƒ¨æ§åˆ¶å™¨è°ƒç”¨æ—¶å¦‚ä¸‹æ‰€ç¤ºï¼š [manager calculate:^int(int i) { //å‚æ•°iè‡ªåŠ 1ï¼Œç„¶åè¿”å› i++; return i; }]; NSLog(@&quot;%d&quot;,manager.result); //è¾“å‡ºç»“æœä¸º1 é€šè¿‡æœ€åçš„NSLogè¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¤–ç•Œè°ƒç”¨Blockçš„æ—¶å€™ï¼Œå‚æ•°içš„å€¼è¢«ä¼ ç»™äº†å‡½æ•°å®šä¹‰æ—¶çš„å‚æ•°_resultã€‚ç›¸å½“äº_result = iã€‚ å³æ˜¯å¤–ç•Œæä¾›å€¼ï¼Œç„¶åèµ‹å€¼ç»™Blockå†…éƒ¨çš„å˜é‡ã€‚è€Œä¸æ˜¯ä»Blockä¸­å°†å€¼ä¼ ç»™å¤–ç•Œã€‚ æ³¨æ„ï¼šä¸Šé¢è¿™ç§å†™æ³•å®é™…ä¸Šæœ‰å¾ˆå¤§é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªå‡½æ•°å£°æ˜çš„æ—¶å€™ï¼Œæ²¡æœ‰è¯´è¿™ä¸ªblcokæ˜¯ä¸èƒ½ä¸ºç©ºçš„ï¼Œé‚£ä¹ˆå‡å¦‚å¤–ç•Œåœ¨è°ƒç”¨è¿™ä¸ªblockçš„æ—¶å€™ï¼Œå¦‚æœç»™blockå‚æ•°çš„ä½ç½®ä¼ çš„æ˜¯nilï¼Œè€Œå‡½æ•°å†…éƒ¨åˆç»™è¿™ä¸ªblockä¼ äº†å‚æ•°ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰äº§ç”ŸCrachã€‚ ä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š [manager calculate:nil]; calculate:å‡½æ•°å†…éƒ¨ä¸å˜ï¼Œä¾ç„¶æ˜¯è¿™æ ·ï¼š - (void)calculate:(int (^)(int)) calculateBlock { self.result = calculateBlock(_result); } è¿™æ ·å°±ä¼šå¯¼è‡´Crachï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨Blockä¹‹å‰è¦å¯¹Blockåšåˆ¤ç©ºå¤„ç†ã€‚ - (void)calculate:(int (^)(int)) calculateBlock { if (!calculateBlock) { self.result = calculateBlock(_result); } } ä½¿ç”¨typedefç®€åŒ–Block // 1.ä½¿ç”¨typedefå®šä¹‰Blockç±»å‹ typedef int(^MyBlock)(int, int); // 2.å®šä¹‰ä¸€ä¸ªå½¢å‚ä¸ºBlockçš„OCå‡½æ•° - (void)useBlockForOC:(MyBlock)aBlock { NSLog(@&quot;result = %d&quot;, aBlock(300,200)); } // 3.å£°æ˜å¹¶èµ‹å€¼å®šä¹‰ä¸€ä¸ªBlockå˜é‡ MyBlock addBlock = ^(int x, int y){ return x+y; }; // 4.ä»¥Blockä½œä¸ºå‡½æ•°å‚æ•°,æŠŠBlockåƒå¯¹è±¡ä¸€æ ·ä¼ é€’ [self useBlockForOC:addBlock]; // å°†ç¬¬3ç‚¹å’Œç¬¬4ç‚¹åˆå¹¶ä¸€èµ·,ä»¥å†…è”å®šä¹‰çš„Blockä½œä¸ºå‡½æ•°å‚æ•° [self useBlockForOC:^(int x, int y){ return x+y; }]; Objective-C ä¸­çš„blockå±æ€§ è¯´å®Œäº†å½¢å‚ä¸å˜é‡ï¼Œé‚£ä¹ˆåœ¨ Objective-C çš„å±æ€§ä¸­è¯¥å¦‚ä½•ä½¿ç”¨ block è¯­æ³•å‘¢ï¼Ÿ å®šä¹‰ block ç±»å‹ é¦–å…ˆæˆ‘ä»¬åº”è¯¥å®šä¹‰ä¸€ä¸ª block ç±»å‹ï¼š // åœ¨#import ä¸ @interface ä¹‹é—´å£°æ˜è¯¥ block ç±»å‹ typedef void(^ButtonEventsBlock)(UIButton *btn); è¿™æ ·æˆ‘ä»¬å°±å®šä¹‰äº†ä¸€ä¸ªè¿”å›å€¼ä¸ºç©ºï¼Œåç§°ä¸º ButtonEventsBlockï¼Œå¸¦æœ‰ä¸€ä¸ª UIButton ç±»å‹å‚æ•°çš„ block ç±»å‹äº†ã€‚ å£°æ˜ block å±æ€§ è¿™ä¸€æ­¥å¾ˆç®€å•ï¼Œå°±å¦‚åŒå£°æ˜å…¶ä»–å˜é‡ä¸€æ ·ï¼Œä½¿ç”¨ä¹‹å‰å®šä¹‰å¥½çš„ block ç±»å‹å£°æ˜ä¸€ä¸ªå˜é‡å³å¯ã€‚ @property (nonatomic, copy) ButtonEventsBlock buttonEventsBlock; å¯¹ block å±æ€§èµ‹å€¼ è¿™é‡Œæˆ‘å°†æ¼”ç¤ºä¸¤ç§æ–¹æ³•ï¼šæ‡’åŠ è½½ ä¸ Runtimeã€‚ æ‡’åŠ è½½ åœ¨ä»£ç ä¸­ä¸º block å±æ€§èµ‹å€¼å’Œä½¿ç”¨ æ‡’åŠ è½½ å¯¹ block èµ‹å€¼åœ¨è¯­æ³•å±‚é¢æ²¡æœ‰å¤ªå¤§çš„å·®å¼‚ï¼Œæ‰€ä»¥è¿™é‡Œå°±åªæ¼”ç¤ºæ‡’åŠ è½½äº†ã€‚ é‚£ä¹ˆè®©æˆ‘ä»¬ç›´æ¥ç ä»£ç å§ï¼š - (ButtonEventsBlock)buttonEventsBlock { if (!_buttonEventsBlock) { _buttonEventsBlock = ^(UIButton *btn) { // your code }; } return _buttonEventsBlock; } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¯­æ³•å±‚é¢ä¸Šï¼Œé™¤äº†ä¸º block èµ‹å€¼çš„é‚£éƒ¨åˆ†å¤–ï¼Œå…¶ä½™éƒ¨åˆ†ä¸ä¸€èˆ¬çš„æ‡’åŠ è½½å¹¶æ— å·®å¼‚ã€‚è€Œä¸º block èµ‹å€¼çš„é‚£éƒ¨åˆ†ä»£ç æˆ‘ä»¬ä¹‹å‰ä¹Ÿå·²ç»æåˆ°è¿‡äº†ã€‚ Runtime å¦‚æœæˆ‘ä»¬è¦åœ¨åˆ†ç±»ä¸­ä½¿ç”¨ block å±æ€§çš„è¯ï¼Œæˆ‘ä»¬å°±è¦å€Ÿä½ Runtime æ¥å®ç°äº†ã€‚å› ä¸º Category ä¸­å¹¶ä¸ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆæˆå‘˜å˜é‡ã€‚ é‚£ä¹ˆæˆ‘ä»¬ä»£ç é•¿ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ static void *buttonEventsBlockKey = &amp;buttonEventsBlockKey; - (ButtonEventsBlock)buttonEventsBlock { return objc_getAssociatedObject(self, &amp;buttonEventsBlockKey); } - (void)setMbc_buttonEventsBlock:(ButtonEventsBlock)buttonEventsBlock { objc_setAssociatedObject(self, &amp;buttonEventsBlockKey, buttonEventsBlockKey, OBJC_ASSOCIATION_COPY); } å“ˆï¼Œè¿™é‡Œåˆå’Œä¸€èˆ¬çš„åœ¨ Category ä¸­ä½¿ç”¨å±æ€§çš„è¯­æ³•æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«äº†ã€‚åªä¸è¿‡ï¼Œè¿™é‡Œæˆ‘ä»¬å°±æ²¡æœ‰åŠæ³•ä½¿ç”¨æ‡’åŠ è½½ä¸ºå…¶èµ‹å€¼äº†ï¼Œå¦‚æœéœ€è¦é»˜è®¤æ“ä½œçš„è¯ï¼Œæˆ‘ä»¬åªèƒ½åœ¨ä»£ç ä¸­å¯¹å…¶èµ‹å€¼äº†ã€‚ å‚è€ƒ ä¸€ç¯‡æ–‡ç« çœ‹æ‡‚iOSä»£ç å—Blockâ€”â€”èšŠé¦™é…± iOSå¼€å‘ï¼šBlockä½œä¸ºå‚æ•°ä½¿ç”¨ï¼ˆå¸¸è§äºå„æ¡†æ¶ï¼‰â€”â€”å¤é²é² ","link":"https://blog.rakuyoo.top/objc-block-basic-usage/"},{"title":"Objective-C ä¸­ id å’Œ instancetype çš„ä½¿ç”¨ä¸å¼‚åŒ","content":"ä»Šå¤©è®°å½•ä¸€ä¸‹åœ¨Objective-Cä¸­ï¼Œä¿ç•™å­—idå’Œinstancetypeå„è‡ªçš„ç”¨æ³•ï¼Œä»¥åŠå¼‚åŒã€‚ id ä»€ä¹ˆæ˜¯idç±»å‹ åœ¨æ¦‚å¿µä¸Šï¼Œidç±»ä¼¼äºJavaä¸­çš„Objectç±»ï¼Œå¯ä»¥è½¬æ¢ä¸ºä»»ä½•æ•°æ®ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œidç±»å‹çš„å˜é‡å¯ä»¥å­˜æ”¾ä»»ä½•æ•°æ®ç±»å‹çš„å¯¹è±¡ã€‚åœ¨å†…éƒ¨å¤„ç†ä¸Šï¼Œè¿™ç§ç±»å‹è¢«å®šä¹‰ä¸ºæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘è¿™ç§å¯¹è±¡çš„å®ä¾‹å˜é‡çš„æŒ‡é’ˆã€‚ ä¸‹é¢æ˜¯idç±»å‹åœ¨Objective-Cä¸­çš„å®šä¹‰: typedef struct objc_object { Class isa; } *id; ä»ä¸Šé¢çœ‹å‡ºï¼Œidæ˜¯æŒ‡å‘struct objc_objectçš„ä¸€ä¸ªæŒ‡é’ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œidæ˜¯ä¸€ä¸ªæŒ‡å‘ä»»ä½•ä¸€ä¸ªç»§æ‰¿äº†Objectï¼ˆæˆ–è€…NSObjectï¼‰ç±»çš„å¯¹è±¡ã€‚ idçš„ç”¨æ³• idæ˜¯ä¸€ä¸ªæŒ‡é’ˆ å› ä¸ºidç±»å‹æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨idç±»å‹çš„æ—¶å€™ä¸éœ€è¦æ·»åŠ ä»»ä½•çš„æ˜Ÿå·ï¼Œä¾‹å¦‚: id foo = nil; ä¸Šé¢çš„ä»£ç å£°æ˜äº†ä¸€ä¸ªidç±»å‹çš„æŒ‡é’ˆfooï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘NSObjectçš„ä»»æ„ä¸€ä¸ªå­ç±»ã€‚ è€Œä¸‹é¢çš„ä»£ç åˆ™å®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªæŒ‡é’ˆï¼Œè¢«æŒ‡å‘çš„è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘NSObjectçš„ä¸€ä¸ªå­ç±»ã€‚ id *foo = nil; å¯ä»¥æ¥æ”¶ä»»ä½•æ¶ˆæ¯ åœ¨ObjeciveCä¸­ï¼Œidæ˜¯å¯ä»¥æ¥æ”¶ä»»ä½•æ¶ˆæ¯çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªå˜é‡å£°æ˜ä¸ºidç±»å‹ï¼Œç”¨æ¥æ¥æ”¶å¤šç§ç±»å‹çš„æ•°æ®ã€‚ ä¾‹å¦‚NSArrayä¸­å³å¯ä»¥æ¥æ”¶NSStringï¼Œä¹Ÿå¯ä»¥æ˜¯NSObjectï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨idäº†ã€‚ å°ç»“ åœ¨æˆ‘çš„ç†è§£çœ‹æ¥ï¼Œidç±»å‹å°±æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„ç±»å‹ï¼Œå½“æˆ‘ä»¬æš‚æ—¶ä¸çŸ¥é“æ–¹æ³•çš„è¿”å›å€¼è¯¥æ˜¯ä»€ä¹ˆç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°è¯•å°†æ–¹æ³•å®šä¹‰ä¸ºidç±»å‹ï¼Œç­‰å¾…ç¡®å®šæ–¹æ³•è¿”å›å€¼åå†å›æ¥ä¿®æ”¹ï¼Œæˆ–è€…å°±ç›´æ¥å®šä¹‰ä¸ºidç±»å‹ç½¢äº†ã€‚ æˆ–è€…æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªidç±»å‹çš„å˜é‡ï¼Œç”¨å®ƒæ¥åšä¸­é—´å˜é‡ï¼Œç”¨æ¥æ¥æ”¶å¤šç§ç±»å‹çš„æ•°æ®ã€‚ å…³è”è¿”å›ç±»å‹ åœ¨ä»‹ç»instancetypeä¹‹å‰å…ˆè®²è§£ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯å…³è”è¿”å›ç±»å‹çš„æ–¹æ³•ã€‚ æ ¹æ®Cocoaçš„å‘½åè§„åˆ™ï¼Œæ»¡è¶³ä¸‹è¿°è§„åˆ™çš„æ–¹æ³•ï¼š ç±»æ–¹æ³•ä¸­ï¼Œä»¥allocæˆ–newå¼€å¤´ å®ä¾‹æ–¹æ³•ä¸­ï¼Œä»¥autoreleaseï¼Œinitï¼Œretainæˆ–selfå¼€å¤´ ä¼šè¿”å›ä¸€ä¸ªæ–¹æ³•æ‰€åœ¨ç±» ç±»å‹ çš„å˜é‡ï¼Œè¿™é‡Œæˆ‘ç”¨ç©ºæ ¼å’ŒåŠ ç²—æ–­å¥ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›æ–¹æ³•çš„è¿”å›å€¼çš„ç±»å‹ï¼Œæ˜¯è°ƒç”¨è¿™äº›æ–¹æ³•çš„é‚£ä¸ªç±»çš„ç±»å‹ã€‚NSArrayè°ƒç”¨çš„allocæ–¹æ³•ï¼Œå³[NSArray alloc]ã€‚é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯NSArrayç±»å‹çš„ã€‚åŒç†[[NSArray alloc] init]è¿”å›çš„ä¹Ÿæ˜¯NSArrayç±»å‹çš„å€¼ã€‚ é‚£ä¹ˆè¯´å›æ¥ï¼Œä»¥ä¸Šè¿™äº›çš„æ–¹æ³•å‘¢ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºå…³è”è¿”å›ç±»å‹çš„æ–¹æ³•ã€‚ instancetype ä»€ä¹ˆæ˜¯instancetypeç±»å‹ instancetypeæ˜¯ä» clang 3.5 å¼€å§‹æä¾›çš„ä¸€ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºæŸä¸ªæ–¹æ³•è¿”å›çš„æœªçŸ¥ç±»å‹çš„Objective-Cå¯¹è±¡ã€‚å•çœ‹è¿™ä¸ªå®šä¹‰ï¼Œæ„Ÿè§‰å’Œidè¿˜æ˜¯æŒºåƒçš„ã€‚ instancetypeçš„ä½œç”¨ å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ª: @interface UIView (TestView) + (id) testFounation; @end TestViewç±»æ˜¯UIViewç±»çš„åˆ†ç±»ï¼Œå½“æˆ‘ä»¬å¦‚ä¸‹è°ƒç”¨testFounationæ–¹æ³•æ—¶ [TestView testFounation]; å…¶è¿”å›å€¼çš„ç±»å‹å’Œæ–¹æ³•çš„å£°æ˜ç›¸åŒï¼Œæ˜¯idç±»å‹ã€‚ è€Œå¦‚æœæˆ‘ä»¬å¦‚ä¸‹ä½¿ç”¨instancetypeå£°æ˜testFounationçš„è¯ @interface UIView (TestView) + (instancetype) testFounation; @end å½“æˆ‘ä»¬å†æ¬¡è°ƒç”¨testFounationæ–¹æ³•: [TestView testFounation]; å…¶è¿”å›å€¼çš„ç±»å‹ä¼šæ˜¯TestViewç±»å‹ã€‚ å°ç»“ ç»¼ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œinstancetypeçš„ä½œç”¨å®é™…ä¸Šå°±æ˜¯ä½¿éå…³è”è¿”å›ç±»å‹çš„æ–¹æ³•è¿”å›æ‰€åœ¨ç±»çš„ç±»å‹ã€‚ é€šä¿—çš„è®²ï¼Œå°±æ˜¯å½“æˆ‘ä»¬éœ€è¦æ–¹æ³•çš„è¿”å›ç±»å‹ä¸æ˜¯æœªçŸ¥çš„idç±»å‹ï¼Œè€Œæ˜¯å…·ä½“çš„ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„ç±»çš„ç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨instancetypeç±»å‹ã€‚ å†å…·ä½“ä¸€äº›ï¼Œå½“æˆ‘ä»¬è‡ªå®šä¹‰initæ–¹æ³•çš„æ—¶å€™ï¼Œå…¶è¿”å›å€¼å°±æ˜¯instancetypeç±»å‹ã€‚ idå’Œinstancetypeçš„å¼‚åŒ æ€»ç»“ä¸‹æ¥ï¼Œidå’Œinstancetypeçš„å¼‚åŒä¸€å…±æœ‰ä»¥ä¸‹å‡ ç‚¹: ç›¸åŒä¹‹å¤„ å…¶éƒ½å¯ä»¥ä½œä¸ºæ–¹æ³•çš„è¿”å›ç±»å‹ã€‚ ä¸åŒä¹‹å¤„ instancetypeå¯ä»¥è¿”å›å’Œæ–¹æ³•æ‰€åœ¨ç±»ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œidåªèƒ½è¿”å›æœªçŸ¥ç±»å‹çš„å¯¹è±¡ã€‚ instancetypeåªèƒ½ä½œä¸ºè¿”å›å€¼ï¼Œä¸èƒ½åƒidé‚£æ ·ä½œä¸ºå‚æ•°ã€‚instancetypeåªé€‚ç”¨äºåˆå§‹åŒ–æ–¹æ³•å’Œä¾¿åˆ©æ„é€ å™¨çš„è¿”å›å€¼ç±»å‹ã€‚ åœ¨ä¸åŒçš„å†…å­˜ç®¡ç†æœºåˆ¶ä¸­: åœ¨ARC(Auto Reference Count)ç¯å¢ƒä¸‹:instancetypeç”¨æ¥åœ¨ç¼–è¯‘æœŸç¡®å®šå®ä¾‹çš„ç±»å‹,è€Œä½¿ç”¨idçš„è¯,ç¼–è¯‘å™¨ä¸æ£€æŸ¥ç±»å‹, è¿è¡Œæ—¶æ£€æŸ¥ç±»å‹ã€‚ åœ¨MRC(Manual Reference Count)ç¯å¢ƒä¸‹:instancetypeå’Œidä¸€æ ·,ä¸åšå…·ä½“ç±»å‹æ£€æŸ¥ã€‚ å…³äºç¬¬ä¸‰ç‚¹ï¼Œå› ä¸ºæˆ‘ç°åœ¨è¿˜æ²¡æœ‰å…·ä½“å­¦ä¹ åˆ°å†…å­˜ç®¡ç†ç›¸å…³çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒä¸‹æ–¹å‚è€ƒä¸­ä¸‰æœ¨æˆæ£®çš„æ–‡ç« ï¼Œæœ‰ä¸¾ä¾‹è¯´æ˜è¯¥ç‚¹ã€‚ å‚è€ƒ Objective-Cä¸­çš„idç±»å‹â€”â€”Kilnn ç†è§£Objective C ä¸­idâ€”â€”åšä¸ªä¸å–„çš„äºº OCä¸­instancetypeä¸idçš„åŒºåˆ«â€”â€”ä¸‰æœ¨æˆæ£® Objective-Cä¸­çš„instancetypeå’ŒidåŒºåˆ«â€”â€”kuizhang1 ","link":"https://blog.rakuyoo.top/use-of-id-and-instancetype/"},{"title":"Cè¯­è¨€çš„å˜é‡ç±»å‹","content":"cè¯­è¨€å¤ä¹ ä¹‹è·¯ï¼Œä¹‹ä¸€ å˜é‡ç±»å‹ å˜é‡çš„å­˜å‚¨ç±»å‹ Cè¯­è¨€æ ¹æ®å˜é‡çš„å­˜å‚¨ç±»å‹çš„ä¸åŒï¼Œå¯ä»¥æŠŠå˜é‡åˆ†ä¸º:è‡ªåŠ¨å˜é‡ã€é™æ€å˜é‡ã€å¯„å­˜å™¨å˜é‡ã€‚ è‡ªåŠ¨å˜é‡ å®šä¹‰ï¼šè‡ªåŠ¨å˜é‡æ˜¯å­˜å‚¨åœ¨å †æ ˆä¸­çš„ã€‚ æ‰€æœ‰å±€éƒ¨å˜é‡é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯è‡ªåŠ¨å˜é‡ã€‚ å£°æ˜å‘¨æœŸï¼šè‡ªåŠ¨å˜é‡éšæ‰€åœ¨ä»£ç å—è¢«æ‰§è¡Œè€Œåˆ›å»ºï¼Œéšæ‰€åœ¨ä»£ç å—æ‰§è¡Œç»“æŸè€Œé”€æ¯ã€‚å¦‚æœå‡½æ•°è¢«é‡å¤è°ƒç”¨ï¼Œè‡ªåŠ¨å˜é‡ä¼šè¢«é‡å¤åˆ›å»ºã€é”€æ¯ã€‚ é™æ€å˜é‡ å®šä¹‰ï¼šé™æ€å˜é‡å­˜å‚¨äºé™æ€å†…å­˜ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸å±äºå †æ ˆã€‚ å“ªäº›æ˜¯é™æ€å˜é‡: æ‰€æœ‰çš„å…¨å±€å˜é‡éƒ½æ˜¯é™æ€å˜é‡ã€‚ è¢«å…³é”®å­—staticä¿®é¥°çš„å±€éƒ¨å˜é‡ä¹Ÿæ˜¯é™æ€å˜é‡ã€‚ å£°æ˜å‘¨æœŸ:é™æ€å˜é‡åœ¨ç¨‹åºè¿è¡Œä¹‹å‰è¢«åˆ›å»ºï¼Œå§‹ç»ˆå­˜åœ¨ã€‚ å¯„å­˜å™¨å˜é‡ å®šä¹‰:å­˜å‚¨åœ¨ç¡¬ä»¶å¯„å­˜å™¨ä¸­çš„å˜é‡ï¼Œç§°ä¸ºå¯„å­˜å™¨å˜é‡ã€‚ å“ªäº›å˜é‡æ˜¯å¯„å­˜å™¨å˜é‡: è¢«å…³é”®å­—registerä¿®é¥°çš„è‡ªåŠ¨å˜é‡éƒ½æ˜¯å¯„å­˜å™¨å˜é‡ã€‚ åªæœ‰è‡ªåŠ¨å˜é‡æ‰å¯ä»¥æ˜¯å¯„å­˜å™¨å˜é‡ï¼Œé™æ€å˜é‡(å…¨å±€å˜é‡)ä¸è¡Œã€‚ å¯„å­˜å™¨å˜é‡åªé™äºintã€charå’ŒæŒ‡é’ˆç±»å‹ä½¿ç”¨ã€‚ ç”Ÿå‘½å‘¨æœŸ:è°ƒç”¨è¯¥å‡½æ•°æ—¶å ç”¨å¯„å­˜å™¨ä¸­å­˜æ”¾çš„å€¼ï¼Œå½“å‡½æ•°ç»“æŸæ—¶é‡Šæ”¾å¯„å­˜å™¨ï¼Œå˜é‡æ¶ˆå¤±ã€‚ ä½¿ç”¨æ³¨æ„: ä¸èƒ½è¿‡å¤šä½¿ç”¨ã€‚å¦‚æœå¯„å­˜å™¨ä½¿ç”¨é¥±å’Œæ—¶ï¼Œç¨‹åºå°†å¯„å­˜å™¨å˜é‡è‡ªåŠ¨è½¬æ¢ä¸ºè‡ªåŠ¨å˜é‡å¤„ç†ã€‚ ä¸ºäº†æé«˜è¿ç®—é€Ÿåº¦ï¼Œä¸€èˆ¬ä¼šå°†ä¸€äº›é¢‘ç¹ä½¿ç”¨çš„è‡ªåŠ¨å˜é‡å®šä¹‰ä¸ºå¯„å­˜å™¨å˜é‡ï¼Œè¿™æ ·ç¨‹åºå°½å¯èƒ½åœ°ä¸ºå®ƒåˆ†é…å¯„å­˜å™¨å­˜æ”¾ï¼Œè€Œä¸ç”¨å†…å­˜ã€‚ register int a; // aå°±æ˜¯ä¸€ä¸ªå¯„å­˜å™¨å˜é‡ å‚è€ƒ ã€Cè¯­è¨€ã€‘18-å˜é‡ç±»å‹â€”â€”Mäº†ä¸ªJ ","link":"https://blog.rakuyoo.top/variable-types-in-c/"},{"title":"Git åŸºæœ¬æ“ä½œæ€»ç»“","content":"æ€»ç»“ä¸€ä¸‹ Mac ä¸‹ Git çš„ä¸€äº›åŸºæœ¬æ“ä½œã€‚ æœ¬æ–‡å…¶å®æ˜¯æŠŠä¹‹å‰ç»™å¤§ä¸€å­¦ç”Ÿè®² Git æ—¶å¤‡è¯¾çš„ç¨¿å­æ‹¿è¿‡æ¥ï¼Œæ•´ç†ä¿®æ”¹ï¼ŒäºŒæ¬¡åŠ å·¥åçš„äº§ç‰©ã€‚ æ–‡ç« é£æ ¼åå‘äºâ€œå¤‡å¿˜å½•â€ï¼Œè€Œä¸æ˜¯â€œæ•™ç¨‹â€ã€‚éƒ¨åˆ†åœ°æ–¹è¯´çš„ä¸å¤Ÿæ¸…æ™°è¿˜è¯·è¯»è€…è§è°…ã€‚ è‡³äºGitçš„åˆå­¦è€…å¯ä»¥æ‹‰åˆ°æ–‡ç« æœ€ä¸‹é¢ï¼Œåˆ°å»–é›ªå³°å¤§ç¥çš„blogå»å­¦ä¹ ã€‚ æ¦‚è§ˆ é¦–å…ˆæ”¾ä¸€ä¸ªåæ–‡æ¶‰åŠåˆ°çš„å‘½ä»¤çš„æ€»ç»“ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾ã€‚ æŒ‡ä»¤ ä½œç”¨ ssh-keygen -t rsa -C &quot;your-email@emial.com&quot; æ–°å»º SSH ssh -T git@&lt;git url&gt; æ£€æŸ¥æœ¬åœ°å’Œè¿œç«¯çš„ SSH è¿é€šæ€§ git add xx.txt æ·»åŠ æŸä¸€æ–‡ä»¶åˆ°ç¼“å­˜åŒº git add . æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°ç¼“å­˜åŒº git commit -m&quot;æ³¨é‡Šä¿¡æ¯&quot; æäº¤ä¿®æ”¹åˆ°å·¥ä½œåŒº git status æŸ¥çœ‹Gitä»“åº“çŠ¶æ€ git diff æŸ¥çœ‹æ–‡ä»¶ä¸ä¹‹å‰æœ‰ä½•ä¸åŒ git reset --hard HEAD^ è¿”å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ git reset --hard HEAD~10 å‘å‰å›æ»š10ä¸ªç‰ˆæœ¬ git reset --hard commit IDå€¼ å›æ»šåˆ°æŸä¸ªå…·ä½“çš„ç‰ˆæœ¬ git log --pretty=oneline è¾“å‡ºcommitæ—¥å¿—ï¼ŒåŒ…å«ä½œè€…ï¼Œæ—¥æœŸï¼Œæäº¤è¯´æ˜ï¼Œæäº¤ID git reflog è¾“å‡ºæ‰€æœ‰çš„æ“ä½œä¿¡æ¯ã€‚æ–¹ä¾¿æˆ‘ä»¬åœ¨æ¸…å±æˆ–é€€å‡ºç»ˆç«¯åæŸ¥è¯¢commit IDå€¼ git checkout -- file æ’¤é”€å·¥ä½œåŒºä¿®æ”¹(addä¹‹å‰) git reset HEAD file æ’¤é”€æš‚å­˜åŒºä¿®æ”¹(commitä¹‹å‰) rm file åˆ é™¤æœ¬åœ°æ–‡ä»¶ git rm file åˆ é™¤gitä»“åº“ä¸­çš„æ–‡ä»¶ git branch æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨ï¼Œç»¿è‰²ä¸ºå½“å‰åˆ†æ”¯ git branch åˆ†æ”¯å åˆ›å»ºåˆ†æ”¯ git checkout åˆ†æ”¯å åˆ‡æ¢åˆ†æ”¯ git checkout -b åˆ†æ”¯å åˆ‡æ¢åˆ†æ”¯ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒ git log --graph --pretty=oneline --abbrev-commit è¾“å‡ºå¸¦åˆ†æ”¯ä¿¡æ¯çš„logåˆ—è¡¨ git merge ç›®æ ‡åˆ†æ”¯å åˆå¹¶åˆ†æ”¯ git branch -d åˆ†æ”¯å åˆ é™¤åˆ†æ”¯ SSH é¦–å…ˆæ˜¯ SSHï¼Œå»ºè®®é€šè¿‡ SSH è€Œä¸æ˜¯ https å…‹éš†é¡¹ç›®ï¼Œæœ‰ä¸€äº›å…¬å¸ç”šè‡³å¯èƒ½ä¼šè®¾ç½®åªå…è®¸é€šè¿‡ SSH è¿›è¡Œå…‹éš†ã€‚ æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨é…ç½® SSH æœ¬åœ°ç›®å½•ä¸º ~/.sshï¼Œå¯ä»¥åœ¨ Finder æˆ–ç»ˆç«¯ä¸­è¿›åˆ°è¯¥æ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ id_rsa å’Œ id_rsa.pub æ–‡ä»¶ï¼Œæ¥åˆ¤æ–­æ˜¯å¦å·²ç»åˆ›å»ºäº† SSH é…ç½®ã€‚å¦‚æœæ‚¨ä¹‹å‰æ²¡æœ‰é…ç½®è¿‡ SSHï¼Œé‚£ä¹ˆå¯èƒ½è¿è¿™ä¸ªæ–‡ä»¶å¤¹éƒ½ä¸å­˜åœ¨ã€‚ æ–°å»º SSH å¦‚æœæ²¡æœ‰ï¼Œé‚£å°±éœ€è¦æ–°å»ºã€‚å‘½ä»¤å¦‚ä¸‹ï¼š $ ssh-keygen -t rsa -C &quot;your-email@emial.com&quot; è¾“å…¥å®Œè¿™æ¡å‘½ä»¤ä¹‹åï¼Œæˆ‘ä»¬è¿ç€æ•²ä¸‰ä¸ªå›è½¦ï¼Œä¸ç®¡å®ƒæ˜¾ç¤ºçš„ä»€ä¹ˆï¼Œä¸€ç›´æ•²å›è½¦ã€‚ç›´åˆ°ä¸‹é¢å‡ºç°ä¸€ä¸ªå›¾å½¢ã€‚ ä¹‹åå°±å¯ä»¥åˆ° ~/.ssh æ–‡ä»¶å¤¹ä¸‹æŸ¥çœ‹æ˜¯å¦å¤šå‡ºäº† id_rsa å’Œ id_rsa.pub æ–‡ä»¶ã€‚ æ·»åŠ åˆ°è¿œç«¯ Git å¹³å° ä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡ cat å‘½ä»¤ï¼Œæˆ–è€…ç›´æ¥æ‰“å¼€ id_rsa.pub æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„å†…å®¹å¤åˆ¶åˆ° Git å¹³å°çš„ SSH é…ç½®ä¸­å³å¯ã€‚ æ£€æŸ¥è¿é€šæ€§ æ·»åŠ å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥æœ¬åœ°å’Œè¿œç«¯ Git çš„ SSH è¿é€šæ€§ã€‚ $ ssh -T git@&lt;git url&gt; æ•²å›è½¦åï¼Œå¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡è¿æ¥ï¼Œä¼šè¯¢é—®ä½ yes or noï¼Œè¾“å…¥yesï¼Œç„¶åè¾“å…¥ Git çš„å¯†ç ã€‚å¦‚æœä¸€åˆ‡éƒ½æ²¡é—®é¢˜ï¼Œä¼šè¿”å›æ¬¢è¿ä¿¡æ¯ã€‚ Git é…ç½® é…ç½®å¥½ SSH ä¹‹åï¼Œå°±å¯ä»¥å›è¿‡å¤´æ¥é…ç½® Gitã€‚ Mac å¹³å°åœ¨å®‰è£…äº† Xcode åè‡ªå¸¦ Git æœåŠ¡ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥ä¸‹åˆ—å‘½ä»¤è¿›è¡Œ Git é…ç½®ï¼š $ git config --global user.name &quot;Your Name&quot; $ git config --global user.email &quot;email@example.com&quot; æ–°å»º Git é¡¹ç›®ä¸è¿œç«¯å…‹éš† ä¸€èˆ¬å¾ˆå°‘æœ‰åªåœ¨æœ¬åœ°ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„åœºæ™¯ï¼ŒåŸºæœ¬éƒ½ä¼šå’Œè¿œç«¯ Git ç»“åˆä¸€èµ·ä½¿ç”¨ã€‚ é‚£ä¹ˆæˆ‘å»ºè®®çš„æµç¨‹æ˜¯ï¼š ç°åœ¨è¿œç«¯å»ºç«‹ç©ºé¡¹ç›® å°†è¿œç«¯é¡¹ç›®å…‹éš†åˆ°æœ¬åœ° åœ¨å…‹éš†çš„æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºé¡¹ç›®è¿›è¡Œå¼€å‘ æœ‰çš„äººä¹ æƒ¯æœ¬åœ°æœ‰é¡¹ç›®ä¹‹åï¼Œå†å’Œè¿œç«¯é¡¹ç›®è¿›è¡Œå…³è”ã€‚è¿™é‡Œä¸ä»‹ç»è¯¥ç§æ–¹æ³•ã€‚ å¦‚æœä½ æœ¬åœ°å·²ç»æœ‰ä»£ç ï¼š æ²¡æœ‰é›†æˆ Git çš„æƒ…å†µä¸‹ï¼Œåœ¨è¿œç«¯ç©ºé¡¹ç›®å…‹éš†åˆ°æœ¬åœ°åï¼Œç›´æ¥å°†æœ¬åœ°å·²æœ‰çš„ä»£ç ç§»åŠ¨åˆ°è¯¥ç©ºé¡¹ç›®ä¸­å³å¯ã€‚ å¦‚æœå·²ç»é›†æˆäº† Gitï¼Œåˆ™å¯ä»¥ä¿®æ”¹é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„ .git/config æ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­çš„ remote é‡Œçš„ url é¡¹æ”¹ä¸ºè¿œç«¯ url å³å¯ã€‚è¯¥æ“ä½œä¹Ÿé€‚ç”¨äºæ›´æ¢é¡¹ç›®çš„è¿œç«¯åœ°å€ã€‚ å…‹éš†é¡¹ç›® å…‹éš†çš„å‘½ä»¤éå¸¸ç®€å•ï¼Œè€Œä¸”éå¸¸é¡¾åæ€ä¹‰ã€‚åœ¨æŸä¸€ç›®å½•ä¸‹æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ï¼Œå°±å¯ä»¥å°†è¿œç¨‹ä»“åº“é‡Œçš„å†…å®¹å…¨éƒ¨å…‹éš†åˆ°æœ¬åœ°è¯¥æ–‡ä»¶å¤¹ä¸‹ã€‚ $ git clone &lt;sshé“¾æ¥&gt; æ¨é€æ–‡ä»¶ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç å°†æœ¬åœ°é¡¹ç›® push æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚ $ git push origin master è¯¥å‘½ä»¤å®é™…ä¸Šæ˜¯æŠŠå½“å‰åˆ†æ”¯ master æ¨é€åˆ°è¿œç¨‹ã€‚ Git å¸¸ç”¨æ“ä½œ æ·»åŠ ï¼Œæäº¤æ–‡ä»¶ æ·»åŠ ã€æäº¤æ–‡ä»¶çš„æ­¥éª¤ä¸º: $ git add xx.txt $ git commit -m &quot;æ³¨é‡Šä¿¡æ¯&quot; addï¼Œæ·»åŠ çš„æ„æ€ï¼ŒæŠŠxx.txtæ·»åŠ åˆ°gitä»“åº“ã€‚ commitï¼Œæäº¤çš„æ„æ€ã€‚åé¢çš„-mçš„å†…å®¹ï¼Œæ˜¯ä¸€ä¸ªæè¿°æ€§å†…å®¹ï¼Œç”¨æ¥æè¿°æˆ‘ä»¬è¿™æ¬¡æäº¤çš„å¯¹æ–‡ä»¶åšäº†å“ªäº›ä¿®æ”¹çš„ã€‚ æ³¨æ„: å¯ä»¥ä½¿ç”¨ git add . å°†æ‰€æœ‰æ–‡ä»¶ä¸€å¹¶ addï¼Œé€‚åˆå¯¹å¤šä¸ªæ–‡ä»¶è¿›è¡Œä¿®æ”¹çš„æƒ…å†µã€‚ä¸€èˆ¬ç›´æ¥ç”¨è¿™ä¸ªå°±å¯ä»¥ã€‚ åœ¨æäº¤æ—¶ï¼Œ-m å¯ä»¥å…ˆè¾“å…¥ä¸€ä¸ªå·¦å•å¼•å·ï¼Œæ•²å›è½¦åå¯ä»¥è¾“å…¥å¤šè¡Œæ³¨é‡Šä¿¡æ¯ã€‚ç„¶åå†è¾“å…¥å³å•å¼•å·ï¼Œå®Œæˆæ³¨é‡Šä¿¡æ¯çš„è¾“å…¥ã€‚ è¿™ä¸ª add å‘½ä»¤å®é™…ä¸Šæ˜¯å¯ä»¥ä¸€å£æ°”æ·»åŠ å¤šä¸ªæ–‡ä»¶ï¼Œç„¶åä¸€å£æ°” commitã€‚ ä¿®æ”¹æ–‡ä»¶ æŒ‡ä»¤ ä½œç”¨ git status æŸ¥çœ‹Gitä»“åº“çŠ¶æ€ git diff æŸ¥çœ‹æ–‡ä»¶ä¸ä¹‹å‰æœ‰ä½•ä¸åŒ ç‰ˆæœ¬å›é€€ ä¸‹é¢çš„è¡¨æ ¼æ˜¯ç‰ˆæœ¬å›é€€çš„å…·ä½“æŒ‡ä»¤ã€‚ æŒ‡ä»¤ ä½œç”¨ git reset --hard HEAD^ è¿”å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ git reset --hard HEAD~10 å‘å‰å›æ»š10ä¸ªç‰ˆæœ¬ git reset --hard commit IDå€¼ å›æ»šåˆ°æŸä¸ªå…·ä½“çš„ç‰ˆæœ¬ ä¸‹é¢çš„è¡¨æ ¼å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›æˆ‘ä»¬æ‰€éœ€è¦çš„commit IDå€¼ã€‚ æŒ‡ä»¤ ä½œç”¨ git log --pretty=oneline è¾“å‡º commit æ—¥å¿—ï¼ŒåŒ…å«ä½œè€…ï¼Œæ—¥æœŸï¼Œæäº¤è¯´æ˜ï¼Œæäº¤ID git reflog è¾“å‡ºæ‰€æœ‰çš„æ“ä½œä¿¡æ¯ã€‚æ–¹ä¾¿æˆ‘ä»¬åœ¨æ¸…å±æˆ–é€€å‡ºç»ˆç«¯åæŸ¥è¯¢commit IDå€¼ æ’¤é”€ä¿®æ”¹ åœ¨æˆ‘ä»¬ push åˆ°è¿œç¨‹ä»“åº“ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹è¡¨çš„æŒ‡ä»¤æ¥æ’¤é”€æˆ‘ä»¬å¯¹ä»“åº“å†…æ–‡ä»¶åšå‡ºçš„ä¿®æ”¹ã€‚æ¢å¤åˆ°ä¸Šæ¬¡æäº¤çš„çŠ¶æ€ã€‚ æŒ‡ä»¤ ä½œç”¨ git checkout -- file æ’¤é”€å·¥ä½œåŒºä¿®æ”¹(addä¹‹å‰) git reset HEAD file æ’¤é”€æš‚å­˜åŒºä¿®æ”¹(commitä¹‹å‰) git reset --hard HEAD^ å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬(pushä¹‹å‰) åˆ é™¤æ–‡ä»¶/æ–‡ä»¶å¤¹ æŒ‡ä»¤ ä½œç”¨ rm file åˆ é™¤æœ¬åœ°æ–‡ä»¶ git rm file åˆ é™¤gitä»“åº“ä¸­çš„æ–‡ä»¶ git rm æ–‡ä»¶å¤¹å -r -f åˆ é™¤gitå’Œæœ¬åœ°ä¸­è¯¥æ–‡ä»¶å¤¹åŠå…¶ä¸‹æ–‡ä»¶ æ³¨æ„ åœ¨ git rm ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ’¤é”€ï¼Œå¯ä»¥æ”¾å¼ƒå·¥ä½œåŒºä¿®æ”¹ï¼Œgit checkout -- fileã€‚ åœ¨ git rm ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ’¤é”€ï¼Œç›´æ¥ git reset --hard HEAD^ å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬å°±å¯ä»¥äº† åœ¨è¿™é‡Œå¤šè¯´ä¸€å¥ï¼Œå¦‚æœæƒ³è¦åˆ é™¤Gitä»“åº“ï¼Œæˆ‘ä»¬ç”¨ä»£ç  rm -rf .git åˆ é™¤**.gitæ–‡ä»¶å¤¹**å°±å¯ä»¥äº†ã€‚ åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯ åˆ›å»ºåˆ†æ”¯ä¸åˆ‡æ¢åˆ†æ”¯ç›¸å…³çš„å‘½ä»¤å¦‚ä¸‹è¡¨æ‰€ç¤º: æŒ‡ä»¤ ä½œç”¨ git branch æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨ï¼Œç»¿è‰²ä¸ºå½“å‰åˆ†æ”¯ git branch åˆ†æ”¯å åˆ›å»ºåˆ†æ”¯ git checkout åˆ†æ”¯å åˆ‡æ¢åˆ†æ”¯ git checkout -b åˆ†æ”¯å åˆ‡æ¢åˆ†æ”¯ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒ git log --graph --pretty=oneline --abbrev-commit è¾“å‡ºå¸¦åˆ†æ”¯ä¿¡æ¯çš„logåˆ—è¡¨ åˆå¹¶åˆ†æ”¯ åœ¨æˆ‘ä»¬åˆ‡æ¢å›masteråˆ†æ”¯åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°±å¯ä»¥ç”¨å¿«é€Ÿåˆå¹¶çš„æ¨¡å¼å°†ç›®æ ‡åˆ†æ”¯åˆå¹¶åˆ°masteråˆ†æ”¯ä¸Šã€‚ $ git merge &lt;ç›®æ ‡åˆ†æ”¯å&gt; æ³¨æ„: å‡å¦‚æˆ‘ä»¬è¦å°†Aåˆ†æ”¯ï¼Œåˆå¹¶åˆ° master åˆ†æ”¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»å…ˆåˆ‡æ¢åˆ°masteråˆ†æ”¯ï¼Œç„¶åå†æ‰§è¡ŒæŠŠAåˆ†æ”¯åˆå¹¶åˆ° master åˆ†æ”¯çš„æ“ä½œã€‚ ä»‹ç»ä¸€ä¸ª git æŒ‡ä»¤ git ls-filesï¼Œè¯¥æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ git ä»“åº“ä¸‹çš„æ–‡ä»¶ã€‚å¦‚æœæƒ³éªŒè¯æ–°å»ºæ–‡ä»¶æ˜¯å¦åˆå¹¶æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚ åˆ é™¤åˆ†æ”¯ åˆ é™¤åˆ†æ”¯çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºã€‚æ³¨æ„ï¼Œè¿™æ¡å‘½ä»¤å¯ä¸æ˜¯ç±»ä¼¼ branch rm äº†ã€‚ $ git branch -d &lt;åˆ†æ”¯å&gt; åˆ†æ”¯ç®¡ç†å°ç»“ å…³äºåˆ†æ”¯ç®¡ç†çš„ä¸€èˆ¬è¿‡ç¨‹ï¼Œæˆ‘åšäº†ä¸€ä¸ª GIFï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: å¦‚å›¾GIFæ¼”ç¤ºäº†ä»åˆ›å»ºåˆ†æ”¯åˆ°åˆå¹¶åˆ†æ”¯çš„è¿‡ç¨‹ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªåœ†é¥¼ä»£è¡¨ç€ä¸€æ¬¡ commitã€‚ å‚è€ƒ å»–é›ªå³°å¤§ç¥çš„blog ","link":"https://blog.rakuyoo.top/git/"}]}